# Visualiza√ß√£o de dados {#cap6}

## Pr√©-requisitos do cap√≠tulo {-}

Pacotes que ser√£o utilizados nesse cap√≠tulo.

```{r}
## Pacotes
library(tidyverse)
library(palmerpenguins)
library(datasauRus)
library(gridExtra)

## Dados
penguins <- palmerpenguins::penguins

## Edi√ß√£o dos nomes das colunas para portugu√™s 
colnames(penguins) <- c("especies", "ilha", "comprimento_bico", 
                        "profundidade_bico", "comprimento_nadadeira", 
                        "massa_corporal", "sexo", "ano")
```

## Contextualiza√ß√£o

A visualiza√ß√£o de dados atrav√©s de gr√°ficos frequentemente √© a melhor forma de apresentar e interpretar informa√ß√µes ecol√≥gicas pois sintetiza os dados e facilita o entendimento de padr√µes. Geralmente, os gr√°ficos s√£o necess√°rios em quase todas as an√°lises estat√≠sticas, al√©m de enriquecer a argumenta√ß√£o e discuss√£o de hip√≥teses levantadas para publica√ß√µes, trabalhos de consultoria, TCCs, disserta√ß√µes, teses, entre outros.

Existem v√°rios tipos de gr√°ficos para representar os padr√µes em seus dados para diferentes finalidades. Esses diferentes tipos de gr√°ficos podem at√© mesmo ser usados para representar o mesmo tipo de dado. Nesta se√ß√£o, focaremos nos gr√°ficos mais simples para representar uma ou duas vari√°veis (i.e., gr√°ficos bidimensionais). Dependendo do tipo de vari√°vel (categ√≥rica ou cont√≠nua ‚Äì veja os tipos de vari√°veis na Figura \@ref(fig:fig-box) do Cap√≠tulo \@ref(cap2)), os gr√°ficos mais indicados para representar os dados mudam. De forma simplificada, os gr√°ficos s√£o representa√ß√µes dos nossos dados tabulares, de modo que os eixos representam as colunas e as fei√ß√µes (pontos, linhas, barras, caixas, etc.) representam as linhas.

Comumente nos gr√°ficos s√£o representados uma ou duas colunas, quando muito tr√™s, em gr√°ficos de tr√™s dimens√µes. Para mais colunas, partimos para dados agregados que podem ser vistos no Cap√≠tulo \@ref(cap9) de an√°lises multivariadas. Al√©m disso, a utiliza√ß√£o de mais de duas colunas pode estar relacionado com outras partes est√©ticas (e.g. `aes()` no pacote `ggplot2`) do gr√°fico como cor, forma ou tamanho de pontos, linhas ou outras fei√ß√µes.

Dessa forma, dedicamos esse cap√≠tulo inteiramente a apresentar os principais conceitos, como a gram√°tica de gr√°ficos, e uma apresenta√ß√£o geral que pode funcionar como "um guia de bolso" de gr√°ficos, uma vez que apresentamos os principais tipos de gr√°ficos para an√°lises ecol√≥gicas e estat√≠sticas. Al√©m disso, no √∫ltimo t√≥pico focamos na finaliza√ß√£o (ajustes finos) de gr√°ficos para publica√ß√µes. Este cap√≠tulo fornece a base conceitual necess√°ria para entender a visualiza√ß√£o gr√°fica de dados apresentada ao longo do livro.

Existe uma ampla gama de pacotes para fazer gr√°ficos no R, sendo esse um ponto muito forte dessa linguagem. Al√©m disso, essa grande disponibilidade de pacotes e fun√ß√µes permitem a visualiza√ß√£o dos mais diferentes tipos de dados, o que torna a linguagem R detentora de alta praticidade, uma vez que a maior parte dos pacotes possui uma sintaxe relativamente simples para a apresenta√ß√£o de gr√°ficos excelentes e de √≥tima qualidade. Mais adiante no Cap√≠tulo \@ref(cap15), ampliamos a discuss√£o da visualiza√ß√£o gr√°fica com ferramentas para visualiza√ß√£o de dados geoespaciais no R.

Este cap√≠tulo foi organizado em quatro partes: i) principais pacotes, ii) gram√°tica dos gr√°ficos, iii) tipos de gr√°ficos (um guia de bolso para visualiza√ß√£o de v√°rios gr√°ficos no R), e iv) edi√ß√£o de gr√°ficos com alta qualidade para publica√ß√£o. Apesar de apresentarmos diferentes pacotes com grande potencial para visualiza√ß√£o gr√°fica, focaremos neste cap√≠tulo no pacote `ggplot2`, talvez o pacote mais utilizado e com maior gama de possibilidades de cria√ß√£o de excelentes gr√°ficos.

::: {.alert .alert-info}
<strong> üìù Importante </strong>\
Neste cap√≠tulo, vamos ensinar gradativamente os comandos para construir gr√°ficos e como editar suas diferentes camadas. Por este motivo, o leitor n√£o ver√° uma padroniza√ß√£o nos temas dos gr√°ficos (fonte, cor, fundo do painel, etc.), uma vez que os gr√°ficos sem edi√ß√£o (padr√£o do ggplot2) possuem temas pr√©-definidos. Desse modo, para fazer um gr√°fico com maior qualidade (chamamos aqui de vers√£o "com ajustes finos") ser√° necess√°rio adicionar comandos extras que s√£o exatamente o foco deste cap√≠tulo. Em alguns comandos b√°sicos o leitor vai perceber que devido aos dados utilizados, os eixos v√£o possuir palavras em ingl√™s misturadas com as palavras em portugu√™s. Optamos por n√£o traduzir esses nomes para preservar o padr√£o que ser√° visualizado nos primeiros comandos que cada leitor ir√° fazer em seu computador.  
:::

Usaremos os dados dispon√≠veis no pacote `palmerpenguins` para exemplificar as fun√ß√µes do `ggplot2`, descrito no Cap√≠tulo \@ref(cap5).

## Principais pacotes

A seguir, apresentamos uma listagem dos principais pacotes para visualiza√ß√£o de dados no R, al√©m das principais fun√ß√µes desses pacotes.

-   [*graphics*](http://search.r-project.org/R/library/graphics/html/00Index.html): √© o pacote padr√£o (*default*) do R para produzir gr√°ficos simples, por√©m √∫til para visualiza√ß√µes r√°pidas de quase todos as classes de objetos. Possui fun√ß√µes como: `plot()`, `hist()`, `barplot()`, `boxplot()`, `abline()`, `points()`, `lines()` e `polygon()`. Destacamos que a fun√ß√£o `plot()` pode estar presente em diversos pacotes

-   [*ggplot2*](https://ggplot2.tidyverse.org/): pacote integrado ao *tidyverse* (Cap√≠tulo \@ref(cap5)), possui uma sintaxe pr√≥pria baseada na gram√°tica de gr√°ficos por camadas (*layers*), necessitando de fun√ß√µes espec√≠ficas para objetos de classes diferentes, demandando geralmente mais tempo para a constru√ß√£o dos c√≥digos. Possui fun√ß√µes como `ggplot()`, `aes()`, `geom_*()`, `facet_*()`, `stats_*()`, `coord_*()` e `theme_*()`, que s√£o conectadas pelo operador `+`

-   [*ggplot2 extentions*](https://exts.ggplot2.tidyverse.org/): conjunto de pacotes que adicionam diversas expans√µes ao pacote `ggplot2`. Exemplos: [*gganimate*](https://gganimate.com/), [*GGally*](https://ggobi.github.io/ggally/), [*patchwork*](https://patchwork.data-imaginist.com/) e [*esquisse*](https://dreamrs.github.io/esquisse/)

-   [*visdat*](https://docs.ropensci.org/visdat/): cria visualiza√ß√µes preliminares de dados explorat√≥rios de um conjunto de dados inteiro para identificar problemas ou recursos inesperados usando 'ggplot2'. Possui diversas fun√ß√µes espec√≠ficas: `vis_dat()` para vis√£o geral dos dados, `vis_miss()` para vis√£o de dados faltantes (`NA`) e `vis_compare()` para visualizar a diferen√ßa entre dados

-   [*ggpubr*](https://rpkgs.datanovia.com/ggpubr/): pacote que fornece fun√ß√µes simplificadas para criar e personalizar gr√°ficos para publica√ß√£o, baseados no `ggplot2`. Possui fun√ß√µes espec√≠ficas: `gghistogram()`, `ggdensity()`, `ggboxplot()`, `ggviolin()`, `ggbarplot()` e `ggscatter()`

-   [lattice](http://lattice.r-forge.r-project.org/): pacote para visualiza√ß√£o de dados inspirado nos gr√°ficos treli√ßa (do ingl√™s *Trellis*, geralmente para dados com muitas vari√°veis que geram uma matriz retangular de gr√°ficos). Tamb√©m possui fun√ß√µes espec√≠ficas: `xyplot()`, `histogram()`, `densityplot()`, `barchart()`, `bwplot()` e `dotplot()`. O pacote [latticeExtra](http://latticeextra.r-forge.r-project.org/) disponibiliza algumas possibilidades a mais para esse pacote

-   [plotly](https://plotly.com/r/): pacote para criar gr√°ficos interativos da web por meio da biblioteca gr√°fica de JavaScript de c√≥digo aberto [plotly.js](https://plotly.com/). Tamb√©m possui fun√ß√µes espec√≠ficas: `plot_ly()`, `add_histogram()`, `add_bars()`, `add_boxplot()`, `add_markers()`, `add_paths()`, `add_lines()` e `add_polygons()`

## Gr√°matica dos gr√°ficos

O livro *The Grammar of Graphics* [@wilkinson2005] utiliza uma analogia da lingu√≠stica para criar uma "gram√°tica" para a visualiza√ß√£o gr√°fica. Segundo ele, a l√≠ngua se torna expressiva pelo fato da gram√°tica criar um sistema de regras que tornam as declara√ß√µes com significado conhecido. De maneira semelhante, a ideia da *gram√°tica dos gr√°ficos* cria regras para representa√ß√£o gr√°fica dos dados a partir de atributos est√©ticos (do ingl√™s *aesthetic*) como cor, forma e tamanho que definem a geometria dos objetos, como pontos, linhas e barras [@wickham2016]. Al√©m disso, esta gram√°tica reconhece que tais elementos podem ser organizados em camadas, tal como constru√≠mos um mapa com diferentes camadas como eleva√ß√£o, hidrografia, rodovias, limites pol√≠ticos, etc.

Inspirado pela *gram√°tica dos gr√°ficos* proposta por Wilkinson & Wills [-@wilkinson2005], Hadley Wickham criou o pacote `ggplot2`, onde "gg" representa a contra√ß√£o de *Grammar of Graphics* [@wickham2016]. As camadas nesta gram√°tica (*layered-grammar*) s√£o organizadas da seguinte forma:

- **Camada 1** - dados `ggplot()`: s√£o as informa√ß√µes no formato `data.frame` que ser√£o usadas nas diferentes camadas nas fun√ß√µes `aes()`, `geom_*()`, `stat_*()`, `facet_*()` e `scale_*()`
- **Camada 2** - mapeamento `aes()`: atributos est√©ticos, determina que colunas do `data.frame` ser√£o usadas para as representa√ß√µes geom√©tricas, assim como tamanho, forma, cor, preenchimento e transpar√™ncia
- **Camada 3** - defini√ß√£o da geometria `geom_*()`: define o tipo de gr√°fico, como pontos, boxplots, violino, linhas, pol√≠gonos, entre outros
- **Camada 4** - transforma√ß√µes estat√≠sticas `stat_*()`: modificam, quando necess√°rio, os dados que ser√£o inclu√≠dos no gr√°fico, al√©m de produzir estat√≠sticas como regress√µes
- **Camada 5** - sistema de coordenadas `coords_*()`: descreve como as coordenadas dos dados s√£o mapeadas para o plano do gr√°fico
- **Camada 6** - facetas `facets_*()`: especifica como a visualiza√ß√£o dos elementos `aes()` s√£o divididos em diferentes "janelas gr√°ficas"
- **Camada 7** - escala `scale_*()`: permite o controle das caracter√≠sticas visuais (cor, forma e tamanho) dos elementos declarados em `aes()`
- **Camada 8** - temas `theme*()`: controla a apar√™ncia visual dos elementos do gr√°fico, como fontes, cores e legenda

Estruturalmente podemos observar a estrutura da Figura \@ref(fig:fig-camadas).

```{r fig-camadas, echo=FALSE, fig.cap="Esquema gr√°fico ilustrando as camadas que definem a strutura de organiza√ß√£o aditiva da gram√°tica dos gr√°ficos (ggplot2). No exemplo, a partir de um banco de dados, o mapeamento de quais colunas representam o eixo Y e X e de um atributo gr√°fico (pontos) √© poss√≠vel construir um gr√°fico de dispers√£o que ilustra a rela√ß√£o quantitativa entre a vari√°vel Y e X."}
knitr::include_graphics("img/cap06_fig01.png")
```

Em resumo, o mapeamento gr√°fico do ggplot2 segue a seguinte estrutura [@wickham2017]:

```r
ggplot(data = <DATA>) + 
    <GEOM_FUNCTION>(
        mapping = aes(<MAPPINGS>),
        stat = <STAT>, 
        position = <POSITION>
        ) +
    <COORDINATE_FUNCTION> +
    <FACET_FUNCTION> +
    <SCALE_FUNCTION> +
    <THEME_FUNCTION>
```

## Tipos de gr√°ficos

Nesta se√ß√£o, listamos os principais tipos de gr√°ficos e fazemos uma descri√ß√£o de quantas colunas e o tipo de vari√°vel que eles representam.

-   **Histograma (*histogram*)**: distribui√ß√£o de frequ√™ncia de uma coluna para dados cont√≠nuos (cores diferentes podem representar esp√©cies, popula√ß√µes ou grupos distintos)
-   **Gr√°fico de densidade (*density plot*)**: distribui√ß√£o da densidade de uma coluna para dados cont√≠nuos (assim como no histograma, cores diferentes podem ser utilizadas para representar esp√©cies, popula√ß√µes ou grupos distintos)
-   **Gr√°fico de dispers√£o (*scatter plot*) e gr√°fico de linha**: rela√ß√£o entre valores de duas colunas para dados cont√≠nuos (X e Y)
-   **Diagrama de pontos (*dot plot*)**: distribui√ß√£o da quantidade de valores agrupados de uma coluna para dados cont√≠nuos
-   **Gr√°fico de setores (*pie chart* e *donut chart*)**: representa√ß√£o da quantidade de valores de uma coluna para dados categ√≥ricos, geralmente em propor√ß√£o ou porcentagem
-   **Gr√°fico de barras (*bar plot*)**: representa√ß√£o da quantidade de valores de uma ou mais colunas para dados categ√≥ricos
-   **Gr√°fico de caixa (*box plot* e *violin plot*)**: distribui√ß√£o de valores cont√≠nuos de uma coluna (Y) para dois ou mais fatores categ√≥ricos de outra coluna (X) no formato de caixas e tamb√©m no formato de "violinos" (considerando a varia√ß√£o e distribui√ß√£o)
-   **Gr√°fico pareado (*pairs plot*)**: rela√ß√£o entre valores de duas colunas para dados cont√≠nuos (X e Y), para colunas par-a-par

Para facilitar a compreens√£o das regras da gram√°tica dos gr√°ficos, cada tipo de gr√°fico segue a mesma estrutura de organiza√ß√£o, que respeita as camadas de informa√ß√£o descritas na se√ß√£o anterior. Podemos perceber, portanto, que algumas camadas n√£o s√£o necess√°rias dependendo do tipo de gr√°fico ou do conjunto de dados que pretendemos analisar. 

Nos exemplos a seguir, a *vers√£o padr√£o* se refere √† representa√ß√£o determinada no *default* das fun√ß√µes do pacote `ggplot2`. Desse modo, somente informamos as vari√°veis que ser√£o utilizadas dentro de cada camada e a forma geom√©trica (i.e., tipo de gr√°fico) desejada. Por√©m, para cada tipo gr√°fico apresentamos fun√ß√µes e argumentos para ajustes finos e personalizados.

### Histograma (*histogram*)

O [histograma](https://www.data-to-viz.com/graph/histogram.html) √© um gr√°fico extremamente popular, sendo bastante √∫til para visualizar a distribui√ß√£o de vari√°veis cont√≠nuas. √â bem prov√°vel que voc√™ j√° tenha visto um histograma quando aprendeu pela primeira vez a famosa *distribui√ß√£o normal* (Figura \@ref(fig:fig-hist-norm)).

```{r fig-hist-norm, fig.cap="Histograma de uma distribui√ß√£o normal com 10000 observa√ß√µes."}
## Dados
dist_normal <- data.frame(x = rnorm(10000, mean = 0, sd = 1))

## Histograma de uma vari√°vel cont√≠nua
ggplot(data = dist_normal, aes(x = x)) +
    geom_histogram()
```

Neste histograma √© poss√≠vel entender que a maioria dos valores da vari√°vel `x` do objeto dist_normal est√£o pr√≥ximos ao valor da m√©dia, i.e., zero. Em Ecologia, os histogramas s√£o utilizados para visualizar, por exemplo, a varia√ß√£o morfol√≥gica entre esp√©cies (subesp√©cies, g√™nero, fam√≠lias, etc.), varia√ß√£o de par√¢metros populacionais entre diferentes esp√©cies ou dentro da mesma esp√©cie em diferentes localidades.

**Vers√£o padr√£o**

Vamos utilizar o conjunto de dados *palmerpenguins* para construir um histograma da distribui√ß√£o da vari√°vel *`comprimento_nadadeira`* com a fun√ß√£o `geom_hitogram()`. Esta fun√ß√£o utiliza uma vari√°vel cont√≠nua no eixo X e a frequ√™ncia de cada categoria de intervalo de valores no eixo Y. O gr√°fico a seguir representa a frequ√™ncia de uma vari√°vel (neste caso, a medida de todos os pinguins, independente da esp√©cie) (Figura \@ref(fig:fig-hist-flipper)).

```{r fig-hist-flipper, fig.cap="Histograma da vari√°vel `comprimento_nadadeira`."}
## Histograma da coluna flipper_length_mm
ggplot(data = penguins, aes(x = comprimento_nadadeira)) +
    geom_histogram()
```

**Definindo o n√∫mero de classes**

Vamos utilizar o argumento `bins` para definir em quantas classes a vari√°vel `x` deve ser dividida (Figura \@ref(fig:fig-hist-bins)).

```{r fig-hist-bins, fig.cap="Histograma da vari√°vel `comprimento_nadadeira` para diferentes classes de divis√£o."}
## Histograma com 10 classes
ggplot(data = penguins, aes(x = comprimento_nadadeira)) +
    geom_histogram(bins = 10) +
    labs(title = "10 classes")

## Histograma com 30 classes
ggplot(data = penguins, aes(x = comprimento_nadadeira)) +
    geom_histogram(bins = 30) +
    labs(title = "30 classes")
```

**Comparando m√∫ltiplas categorias**

Se quisermos comparar a distribui√ß√£o de uma vari√°vel cont√≠nua entre diferentes categorias, podemos utilizar o argumento `fill` para colorir o gr√°fico. No exemplo abaixo, utilizamos cores diferentes para ilustrar a distribui√ß√£o da vari√°vel X (`x = comprimento_nadadeira`) entre esp√©cies diferentes (`fill = especies`) (Figura \@ref(fig:fig-hist-cat)).

```{r fig-hist-cat, fig.cap="Histograma da vari√°vel `comprimento_nadadeira` para diferentes esp√©cies com e sem sobreposi√ß√£o."}
## Histograma com cores para diferentes categorias com sobreposi√ß√£o
ggplot(data = penguins, aes(x = comprimento_nadadeira, fill = especies)) +
    geom_histogram(alpha = .4) +
    labs(title = "Com sobreposi√ßao")

## Histograma com cores para diferentes categorias sem sobreposi√ß√£o
ggplot(data = penguins, aes(x = comprimento_nadadeira, fill = especies)) +
    geom_histogram(position = "dodge") +
    labs(title = "Sem sobreposi√ßao")
```

**Ajustes finos (vers√£o personalizada)**

```{r fig-hist-fino, fig.cap="Histograma da vari√°vel `comprimento_nadadeira` com ajustes finos."}
## Histograma exemplo
ggplot(data = penguins, aes(x = comprimento_nadadeira, fill = especies)) +
    geom_histogram(alpha = .4, position = "identity") +
    scale_fill_manual(values = c("darkorange", "darkorchid", "cyan4")) +
    theme_bw(base_size = 14) +
    labs(x = "Comprimento da nadadeira (mm)", 
         y = "Frequ√™ncia absoluta", fill = "Esp√©cies")
```

**Principais camadas utilizadas na fun√ß√£o `geom_histogram()`**

- `aes()`
- Eixo X (`x`): vari√°vel cont√≠nua (`comprimento_nadadeira`)
- Preenchimento (`fill`): vari√°vel categ√≥rica (`especies`) que define as cores tendo como base o n√∫mero de n√≠veis dentro desta categoria
- `geom()` 
- `geom_histogram()`: para que a vari√°vel cont√≠nua seja plotada como histograma
- Transpar√™ncia das linhas e preenchimentos (`alpha`): 0.5 (varia de 0, transpar√™ncia m√°xima, a 1, sem transpar√™ncia)
- Posi√ß√£o das barras: o argumento `position` define se as barras devem ser inseridas de maneira sobreposta (`position = "identity"`) ou n√£o (`position = "dodge"`)
- `scale()`
- `scale_fill_manual()`: para definir manualmente as cores
- `theme()`
- `theme_bw()`: para selecionar o tema com fundo branco 
- `labs()`: para personalizar os t√≠tulos dos eixos X e Y, e da legenda

### Gr√°fico de densidade (*density plot*)

Nesta se√ß√£o aprenderemos a criar um [gr√°fico de densidade](https://www.data-to-viz.com/graph/density.html) no R utilizando o `ggplot2`. Assim como o histograma, o **gr√°fico de densidade** √© utilizado para visualizar a distribui√ß√£o de uma vari√°vel cont√≠nua em intervalos. Esse gr√°fico √© uma varia√ß√£o do histograma que utiliza [Kernel Smoother](https://en.wikipedia.org/wiki/Kernel_smoother) e, al√©m de ser muito √∫til para visualizar distribui√ß√µes, pode ser usado para testar v√°rias hip√≥teses ecol√≥gicas, como descrito no Cap√≠tulo \@ref(cap14).

**Vers√£o padr√£o**

Vamos utilizar o conjunto de dados *palmerpenguins* para plotar a distribui√ß√£o da vari√°vel *`comprimento_nadadeira`* em um gr√°fico de densidade. Utilizaremos a fun√ß√£o `geom_density()` para plotar uma vari√°vel no eixo X (Figura \@ref(fig:fig-dens-flipper)).

```{r fig-dens-flipper, fig.cap="Gr√°fico de densidade da vari√°vel `comprimento_nadadeira`."}
## Gr√°fico de densidade
ggplot(data = penguins, aes(x = comprimento_nadadeira)) +
    geom_density()
```

Al√©m da vers√£o de densidade em linha, √© poss√≠vel utilizar o argumento `fill` para definir a cor de preenchimento do gr√°fico e o argumento `alpha` para definir a transpar√™ncia do preenchimento. Utilizamos ainda o argumento `color` para definir a cor da linha (Figura \@ref(fig:fig-dens-flipper-color)).

```{r fig-dens-flipper-color, fig.cap="Gr√°fico de densidade da vari√°vel `comprimento_nadadeira` com cor e preenchimento."}
## Argumento fill
ggplot(data = penguins, aes(x = comprimento_nadadeira)) +
    geom_density(fill = "cyan4")

## Argumento fill, color e alpha
ggplot(data = penguins, aes(x = comprimento_nadadeira)) +
    geom_density(fill = "cyan4", color = "black", alpha = .4)
```

**Comparando m√∫ltiplas categorias**

Em algumas situa√ß√µes queremos comparar a distribui√ß√£o de uma vari√°vel cont√≠nua entre diferentes categorias. Dessa forma, podemos utilizar o argumento `fill` para colorir o gr√°fico. No exemplo abaixo, utilizamos cores diferentes para ilustrar a distribui√ß√£o da vari√°vel x entre esp√©cies diferentes (`fill = especies`) (Figura \@ref(fig:fig-dens-flipper-cat)).

```{r fig-dens-flipper-cat, fig.cap="Gr√°fico de densidade da vari√°vel `comprimento_nadadeira` para diferentes esp√©cies com e sem transpar√™ncia."}
## O argumento fill preenche cada n√≠vel da coluna "especies" (sem transpar√™ncia: alpha = 1)
ggplot(data = penguins, aes(x = comprimento_nadadeira, fill = especies)) +
    geom_density() +
    scale_fill_manual(values = c("darkorange", "darkorchid", "cyan4")) +
    labs(title = "Sem transpar√™ncia")

## Gr√°fico de densidade com cores para diferentes categorias com sobreposi√ß√£o
ggplot(data = penguins, aes(x = comprimento_nadadeira, fill = especies)) +
    geom_density(alpha = .4) +
    scale_fill_manual(values = c("darkorange", "darkorchid", "cyan4")) +
    labs(title = "Com transpar√™ncia")
```

**Ajustes finos (vers√£o personalizada)**

```{r fig-dens-fino, fig.cap="Gr√°fico de densidade da vari√°vel `comprimento_nadadeira` com ajustes finos."}
## Gr√°fico de densidade exemplo
ggplot(data = penguins, aes(x = comprimento_nadadeira, fill = especies)) +
    geom_density(alpha = .4) +
    scale_fill_manual(values = c("darkorange", "darkorchid", "cyan4")) +
    scale_x_continuous(breaks = seq(from = 160, to = 240, by = 10), limits = c(160, 240)) +
    scale_y_continuous(breaks = seq(from = 0, to = .07, by = .01)) +
    theme_bw(base_size = 14) +
    labs(x = "Comprimento da nadadeira (mm)", y = "Densidade", fill = "Esp√©cies")
```

**Principais camadas utilizadas na fun√ß√£o `geom_density()`**

- `aes()`
- Eixo X (`x`): vari√°vel cont√≠nua (`comprimento_nadadeira`)
- Preenchimento (`fill`): vari√°vel categ√≥rica (`especies`) que define as cores tendo como base o n√∫mero de n√≠veis dentro desta categoria
- `geom()` 
- `geom_density()`: para que a vari√°vel cont√≠nua seja plotada como densidade
- Transpar√™ncia das linhas e preenchimentos (`alpha`): 0.5 (varia de 0, transpar√™ncia m√°xima, a 1, sem transpar√™ncia)
- `scale()`
- `scale_fill_manual()`: para definir manualmente as cores de prefer√™ncia do usu√°rio
- `scale_x_continuous()` e `scale_y_continuous()`: determinam os limites (valores m√≠nimos e m√°ximos) para os dois eixos e, al√©m disso, os intervalos entre os valores (`breaks`)
- `theme()` 
- `theme_bw()`: para selecionar o tema com fundo branco
- `labs()`: para personalizar os t√≠tulos dos eixos X e Y, e da legenda

### Diagrama de pontos (*dot plot*)

Uma alternativa ao histograma e ao gr√°fico de densidade √© o diagrama de pontos ([Dot plot](https://datavizproject.com/data-type/dot-plot/), apesar de ser relativamente menos usado em Ecologia.

**Vers√£o padr√£o**

Vamos utilizar o conjunto de dados palmerpenguins para visualizar a distribui√ß√£o da vari√°vel comprimento_nadadeira com o diagrama de pontos com a fun√ß√£o `geom_dotplot()` (Figura \@ref(fig:fig-dot-flipper)).

```{r fig-dot-flipper, fig.cap="Diagrama de pontos da vari√°vel `comprimento_nadadeira`."}
## Gr√°fico de pontos
ggplot(data = penguins, aes(x = comprimento_nadadeira)) +
    geom_dotplot(dotsize = .6)
```

**Comparando m√∫ltiplas categorias**

Assim como nas fun√ß√µes `geom_histogram()` e `geom_density()`, √© poss√≠vel comparar categorias na fun√ß√£o `geom_dotplot()` utilizando o argumento `fill`, bem como os argumentos `color`, `alpha` e `dotsize` (Figura \@ref(fig:fig-dot-flipper-cat)).

```{r fig-dot-flipper-cat, fig.cap="Diagrama de pontos da vari√°vel `comprimento_nadadeira` para diferentes esp√©cies com e sem transpar√™ncia."}
## O argumento fill preenche cada n√≠vel da coluna "especies" (sem transpar√™ncia: alpha = 1)
ggplot(data = penguins, aes(x = comprimento_nadadeira, fill = especies)) +
    geom_dotplot(dotsize = .9)

## Diagrama de pontos com cores para diferentes categorias com sobreposi√ß√£o
ggplot(data = penguins, aes(x = comprimento_nadadeira, fill = especies)) +
    geom_dotplot(dotsize = .7, color = "black", alpha = .4)
```

**Ajustes finos (vers√£o personalizada)**

```{r fig-dot-flipper-fino, fig.cap="Diagrama de pontos da vari√°vel `comprimento_nadadeira` com ajustes finos."}
## Diagrama de pontos exemplo
ggplot(data = penguins, aes(x = comprimento_nadadeira, fill = especies)) +
    geom_dotplot(color = "black", alpha = .7, position = "dodge") +
    scale_fill_manual(values = c("darkorange", "darkorchid", "cyan4")) +
    scale_x_continuous(breaks = seq(from = 170, to = 240, by = 10), limits = c(170, 240)) +
    scale_y_continuous(breaks = seq(from = 0, to = 1.4, by = .2), limits = c(0, 1.4)) +
    theme_bw(base_size = 14) +
    labs(x = "Comprimento da nadadeira (mm)", y = "Frequ√™ncia", fill = "Esp√©cies")
```

::: {.alert .alert-info}
<strong> üìù Importante </strong>\
Uma das limita√ß√µes do diagrama de pontos √© que a sobreposi√ß√£o dos pontos pode n√£o permitir a visualiza√ß√£o apropriada desses valores sobrepostos entre diferentes grupos quando comparados.
:::

**Principais camadas utilizadas na fun√ß√£o `geom_dotplot()`**

- `aes()`
- Eixo X (`x`): vari√°vel cont√≠nua (`comprimento_nadadeira`)
- Preenchimento (`fill`): vari√°vel categ√≥rica (`especies`) que define as cores tendo como base o n√∫mero de n√≠veis dentro desta categoria
- `geom()` 
- `geom_dotplot()`: para que a vari√°vel cont√≠nua seja plotada como diagrama de pontos
- Transpar√™ncia dos pontos (`alpha`): 0.5 (varia de 0, transpar√™ncia m√°xima, a 1, sem transpar√™ncia)
- Cor da borda do ponto (`color`): valor padr√£o (se n√£o for especificado) √© `black`
- Tamanho dos pontos (`dotsize`): valor padr√£o (se n√£o for especificado) √© 1
- Posi√ß√£o dos pontos: o argumento `position` define se os pontos devem ser inseridos de maneira sobreposta (`position = "identity"`) ou n√£o (`position = "dodge"`)
- `scale()`
- `scale_fill_manual()`: para definir manualmente as cores de prefer√™ncia do usu√°rio
- `scale_x_continuous()`: e `scale_y_continuous()` determinam os limites (valor m√≠nimo e m√°ximo) para os dois eixos e, al√©m disso, os intervalos entre os valores (`breaks`)
- `theme()` 
- `theme_bw()`: para selecionar o tema com fundo branco
- `labs()`: para personalizar os t√≠tulos dos eixos X e Y, e da legenda

### Gr√°fico de barras (*bar plot*)

O [gr√°fico de barras](https://www.data-to-viz.com/graph/barplot.html) √© um dos gr√°ficos mais usados em artigos e livros de Ecologia, uma vez que permite comparar valores absolutos ou m√©dios (combinados com alguma medida de varia√ß√£o, como desvio padr√£o) de uma vari√°vel cont√≠nua entre diferentes n√≠veis de uma vari√°vel categ√≥rica.

**Vers√£o padr√£o**

O gr√°fico de barras utiliza ret√¢ngulos para representar uma vari√°vel cont√≠nua ou a contagem de uma vari√°vel categ√≥rica, sendo que o comprimento dos ret√¢ngulos √© proporcional ao valor que ele representa. Por exemplo, √© poss√≠vel comparar qual a quantidade de indiv√≠duos medidos para cada esp√©cie de pinguim (Figura \@ref(fig:fig-bar-species)).

```{r fig-bar-species, fig.cap="Gr√°fico de barras indicando a quantidade de indiv√≠duos medidos de cada esp√©cie de pinguim."}
## N√∫mero de indiv√≠duos coletados
penguins_count <- penguins %>%
    dplyr::count(especies)
penguins_count

## Gr√°fico de barras
ggplot(data = penguins_count, aes(x = especies, y = n)) + 
    geom_bar(stat = "identity")
```

Al√©m disso, √© poss√≠vel alterar as cores (`color`) e o preenchimento (`fill`) das barras, bem como sua transpar√™ncia (`alpha`) e largura (`width`), como demonstrado nos pr√≥ximos quatro gr√°ficos (Figura \@ref(fig:fig-bar-species-color)).

```{r fig-bar-species-color, fig.cap="Gr√°ficos de barras indicando a quantidade de indiv√≠duos medidos de cada esp√©cie de pinguim, modificando cor, preenchimento, transpar√™ncia e largura das barras."}
## Modificando o preenchimento
ggplot(data = penguins_count, aes(x = especies, y = n)) + 
    geom_bar(stat = "identity", fill = "cyan4")

## Modificando a cor e o preenchimento
ggplot(data = penguins_count, aes(x = especies, y = n)) + 
    geom_bar(stat = "identity", color = "cyan4", fill = "white")

## Modificando a largura da barra = .75
ggplot(data = penguins_count, aes(x = especies, y = n)) +
    geom_bar(stat = "identity", width = .75) +
    labs(title = "Largura = .75")

## Modificando a largura da barra = .25
ggplot(data = penguins_count, aes(x = especies, y = n)) +
    geom_bar(stat = "identity", width = .25) +
    labs(title = "Largura = .25") 
```

Outra possibilidade para representa√ß√£o do gr√°fico de barras √© inverter a dire√ß√£o das barras com a fun√ß√£o `coord_flip()` (Figura \@ref(fig:fig-bar-species-invert)).

```{r fig-bar-species-invert, fig.cap="Gr√°ficos de barras indicando a quantidade de indiv√≠duos medidos de cada esp√©cie de pinguim, invertendo a dire√ß√£o das barras."}
## Barras vertical
ggplot(data = penguins_count, aes(x = especies, y = n)) +
    geom_bar(stat = "identity", width = .6)

## Barras horizontal
ggplot(data = penguins_count, aes(x = especies, y = n)) +
    geom_bar(stat = "identity", width = .6) + 
    coord_flip()
```

√â poss√≠vel utilizar vari√°veis categ√≥ricas para definir cores e preenchimento e ilustrar, por exemplo, tratamentos ou esp√©cies diferentes com os argumentos `fill` e `color` (Figura \@ref(fig:fig-bar-species-fill)).

```{r fig-bar-species-fill, fig.cap="Gr√°fico de barras indicando a quantidade de indiv√≠duos medidos de cada esp√©cie de pinguim, para diferentes esp√©cies."}
## Gr√°fico de barras com preenchimento colorido
ggplot(data = penguins_count, aes(x = especies, y = n, fill = especies)) +
    geom_bar(stat = "identity")
```

**Adicionando medidas de varia√ß√£o**

Em algumas compara√ß√µes, utilizar somente os valores absolutos pode n√£o ser a visualiza√ß√£o mais apropriada, como, por exemplo, em desenhos de ANOVA (Cap√≠tulo \@ref(cap7)). Desse modo, ao inv√©s do valor m√°ximo da barra representar o valor absoluto (e.g., n√∫mero de indiv√≠duos de uma esp√©cie), ele vai representar o valor m√©dio. Al√©m disso, linhas adicionais (chamadas barras de erro) v√£o representar alguma medida de varia√ß√£o como desvio padr√£o, erro padr√£o, intervalo de confian√ßa, entre outros (Figura \@ref(fig:fig-bar-species-sd)).

```{r fig-bar-species-sd, fig.cap="Gr√°fico de barras indicando os valores m√©dios e o desvio padr√£o da vari√°vel `comprimento_nadadeira` para cada esp√©cie de pinguim."}
## Calcular o desvio padr√£o por esp√©cie
penguins_media <- penguins %>% 
    dplyr::group_by(especies) %>% 
    dplyr::summarise(media = mean(comprimento_nadadeira, na.rm = TRUE),
                     desvio = sd(comprimento_nadadeira, na.rm = TRUE))

## Gr√°fico de barras com desvio padr√£o
ggplot(data = penguins_media, aes(x = especies, y = media, fill = especies)) +
    geom_bar(stat = "identity", alpha = .4) +
    geom_errorbar(aes(ymin = media-desvio, ymax = media+desvio), width = .1) + 
    geom_point()
```

**Ajustes finos (vers√£o personalizada)**

```{r fig-bar-species-fino, fig.cap="Gr√°fico de barras indicando a quantidade de indiv√≠duos medidos de cada esp√©cie de pinguim, com ajustes finos."}
## Gr√°fico de barra exemplo
ggplot(data = penguins_count, aes(x = especies, y = n, fill = especies)) +
    geom_bar(stat = "identity") +
    geom_label(aes(label = n), fill = "white") +
    scale_fill_manual(values = c("darkorange", "purple", "cyan4")) +
    theme_bw(base_size = 14) +
    labs(x = "Esp√©cies", y = "N√∫mero de indiv√≠duos", fill = "Esp√©cies")
```

### Gr√°fico de setores (*pie chart* e *donut chart*)

Al√©m do gr√°fico de barras, o [gr√°fico de setores](https://www.data-to-viz.com/caveat/pie.html) representa uma alternativa para comparar a propor√ß√£o entre categorias. Tais gr√°ficos podem ser representados como [*pie charts*](https://datavizproject.com/data-type/pie-chart/) ou [*donut charts*](https://datavizproject.com/data-type/donut-chart/), como demonstrado abaixo. No exemplo abaixo, utilizamos a mesma compara√ß√£o realizada no item acima. Por√©m, os valores de contagem (n√∫mero de indiv√≠duos por esp√©cie) devem ser transformados previamente em propor√ß√£o.

**Gr√°fico de setores (*pie chart*)**

Gr√°fico de setores do tipo *pie* (Figura \@ref(fig:fig-pie)).

```{r fig-pie, fig.cap="Gr√°fico de setores indicando a propor√ß√£o de indiv√≠duos medidos de cada esp√©cie de pinguim."}
## C√°lculo da propor√ß√£o - pie
penguins_prop <- penguins %>%
    dplyr::count(especies) %>% 
    dplyr::mutate(prop = round(n/sum(n), 4)*100)

## Gr√°fico de setores
ggplot(data = penguins_prop, aes(x = "", y = prop, fill = especies)) + 
    geom_bar(stat = "identity", color = "white") +
    geom_text(aes(label = paste0(prop, "%")), color = "white", 
              position = position_stack(vjust = .5), size = 6) +
    scale_fill_manual(values = c("darkorange", "purple", "cyan4")) +
    coord_polar("y", start = 0) +
    theme_void() +
    labs(fill = "Esp√©cies")
```

**Gr√°fico de setores (*donut chart*)**

Gr√°fico de setores do tipo *donuts* (Figura \@ref(fig:fig-donut)).

```{r fig-donut, fig.cap="Gr√°fico de setores do tipo *donuts* indicando a propor√ß√£o de indiv√≠duos medidos de cada esp√©cie de pinguim."}
## Gr√°fico de setores - donut
ggplot(data = penguins_prop, aes(x = 2, y = prop, fill = especies)) +
    geom_bar(stat = "identity") +
    geom_text(aes(label = paste0(prop, "%")), color = "white",
              position = position_stack(vjust = .5), size = 4) +
    scale_fill_manual(values = c("darkorange", "purple", "cyan4")) +
    xlim(0, 2.5) +
    coord_polar(theta = "y", start = 0) +
    theme_void() +
    theme(legend.position = c(.5, .5),
          legend.title = element_text(size = 20),
          legend.text = element_text(size = 15)) +
    labs(fill = "Esp√©cies")
```

**Comparando gr√°ficos de setores com gr√°fico de barras**

O mesmo conjunto de dados pode ser visualizado de diferentes formas. N√£o diferente, a compara√ß√£o da propor√ß√£o de ocorr√™ncias de diferentes categorias pode ser feita de v√°rias maneiras. Abaixo, apresentamos a compara√ß√£o da propor√ß√£o de indiv√≠duos de cada uma das tr√™s esp√©cies no banco de dados `penguins` (Figura \@ref(fig:fig-prop)).

```{r fig-prop, fig.cap="Compara√ß√£o da propor√ß√£o de indiv√≠duos por cada uma das tr√™s esp√©cies dos dados feita atrav√©s de gr√°fico de barras, setores do tipo *pie* e setores do tipo *donuts*.", message=FALSE, warning=FALSE, out.width="100%"}
## Gr√°fico de barras - vertical  
g_bar_v <- ggplot(data = penguins_prop, aes(x = especies, y = prop, fill = especies)) +
    geom_bar(stat = "identity") +
    geom_label(aes(label = prop), fill = "white") +
    scale_fill_manual(values = c("darkorange", "purple", "cyan4")) +
    theme_bw() +
    theme(legend.position = "none") +
    labs(title = "Gr√°fico de Barras (Vertical)", x = "Esp√©cies", 
         y = "N√∫mero de indiv√≠duos", fill = "Esp√©cies")

## Gr√°fico de barras - horizontal  
g_bar_h <- ggplot(data = penguins_prop, aes(x = especies, y = prop, fill = especies)) +
    geom_bar(stat = "identity") +
    geom_label(aes(label = prop), fill = "white") +
    scale_fill_manual(values = c("darkorange", "purple", "cyan4")) +
    coord_flip() +
    theme_bw() +
    theme(legend.position = "none") +
    labs(title = "Gr√°fico de Barras (Horizonal)", x = "Esp√©cies", 
         y = "N√∫mero de indiv√≠duos", fill = "Esp√©cies")

## Gr√°fico de setores - pie
g_pie <- ggplot(data = penguins_prop, aes(x = "", y = prop, fill = especies)) + 
    geom_bar(stat = "identity", color = "white") +
    geom_text(aes(label = paste0(prop, "%")), color = "white", 
              position = position_stack(vjust = .5), size = 3) +
    scale_fill_manual(values = c("darkorange", "purple", "cyan4")) +
    coord_polar("y", start = 0) +
    theme_void() +
    labs(title = "Pie chart", fill = "Esp√©cies")

## Gr√°fico de setores - donut
g_donut <- ggplot(data = penguins_prop, aes(x = 2, y = prop, fill = especies)) +
    geom_bar(stat = "identity") +
    geom_text(aes(label = paste0(prop, "%")), color = "white",
              position = position_stack(vjust = .5), size = 2) +
    scale_fill_manual(values = c("darkorange", "purple", "cyan4")) +
    coord_polar(theta = "y", start = 0) +
    xlim(0, 2.5) +
    theme_void() +
    theme(legend.position = "none") +
    labs(title = "Donut chart", fill = "Esp√©cies")

## Combina√ß√£o dos gr√°figos
grid.arrange(g_bar_v, g_bar_h, g_pie, g_donut, nrow = 2)
```

**Principais camadas utilizadas no gr√°fico de barras e de setores: `geom_bar()`**

- `aes()`
- Eixo X (`x`): vari√°vel categ√≥rica (`especies`)
- Eixo Y (`y`): vari√°vel cont√≠nua (`comprimento_nadadeira`)
- Preenchimento (`fill`): a vari√°vel categ√≥rica (`especies`) define a cor do preenchimento e os n√≠veis dentro desta categoria determinam o n√∫mero de cores que devem ser indicadas no `scale_fill_manual()`
- `geom()`
- `geom_bar()`: para que as vari√°veis categ√≥ricas sejam plotadas como gr√°ficos de barra ou setores
- Transpar√™ncia das barras (`alpha`): 0.5 (varia de 0, transpar√™ncia m√°xima, a 1, sem transpar√™ncia)
- `stat`: √© necess√°rio usar o argumento `identity` quando os valores do eixo Y s√£o adicionados pelo usu√°rio
- `geom_label()`: forma geom√©trica que adiciona r√≥tulo dos valores absolutos das barras por categoria (`especies`)
- `geom_errorbar()`: `ymin`e `ymax` delimitam os valores m√≠nimos e m√°ximos, respectivamente, das barras de erro. Tais valores s√£o representados pelo valor da m√©dia menos (no caso do ymin) ou mais (no caso do ymax) o valor do intervalo de confian√ßa, desvio ou erro padr√£o
- `coord`
- `coord_polar()`: sistema de coordenadas para gerar barras circulares sobrepostas (*stacked*) que s√£o usadas nos gr√°ficos de setores (*pie chart* e *donut chart*)
- o argumento `start = 0` indica o local de in√≠cio do gr√°fico que, neste caso, come√ßa na "hora" 0 em um "rel√≥gio" de 12 horas
- `scale()`
- `scale_fill_manual()`: para definir manualmente as cores de prefer√™ncia do usu√°rio
- `theme()`
- `theme_bw()`: para selecionar o tema com fundo branco
- `labs()`: para personalizar os t√≠tulos dos eixos X e Y, e da legenda.

### Gr√°fico de caixa (*boxplot*)

O gr√°fico de caixa, tamb√©m conhecido como [boxplot](https://www.data-to-viz.com/caveat/boxplot.html), e amplamente utilizado nos artigos e livros de Ecologia, √© uma visualiza√ß√£o gr√°fica que sintetiza informa√ß√µes importantes de dados cont√≠nuos como mediana e varia√ß√£o (Figura \@ref(fig:fig-boxplot-desc)) para diferentes n√≠veis de uma vari√°vel categ√≥rica.

```{r fig-boxplot-desc, fig.cap="Estrutura e elementos do boxplot.", out.width="90%", echo=FALSE}
knitr::include_graphics("img/cap06_fig03.png")
```

**Vers√£o padr√£o**

Vamos plotar uma vari√°vel cont√≠nua (`comprimento_nadadeira`) no eixo y em fun√ß√£o de uma vari√°vel categ√≥rica no eixo x (`especies`). A defini√ß√£o de qual coluna do bando de dados √© a x e qual √© a y √© feita dentro do na fun√ß√£o `aes()` (Figura \@ref(fig:fig-boxplot)).

```{r fig-boxplot, fig.cap="Gr√°fico de caixa para a vari√°vel `comprimento_nadadeira` para cada esp√©cie de pinguim."}
## Gr√°fico de caixas das coluna comprimento_nadadeira e esp√©cies
ggplot(data = penguins, aes(y = comprimento_nadadeira, x = especies)) +
    geom_boxplot()
```

√â poss√≠vel destacar, se houver, os pontos referentes aos *outliers* (valores discrepantes) com o argumento `outlier.color`. Caso tenha interesse, √© poss√≠vel tamb√©m remover os outliers do gr√°fico (Figura \@ref(fig:fig-boxplot-outlier)).

```{r fig-boxplot-outlier, fig.cap="Gr√°fico de caixa para a vari√°vel `comprimento_nadadeira` para cada esp√©cie de pinguim, destacando e removendo os outliers."}
## Destaque dos outliers
ggplot(data = penguins, aes(y = comprimento_nadadeira, x = especies)) +
    geom_boxplot(outlier.color = "red") +
    labs(title = "Outliers vermelhos")

## Remo√ß√£o dos outliers
ggplot(data = penguins, aes(y = comprimento_nadadeira, x = especies)) +
    geom_boxplot(outlier.shape = NA) +
    labs(title = "Outliers removidos")
```

Outra op√ß√£o para os gr√°ficos do tipo boxplot √© utilizar o argumento `notch = TRUE` para produzir diagramas de caixa entalhados (*notched*). Estes diagramas s√£o √∫teis para inferir de forma aproximada se existe diferen√ßa significativa entre as medianas dos grupos (Figura \@ref(fig:fig-boxplot-notched)).

```{r fig-boxplot-notched, fig.cap="Gr√°fico de caixa para a vari√°vel `comprimento_nadadeira` para cada esp√©cie de penguim, com entalhamentos."}
## Gr√°fico com caixa entalhadas
ggplot(data = penguins, aes(y = comprimento_nadadeira, x = especies)) +
    geom_boxplot(notch = TRUE) +
    labs(title = "Caixas entalhadas")
```

**Comparando m√∫ltiplas categorias**

No exemplo abaixo, utilizamos cores diferentes para ilustrar esp√©cies diferentes atrav√©s do argumento `fill = especies` (Figura \@ref(fig:fig-boxplot-cat)).

```{r fig-boxplot-cat, fig.cap="Gr√°fico de caixa para a vari√°vel `comprimento_nadadeira` para cada esp√©cie de pinguim, com preenchimentos diferentes."}
## Modificando o preenchimento
ggplot(data = penguins, 
       aes(y = comprimento_nadadeira, x = especies, fill = especies)) +
    geom_boxplot()
```

**Combinando boxplot com pontos (*jitter*)**

Podemos ainda acrescentar pontos para mostrar a distribui√ß√£o dos dados, fazendo uma "agita√ß√£o" (*jitter*) dos pontos sobre as caixas (Figura \@ref(fig:fig-boxplot-jitter)).

```{r fig-boxplot-jitter, fig.cap="Gr√°fico de caixa para a vari√°vel `comprimento_nadadeira` para cada esp√©cie de penguim, com distribui√ß√£o dos dados."}
## Boxplot com jitters
ggplot(data = penguins, aes(y = comprimento_nadadeira, 
                            x = especies, 
                            fill = especies)) +
    geom_boxplot() +
    geom_jitter(size = .5)
```

**Gr√°fico de violino (*violin plot*) como alternativa ao boxplot**

Al√©m das caixas no boxplot, podemos utilizar o formato de "violino" ([gr√°fico de violino](https://datavizproject.com/data-type/violin-plot/)) para representar a varia√ß√£o dos dados cont√≠nuos para as categorias. A informa√ß√£o adicional ao boxplot que o gr√°fico de violino permite visualizar √© a densidade e distribui√ß√£o dos pontos, assim como apresentamos acima no gr√°fico de densidades `geom_density()`. A diferen√ßa √© que a densidade √© espelhada e, desse modo, podemos visualizar os intervalores dos dados com maior ou menor concentra√ß√£o de valores (Figura \@ref(fig:fig-violin)).

```{r fig-violin, fig.cap="Gr√°fico de violino para a vari√°vel `comprimento_nadadeira` para cada esp√©cie de penguim, com distribui√ß√£o dos dados."}
## Gr√°fico de violino
ggplot(data = penguins, aes(y = comprimento_nadadeira, x = especies, fill = especies)) +
    geom_violin() +
    geom_jitter(size = .5)
```

√â poss√≠vel tamb√©m combinar boxplot e gr√°fico de violino em um √∫nico gr√°fico (Figura \@ref(fig:fig-boxplot-violin)).

```{r fig-boxplot-violin, fig.cap="Gr√°fico de caixa e de violino para a vari√°vel `comprimento_nadadeira` para cada esp√©cie de penguim."}
## Combinando o gr√°fico de violino com o de caixas
ggplot(data = penguins, aes(y = comprimento_nadadeira, x = especies, fill = especies)) +
    geom_violin() +
    geom_boxplot(width = .1, fill = "gray")
```

**Ajustes finos (vers√£o personalizada)**

```{r fig-boxplot-violin-fino, fig.cap="Gr√°fico de caixa combinado ou n√£o com Gr√°fico de violino e jitter para a vari√°vel `comprimento_nadadeira` para cada esp√©cie de penguim, com ajustes finos."}
## Gr√°fico de caixas exemplo
ggplot(data = penguins, aes(x = especies, y = comprimento_nadadeira, fill = especies)) +
    geom_boxplot(width = .5, show.legend = FALSE) +
    scale_fill_manual(values = c("darkorange", "purple", "cyan4")) +
    theme_bw(base_size = 14) +
    labs(title = "Boxplot sem pontos", x = "Esp√©cies", y = "Comprimento da nadadeira (mm)")

## Gr√°fico de violino exemplo
ggplot(data = penguins, aes(x = especies, y = comprimento_nadadeira, fill = especies)) +
    geom_violin(width = .5, show.legend = FALSE) +
    geom_jitter(alpha = .4, show.legend = FALSE, 
                position = position_jitter(width = .15, seed = 0)) +
    scale_fill_manual(values = c("darkorange", "purple", "cyan4")) +
    theme_bw(base_size = 14) +
    labs(title = "Gr√°fico de violino com jitter", x = "Esp√©cies", y = "Comprimento da nadadeira (mm)")

## Gr√°fico de caixas e violino exemplo
ggplot(data = penguins, aes(x = especies, y = comprimento_nadadeira, fill = especies)) +
    geom_violin(width = .5, show.legend = FALSE) +
    geom_boxplot(width = .3, fill = "gray", show.legend = FALSE) +
    scale_fill_manual(values = c("darkorange", "purple", "cyan4")) +
    theme_bw(base_size = 14) +
    labs(title = "Gr√°fico de violino com boxplot", x = "Esp√©cies", y = "Comprimento da nadadeira (mm)")
```

**Principais camadas utilizadas no `geom_boxplot()` e `geom_violin()`**

- `aes()`
- Eixo X (`x`): vari√°vel categ√≥rica (`especies`)
- Eixo Y (`y`): vari√°vel cont√≠nua (`comprimento_nadadeira`)
- Preenchimento (`fill`): a vari√°vel categ√≥rica (`especies`) define a cor do preenchimento e os n√≠veis dentro desta categoria determinam o n√∫mero de cores que devem ser indicadas no `scale_fill_manual()`.
- `geom()`
- `geom_boxplot()`: para que as vari√°veis cont√≠nuas e categ√≥ricas sejam plotadas como gr√°ficos de caixas ou violinos
- `width`: largura das barras ou dos pontos(valor padr√£o: width = 1)
- `fill`: pode definir uma cor padr√£o (caso n√£o tenha utilizado o fill dentro do argumento `aes()`) como `fill = "gray"`
- `notch`: para utilizar a caixa entalhada o argumento deve ser `notch = TRUE`, a escolha padr√£o da fun√ß√£o `geom_boxplot()` √© `notch = FALSE`
- `geom_violin()`: assim como nas outras formas geom√©tricas, √© poss√≠vel controlar largura, cor, preenchimento e transpar√™ncias dos violinos
- `geom_jitter()`: esta fun√ß√£o basicamente "agita" aleatoriamente os pontos para evitar a sobreposi√ß√£o de valores id√™nticos. Esta fun√ß√£o produz a mesma representa√ß√£o se usar a fun√ß√£o `geom_point(position = "jitter")`
- `scale()`
- `scale_fill_manual()`: para definir manualmente as cores de prefer√™ncia do usu√°rio
- `theme()`
- `theme_bw()`: para selecionar o tema com fundo branco 
- `labs()`: para personalizar os t√≠tulos dos eixos X e Y, e da legenda

### Gr√°fico de dispers√£o (*scatter plot*)

O [gr√°fico de dispers√£o](https://datavizproject.com/data-type/scatter-plot/) (em ingl√™s, *scatter plot*) √© famoso na Ecologia por ser a visualiza√ß√£o preferida para representar a rela√ß√£o entre √°rea e riqueza de esp√©cies. Neste gr√°fico, os eixos X e Y s√£o representados por vari√°veis cont√≠nuas. Em especial, os gr√°ficos de dispers√£o s√£o usados para representar os resultados testados por an√°lises estat√≠sticas como regress√£o linear, ANCOVA, mantel, PCA, PCoA, nMDS entre outros (para mais detalhes, consultar os Cap√≠tulos \@ref(cap7), \@ref(cap8) e \@ref(cap9)).

**Vers√£o padr√£o**

Vamos utilizar o conjunto de dados *palmerpenguins* para construir um gr√°fico de dispers√£o relacionando as vari√°veis `comprimento_bico` e `comprimento_nadadeira` com a fun√ß√£o `geom_point()`. Esta fun√ß√£o utiliza vari√°vel cont√≠nuas no eixo X e no Y. O gr√°fico mostra os pares ordenados das medidas das duas vari√°veis (Figura \@ref(fig:fig-scatter)).

```{r fig-scatter, fig.cap="Gr√°fico de dispers√£o relacionando as vari√°veis `comprimento_bico` e `comprimento_nadadeira`."}
## Gr√°fico de dispers√£o das coluna comprimento_nadadeira e comprimento_bico
ggplot(data = penguins, aes(x = comprimento_bico, y = comprimento_nadadeira)) +
    geom_point()
```

**Definindo a cor, tamanho, forma e preenchimento dos pontos**

Da mesma forma que para os outros gr√°ficos, podemos alterar cor, tamanho, forma e preenchimento dos pontos (Figura \@ref(fig:fig-scatter-col)).

```{r fig-scatter-col, fig.cap="Gr√°fico de dispers√£o relacionando as vari√°veis `comprimento_bico` e `comprimento_nadadeira` para cada esp√©cie de penguim, com altera√ß√µes na cor, tamanho e preenchimento dos pontos."}
## Cor e tamanho dos pontos 
ggplot(data = penguins, aes(x = comprimento_bico, y = comprimento_nadadeira)) +
    geom_point(color = "cyan4", size = 4) + 
    labs(title = "Sem transpar√™ncia")

## Cor, tamanho dos pontos e transpar√™ncia
ggplot(data = penguins, aes(x = comprimento_bico, y = comprimento_nadadeira)) +
    geom_point(color = "cyan4", size = 4, alpha = .4) +
    labs(title = "Com transpar√™ncia")
```

A forma dos pontos permite dois controles importantes: a forma em si (s√≠mbolos como c√≠rculo, quadrado, etc.) e a possibilidade de preenchimento da forma. A figura a seguir discrimina esses s√≠mbolos e o valor que deve ser utilizado para desenhar a forma preferida. √â importante notar que os s√≠mbolos 21 a 25 possuem dois argumentos: (i) color, que, na verdade √© a cor da borda do s√≠mbolo e (ii) fill, a cor de preenchimento do s√≠mbolo. O tipo de s√≠mbolo √© definido pelo argumento `shape` (Figura \@ref(fig:fig-point-shape)).

```{r fig-point-shape, out.width ="50%", echo=FALSE, fig.cap="Tipos de s√≠mbolos dispon√≠veis para representar pontos."}
knitr::include_graphics("img/cap06_fig02.png")
```

Assim, √© poss√≠vel controlar cores, formas e preenchimento combinado os argumentos `shape`, `fill` e `color` com a fun√ß√£o `scale_manual()`. √â importante notar que para os s√≠mbolos entre 15 e 20 s√≥ podemos controlar o argumento cor, enquanto os s√≠mbolos entre 21 e 25 podemos controlar a cor e o preenchimento (Figura \@ref(fig:fig-scatter-shape)).

```{r fig-scatter-shape, fig.cap="Gr√°fico de dispers√£o relacionando as vari√°veis `comprimento_bico` e `comprimento_nadadeira` para cada esp√©cie de pinguim, com varia√ß√µes na cor e no preenchimento dos pontos."}
## Formato e tamanho
ggplot(data = penguins, aes(x = comprimento_bico, y = comprimento_nadadeira)) +
    geom_point(shape = 1, size = 4)

## Formato e tamanho para esp√©cies
ggplot(data = penguins, aes(x = comprimento_bico, y = comprimento_nadadeira, color = especies)) +
    geom_point(shape = 19, size = 4)

## Formato e tamanho e cor
ggplot(data = penguins, aes(x = comprimento_bico, y = comprimento_nadadeira, fill = especies)) +
    geom_point(shape = 21, size = 4, color = "black")
```

**Definindo linhas de ajuste**

Quando usamos modelos estat√≠sticos como, por exemplo, `lm()`, `glm()`, `gam()`, entre outros (veja mais nos Cap√≠tulos \@ref(cap7) e \@ref(cap8)), podemos utilizar os valores preditos para demonstrar a rela√ß√£o entre as vari√°veis X e Y. No `ggplot2`, a fun√ß√£o `geom_smooth()` faz esse ajuste com certa simplicidade (Figura \@ref(fig:fig-scatter-smooth)).

```{r fig-scatter-smooth, fig.cap="Gr√°fico de dispers√£o relacionando as vari√°veis `comprimento_bico` e `comprimento_nadadeira` para cada esp√©cie de penguim, com linhas de ajustes estat√≠sticos."}
## Linha de ajuste
ggplot(data = penguins, aes(x = comprimento_bico, y = comprimento_nadadeira)) +
    geom_point(shape = 20, size = 4, color = "black") +
    geom_smooth(method = lm)
```

**Ajustes finos (vers√£o personalizada)**

```{r fig-scatter-fino, fig.cap="Gr√°fico de dispers√£o relacionando as vari√°veis `comprimento_bico` e `comprimento_nadadeira` para cada esp√©cie de penguim, com ajustes finos."}
## Gr√°fico de dispers√£o exemplo
ggplot(data = penguins, aes(x = comprimento_bico, y = comprimento_nadadeira,
                            color = especies, shape = especies)) +
    geom_point(size = 4, alpha = .7) +
    geom_smooth(method = "lm", se = FALSE) +
    scale_shape_manual(values = c(19, 15, 17)) +
    scale_color_manual(values = c("darkorange", "purple", "cyan4")) +
    theme_bw(base_size = 16) +
    labs(x = "Comprimento do bico (mm)", y = "Comprimento da nadadeira (mm)", 
         color = "Esp√©cies", shape = "Esp√©cies")
```

Al√©m disso, podemos relacionar dados n√£o t√£o usuais. Recomendamos a leitura do artigo de Matejka & Fitzmaurice [-@matejka_same_2017] que apresenta as armadilhas t√≠picas que dados podem gerar quando evitamos de visualiz√°-los previamente (Figura \@ref(fig:fig-scatter-dino)).

```{r fig-scatter-dino, fig.cap="Gr√°fico de dispers√£o relacionando as vari√°veis `x` e `y` formando um dinossauro."}
## Gr√°fico do dinossauro
datasaurus_dozen %>% 
    dplyr::filter(dataset == "dino") %>% 
    ggplot() +
    aes(x = x, y = y) +
    geom_point(colour = "black", fill = "black", 
               size = 4, alpha = .7, shape = 21) +
    theme_bw() +
    theme(axis.title = element_text(size = 24),
          axis.text.x = element_text(size = 20),
          axis.text.y = element_text(size = 20))
```

### Visualiza√ß√£o de m√∫ltiplos gr√°ficos pareados

Muitas vezes precisamos plotar a rela√ß√£o de mais de uma vari√°vel, e muitas vezes essas vari√°veis s√£o de mais de um tipo (cont√≠nua, categ√≥rica, etc.). O gr√°fico mais indicado nesses casos √© o gr√°fico pareado [@emerson_generalized_2013] que nos auxilia √† ter uma vis√£o geral do conjunto de dados e de suas interrela√ß√µes. Esse gr√°fico tamb√©m √© chamado de *pairs plot* ou [correlograma](https://www.data-to-viz.com/graph/correlogram.html).

**Gr√°fico pareado com vari√°veis cont√≠nuas**

A fun√ß√£o `ggpairs()` do pacote `GGally` permite criar m√∫ltiplos gr√°ficos pareados comparando as vari√°veis cont√≠nuas no seu conjunto de dados. Al√©m de demonstrar gr√°ficos de dispers√£o de cada par de vari√°veis, ela apresenta gr√°ficos de densidade de cada vari√°vel individualmente e, al√©m disso, os valores de correla√ß√£o entre os pares analisados com ou sem uma potencial vari√°vel categ√≥rica (neste caso, `especies`) (Figura \@ref(fig:fig-pairs-cont)).

```{r fig-pairs-cont, fig.cap="Gr√°fico pareado relacionando v√°rias vari√°veis cont√≠nuas para as esp√©cies de penguins."}
## Gr√°fico pareado com vari√°veis cont√≠nuas
penguins %>%
    dplyr::select(massa_corporal, comprimento_bico, profundidade_bico, comprimento_nadadeira) %>%
    GGally::ggpairs(aes(color = penguins$especies)) +
    scale_colour_manual(values = c("darkorange", "purple", "cyan4")) +
    scale_fill_manual(values = c("darkorange", "purple", "cyan4")) +
    theme_bw()
```

**Gr√°fico pareado com v√°rios tipos de vari√°veis**

Como alternativa, a fun√ß√£o **`ggpairs()`** permite tamb√©m incluir vari√°veis categ√≥ricas nas compara√ß√µes. Neste caso, ela reconhece o tipo de gr√°fico (boxplot, dispers√£o, etc.) a partir dos modos das vari√°veis (Figura \@ref(fig:fig-pairs-cont-cat)).

```{r fig-pairs-cont-cat, fig.cap="Gr√°fico pareado relacionando v√°rias vari√°veis cont√≠nuas e categ√≥ricas para as esp√©cies de penguins."}
## Gr√°fico pareado com vari√°veis cont√≠nuas e categ√≥ricas
penguins %>%
    dplyr::select(sexo, massa_corporal, comprimento_bico, profundidade_bico, comprimento_nadadeira) %>%
    GGally::ggpairs(aes(color = sexo)) +
    scale_colour_manual(values = c("darkorange", "purple", "cyan4")) +
    scale_fill_manual(values = c("darkorange", "purple", "cyan4")) +
    theme_bw()
```

### Erros comuns dos usu√°rios do `ggplot2` e como evit√°-los

Abaixo, apresentamos uma lista n√£o exaustiva dos erros mais comuns que cometemos (e vimos muitos usu√°rios cometerem) ao fazer gr√°ficos no ggplot2.

- Utilizar ajuste manual nas fun√ß√µes `scale_shape_manual()`, `scale_color_manual()` ou `scale_fill_manual()` sem indicar no argumento `aes()` as vari√°veis que devem definir cada um desses elementos gr√°ficos

- Utilizar ajuste manual na fun√ß√£o `scale_size_manual()` indicando uma vari√°vel categ√≥rica em vez de num√©rica

- N√∫mero de cores indicadas como valores no `scale_fill_manual()` ou `scale_color_manual()`: ao definir as cores de maneira personalizada (ou seja, n√£o usando o padr√£o da fun√ß√£o) √© muito comum utilizarmos o n√∫mero de cores usados por algum tutorial ou livro. Com frequ√™ncia, o exemplo seguido e seus dados n√£o possuem o mesmo n√∫mero de cores dos nossos dados. Deste modo, voc√™ pode usar c√≥digos no R para ajudar a quantificar o n√∫mero de cores necess√°rias. Por exemplo, para os dados `penguins`, o c√≥digo a seguir indica o n√∫mero de cores necess√°rias: `length(levels(penguins\$species))`. Assim, ser√° necess√°rio indicar tr√™s cores diferentes dentro da fun√ß√£o `scale_*()`.

- Fun√ß√£o `geom_smooth()`: como explicado acima, a fun√ß√£o `geom_smooth()` √© muito √∫til (e simples) para gerar as linhas de ajuste (*best fit*) t√≠picas de modelos lineares e n√£o lineares. Por√©m, fique alerta ao usar, por exemplo, `geom_smooth(method = lm)`, o modelo linear utilizado para testar sua predi√ß√£o foi o `lm()`. Se tiver utilizado `glm()`ou `gam()` o ajuste deve ser produzido a partir desses modelos.

- Uso incorreto do modo das vari√°veis: neste caso, o usu√°rio utilizar uma vari√°vel num√©rica (por exemplo, 1, 2 e 3) como vari√°vel categ√≥rica. Neste caso, √© preciso transformar a vari√°vel num√©rica em vari√°vel categ√≥ricas (antes de fazer o ggplot2 ou dentro do `aes()`). 

Veja exemplos (Figura \@ref(fig:fig-plot-error)).

```{r fig-plot-error, fig.cap="Gr√°ficos mostrando erros comuns na cria√ß√£o de gr√°ficos no pacote `ggplot2`."}
## Figura incorreta, sem a transforma√ß√£o da vari√°vel ano
penguins %>%
    ggplot(aes(x = ano, y = comprimento_bico)) +
    geom_boxplot() + 
    theme_bw() +
    labs(title = "Figura incorreta")

## Figura correta, com transforma√ß√£o interna da vari√°vel ano
penguins %>%
    ggplot(aes(x = factor(ano), y = comprimento_bico)) +
    geom_boxplot() + 
    theme_bw() +
    labs(title = "Figura correta com transforma√ß√£o interna")

## Figura correta, com transforma√ß√£o pr√©via da vari√°vel ano
penguins %>%
    mutate(ano_f = as.factor(ano)) %>% 
    ggplot(aes(x = ano_f, y = comprimento_bico)) +
    geom_boxplot() + 
    theme_bw() +
    labs(title = "Figura correta com transforma√ß√£o pr√©via")
```

## Finaliza√ß√£o de gr√°ficos para publica√ß√£o

### Posi√ß√£o, cores e fonte da legenda

√â poss√≠vel controlar a posi√ß√£o, cores e fonte da legenda em diversos locais com alguns argumentos dentro da fun√ß√£o `theme()`:

- `legend.position`: controla a posi√ß√£o na √°rea do gr√°fico: `top`, `right`, `bottom`, `left` ou `none`. Al√©m disso, √© poss√≠vel inserir a legenda internamente no gr√°fico indicando as posi√ß√µes nos eixos X e Y

- `legend.box`: determina as caracter√≠sticas do ret√¢ngulo onde a legenda √© inserida: `legend.box.background` (combinado com `element_rect()`) e `legend.box.margin` (combinado com `margin()`)

- `legend.text`: controla a cor e tamanho da legenda (as duas informa√ß√µes devem ser inseridas dentro da fun√ß√£o `element_text()`)

- `legend.title`: personaliza a cor e tamanho da legenda tamb√©m dentro da fun√ß√£o `element_text()`

Vejamos alguns exemplos (Figura \@ref(fig:fig-plot-final-legenda)).

```{r fig-plot-final-legenda, fig.cap="Gr√°ficos mostrando a finaliza√ß√£o de gr√°ficos para publica√ß√£o em rela√ß√£o √† posi√ß√£o, cores e fonte da legenda no pacote `ggplot2`."}
## Legenda acima
ggplot(data = penguins, 
       aes(x = comprimento_bico, y = comprimento_nadadeira,
           color = especies, shape = especies)) +
    geom_point(size = 4, alpha = .7) +
    geom_smooth(method = "lm", se = FALSE) +
    scale_shape_manual(values = c(19, 15, 17)) +
    scale_color_manual(values = c("darkorange", "purple", "cyan4")) +
    theme_bw(base_size = 14) +
    theme(legend.position = "top") +
    labs(title = "Legenda acima do gr√°fico", x = "Comprimento do bico (mm)", 
         y = "Profundidade do bico (mm)", color = "Esp√©cies", shape = "Esp√©cies")

## Leganda abaixo
ggplot(data = penguins, 
       aes(x = comprimento_bico, y = comprimento_nadadeira,
           color = especies, shape = especies)) +
    geom_point(size = 4, alpha = .7) +
    geom_smooth(method = "lm", se = FALSE) +
    scale_shape_manual(values = c(19, 15, 17)) +
    scale_color_manual(values = c("darkorange", "purple", "cyan4")) +
    theme_bw(base_size = 14) +
    theme(legend.position = "bottom") +
    labs(title = "Legenda abaixo do gr√°fico", x = "Comprimento do bico (mm)", 
         y = "Profundidade do bico (mm)", color = "Esp√©cies", shape = "Esp√©cies")

## Sem legenda
ggplot(data = penguins, 
       aes(x = comprimento_bico,  y = comprimento_nadadeira,
           color = especies, shape = especies)) +
    geom_point(size = 4, alpha = .7) +
    geom_smooth(method = "lm", se = FALSE) +
    scale_shape_manual(values = c(19, 15, 17)) +
    scale_color_manual(values = c("darkorange", "purple", "cyan4")) +
    theme_bw(base_size = 14) +
    theme(legend.position = "none") +
    labs(title = "Sem legenda", x = "Comprimento do bico (mm)", 
         y = "Profundidade do bico (mm)", color = "Esp√©cies", shape = "Esp√©cies")

## Legenda personalizada
ggplot(data = penguins, 
       aes(x = comprimento_bico, y = comprimento_nadadeira,
           color = especies, shape = especies)) +
    geom_point(size = 4, alpha = .7) +
    geom_smooth(method = "lm", se = FALSE) +
    scale_shape_manual(values = c(19, 15, 17)) +
    scale_color_manual(values = c("darkorange", "purple", "cyan4")) +
    theme_bw(base_size = 14) +
    theme(legend.position = "right",
          legend.text = element_text(size = 14, colour = "red"),
          legend.title = element_text(face = "bold"),
          legend.box.background = element_rect(color="red", size=2),
          legend.margin = margin(6, 6, 6, 6)) +
    labs(title = "Legenda personalizada", x = "Comprimento do bico (mm)", 
         y = "Profundidade do bico (mm)", color = "Esp√©cies", shape = "Esp√©cies")

## Legenda interna
ggplot(data = penguins, 
       aes(x = comprimento_bico, y = comprimento_nadadeira,
           color = especies, shape = especies)) +
    geom_point(size = 4, alpha = .7) +
    geom_smooth(method = "lm", se = FALSE) +
    scale_shape_manual(values = c(19, 15, 17)) +
    scale_color_manual(values = c("darkorange", "purple", "cyan4")) +
    theme_bw(base_size = 16) +
    theme(legend.position = c(.2, .8),
          legend.title = element_blank(),
          legend.key =  element_blank(),
          legend.background = element_blank(),
          legend.text = element_text(size = 12, face = "bold")) +
    labs(title = "Legenda interna", x = "Comprimento do bico (mm)", 
         y = "Profundidade do bico (mm)", color = "Esp√©cies", shape = "Esp√©cies")
```

### Elementos gr√°ficos: eixo, fonte, gride

O gr√°fico padronizado (sem edi√ß√£o extra) geralmente n√£o traz elementos m√≠nimos para publica√ß√£o em revistas, livros ou peri√≥dicos. Al√©m do controle da posi√ß√£o, cor e tamanho da legenda, √© fundamental personalizar os seguintes elementos: eixo, fonte e gride.

- Eixos
- Varia√ß√£o: define limites m√≠nimos e m√°ximos para os eixos X (`xlim()`) e Y (`ylim()`)
- Intervalo: define o valor intervalo entre os n√∫meros dos eixos X e Y

Vejamos mais alguns exemplos (Figura \@ref(fig:fig-plot-final-eixos)).

```{r fig-plot-final-eixos, fig.cap="Gr√°ficos mostrando a finaliza√ß√£o de gr√°ficos para publica√ß√£o em rela√ß√£o aos elementos gr√°ficos de eixo, fonte e gride no pacote `ggplot2`."}
## Nome dos eixos
ggplot(data = penguins,  
       aes(x = comprimento_bico, y = comprimento_nadadeira, 
           color = especies, shape = especies)) +
    geom_point(size = 4, alpha = .4) +
    ylim(170, 230) +
    xlim(30, 60) +
    labs(title = "Nome dos eixos", x = "Eixo X", y = "Eixo Y")

## Intervalo dos eixos
ggplot(data = penguins, 
       aes(x = comprimento_bico, y = comprimento_nadadeira,
           color = especies, shape = especies)) +
    geom_point(size = 4, alpha = .4) +
    scale_x_continuous(limits = c(30, 60), breaks = seq(30, 60, 2)) +
    labs(title = "Intervalo dos eixos", x = "Eixo X", y = "Eixo Y")
```

- Fonte dos eixos X e Y
- Tipo
- Tamanho
- Cor
- Face (it√°lico, negrito, etc.)
- √Çngulo

Vejamos outros exemplos com mudan√ßas nos eixos (Figura \@ref(fig:fig-plot-final-eixos-fonte)).

```{r fig-plot-final-eixos-fonte, fig.cap="Gr√°ficos mostrando a finaliza√ß√£o de gr√°ficos para publica√ß√£o em rela√ß√£o aos eixos no pacote `ggplot2`."}
## Cor e fonte dos eixos
ggplot(data = penguins, 
       aes(x = comprimento_bico, y = comprimento_nadadeira,
           color = especies, shape = especies)) +
    geom_point(size = 4, alpha = .4) +
    theme(axis.title.x = element_text(face = "bold", size = 20, colour = "cyan4"),
          axis.text.x = element_text(size = 14),
          axis.title.y = element_text(face = "bold", size = 20, colour = "cyan4"),
          axis.text.y = element_text(size = 14)) +
    labs(title = "Cor e fonte dos eixos", x = "Eixo X", y = "Eixo Y")

## Intervalo e √¢ngulos do texto dos eixos
ggplot(data = penguins, 
       aes(x = comprimento_bico, y = comprimento_nadadeira,
           color = especies, shape = especies)) +
    geom_point(size = 4, alpha = .4) +
    scale_x_continuous(limits = c(20, 60), breaks = seq(20, 60, 2)) +
    theme(axis.title.x = element_text(face = "bold", size = 20, colour = "cyan4"),
          axis.text.x = element_text(size = 14, angle = 45),
          axis.title.y = element_text(face = "bold", size = 20, colour = "cyan4"),
          axis.text.y = element_text(size = 14)) +
    labs(title = "Intervalo e √¢ngulos do texto dos eixos", x = "Eixo X", y = "Eixo Y")
```

- Gride
- Linhas de grade principais (`panel.grid.major`)
- Linhas de grade secund√°rias (`panel.grid.minor`)
- Borda do gr√°fico (`panel.border`)

Vejamos outros exemplos com mudan√ßas ao gride (Figura \@ref(fig:fig-plot-final-gride)).

```{r fig-plot-final-gride, fig.cap="Gr√°ficos mostrando a finaliza√ß√£o de gr√°ficos para publica√ß√£o em rela√ß√£o ao gride no pacote `ggplot2`."}
## Linhas de grade principais
ggplot(data = penguins, 
       aes(x = comprimento_bico, y = comprimento_nadadeira,
           color = especies, shape = especies)) +
    geom_point(size = 4, alpha = .4) +
    scale_x_continuous(limits = c(30, 60), breaks = seq(30, 60, 5)) +
    theme(axis.title.x = element_text(face = "bold", size = 16),
          axis.text.x = element_text(size = 12),
          axis.title.y = element_text(face = "bold", size = 16),
          axis.text.y = element_text(size = 12),
          panel.grid.minor = element_blank()) +
    labs(title = "Linhas de grade principais", x = "Eixo X", y = "Eixo Y")

## Retirar linhas de grade
ggplot(data = penguins, 
       aes(x = comprimento_bico, y = comprimento_nadadeira,
           color = especies, shape = especies)) +
    geom_point(size = 4, alpha = .4) +
    scale_x_continuous(limits = c(30, 60), breaks = seq(30, 60, 5)) +
    theme(axis.title.x = element_text(face = "bold", size = 16),
          axis.text.x = element_text(size = 12),
          axis.title.y = element_text(face = "bold", size = 16),
          axis.text.y = element_text(size = 12),
          panel.grid.minor = element_blank(),
          panel.grid.major = element_blank()) +
    labs(title = "Retirar linhas de grade", x = "Eixo X", y = "Eixo Y")

## Borda do gr√°fico
ggplot(data = penguins, 
       aes(x = comprimento_bico, y = comprimento_nadadeira,
           color = especies, shape = especies)) +
    geom_point(size = 4, alpha = 0.5) +
    scale_x_continuous(limits = c(30, 60), breaks = seq(30, 60, 5)) +
    theme(axis.title.x = element_text(face = "bold", size = 16),
          axis.text.x = element_text(size = 12),
          axis.title.y = element_text(face = "bold", size = 16),
          axis.text.y = element_text(size = 12),
          panel.grid.minor = element_blank(),
          panel.grid.major = element_blank(),
          panel.border = element_rect(size = 2, colour = "black", fill = NA)) +
    labs(title = "Borda do gr√°fico", x = "Eixo X", y = "Eixo Y")

## Borda do gr√°fico
ggplot(data = penguins, 
       aes(x = comprimento_bico, y = comprimento_nadadeira,
           color = especies, shape = especies)) +
    geom_point(size = 4, alpha = .4) +
    scale_x_continuous(limits = c(30, 60), breaks = seq(30, 60, 5)) +
    theme(axis.title.x = element_text(face = "bold", size = 16),
          axis.text.x = element_text(size = 12),
          axis.title.y = element_text(face = "bold", size = 16),
          axis.text.y = element_text(size = 12),
          panel.grid.minor = element_blank(),
          panel.grid.major = element_blank(),
          axis.line = element_line(size = 1)) +
    labs(title = "Borda do gr√°fico", x = "Eixo X", y = "Eixo Y")
```

### Temas personalizados `ggtheme()`

Existem v√°rios temas criados dentro do universo [`ggtheme()`](https://ggplot2.tidyverse.org/reference/ggtheme.html) que podem facilitar a escolha de um modelo com √≥tima qualidade para publica√ß√£o. Abaixo, demonstramos os modelos mais utilizados (Figura \@ref(fig:fig-plot-final-ggtheme)).

```{r fig-plot-final-ggtheme, fig.cap="Gr√°ficos mostrando a finaliza√ß√£o de gr√°ficos para publica√ß√£o em rela√ß√£o ao `ggtheme()` no pacote `ggplot2`."}
## theme_gray
ggplot(data = penguins, 
       aes(x = comprimento_bico, y = comprimento_nadadeira,
           color = especies, shape = especies)) +
    geom_point(size = 4, alpha = .7) +
    geom_smooth(method = "lm", se = FALSE) +
    scale_shape_manual(values = c(19, 15, 17)) +
    scale_color_manual(values = c("darkorange", "purple", "cyan4")) +
    theme_gray(base_size = 16) +
    labs(title = "theme_gray()", x = "Comprimento do bico (mm)", 
         y = "Profundidade do bico (mm)", color = "Esp√©cies", shape = "Esp√©cies") 
## theme_bw()
ggplot(data = penguins, 
       aes(x = comprimento_bico, y = comprimento_nadadeira,
           color = especies, shape = especies)) +
    geom_point(size = 4, alpha = .7) +
    geom_smooth(method = "lm", se = FALSE) +
    scale_shape_manual(values = c(19, 15, 17)) +
    scale_color_manual(values = c("darkorange", "purple", "cyan4")) +
    theme_bw(base_size = 16) +
    labs(title = "theme_bw()", x = "Comprimento do bico (mm)",
         y = "Profundidade do bico (mm)", color = "Esp√©cies", shape = "Esp√©cies") 
## theme_classic()
ggplot(data = penguins, 
       aes(x = comprimento_bico, y = comprimento_nadadeira,
           color = especies, shape = especies)) +
    geom_point(size = 4, alpha = .7) +
    geom_smooth(method = "lm", se = FALSE) +
    scale_shape_manual(values = c(19, 15, 17)) +
    scale_color_manual(values = c("darkorange", "purple", "cyan4")) +
    theme_classic(base_size = 16) +
    labs(title = "theme_classic()", x = "Comprimento do bico (mm)", 
         y = "Profundidade do bico (mm)", color = "Esp√©cies", shape = "Esp√©cies")
```

### Criando seu pr√≥prio `theme_custom()`

Por fim, √© poss√≠vel criar um tema personalizado como uma fun√ß√£o. Assim, o usu√°rio pode controlar todos os elementos gr√°ficos em um √∫nico c√≥digo. O maior benef√≠cio de personalizar uma fun√ß√£o √© que n√£o ser√° necess√°rio fazer os ajustes finos em todos os gr√°ficos que tiver construindo, o que pode representar grande economia de tempo e linhas de c√≥digo (Figura \@ref(fig:fig-plot-final-theme-custom)).

```{r fig-plot-final-theme-custom, fig.cap="Gr√°ficos mostrando a finaliza√ß√£o de gr√°ficos para publica√ß√£o em rela√ß√£o √† cria√ß√£o de um tema usando o `theme_custom()` no pacote `ggplot2`."}
## Criar uma fun√ß√£o com os ajustes finos
tema_personalizado <- function(){
    
    # Defina uma fonte
    font <- "Times" # Digite names(pdfFonts()) no console do R para ver a lista de fontes dispon√≠veis
    
    theme(
        
        # Defina elementos do gride
        panel.grid.major = element_line(colour = "#d3d3d3"),  
        panel.grid.minor = element_blank(),
        axis.ticks = element_blank(), 
        panel.border = element_rect(colour = "black", fill = NA, size = .5),
        
        # Defina elementos textuais
        # T√≠tulo
        plot.title = element_text(             
            family = font,            # Fonte
            size = 20,                # Tamanho da fonte
            face = 'bold',            # Tipo de fonte
            hjust = 0,                # Alinhamento horizontal
            vjust = 2),               # Alinhamento vertical
        
        # Subt√≠tulo
        plot.subtitle = element_text(          
            family = font,            # Fonte
            size = 14),               # Tamanho da fonte
        
        # R√∫brica
        plot.caption = element_text(           
            family = font,            # Fonte
            size = 10,                # Tamanho da fonte
            hjust = 1),               # Alinhamento horizontal
        
        # T√≠tulo dos eixos
        axis.title = element_text(             
            family = font,            # Fonte
            size = 14),               # Tamanho da fonte
        
        # Texto dos eixos
        axis.text = element_text(              
            family = font,            # Fonte
            size = 14)              # Tamanho da fonte
        
    )}

## Gr√°fico usando a fun√ß√£o de tema criada
ggplot(data = penguins, 
       aes(x = comprimento_bico, y = comprimento_nadadeira,
           color = especies, shape = especies)) +
    geom_point(size = 4, alpha = .7) +
    geom_smooth(method = "lm", se = FALSE) +
    scale_shape_manual(values = c(19, 15, 17)) +
    scale_color_manual(values = c("darkorange", "purple", "cyan4")) +
    tema_personalizado() +
    labs(title = "Tema personalizado", x = "Comprimento do bico (mm)", 
         y = "Profundidade do bico (mm)", color = "Esp√©cies", 
         shape = "Esp√©cies", caption = "Fonte = palmerpinguins")
```

### Exportando gr√°ficos com alta qualidade com a fun√ß√£o `ggsave()`

O √∫ltimo passo para construir gr√°ficos com qualidade de publica√ß√£o √© exportar em um formato espec√≠fico, como .png, .pdf ou .svg (entre outros). A fun√ß√£o `ggsave()` n√£o s√≥ permite que voc√™ tenha o controle sobre o formato, mas tamb√©m sobre a qualidade e tamanho desejados com os seguintes argumentos:

- `width`: largura do gr√°fico
- `height`: altura do gr√°fico
- `units`: unidade de medida (cm, mm) do gr√°fico para definir largura e tamanho
- `dpi`: resolu√ß√£o ou qualidade da imagem, medida em pontos por polegada (*dots per inch*) (padr√£o = 300)

Vejamos um √∫ltimo exemplo (Figura \@ref(fig:fig-plot-final-export)).

```{r fig-plot-final-export, fig.cap="Gr√°fico criado para a exporta√ß√£o no pacote `ggplot2`."}
## Gr√°fico
g1 <- ggplot(data = penguins, 
             aes(x = comprimento_bico, y = comprimento_nadadeira,
                 color = especies, shape = especies)) +
    geom_point(size = 4, alpha = .7) +
    geom_smooth(method = "lm", se = FALSE) +
    scale_shape_manual(values = c(19, 15, 17)) +
    scale_color_manual(values = c("darkorange", "purple", "cyan4")) +
    theme(legend.position = c(.1, .1),
          legend.title = element_blank(),
          legend.key =  element_blank(),
          legend.background = element_blank()) +
    tema_personalizado() +
    labs(x = "Comprimento do bico (mm)", y = "Profundidade do bico (mm)", 
         color = "Esp√©cies", shape = "Esp√©cies")
g1
```

Podemos exportar esse gr√°fico de diferentes formas.

```{r eval=FALSE}
## Exportar no formato PDF
ggsave(filename = "g1.pdf", 
       plot = g1, 
       width = 15, 
       height = 15, 
       dpi =300,
       units = "cm")

## Exportar no formato PNG
ggsave(filename = "g1.png", 
       plot = g1, 
       width = 15, 
       height = 15, 
       dpi =300,
       units = "cm")

## Exportar no formato SVG
ggsave(filename = "g1.svg", 
       plot = g1, 
       width = 15, 
       height = 15, 
       dpi =300,
       units = "cm")
```

## Para se aprofundar

Listamos abaixo livros e links que recomendamos para seguir com sua aprendizagem em R e gr√°ficos.

### Livros

Recomendamos aos interessados os livros: i) Chang [-@chang_r_2018] R Graphics Cookbook, ii) Healy [-@healy_data_2018] Data Visualization: a practical introduction, iii) Rahlf [-@rahlf_data_2019] Data Visualisation with R: 111 Examples, iv) Sievert [-@sievert_interactive_2020] Interactive web-based data visualization with R, plotly, and shiny, v) Wickham [-@wickham2016] ggplot2: elegant graphics for data analysis, vi) Wilke [-@wilke_fundamentals_2019] Fundamentals of Data Visualization, vii) Wilkinson e colaboradores [-@wilkinson2005] The Grammar of Graphics.

### Links
Existem centenas de ferramentas online para aprender visualiza√ß√£o de dados e ggplot2. Tais ferramentas s√£o bastante variadas, incluindo desde a escolha de tipos de gr√°ficos √† sele√ß√£o de cores. Dentre elas, indicamos os seguintes links em ingl√™s:  

**Visualiza√ß√£o**
- [Data Visualization with R - Rob Kabacoff](https://rkabacoff.github.io/datavis/)
- [The Data Visualisation Catalogue](https://datavizcatalogue.com/index.html)
- [The R Graph Gallery](https://www.r-graph-gallery.com/index.html)
- [From Data to Viz](https://www.data-to-viz.com/)
- [Data Viz Project](https://datavizproject.com/)
- [QuickChart](https://quickchart.io/)
- [Chart.js](https://www.chartjs.org/)
- [drawdata.xyz](https://drawdata.xyz)

**Sele√ß√£o de cores (paletas)**
- [Color Brewer: color advice](https://colorbrewer2.org/)
- [Wes Anderson Palletes](https://github.com/karthik/wesanderson)
- [Choosing colors for data visualization](https://blog.datawrapper.de/colors/)

## Exerc√≠cios

**6.1**
Utilizando o banco de dados `penguins` compare o comprimento do bico entre as diferentes esp√©cies de penguins. Utilize um gr√°fico de caixa ([boxplot](https://analises-ecologicas.netlify.app/cap6.html#gr%C3%A1fico-de-caixa-boxplot)) para ilustrar a varia√ß√£o intraespec√≠fica e poss√≠veis outliers nos dados. Para melhorar o seu gr√°fico, lembre-se de nomear os dois eixos corretamente, definir um tema e posicionar a legenda.

**6.2**
Utilizando o banco de dados `penguins` fa√ßa um [histograma](https://analises-ecologicas.netlify.app/cap6.html#histograma-histogram) com a distribui√ß√£o da massa corporal para cada uma das esp√©cies. Utilize uma cor de preenchimento para cada esp√©cie.

**6.3**
Utilizando o banco de dados `penguins`, fa√ßa tr√™s gr√°ficos com o mesmo eixo Y e eixo X. Coloque o comprimento das nadadeiras no eixo Y e as esp√©cies de pinguins no eixo X. No primeiro gr√°fico, utilize o `geom_jitter()` para plotar os dados brutos. No segundo gr√°fico, utilize o `geom_violin()` para mostrar a distribui√ß√£o de densidade dos dados. No terceiro gr√°fico, utilize o `geom_boxplot()` para destacar a mediana e os quartis.

**6.4**
Se voc√™ conseguiu resolver o exerc√≠cio 6.3, agora d√™ um passo a mais e compare os tr√™s gr√°ficos lado a lado utilizando a fun√ß√£o `grid.arrange()`. Lembre-se de colocar um t√≠tulo informativo em cada um dos gr√°ficos antes de junt√°-los em uma prancha √∫nica. Ao comparar os tr√™s tipos de gr√°ficos, qual voc√™ considera mais informativo? Experimente combinar mais de um "geom" (camadas) e produzir gr√°ficos ainda mais interessantes.

**6.5**
Utilize o conjunto de dados `ecodados::anova_dois_fatores` para construir um [gr√°fico de barras](https://analises-ecologicas.netlify.app/cap6.html#gr%C3%A1fico-de-barras-bar-plot) com a m√©dia e o erro padr√£o do Tempo (Tempo para eliminar a droga do corpo) no eixo Y em fun√ß√£o da vari√°vel Pessoas (XX, ou XY) e Idade (jovem ou idoso). Antes de fazer o gr√°fico leia com aten√ß√£o a descri√ß√£o do mesmo atrav√©s do comando `?ecodados::anova_dois_fatores`. Uma dica, utilize `fill` dentro do `aes()` para representar um dos fatores (ex. Pessoas). O outro fator voc√™ pode representar no eixo X. Veja se consegue, se n√£o conseguir pode olhar a cola com a solu√ß√£o para aprender como √© feito. Outra dica, pesquise sobre a fun√ß√£o `stat_summary()` ela ir√° te ajudar a calcular a m√©dia e o erro padr√£o dentro do comando que gera o gr√°fico.

**6.6**
Utilize o banco de dados `penguins` para criar um [gr√°fico de dispers√£o](https://analises-ecologicas.netlify.app/cap6.html#gr%C3%A1fico-de-dispers%C3%A3o-scatter-plot) entre o tamanho da nadadeira (eixo Y) e a massa corporal (eixo X). Utilize o argumento `fill` para ilustrar com cores as diferen√ßas entre os sexos e utilize a fun√ß√£o `facte_grid()` para criar um gr√°fico separado para cada esp√©cie de pinguim. Se voc√™ n√£o conhece essa fun√ß√£o, d√™ uma olhada no help `?facet_grid()`. Voc√™ tamb√©m pode utilizar a fun√ß√£o `drop_na()` para excluir os dados faltantes da coluna `sexo`.

[Solu√ß√µes dos exerc√≠cios](https://exercicios-livro-aer.netlify.app/cap.-6---visualiza%C3%A7%C3%A3o-de-dados.html).
