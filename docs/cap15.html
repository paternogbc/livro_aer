<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Cap√≠tulo 15 Dados geoespaciais | An√°lises Ecol√≥gicas no R</title>
<meta name="author" content="Fernando Rodrigues da Silva, Thiago Gon√ßalves-Souza, Gustavo Brant Paterno,   Diogo Borges Provete, Maur√≠cio Humberto Vancine">
<meta name="description" content="Pr√©-requisitos do cap√≠tulo Pacotes e dados que ser√£o utilizados nesse cap√≠tulo. ## Pacotes library(ecodados) library(here) library(tidyverse) library(sf) library(raster) library(rgdal)...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Cap√≠tulo 15 Dados geoespaciais | An√°lises Ecol√≥gicas no R">
<meta property="og:type" content="book">
<meta property="og:url" content="https://analises-ecologicas.netlify.app/cap15.html">
<meta property="og:image" content="https://analises-ecologicas.netlify.app/img/capa.jpeg">
<meta property="og:description" content="Pr√©-requisitos do cap√≠tulo Pacotes e dados que ser√£o utilizados nesse cap√≠tulo. ## Pacotes library(ecodados) library(here) library(tidyverse) library(sf) library(raster) library(rgdal)...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Cap√≠tulo 15 Dados geoespaciais | An√°lises Ecol√≥gicas no R">
<meta name="twitter:description" content="Pr√©-requisitos do cap√≠tulo Pacotes e dados que ser√£o utilizados nesse cap√≠tulo. ## Pacotes library(ecodados) library(here) library(tidyverse) library(sf) library(raster) library(rgdal)...">
<meta name="twitter:image" content="https://analises-ecologicas.netlify.app/img/capa.jpeg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="bs4_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">An√°lises Ecol√≥gicas no R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Sum√°rio"><h2>Sum√°rio</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Bem-vindos</a></li>
<li><a class="" href="pref%C3%A1cio.html">Pref√°cio</a></li>
<li><a class="" href="dedicat%C3%B3ria.html">Dedicat√≥ria</a></li>
<li><a class="" href="sobre-os-autores.html">Sobre os autores</a></li>
<li><a class="" href="revisores-e-colaboradores.html">Revisores e colaboradores</a></li>
<li><a class="" href="cap1.html"><span class="header-section-number">1</span> Introdu√ß√£o</a></li>
<li><a class="" href="cap2.html"><span class="header-section-number">2</span> Voltando ao b√°sico: como dominar a arte de fazer perguntas cientificamente relevantes</a></li>
<li><a class="" href="cap3.html"><span class="header-section-number">3</span> Pr√©-requisitos</a></li>
<li><a class="" href="cap4.html"><span class="header-section-number">4</span> Introdu√ß√£o ao R</a></li>
<li><a class="" href="cap5.html"><span class="header-section-number">5</span> Tidyverse</a></li>
<li><a class="" href="cap6.html"><span class="header-section-number">6</span> Visualiza√ß√£o de dados</a></li>
<li><a class="" href="cap7.html"><span class="header-section-number">7</span> Modelos lineares</a></li>
<li><a class="" href="cap8.html"><span class="header-section-number">8</span> Modelos Lineares Generalizados</a></li>
<li><a class="" href="cap9.html"><span class="header-section-number">9</span> An√°lises Multidimensionais</a></li>
<li><a class="" href="cap10.html"><span class="header-section-number">10</span> Rarefa√ß√£o</a></li>
<li><a class="" href="cap11.html"><span class="header-section-number">11</span> Estimadores de riqueza</a></li>
<li><a class="" href="cap12.html"><span class="header-section-number">12</span> Diversidade Taxon√¥mica</a></li>
<li><a class="" href="cap13.html"><span class="header-section-number">13</span> Diversidade Filogen√©tica</a></li>
<li><a class="" href="cap14.html"><span class="header-section-number">14</span> Diversidade Funcional</a></li>
<li><a class="active" href="cap15.html"><span class="header-section-number">15</span> Dados geoespaciais</a></li>
<li><a class="" href="gloss%C3%A1rio.html">Gloss√°rio</a></li>
<li><a class="" href="refer%C3%AAncias.html">Refer√™ncias</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/paternogbc/livro_aer">Ver c√≥digo fonte <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="cap15" class="section level1" number="15">
<h1>
<span class="header-section-number">Cap√≠tulo 15</span> Dados geoespaciais<a class="anchor" aria-label="anchor" href="#cap15"><i class="fas fa-link"></i></a>
</h1>
<div id="pr√©-requisitos-do-cap√≠tulo-11" class="section level2 unnumbered">
<h2>Pr√©-requisitos do cap√≠tulo<a class="anchor" aria-label="anchor" href="#pr%C3%A9-requisitos-do-cap%C3%ADtulo-11"><i class="fas fa-link"></i></a>
</h2>
<p>Pacotes e dados que ser√£o utilizados nesse cap√≠tulo.</p>
<div class="sourceCode" id="cb548"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Pacotes</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ecodados</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span> 
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster">raster</a></span><span class="op">)</span> 
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://rgdal.r-forge.r-project.org">rgdal</a></span><span class="op">)</span> 
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://nowosad.github.io/spData/">spData</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ropenscilabs/rnaturalearth">rnaturalearth</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ipeaGIT/geobr">geobr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://paleolimbot.github.io/ggspatial/">ggspatial</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mtennekes/tmap">tmap</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mtennekes/tmaptools">tmaptools</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/mapview">mapview</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/leaflet/">leaflet</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/">viridis</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rpradosiqueira/sidrar/">sidrar</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/landscapetools/">landscapetools</a></span><span class="op">)</span>

<span class="co">## Dados</span>
<span class="co"># world &lt;- world</span>
<span class="co"># volcano &lt;- volcano</span>
<span class="co"># geo_anfibios_locais &lt;- ecodados::geo_anfibios_locais</span>
<span class="co"># geo_anfibios_especies &lt;- ecodados::geo_anfibios_especies</span>
<span class="co"># geo_vetor_nascentes &lt;- ecodados::geo_vetor_nascentes</span>
<span class="co"># geo_vetor_hidrografia &lt;- ecodados::geo_vetor_hidrografia</span>
<span class="co"># geo_vetor_cobertura &lt;- ecodados::geo_vetor_cobertura</span>
<span class="co"># geo_vetor_rio_claro &lt;- ecodados::geo_vetor_rio_claro</span>
<span class="co"># geo_vetor_brasil &lt;- ecodados::geo_vetor_brasil</span>
<span class="co"># geo_vetor_brasil_anos &lt;- ecodados::geo_vetor_brasil_anos</span>
<span class="co"># geo_vetor_am_sul &lt;- ecodados::geo_vetor_am_sul</span>
<span class="co"># geo_vetor_biomas &lt;- ecodados::geo_vetor_biomas</span>
<span class="co"># geo_vetor_mata_atlantica &lt;- ecodados::geo_vetor_mata_atlantica</span>
<span class="co"># geo_raster_srtm &lt;- ecodados::geo_raster_srtm</span>
<span class="co"># geo_raster_bioclim &lt;- ecodados::geo_raster_bioclim</span>
<span class="co"># geo_raster_globcover_mata_atlantica &lt;- ecodados::geo_raster_globcover_mata_atlantica</span></code></pre></div>
</div>
<div id="contextualiza√ß√£o-3" class="section level2" number="15.1">
<h2>
<span class="header-section-number">15.1</span> Contextualiza√ß√£o<a class="anchor" aria-label="anchor" href="#contextualiza%C3%A7%C3%A3o-3"><i class="fas fa-link"></i></a>
</h2>
<p>Nesta se√ß√£o, vamos fazer uma breve introdu√ß√£o aos principais conceitos sobre a manipula√ß√£o e visualiza√ß√£o de dados geoespaciais no R. Iremos abordar temas de forma te√≥rica e pr√°tica, utilizando a linguagem R, focando em: i) formatos de dados vetoriais e dados raster, ii) Sistemas de Refer√™ncias de Coordenadas e unidades (geogr√°ficas e projetadas), iii) fontes de dados, iv) importar e exportar dados, v) descri√ß√£o de objetos geoespaciais e vi) principais opera√ß√µes (atributos, espaciais e geom√©tricas). Num segundo momento, criaremos mapas com seus principais elementos como mapas principal e secund√°rio, t√≠tulo, legenda, barra de escala, indicador de orienta√ß√£o (Norte), gride de coordenadas, descri√ß√£o do Sistema de Refer√™ncia de Coordenadas e informa√ß√µes de origem dos dados. Por fim, apresentaremos exemplos de aplica√ß√µes de an√°lises geoespaciais para dados ecol√≥gicos, focadas em: i) agregar informa√ß√µes sobre a biodiversidade, ii) preparar dados para compor vari√°veis preditoras, e iii) como fazer predi√ß√µes espaciais de distribui√ß√£o de uma esp√©cie e riqueza de esp√©cies.</p>
<p>Esse cap√≠tulo segue parte da estrutura organizada por Lovelace et al. <span class="citation">(<a href="refer%C3%AAncias.html#ref-lovelace2019" role="doc-biblioref">2019</a>)</span>, principalmente os Cap√≠tulos 2 a 8, sendo adaptado para atender aos principais requisitos que julgamos necess√°rios a estudos ecol√≥gicos. Entretanto, n√£o foi poss√≠vel cobrir todos os assuntos sobre o uso de dados geoespaciais no R, sendo um tema muito extenso que requer a leitura de livros especializados na √°rea como: i) Mas et al. <span class="citation">(<a href="refer%C3%AAncias.html#ref-mas2019" role="doc-biblioref">2019</a>)</span> <a href="https://bit.ly/2KpSI7C">An√°lise espacial com R</a>, ii) Wegmann, Leutner &amp; Dech <span class="citation">(<a href="refer%C3%AAncias.html#ref-wegmann2016" role="doc-biblioref">2016</a>)</span> <em>Remote Sensing and GIS for Ecologists: Using Open Source Software</em>, iii) Wegmann, Schwalb-Willmann &amp; Dech <span class="citation">(<a href="refer%C3%AAncias.html#ref-wegmann2020" role="doc-biblioref">2020</a>)</span> <em>An Introduction to Spatial Data Analysis Remote Sensing and GIS with Open Source Software</em>, e iv) Fletcher &amp; Fortin <span class="citation">(<a href="refer%C3%AAncias.html#ref-fletcher2018" role="doc-biblioref">2018</a>)</span> <em>Spatial ecology and conservation modeling: Applications with R</em>. Outros livros sobre a an√°lise geoespacial no R podem ser consultados no Cap√≠tulo <a href="https://www.bigbookofr.com/geospatial.html">11 - Geospatial</a> do <a href="https://www.bigbookofr.com/index.html">Big Book of R</a>.</p>
</div>
<div id="vetor" class="section level2" number="15.2">
<h2>
<span class="header-section-number">15.2</span> Vetor<a class="anchor" aria-label="anchor" href="#vetor"><i class="fas fa-link"></i></a>
</h2>
<p>Dados vetoriais s√£o usados para mapear fen√¥menos ou objetos espacialmente expl√≠citos que possuem localiza√ß√£o ou dimens√µes bem definidas, representado a partir de formas geom√©tricas (como pontos, linhas e pol√≠gonos) e possuem a possibilidade de ter associado a eles informa√ß√µes tabulares. A tabela de atributos √© uma tabela que inclui dados geoespaciais e dados alfanum√©ricos. Os dados geoespaciais s√£o representados por fei√ß√µes geolocalizada espacialmente (ponto, linha ou pol√≠gono), e os dados alfanum√©ricos (tabela de dados). Dessa forma, a tabela de atributos re√∫ne informa√ß√µes sobre cada fei√ß√£o e pode ser utilizada para realizar de filtros ou agrega√ß√µes dos dados de cada fei√ß√£o (Figura <a href="cap15.html#fig:fig-vetor-tipos">15.1</a>).</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-tipos"></span>
<img src="img/cap15_fig01.png" alt="Representa√ß√£o das geometrias de ponto, linha e pol√≠gono e atributos. Adaptado de:Olaya [-@olaya2020])." width="100%" height="100%"><p class="caption">
Figura 15.1: Representa√ß√£o das geometrias de ponto, linha e pol√≠gono e atributos. Adaptado de:Olaya <span class="citation">(<a href="refer%C3%AAncias.html#ref-olaya2020" role="doc-biblioref">2020</a>)</span>).
</p>
</div>
<div id="sf-principal-pacote-no-r-para-dados-vetoriais" class="section level3" number="15.2.1">
<h3>
<span class="header-section-number">15.2.1</span> sf: principal pacote no R para dados vetoriais<a class="anchor" aria-label="anchor" href="#sf-principal-pacote-no-r-para-dados-vetoriais"><i class="fas fa-link"></i></a>
</h3>
<p>Atualmente o principal pacote para trabalhar com dados vetoriais no R √© o <a href="https://r-spatial.github.io/sf/"><code>sf</code></a>, que implementou o <em>Simple Feature</em> <span class="citation">(<a href="refer%C3%AAncias.html#ref-sf2018" role="doc-biblioref">E. Pebesma 2018</a>)</span>. Entretanto, outro pacote pode ser t√£o vers√°til quanto o <code>sf</code>, no caso o <a href="https://rspatial.org/terra/index.html"><code>terra</code></a>, com algumas mudan√ßas na sintaxe que n√£o abordaremos nesse livro por quest√µes de redu√ß√£o de espa√ßo.</p>
<p>Os tipos de geometrias apresentadas s√£o representados por diferentes classes: <code>POINT</code>, <code>LINESTRING</code> e <code>POLYGON</code> para apenas uma fei√ß√£o de cada tipo de geometria; <code>MULTIPOINT</code>, <code>MULTILINESTRING</code> e <code>MULTIPOLYGON</code> para v√°rias fei√ß√µes de cada tipo de geometria e; <code>GEOMETRYCOLLECTION</code> para v√°rias fei√ß√µes e tipos de geometrias e classes.</p>
<p>Ao olharmos as informa√ß√µes de um objeto da classe <code>sf</code>, podemos notar diversas informa√ß√µes que descrevem o mesmo, numa esp√©cie de cabe√ßalho:</p>
<ul>
<li>
<strong>resumo do vetor</strong>: indica o n√∫mero de fei√ß√µes (linhas) e campos (colunas)</li>
<li>
<strong>tipo da geometria</strong>: umas das sete classes (ou mais outras) listadas anteriormente</li>
<li>
<strong>dimens√£o</strong>: n√∫mero de dimens√µes, geralmente duas (XY)</li>
<li>
<strong>bbox (bordas)</strong>: coordenadas m√≠nimas e m√°ximas da longitude e latitude</li>
<li>
<strong>informa√ß√£o do CRS</strong>: <code>epsg</code> ou <code>proj4string</code> indicando o CRS (<em>Coordinate Reference System</em>)</li>
<li>
<strong>tibble</strong>: tabela de atributos, com destaque para a coluna <code>geom</code> ou <code>geometry</code> que representa cada fei√ß√£o ou geometria</li>
</ul>
<div class="sourceCode" id="cb549"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Dados vetoriais de pol√≠gonos do mundo</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">world</span><span class="op">)</span>
<span class="va">world</span>
<span class="co">#&gt; Simple feature collection with 177 features and 10 fields</span>
<span class="co">#&gt; Geometry type: MULTIPOLYGON</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: -180 ymin: -89.9 xmax: 180 ymax: 83.64513</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt; # A tibble: 177 √ó 11</span>
<span class="co">#&gt;    iso_a2 name_long  continent region_un subregion type  area_km2     pop lifeExp gdpPercap                      geom</span>
<span class="co">#&gt;  * &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;        &lt;MULTIPOLYGON [¬∞]&gt;</span>
<span class="co">#&gt;  1 FJ     Fiji       Oceania   Oceania   Melanesia Sove‚Ä¶   1.93e4  8.86e5    70.0     8222. (((-180 -16.55522, -179.‚Ä¶</span>
<span class="co">#&gt;  2 TZ     Tanzania   Africa    Africa    Eastern ‚Ä¶ Sove‚Ä¶   9.33e5  5.22e7    64.2     2402. (((33.90371 -0.95, 31.86‚Ä¶</span>
<span class="co">#&gt;  3 EH     Western S‚Ä¶ Africa    Africa    Northern‚Ä¶ Inde‚Ä¶   9.63e4 NA         NA         NA  (((-8.66559 27.65643, -8‚Ä¶</span>
<span class="co">#&gt;  4 CA     Canada     North Am‚Ä¶ Americas  Northern‚Ä¶ Sove‚Ä¶   1.00e7  3.55e7    82.0    43079. (((-132.71 54.04001, -13‚Ä¶</span>
<span class="co">#&gt;  5 US     United St‚Ä¶ North Am‚Ä¶ Americas  Northern‚Ä¶ Coun‚Ä¶   9.51e6  3.19e8    78.8    51922. (((-171.7317 63.78252, -‚Ä¶</span>
<span class="co">#&gt;  6 KZ     Kazakhstan Asia      Asia      Central ‚Ä¶ Sove‚Ä¶   2.73e6  1.73e7    71.6    23587. (((87.35997 49.21498, 86‚Ä¶</span>
<span class="co">#&gt;  7 UZ     Uzbekistan Asia      Asia      Central ‚Ä¶ Sove‚Ä¶   4.61e5  3.08e7    71.0     5371. (((55.96819 41.30864, 57‚Ä¶</span>
<span class="co">#&gt;  8 PG     Papua New‚Ä¶ Oceania   Oceania   Melanesia Sove‚Ä¶   4.65e5  7.76e6    65.2     3709. (((141.0002 -2.600151, 1‚Ä¶</span>
<span class="co">#&gt;  9 ID     Indonesia  Asia      Asia      South-Ea‚Ä¶ Sove‚Ä¶   1.82e6  2.55e8    68.9    10003. (((104.37 -1.084843, 104‚Ä¶</span>
<span class="co">#&gt; 10 AR     Argentina  South Am‚Ä¶ Americas  South Am‚Ä¶ Sove‚Ä¶   2.78e6  4.30e7    76.3    18798. (((-68.63401 -52.63637, ‚Ä¶</span>
<span class="co">#&gt; # ‚Ä¶ with 167 more rows</span></code></pre></div>
<p>Podemos fazer um mapa simples utilizando a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/plot.html">plot()</a></code> desse objeto. Para facilitar, escolheremos apenas a primeira coluna <code>[1]</code> (Figura <a href="cap15.html#fig:fig-vetor-mundo">15.2</a>). Caso n√£o escolhermos apenas uma coluna, um mapa para cada coluna ser√° plotado.</p>
<div class="alert alert-info">
<p><strong> üìù Importante </strong><br>
Faremos mapas mais elaborados na se√ß√£o de visualiza√ß√£o de dados geoespaciais deste cap√≠tulo.</p>
</div>
<div class="sourceCode" id="cb550"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot dos pol√≠gonos do mundo</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">world</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Mapa do mundo"</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-mundo"></span>
<img src="livro_files/figure-html/fig-vetor-mundo-1.png" alt="Mapa vetorial do mundo." width="100%" height="100%"><p class="caption">
Figura 15.2: Mapa vetorial do mundo.
</p>
</div>
</div>
</div>
<div id="raster" class="section level2" number="15.3">
<h2>
<span class="header-section-number">15.3</span> Raster<a class="anchor" aria-label="anchor" href="#raster"><i class="fas fa-link"></i></a>
</h2>
<p>Os dados no formato raster consistem em uma matriz (com linhas e colunas) em que os elementos representam c√©lulas, geralmente igualmente espa√ßadas (pixels; Figura <a href="cap15.html#fig:fig-raster">15.3</a>). As c√©lulas dos dados raster possuem duas informa√ß√µes: i) identifica√ß√£o das c√©lulas (IDs das c√©lulas) para especificar sua posi√ß√£o na matriz (Figura <a href="cap15.html#fig:fig-raster">15.3</a> A) e; ii) valores das c√©lulas (Figura <a href="cap15.html#fig:fig-raster">15.3</a> B), que geralmente s√£o coloridos para facilitar a interpreta√ß√£o da varia√ß√£o dos valores no espa√ßo (Figura <a href="cap15.html#fig:fig-raster">15.3</a> C). Al√©m disso, valores ausentes ou n√£o amostrados s√£o representados por <code>NA</code>, ou seja, <em>not available</em> (Figura <a href="cap15.html#fig:fig-raster">15.3</a> B e C).</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster"></span>
<img src="livro_files/figure-html/fig-raster-1.png" alt="Raster: (A) IDs das c√©lulas, (B) valores das c√©lulas, (C) c√©lulas coloridas. Adaptado de:Lovelace et al. [-@lovelace2019]." width="100%" height="100%"><p class="caption">
Figura 15.3: Raster: (A) IDs das c√©lulas, (B) valores das c√©lulas, (C) c√©lulas coloridas. Adaptado de:Lovelace et al. <span class="citation">(<a href="refer%C3%AAncias.html#ref-lovelace2019" role="doc-biblioref">2019</a>)</span>.
</p>
</div>
<p>Pode ainda fazer uma compara√ß√£o com as representa√ß√µes de dados vetoriais vistos na Figura <a href="cap15.html#fig:fig-vetor-tipos">15.1</a>, mas agora no formato raster (Figura <a href="cap15.html#fig:fig-raster-tipos">15.4</a>).</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-tipos"></span>
<img src="img/cap15_fig02.png" alt="Representa√ß√£o das geometrias de ponto, linha e pol√≠gono no formato raster. Adaptado de:Olaya [-@olaya2020]." width="100%" height="100%"><p class="caption">
Figura 15.4: Representa√ß√£o das geometrias de ponto, linha e pol√≠gono no formato raster. Adaptado de:Olaya <span class="citation">(<a href="refer%C3%AAncias.html#ref-olaya2020" role="doc-biblioref">2020</a>)</span>.
</p>
</div>
<div id="raster-principal-pacote-no-r-para-dados-raster" class="section level3" number="15.3.1">
<h3>
<span class="header-section-number">15.3.1</span> raster: principal pacote no R para dados raster<a class="anchor" aria-label="anchor" href="#raster-principal-pacote-no-r-para-dados-raster"><i class="fas fa-link"></i></a>
</h3>
<p>Atualmente, o principal pacote para trabalhar com dados raster √© o <a href="https://rspatial.org/raster/index.html"><em>raster</em></a>, apesar de existir outros dois: <a href="https://rspatial.org/terra/index.html"><em>terra</em></a> e <a href="https://r-spatial.github.io/stars/"><em>stars</em></a>, com algumas mudan√ßas na sintaxe que n√£o abordaremos neste livro.</p>
<p>O pacote <code>raster</code> fornece uma ampla gama de fun√ß√µes para criar, importar, exportar, manipular e processar dados raster no R. O objeto raster criado √† partir do pacote <code>raster</code> pode assumir tr√™s classes: <code>RasterLayer</code>, <code>RasterStack</code> e <code>RasterBrick</code>.</p>
<p>A classe <code>RasterLayer</code> representa apenas uma camada raster. Para criar ou importar um raster no R podemos utilizar a fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/raster.html">raster::raster()</a></code>. Observando essa classe, podemos notar as seguintes informa√ß√µes:</p>
<ul>
<li>
<strong>class</strong>: classe raster do objeto raster</li>
<li>
<strong>dimensions</strong>: n√∫mero de linhas, colunas e c√©lulas</li>
<li>
<strong>resolution</strong>: largura e altura da c√©lula</li>
<li>
<strong>extent</strong>: coordenadas m√≠nimas e m√°ximas da longitude e latitude</li>
<li>
<strong>crs</strong>: Sistema de Refer√™ncia de Coordenadas (<em>CRS</em>)</li>
<li>
<strong>source</strong>: fonte dos dados (mem√≥ria ou disco)</li>
<li>
<strong>names</strong>: nome das camadas</li>
<li>
<strong>values</strong>: valores m√°ximos e m√≠nimos das c√©lulas</li>
</ul>
<p>Vamos utilizar os dados <code>volcano</code>, que possui informa√ß√µes topogr√°ficas (eleva√ß√£o) do vulc√£o Maunga Whau de Auckland na Nova Zel√¢ndia.</p>
<div class="sourceCode" id="cb551"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Dados de altitude de um vulc√£o</span>
<span class="va">volcano</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>
<span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span>
<span class="co">#&gt; [1,]  100  100  101  101  101</span>
<span class="co">#&gt; [2,]  101  101  102  102  102</span>
<span class="co">#&gt; [3,]  102  102  103  103  103</span>
<span class="co">#&gt; [4,]  103  103  104  104  104</span>
<span class="co">#&gt; [5,]  104  104  105  105  105</span></code></pre></div>
<p>Vamos transformar essa matriz de dados em um raster com a fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/raster.html">raster::raster()</a></code>.</p>
<div class="sourceCode" id="cb552"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Rasterlayer</span>
<span class="va">raster_layer</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html">raster</a></span><span class="op">(</span><span class="va">volcano</span><span class="op">)</span>
<span class="va">raster_layer</span>
<span class="co">#&gt; class      : RasterLayer </span>
<span class="co">#&gt; dimensions : 87, 61, 5307  (nrow, ncol, ncell)</span>
<span class="co">#&gt; resolution : 0.01639344, 0.01149425  (x, y)</span>
<span class="co">#&gt; extent     : 0, 1, 0, 1  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs        : NA </span>
<span class="co">#&gt; source     : memory</span>
<span class="co">#&gt; names      : layer </span>
<span class="co">#&gt; values     : 94, 195  (min, max)</span></code></pre></div>
<p>Um mapa simples do objeto raster pode ser obtido utilizando a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/plot.html">plot()</a></code>, do pr√≥prio pacote <code>raster</code> (Figura <a href="cap15.html#fig:fig-raster-layer">15.5</a>).</p>
<div class="sourceCode" id="cb553"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot raster layers</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">raster_layer</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-layer"></span>
<img src="livro_files/figure-html/fig-raster-layer-1.png" alt="Mapa simples de um `RasterLayer`." width="100%" height="100%"><p class="caption">
Figura 15.5: Mapa simples de um <code>RasterLayer</code>.
</p>
</div>
<p>Al√©m da classe <code>RasterLayer</code>, h√° mais duas classes que trabalham com m√∫ltiplas camadas: <code>RasterBrick</code> e <code>RasterStack</code>. Elas diferem em rela√ß√£o ao n√∫mero de formatos de arquivo suportados, tipo de representa√ß√£o interna e velocidade de processamento.</p>
<p>A classe <code>RasterBrick</code> geralmente corresponde √† importa√ß√£o de um √∫nico arquivo de imagem de sat√©lite multiespectral (multicamadas) ou a um √∫nico objeto com v√°rias camadas na mem√≥ria. A fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/brick.html">raster::brick()</a></code> cria um objeto <code>RasterBrick</code>.</p>
<div class="sourceCode" id="cb554"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Raster layers</span>
<span class="va">raster_layer1</span> <span class="op">&lt;-</span> <span class="va">raster_layer</span>
<span class="va">raster_layer2</span> <span class="op">&lt;-</span> <span class="va">raster_layer</span> <span class="op">*</span> <span class="va">raster_layer</span>
<span class="va">raster_layer3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">raster_layer</span><span class="op">)</span>
<span class="va">raster_layer4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">raster_layer</span><span class="op">)</span>

<span class="co">## Raster brick</span>
<span class="va">raster_brick</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span><span class="op">(</span><span class="va">raster_layer1</span>, <span class="va">raster_layer2</span>, 
                              <span class="va">raster_layer3</span>, <span class="va">raster_layer4</span><span class="op">)</span>
<span class="va">raster_brick</span>
<span class="co">#&gt; class      : RasterBrick </span>
<span class="co">#&gt; dimensions : 87, 61, 5307, 4  (nrow, ncol, ncell, nlayers)</span>
<span class="co">#&gt; resolution : 0.01639344, 0.01149425  (x, y)</span>
<span class="co">#&gt; extent     : 0, 1, 0, 1  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs        : NA </span>
<span class="co">#&gt; source     : memory</span>
<span class="co">#&gt; names      :      layer.1,      layer.2,      layer.3,      layer.4 </span>
<span class="co">#&gt; min values :    94.000000,  8836.000000,     9.695360,     1.973128 </span>
<span class="co">#&gt; max values :   195.000000, 38025.000000,    13.964240,     2.290035</span></code></pre></div>
<p>Ao utilizarmos a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/plot.html">plot()</a></code> do pacote <code>raster</code>, podemos visualizar os raster contidos no objeto <code>RasterBrick</code> (Figura <a href="cap15.html#fig:fig-raster-brick">15.6</a>).</p>
<div class="sourceCode" id="cb555"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot raster brick</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">raster_brick</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-brick"></span>
<img src="livro_files/figure-html/fig-raster-brick-1.png" alt="Mapas simples de um raster `RasterBrick`." width="100%" height="100%"><p class="caption">
Figura 15.6: Mapas simples de um raster <code>RasterBrick</code>.
</p>
</div>
<p>J√° a classe <code>RasterStack</code> permite conectar v√°rios objetos raster armazenados em arquivos diferentes ou v√°rios objetos no ambiente do R. Um <code>RasterStack</code> √© uma lista de objetos <code>RasterLayer</code> com a mesma extens√£o, resolu√ß√£o e CRS. Uma maneira de cri√°-lo √© com a jun√ß√£o de v√°rios objetos geoespaciais j√° existentes no ambiente do R ou listar v√°rios arquivos raster em um diret√≥rio armazenado no disco. A fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/stack.html">raster::stack()</a></code> cria um objeto <code>RasterStack</code>.</p>
<p>Outra diferen√ßa √© que o tempo de processamento, para objetos <code>RasterBrick</code> geralmente √© menor do que para objetos <code>RasterStack</code>. A decis√£o sobre qual classe <code>Raster</code> deve ser usada depende principalmente do car√°ter dos dados de entrada.</p>
<div class="sourceCode" id="cb556"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Raster layers</span>
<span class="va">raster_layer1</span> <span class="op">&lt;-</span> <span class="va">raster_layer</span>
<span class="va">raster_layer2</span> <span class="op">&lt;-</span> <span class="va">raster_layer</span> <span class="op">*</span> <span class="va">raster_layer</span>
<span class="va">raster_layer3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">raster_layer</span><span class="op">)</span>
<span class="va">raster_layer4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">raster_layer</span><span class="op">)</span>

<span class="co">## Raster stack</span>
<span class="va">raster_stack</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html">stack</a></span><span class="op">(</span><span class="va">raster_layer1</span>, <span class="va">raster_layer2</span>, 
                              <span class="va">raster_layer3</span>, <span class="va">raster_layer4</span><span class="op">)</span>
<span class="va">raster_stack</span>
<span class="co">#&gt; class      : RasterStack </span>
<span class="co">#&gt; dimensions : 87, 61, 5307, 4  (nrow, ncol, ncell, nlayers)</span>
<span class="co">#&gt; resolution : 0.01639344, 0.01149425  (x, y)</span>
<span class="co">#&gt; extent     : 0, 1, 0, 1  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs        : NA </span>
<span class="co">#&gt; names      :      layer.1,      layer.2,      layer.3,      layer.4 </span>
<span class="co">#&gt; min values :    94.000000,  8836.000000,     9.695360,     1.973128 </span>
<span class="co">#&gt; max values :   195.000000, 38025.000000,    13.964240,     2.290035</span></code></pre></div>
<p>Da mesma forma, ao utilizar a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/plot.html">plot()</a></code> do pacote <code>raster</code>, podemos visualizar os raster contidos no objeto <code>RasterStack</code> (Figura <a href="cap15.html#fig:fig-raster-stack">15.7</a>).</p>
<div class="sourceCode" id="cb557"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot raster stack</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">raster_stack</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-stack"></span>
<img src="livro_files/figure-html/fig-raster-stack-1.png" alt="Mapas simples de um raster `RasterStack`." width="100%" height="100%"><p class="caption">
Figura 15.7: Mapas simples de um raster <code>RasterStack</code>.
</p>
</div>
</div>
</div>
<div id="sistema-de-refer√™ncia-de-coordenadas-e-unidades" class="section level2" number="15.4">
<h2>
<span class="header-section-number">15.4</span> Sistema de Refer√™ncia de Coordenadas e Unidades<a class="anchor" aria-label="anchor" href="#sistema-de-refer%C3%AAncia-de-coordenadas-e-unidades"><i class="fas fa-link"></i></a>
</h2>
<p>Os dados geoespaciais (vetor e raster) possuem ainda um outro componente fundamental que √© o Sistema de Refer√™ncia de Coordenadas, ou do ingl√™s <em>Coordinate Reference System (CRS)</em>. Esse componente define a refer√™ncia espacial dos elementos geoespaciais (vetor e raster) na superf√≠cie da Terra. Esse componente √© composto por dois principais conceitos: primeiro, que tipos de unidades est√£o sendo utilizadas para a representa√ß√£o geogr√°fica, podendo assumir dois tipos - √¢ngulos ou metros, que definem o Sistema de Coordenadas Geogr√°ficas e o Sistema de Coordenadas Projetadas, respectivamente. O segundo componente √© o <em>datum</em>, que √© a rela√ß√£o do sistema de coordenadas (geogr√°fica ou projetada) com a superf√≠cie da Terra. Esse √∫ltimo componente faz parte de uma √°rea da Cartografia denominada Geod√©sia que estuda a forma e dimens√µes da Terra, campo gravitacional e a localiza√ß√£o de pontos fixos e sistemas de coordenadas. O livro de Lapaine &amp; Usery <span class="citation">(<a href="refer%C3%AAncias.html#ref-lapaine2017" role="doc-biblioref">2017</a>)</span> √© um excelente material para se aprofundar nesse assunto.</p>
<div id="sistema-de-coordenadas-geogr√°ficas" class="section level3" number="15.4.1">
<h3>
<span class="header-section-number">15.4.1</span> Sistema de Coordenadas Geogr√°ficas<a class="anchor" aria-label="anchor" href="#sistema-de-coordenadas-geogr%C3%A1ficas"><i class="fas fa-link"></i></a>
</h3>
<p>O Sistema de Coordenadas Geogr√°ficas utiliza √¢ngulos (graus) para representar fei√ß√µes na superf√≠cie da Terra atrav√©s de dois valores: longitude e latitude. A longitude representa o eixo Leste-Oeste e a latitude o eixo Norte-Sul. Nesse sistema, a superf√≠cie da Terra √© representada geralmente por uma superf√≠cie elipsoidal, pois a Terra √© ligeiramente achatada nos polos devido ao seu movimento no entorno do seu eixo.</p>
</div>
<div id="sistema-de-coordenadas-projetadas" class="section level3" number="15.4.2">
<h3>
<span class="header-section-number">15.4.2</span> Sistema de Coordenadas Projetadas<a class="anchor" aria-label="anchor" href="#sistema-de-coordenadas-projetadas"><i class="fas fa-link"></i></a>
</h3>
<p>O Sistema de Coordenadas Projetadas utiliza um Sistema Cartesiano de Coordenadas em uma superf√≠cie plana. Dessa forma, a partir de uma origem tra√ßam-se eixos X e Y e uma unidade linear √© utilizada, como o metro. Todos as proje√ß√µes feitas de sistemas geoespaciais convertem uma superf√≠cie tridimensional em uma superf√≠cie plana bidimensional. Sendo assim, essa convers√£o traz consigo algum tipo de distor√ß√£o em rela√ß√£o √† por√ß√£o real, podendo ser distor√ß√µes em: i) formas locais, ii) √°reas, iii) dist√¢ncias, iv) flex√£o ou curvatura, v) assimetria ou vi) lacunas de continuidade. Dessa forma, um sistema de coordenadas projetadas pode preservar somente uma ou duas dessas propriedades.</p>
<p>Existem tr√™s grandes grupos de proje√ß√µes: i) cil√≠ndricos, ii) c√¥nicos e iii) planares. Na proje√ß√£o cil√≠ndrica, a superf√≠cie da Terra √© mapeada em um cilindro, criada tocando a superf√≠cie da Terra ao longo de uma ou duas linhas de tang√™ncia, sendo utilizada com mais frequ√™ncia para mapear todo o globo tendo como exemplo mais conhecido a Proje√ß√£o Universal Transversa de Mercator (UTM). Na proje√ß√£o c√¥nica, a superf√≠cie da Terra √© projetada em um cone ao longo de uma linha ou duas linhas de tang√™ncia, de modo que as distor√ß√µes s√£o minimizadas ao longo das linhas e aumentam com a dist√¢ncia das mesmas sendo, portanto, mais adequada para mapear √°reas de latitudes m√©dias, tendo como exemplo mais conhecido a Proje√ß√£o C√¥nica Equivalente de Albers e a Proje√ß√£o C√¥nica Conforme de Lambert. E na proje√ß√£o plana, tamb√©m denominada Proje√ß√£o Azimutal, o mapeamento toca o globo em um ponto ou ao longo de uma linha de tang√™ncia, sendo normalmente utilizado no mapeamento de regi√µes polares, sendo a mais comum a Proje√ß√£o Azimutal Equidistante, a mesma utilizada na bandeira da ONU.</p>
</div>
<div id="datum" class="section level3" number="15.4.3">
<h3>
<span class="header-section-number">15.4.3</span> Datum<a class="anchor" aria-label="anchor" href="#datum"><i class="fas fa-link"></i></a>
</h3>
<p>Como dito anteriormente, o <em>datum</em> √© a rela√ß√£o do sistema de coordenadas com a superf√≠cie da Terra. Ele representa o ponto de intersec√ß√£o do elipsoide de refer√™ncia com a superf√≠cie da Terra (geoide, a forma verdadeira da Terra), compensando as diferen√ßas do campo gravitacional da Terra. Existem dois tipos de datum: i) local e ii) geoc√™ntrico. Em um <em>datum</em> local, como o SAD69 - <em>South American Datum 1969</em>, o elipsoide de refer√™ncia √© deslocado para se alinhar com a superf√≠cie em um determinado local, por exemplo, na Am√©rica do Sul. J√° em um <em>datum</em> geoc√™ntrico, como WGS84 - <em>World Geodetic System 1984</em>, o centro do elipsoide √© o centro de gravidade da Terra e a precis√£o das proje√ß√µes n√£o √© otimizada para um local espec√≠fico do globo.</p>
<p>No Brasil, desde 2015, o <a href="https://www.ibge.gov.br/">Instituto Brasileiro de Geografia e Estat√≠stica (IBGE)</a> ajudou a desenvolver e reafirmou o uso do <em>datum</em> SIRGAS2000 - <em>Sistema de Referencia Geoc√©ntrico para las Am√©ricas 2000</em> para todos os mapeamentos realizados no Brasil, um esfor√ßo conjunto para adotar o mesmo <em>datum</em> em toda a Am√©rica. Mais sobre esse <em>datum</em> pode ser lido aqui: <a href="http://www.sirgas.org/pt/sirgas-realizations/sirgas2000/">SIRGAS2000</a>.</p>
</div>
<div id="sistema-de-refer√™ncia-de-coordenadas-crs-no-r" class="section level3" number="15.4.4">
<h3>
<span class="header-section-number">15.4.4</span> Sistema de Refer√™ncia de Coordenadas (CRS) no R<a class="anchor" aria-label="anchor" href="#sistema-de-refer%C3%AAncia-de-coordenadas-crs-no-r"><i class="fas fa-link"></i></a>
</h3>
<p>No R, h√° duas formas principais de representar um Sistema de Refer√™ncia de Coordenadas: i) c√≥digo <code>epsg</code> e ii) <code>proj4string</code>. O c√≥digo EPSG (<em>European Petroleum Survey Group</em>) √© uma sequ√™ncia de n√∫meros curta, referindo-se apenas a um CRS. O site <a href="http://epsg.io/">epsg.io</a> permite consultar diversas informa√ß√µes sobre um c√≥digo, como procurar por um c√≥digo, representa√ß√£o de mapas e fazer transforma√ß√µes de CRS.</p>
<p>J√° o <code>proj4string</code> permite mais flexibilidade para especificar diferentes par√¢metros, como o tipo de proje√ß√£o, <em>datum</em> e elipsoide. Dessa forma, √© poss√≠vel especificar muitas proje√ß√µes, ou mesmo modificar as proje√ß√µes existentes, tornando a representa√ß√£o <code>proj4string</code> mais complexa e flex√≠vel.</p>
<p>Al√©m disso, ainda √© poss√≠vel consultar uma extensa lista de CRSs no site <a href="https://spatialreference.org/">spatialreference.org</a>, que fornece descri√ß√µes em diversos formatos, baseados em GDAL e Proj.4. Essa abordagem permite consultar uma URL que pode produzir uma refer√™ncia espacial em um formato que seu software SIG ou o R pode utilizar como refer√™ncia.</p>
<p>Os pacotes (geo)espaciais no R suportam uma ampla variedade de CRSs e usam a biblioteca <a href="https://proj.org/index.html#">PROJ</a>. A fun√ß√£o <code><a href="http://rgdal.r-forge.r-project.org/reference/make_EPSG.html">rgdal::make_EPSG()</a></code> retorna um <code>data frame</code> das proje√ß√µes dispon√≠veis, com informa√ß√µes dos c√≥digos <code>epsg</code> e <code>proj4string</code> numa mesma tabela, facilitando a busca e uso de CRSs (Tabela <a href="cap15.html#tab:tab-epsg">15.1</a>).</p>
<div class="sourceCode" id="cb558"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Listagem dos Sistemas de Refer√™ncias de Coordenadas no R</span>
<span class="va">crs_data</span> <span class="op">&lt;-</span> <span class="fu">rgdal</span><span class="fu">::</span><span class="fu"><a href="http://rgdal.r-forge.r-project.org/reference/make_EPSG.html">make_EPSG</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/headtail.html">head</a></span><span class="op">(</span><span class="va">crs_data</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:tab-epsg">Tabela 15.1: </span>Listagem de Sistemas de Refer√™ncias de Coordenadas dispon√≠veis no R, com informa√ß√µes dos c√≥digos <code>epsg</code> e <code>proj4string</code>
</caption>
<thead><tr>
<th style="text-align:right;">
code
</th>
<th style="text-align:left;">
note
</th>
<th style="text-align:left;">
prj4
</th>
<th style="text-align:left;">
prj_method
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
3819
</td>
<td style="text-align:left;">
HD1909
</td>
<td style="text-align:left;">
+proj=longlat +ellps=bessel +no_defs +type=crs
</td>
<td style="text-align:left;">
(null)
</td>
</tr>
<tr>
<td style="text-align:right;">
3821
</td>
<td style="text-align:left;">
TWD67
</td>
<td style="text-align:left;">
+proj=longlat +ellps=aust_SA +no_defs +type=crs
</td>
<td style="text-align:left;">
(null)
</td>
</tr>
<tr>
<td style="text-align:right;">
3822
</td>
<td style="text-align:left;">
TWD97
</td>
<td style="text-align:left;">
+proj=geocent +ellps=GRS80 +units=m +no_defs +type=crs
</td>
<td style="text-align:left;">
(null)
</td>
</tr>
<tr>
<td style="text-align:right;">
3823
</td>
<td style="text-align:left;">
TWD97
</td>
<td style="text-align:left;">
+proj=longlat +ellps=GRS80 +no_defs +type=crs
</td>
<td style="text-align:left;">
(null)
</td>
</tr>
<tr>
<td style="text-align:right;">
3824
</td>
<td style="text-align:left;">
TWD97
</td>
<td style="text-align:left;">
+proj=longlat +ellps=GRS80 +no_defs +type=crs
</td>
<td style="text-align:left;">
(null)
</td>
</tr>
<tr>
<td style="text-align:right;">
3887
</td>
<td style="text-align:left;">
IGRS
</td>
<td style="text-align:left;">
+proj=geocent +ellps=GRS80 +units=m +no_defs +type=crs
</td>
<td style="text-align:left;">
(null)
</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div id="principais-fontes-de-dados-geoespaciais" class="section level2" number="15.5">
<h2>
<span class="header-section-number">15.5</span> Principais fontes de dados geoespaciais<a class="anchor" aria-label="anchor" href="#principais-fontes-de-dados-geoespaciais"><i class="fas fa-link"></i></a>
</h2>
<p>Existem diversas fontes de dados geoespaciais em diferentes bases de dados dispon√≠veis gratuitamente. Geralmente essas bases de dados s√£o disponibilizadas separadamente em apenas dados vetoriais e dados raster. Para dados vetoriais, grande parte dos dados disponibilizados s√£o utilizados em mapas como limites pol√≠ticos, limites de biomas ou distribui√ß√£o de esp√©cies para pol√≠gonos; estradas e rios para dados lineares, ou ainda pontos de ocorr√™ncia de esp√©cies ou comunidades, ou medidas tomadas em campo sobre condi√ß√µes naturais como clima ou relevo, como pontos. Entretanto, √© sempre recomendado o uso de bases oficiais, principalmente em rela√ß√£o a dados vetoriais de limites pol√≠ticos. Para tanto, √© fundamental buscar as bases oficiais de cada pa√≠s, entretanto, h√° bases que podem ser utilizadas globalmente, como veremos.</p>
<p>Sobre as bases de dados raster, h√° uma infinidade de dados para diferentes objetivos, mas grande parte deles s√£o relativos a condi√ß√µes ambientais, representando uma vari√°vel de interesse de forma cont√≠nua no espa√ßo, como temperatura, precipita√ß√£o, eleva√ß√£o, etc.</p>
<p>H√° uma compila√ß√£o de dados geoespaciais vetoriais e raster feita por Marcus Vin√≠cius Alves de Carvalho e Angelica Carvalho Di Maio, chamada <a href="http://www.clickgeo.com.br/wp-content/uploads/2018/05/GeoLISTA.pdf">GeoLISTA</a>. Entretanto, como as bases de dados tendem a ser muito din√¢micas, √© poss√≠vel que muitas bases tenham surgido e desaparecido desde a listagem realizada.</p>
<p>Al√©m das bases de dados, h√° pacotes espec√≠ficos no R que fazem o download de dados vetoriais e rasters, facilitando a aquisi√ß√£o e reprodutibilidade. Para conferir uma listagem completa de pacotes para diversas an√°lises espaciais, veja <a href="https://cran.r-project.org/web/views/Spatial.html">CRAN Task View: Analysis of Spatial Data</a>.</p>
<div id="vetor-1" class="section level3" number="15.5.1">
<h3>
<span class="header-section-number">15.5.1</span> Vetor<a class="anchor" aria-label="anchor" href="#vetor-1"><i class="fas fa-link"></i></a>
</h3>
<p>Dentre as bases vetoriais, destacamos as seguintes na Tabela <a href="cap15.html#tab:tab-vetor-bases">15.2</a>.</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:tab-vetor-bases">Tabela 15.2: </span>Principais bases de dados vetoriais para o Brasil e o Mundo.
</caption>
<thead><tr>
<th style="text-align:left;">
Bases de dados
</th>
<th style="text-align:left;">
Descri√ß√£o
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="https://www.ibge.gov.br/geociencias/downloads-geociencias.html">IBGE</a>
</td>
<td style="text-align:left;">
Limites territoriais e censit√°rios do Brasil
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="http://geo.fbds.org.br/">FBDS</a>
</td>
<td style="text-align:left;">
Uso da terra, APP e hidrografia - Mata Atl√¢ntica e Cerrado
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="http://geosgb.cprm.gov.br/">GeoBank</a>
</td>
<td style="text-align:left;">
Dados geol√≥gicos do Brasil
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="http://maps.lapig.iesa.ufg.br">Pastagem.org</a>
</td>
<td style="text-align:left;">
Dados de pastagens e gado para o Brasil
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="http://www.dsr.inpe.br/laf/canasat/">CanaSat</a>
</td>
<td style="text-align:left;">
Dados de cana-de-a√ß√∫car para o Brasil
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="http://maps.csr.ufmg.br">CSR Maps</a>
</td>
<td style="text-align:left;">
Diversos dados vetoriais e raster para o Brasil
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://ecoregions2017.appspot.com/">Ecoregions</a>
</td>
<td style="text-align:left;">
Dados de biorregi√µes e geo_vetor_biomas do mundo
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://www.unbiodiversitylab.org/">UN Biodiversity Lab</a>
</td>
<td style="text-align:left;">
Diversas bases de dados para o mundo
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://zenodo.org/record/3261807#.YA8lpPv0nOY">Biodiversity Hotspots</a>
</td>
<td style="text-align:left;">
Dados dos limites dos Hotspots de Biodiversidade
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://www.iucnredlist.org/resources/spatial-data-download">IUCN Red List of Threatened Species</a>
</td>
<td style="text-align:left;">
Dados dos limites das distribui√ß√µes das esp√©cies para o mundo
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://mol.org/">Map of Life (MOL)</a>
</td>
<td style="text-align:left;">
Dados da distribui√ß√£o de esp√©cies e outros dados para o mundo
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="http://www.keybiodiversityareas.org/kba-data/request">Key Biodiversity Areas</a>
</td>
<td style="text-align:left;">
Dados dos limites das Key Biodiversity Areas
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://www.hydrosheds.org/">HydroSHEDS</a>
</td>
<td style="text-align:left;">
Informa√ß√µes hidrol√≥gicas do mundo
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://www.globio.info/download-grip-dataset">Global Roads Inventory Project (GRIP)</a>
</td>
<td style="text-align:left;">
Dados de estradas do mundo todo
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://gadm.org/">Database of Global Administrative Areas (GADM)</a>
</td>
<td style="text-align:left;">
Limites de √°reas administrativas do mundo
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://www.naturaleatoriorthdata.com/">Natural Earth</a>
</td>
<td style="text-align:left;">
Diversos limites para o mundo
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://www.protectedplanet.net">Protected Planet</a>
</td>
<td style="text-align:left;">
Limites de √°reas protegidas para o mundo
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="http://www.gbif.org">Global Biological Information Facility (GBIF)</a>
</td>
<td style="text-align:left;">
Dados de ocorr√™ncias de esp√©cies para o mundo
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="http://www.splink.cria.org.br">Species Link</a>
</td>
<td style="text-align:left;">
Dados de ocorr√™ncias de esp√©cies para o Brasil
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="http://www.gisin.org">Global Invasive Species Information Network (GISIN)</a>
</td>
<td style="text-align:left;">
Dados de ocorr√™ncias de esp√©cies invasoras para o Mundo
</td>
</tr>
</tbody>
</table></div>
</div>
<div id="raster-1" class="section level3" number="15.5.2">
<h3>
<span class="header-section-number">15.5.2</span> Raster<a class="anchor" aria-label="anchor" href="#raster-1"><i class="fas fa-link"></i></a>
</h3>
<p>Dentre as bases raster, destacamos as seguintes na Tabela <a href="cap15.html#tab:tab-raster-bases">15.3</a>.</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:tab-raster-bases">Tabela 15.3: </span>Principais bases de dados raster para o Brasil e o Mundo.
</caption>
<thead><tr>
<th style="text-align:left;">
Bases de dados
</th>
<th style="text-align:left;">
Descri√ß√£o
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="https://mapgeo_vetor_biomas.org/">Mapgeo_vetor_biomas</a>
</td>
<td style="text-align:left;">
Uso e cobertura da terra para o Brasil, Panamazonia Legal e Chaco, de 1985 a 2019
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="ftp://madeira.dea.ufv.br/bdados/bhalu/">Bahlu</a>
</td>
<td style="text-align:left;">
Distribui√ß√µes hist√≥ricas de terras agr√≠colas e pastagens para todo o Brasil de 1940 a 2012
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://www.usgs.gov/">USGS</a>
</td>
<td style="text-align:left;">
Dados de diversos sat√©lites livres para o mundo
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="http://srtm.csi.cgiar.org/">SRTM</a>
</td>
<td style="text-align:left;">
Dados de eleva√ß√£o para o mundo
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://geoservice.dlr.de/web/maps">Geoservice Maps</a>
</td>
<td style="text-align:left;">
Dados de eleva√ß√£o e florestas para o mundo
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://www.globalforestwatch.org/">Global Forest Watch</a>
</td>
<td style="text-align:left;">
Dados de florestas para o mundo
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="http://due.esrin.esa.int/page_globcover.php">GlobCover</a>
</td>
<td style="text-align:left;">
Dados de uso e cobertura da terra para todo o planeta
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://www.earthenv.org/landcover">Landcover</a>
</td>
<td style="text-align:left;">
Dados de uso e cobertura da terra para todo o planeta
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://wcshumanfootprint.org/">Global Human Footprint</a>
</td>
<td style="text-align:left;">
Dados de pegada ecol√≥gica para o mundo
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://ghsl.jrc.ec.europa.eu/download.php">GHSL - Global Human Settlement Layer</a>
</td>
<td style="text-align:left;">
Dados e ferramentas abertos e gratuitos para avaliar a presen√ßa humana no planeta
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://luh.umd.edu/">Land-Use Harmonization (LUH2)</a>
</td>
<td style="text-align:left;">
Dados atuais e previs√µes de uso da terra
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://climate.esa.int/en/odp/#/dashboard">ESA Climate Change Initiative</a>
</td>
<td style="text-align:left;">
Arquivos globais de observa√ß√£o da Terra nos √∫ltimos 30 anos da Ag√™ncia Espacial Europeia (ESA)
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://www.worldclim.org/">WorldClim</a>
</td>
<td style="text-align:left;">
Dados clim√°ticos para o mundo
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://chelsa-climate.org/">CHELSA</a>
</td>
<td style="text-align:left;">
Dados clim√°ticos para o mundo
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://www.earthenv.org/">EarthEnv</a>
</td>
<td style="text-align:left;">
Dados de cobertura da terra, nuvens, relevo e hidrografia
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://soilgrids.org/">SoilGrids</a>
</td>
<td style="text-align:left;">
Dados de solo para o mundo
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://www2.cifor.org/global-wetlands/">Global Wetlands</a>
</td>
<td style="text-align:left;">
Dados de √°reas √∫midas para o mundo
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://global-surface-water.appspot.com/#">Global Surface Water Explorer</a>
</td>
<td style="text-align:left;">
Dados de √°guas superficiais para o mundo
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="http://www.marspec.org/">MARSPEC</a>
</td>
<td style="text-align:left;">
Dados de condi√ß√µes do oceano para o mundo
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="http://www.oracle.ugent.be/">Bio-ORACLE</a>
</td>
<td style="text-align:left;">
Dados de condi√ß√µes do oceano para o mundo
</td>
</tr>
</tbody>
</table></div>
</div>
<div id="pacotes-do-r" class="section level3" number="15.5.3">
<h3>
<span class="header-section-number">15.5.3</span> Pacotes do R<a class="anchor" aria-label="anchor" href="#pacotes-do-r"><i class="fas fa-link"></i></a>
</h3>
<p>Dentre os pacotes no R para download de dados geoespaciais, destacamos os seguintes na Tabela <a href="cap15.html#tab:tab-packages-bases">15.4</a>.</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:tab-packages-bases">Tabela 15.4: </span>Principais pacotes no R para download de dados vetoriais e raster.
</caption>
<thead><tr>
<th style="text-align:left;">
Pacotes
</th>
<th style="text-align:left;">
Descri√ß√£o
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/geobr/index.html">geobr</a>
</td>
<td style="text-align:left;">
Carrega Shapefiles de Conjuntos de Dados Espaciais Oficiais do Brasil
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/rnaturalearth/index.html">rnaturalearth</a>
</td>
<td style="text-align:left;">
Dados do mapa mundial da Natural Earth
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/geodata/index.html">geodata</a>
</td>
<td style="text-align:left;">
Diversas bases de dados para o mundo
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/rworldmap/index.html">rworldmap</a>
</td>
<td style="text-align:left;">
Mapeando Dados Globais
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/spData/index.html">spData</a>
</td>
<td style="text-align:left;">
Conjuntos de dados para an√°lise espacial
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/OpenStreetMap/index.html">OpenStreetMap</a>
</td>
<td style="text-align:left;">
Acesso para abrir imagens raster de mapas de ruas
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/osmdata/index.html">osmdata</a>
</td>
<td style="text-align:left;">
Baixe e importe dados do OpenStreetMap
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/geonames/index.html">geonames</a>
</td>
<td style="text-align:left;">
Interface para o servi√ßo da Web de consulta espacial ‚ÄòGeonames‚Äô
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/rgbif/index.html">rgbif</a>
</td>
<td style="text-align:left;">
Interface para o Global ‚ÄòBiodiversity‚Äô Information Facility API
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/maptools/index.html">maptools</a>
</td>
<td style="text-align:left;">
Ferramentas para lidar com objetos geoespaciais
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/marmap/index.html">marmap</a>
</td>
<td style="text-align:left;">
Importar, tra√ßar e analisar dados batim√©tricos e topogr√°ficos
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/oce/index.html">oce</a>
</td>
<td style="text-align:left;">
Fonte e processamento de dados oceanogr√°ficos
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/envirem/index.html">envirem</a>
</td>
<td style="text-align:left;">
Gera√ß√£o de Vari√°veis ENVIREM
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/sdmpredictors/index.html">sdmpredictors</a>
</td>
<td style="text-align:left;">
Conjuntos de dados preditor de modelagem de distribui√ß√£o de esp√©cies
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/metScanR/index.html">metScanR</a>
</td>
<td style="text-align:left;">
Encontre, Mapeie e Colete Dados e Metadados Ambientais
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/ClimDown/index.html">ClimDown</a>
</td>
<td style="text-align:left;">
Biblioteca de redu√ß√£o de escala do clima para a produ√ß√£o di√°ria do modelo clim√°tico
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/rWBclimate/index.html">rWBclimate</a>
</td>
<td style="text-align:left;">
Acessa dados clim√°ticos do Banco Mundial
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/rnoaa/index.html">rnoaa</a>
</td>
<td style="text-align:left;">
Dados meteorol√≥gicos ‚ÄòNOAA‚Äô de R
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/RNCEP/index.html">RNCEP</a>
</td>
<td style="text-align:left;">
Obtenha, organize e visualize dados meteorol√≥gicos NCEP
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/smapr/index.html">smapr</a>
</td>
<td style="text-align:left;">
Aquisi√ß√£o e processamento de dados ativos-passivos (SMAP) de umidade do solo da NASA
</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div id="importar-e-exportar-dados-geoespaciais" class="section level2" number="15.6">
<h2>
<span class="header-section-number">15.6</span> Importar e exportar dados geoespaciais<a class="anchor" aria-label="anchor" href="#importar-e-exportar-dados-geoespaciais"><i class="fas fa-link"></i></a>
</h2>
<p>Agora que sabemos o que s√£o dados geoespaciais e em quais bases de dados podemos buscar e baixar esses dados, veremos seus principais formatos e como import√°-los e export√°-los do R.</p>
<div id="principais-formatos-de-arquivos-geoespaciais" class="section level3" number="15.6.1">
<h3>
<span class="header-section-number">15.6.1</span> Principais formatos de arquivos geoespaciais<a class="anchor" aria-label="anchor" href="#principais-formatos-de-arquivos-geoespaciais"><i class="fas fa-link"></i></a>
</h3>
<p>H√° diversos formatos de arquivos geoespaciais, alguns espec√≠ficos para dados vetoriais e raster, e outros no formato de banco de dados geoespaciais, como <a href="https://postgis.net/">PostGIS</a>, que podem armazenar ambos os formatos.</p>
<p>Entretanto, todos os formatos para serem importados para o R usam o <a href="https://gdal.org/">GDAL (<em>Geospatial Data Abstraction Library</em>)</a>, uma interface unificada para leitura e escrita de diversos formatos de arquivos geoespaciais, sendo utilizado tamb√©m por uma s√©rie de softwares de GIS como QGIS, GRASS GIS e ArcGIS.</p>
<p>Dentre esses formatos, destacamos os seguintes na Tabela <a href="cap15.html#tab:tab-formatos">15.5</a>.</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:tab-formatos">Tabela 15.5: </span>Principais formatos de arquivos geoespaciais. Adaptado de: Lovelace et al. <span class="citation">(<a href="refer%C3%AAncias.html#ref-lovelace2019" role="doc-biblioref">2019</a>)</span>.
</caption>
<thead><tr>
<th style="text-align:left;">
Nome
</th>
<th style="text-align:left;">
extens√£o
</th>
<th style="text-align:left;">
Descri√ß√£o
</th>
<th style="text-align:left;">
Tipo
</th>
<th style="text-align:left;">
Modelo
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
ESRI Shapefile
</td>
<td style="text-align:left;">
.shp (arquivo principal)
</td>
<td style="text-align:left;">
Formato popular que consiste em pelo menos quatro arquivos: .shp (fei√ß√£o), .dbf (tabela de atributos), .shx (liga√ß√£o entre .shp e .dbf) e .prj (proje√ß√£o)
</td>
<td style="text-align:left;">
Vetor
</td>
<td style="text-align:left;">
Parcialmente aberto
</td>
</tr>
<tr>
<td style="text-align:left;">
GeoJSON
</td>
<td style="text-align:left;">
.geojson
</td>
<td style="text-align:left;">
Estende o formato de troca JSON incluindo um subconjunto da representa√ß√£o de recurso simples
</td>
<td style="text-align:left;">
Vetor
</td>
<td style="text-align:left;">
Aberto
</td>
</tr>
<tr>
<td style="text-align:left;">
KML
</td>
<td style="text-align:left;">
.kml
</td>
<td style="text-align:left;">
Formato baseado em XML para visualiza√ß√£o espacial, desenvolvido para uso com o Google Earth. O arquivo KML compactado forma o formato KMZ
</td>
<td style="text-align:left;">
Vetor
</td>
<td style="text-align:left;">
Aberto
</td>
</tr>
<tr>
<td style="text-align:left;">
GPX
</td>
<td style="text-align:left;">
.gpx
</td>
<td style="text-align:left;">
Esquema XML criado para troca de dados de GPS
</td>
<td style="text-align:left;">
Vetor
</td>
<td style="text-align:left;">
Aberto
</td>
</tr>
<tr>
<td style="text-align:left;">
GeoTIFF
</td>
<td style="text-align:left;">
.tif/.tiff
</td>
<td style="text-align:left;">
Formato raster popular. Um arquivo TIFF contendo metadados espaciais adicionais.
</td>
<td style="text-align:left;">
Raster
</td>
<td style="text-align:left;">
Aberto
</td>
</tr>
<tr>
<td style="text-align:left;">
Arc ASCII
</td>
<td style="text-align:left;">
.asc
</td>
<td style="text-align:left;">
Formato de texto em que as primeiras seis linhas representam o cabe√ßalho raster, seguido pelos valores das c√©lulas raster organizadas em linhas e colunas
</td>
<td style="text-align:left;">
Raster
</td>
<td style="text-align:left;">
Aberto
</td>
</tr>
<tr>
<td style="text-align:left;">
NetCDF
</td>
<td style="text-align:left;">
.nc
</td>
<td style="text-align:left;">
NetCDF (Network Common Data Form) √© um conjunto de bibliotecas de software e formatos de dados independentes que suportam a cria√ß√£o, acesso e compartilhamento de dados cient√≠ficos orientados a arrays
</td>
<td style="text-align:left;">
Raster
</td>
<td style="text-align:left;">
Aberto
</td>
</tr>
<tr>
<td style="text-align:left;">
BIL
</td>
<td style="text-align:left;">
.bil/.hdr
</td>
<td style="text-align:left;">
BIL (Banda intercalada por linha) s√£o m√©todos comuns de organiza√ß√£o para imagens multibanda, geralmente acompanhados por um arquivo .hdr, descrevendo atributos espec√≠ficos da imagem
</td>
<td style="text-align:left;">
Raster
</td>
<td style="text-align:left;">
Aberto
</td>
</tr>
<tr>
<td style="text-align:left;">
R-raster
</td>
<td style="text-align:left;">
.gri/ .grd
</td>
<td style="text-align:left;">
Formato raster nativo do raster do pacote R
</td>
<td style="text-align:left;">
Raster
</td>
<td style="text-align:left;">
Aberto
</td>
</tr>
<tr>
<td style="text-align:left;">
SQLite/SpatiaLite
</td>
<td style="text-align:left;">
.sqlite
</td>
<td style="text-align:left;">
Banco de dados relacional aut√¥nomo
</td>
<td style="text-align:left;">
Vetor e raster
</td>
<td style="text-align:left;">
Aberto
</td>
</tr>
<tr>
<td style="text-align:left;">
ESRI FileGDB
</td>
<td style="text-align:left;">
.gdb
</td>
<td style="text-align:left;">
objetos geoespaciais e n√£o espaciais criados pelo ArcGIS. Permite: v√°rias classes de recursos; topologia
</td>
<td style="text-align:left;">
Vetor e raster
</td>
<td style="text-align:left;">
Propriet√°rio
</td>
</tr>
<tr>
<td style="text-align:left;">
GeoPackage
</td>
<td style="text-align:left;">
.gpkg
</td>
<td style="text-align:left;">
Cont√™iner de banco de dados leve baseado em SQLite permitindo uma troca f√°cil e independente de plataforma de geodados
</td>
<td style="text-align:left;">
Vetor e raster
</td>
<td style="text-align:left;">
Aberto
</td>
</tr>
</tbody>
</table></div>
<p>O formato mais comum para arquivos vetoriais √© o <a href="https://doc.arcgis.com/en/arcgis-online/reference/shapefiles.htm">ESRI Shapefile</a>; para arquivos raster √© o <a href="https://gdal.org/drivers/raster/gtiff.html">GeoTIFF</a>; e para dados clim√°ticos em m√∫ltiplas camadas, geralmente h√° a disponibiliza√ß√£o de dados no formato <a href="https://www.unidata.ucar.edu/software/netcdf/">NetCDF</a>. Entretanto, recentemente tivemos o surgimento do <a href="https://www.geopackage.org/">GeoPackage</a>, que possui diversas vantagens em rela√ß√£o aos formatos anteriores, podendo armazenar em apenas um arquivo, dados no formato vetorial, raster e tamb√©m dados n√£o-espaciais (e.g., tabelas), al√©m de possuir uma grande integra√ß√£o com diversos softwares e bancos de dados.</p>
</div>
<div id="importar-dados-1" class="section level3" number="15.6.2">
<h3>
<span class="header-section-number">15.6.2</span> Importar dados<a class="anchor" aria-label="anchor" href="#importar-dados-1"><i class="fas fa-link"></i></a>
</h3>
<p>As principais fun√ß√µes para importar dados no R s√£o: i) para vetores a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/st_read.html">sf::st_read()</a></code>, e ii) para raster a fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/raster.html">raster::raster()</a></code> e suas varia√ß√µes <code><a href="https://rdrr.io/pkg/raster/man/brick.html">raster::brick()</a></code> e <code><a href="https://rdrr.io/pkg/raster/man/stack.html">raster::stack()</a></code> para m√∫ltiplas camadas. Essas fun√ß√µes atribuem objetos ao seu espa√ßo de trabalho, armazenando-os na mem√≥ria RAM dispon√≠vel em seu hardware, sendo essa a maior limita√ß√£o para trabalhar com dados geoespaciais no R. Por exemplo, se um arquivo raster possui mais de 8 Gb de tamanho, e seu computador possui exatamente 8 Gb de RAM, √© muito prov√°vel que ele n√£o seja importado ou mesmo criado como um objeto dentro do ambiente R. Existem solu√ß√µes para esses problemas, mas n√£o as abordaremos neste cap√≠tulo.</p>
<p><strong>Vetor</strong></p>
<p>Como vimos, os arquivos vetoriais s√£o disponibilizados em diversos formatos. Para sabermos se um determinado formato pode ser importado ou exportado utilizando o pacote <code>sf</code>, podemos utilizar a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/st_drivers.html">sf::st_drivers()</a></code>. Uma amostra desses formatos √© apresentado na Tabela <a href="cap15.html#tab:tab-vetor-formatos">15.6</a>.</p>
<div class="sourceCode" id="cb559"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Formatos vetoriais importados e exportados pelo pacote sf</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/headtail.html">head</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_drivers.html">st_drivers</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:tab-vetor-formatos">Tabela 15.6: </span>Alguns formatos vetoriais importados e exportados pelo pacote <code>sf</code>.
</caption>
<thead><tr>
<th style="text-align:left;">
name
</th>
<th style="text-align:left;">
long_name
</th>
<th style="text-align:left;">
write
</th>
<th style="text-align:left;">
copy
</th>
<th style="text-align:left;">
is_raster
</th>
<th style="text-align:left;">
is_vector
</th>
<th style="text-align:left;">
vsi
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
ESRIC
</td>
<td style="text-align:left;">
Esri Compact Cache
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
FITS
</td>
<td style="text-align:left;">
Flexible Image Transport System
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
PCIDSK
</td>
<td style="text-align:left;">
PCIDSK Database File
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
netCDF
</td>
<td style="text-align:left;">
Network Common Data Format
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
PDS4
</td>
<td style="text-align:left;">
NASA Planetary Data System 4
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
VICAR
</td>
<td style="text-align:left;">
MIPL VICAR file
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
</tbody>
</table></div>
<p><strong>Importar dados vetoriais existentes</strong></p>
<p>Para importar vetores existentes para o R, utilizaremos a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/st_read.html">sf::st_read()</a></code>. A estrutura √© semelhante para todos os formatos descritos na Tabela <a href="cap15.html#tab:tab-vetor-formatos">15.6</a>, de modo que sempre preencheremos o argumento <code>dsn</code> (<em>data source name</em>) com o nome do arquivo a ser importado. Entretanto, para banco de dados, como <em>GeoPackage</em>, pode ser necess√°rio especificar a camada que se tem interesse com um segundo argumento chamado <code>layer</code>, com o nome da camada.</p>
<p>Para quase todas as opera√ß√µes vetoriais nesse cap√≠tulo, usaremos os dados dispon√≠veis para o munic√≠pio de Rio Claro/SP. Primeiramente, baixaremos esses dados da <a href="https://www.fbds.org.br/">FBDS (Funda√ß√£o Brasileira para o Desenvolvimento Sustent√°vel)</a>, atrav√©s desse <a href="http://geo.fbds.org.br/">reposit√≥rio de dados</a>. Em 2013, a FBDS deu in√≠cio ao Projeto de Mapeamento em Alta Resolu√ß√£o dos Biomas Brasileiros, mapeando a cobertura da terra, hidrografia (nascentes, rios e lagos) e √Åreas de Preserva√ß√£o Permanente (APPs). O mapeamento foi conclu√≠do para os munic√≠pios dos Biomas Mata Atl√¢ntica e Cerrado, e mais recentemente para os outros biomas. Para fazer o download dos arquivos de interesse, utilizaremos o R, atrav√©s da fun√ß√£o <code><a href="https://rdrr.io/r/utils/download.file.html">download.file()</a></code>.</p>
<p>Primeiramente, criaremos um diret√≥rio com a fun√ß√£o <code>create.dir()</code>, usando a fun√ß√£o <code><a href="https://here.r-lib.org//reference/here.html">here::here()</a></code> para indicar o reposit√≥rio (ver o Cap√≠tulo <a href="cap5.html#cap5">5</a>).</p>
<div class="sourceCode" id="cb560"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Criar diret√≥rio</span>
<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"vetor"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Em seguida, vamos fazer o download de pontos de nascentes, linhas de hidrografia e pol√≠gonos de cobertura da terra para o munic√≠pio de Rio Claro/SP.</p>
<div class="sourceCode" id="cb561"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Aumentar o tempo de download</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>timeout <span class="op">=</span> <span class="fl">1e3</span><span class="op">)</span>

<span class="co">## Download</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">".dbf"</span>, <span class="st">".prj"</span>, <span class="st">".shp"</span>, <span class="st">".shx"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    
    <span class="co"># Pontos de nascentes</span>
    <span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span>
        url <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"http://geo.fbds.org.br/SP/RIO_CLARO/HIDROGRAFIA/SP_3543907_NASCENTES"</span>, <span class="va">i</span><span class="op">)</span>,
        destfile <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"vetor"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"SP_3543907_NASCENTES"</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span>
    
    <span class="co"># Linhas de hidrografia</span>
    <span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span>
        url <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"http://geo.fbds.org.br/SP/RIO_CLARO/HIDROGRAFIA/SP_3543907_RIOS_SIMPLES"</span>, <span class="va">i</span><span class="op">)</span>,
        destfile <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"vetor"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"SP_3543907_RIOS_SIMPLES"</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span>
    
    <span class="co"># Pol√≠gonos de cobertura da terra</span>
    <span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span>
        url <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"http://geo.fbds.org.br/SP/RIO_CLARO/USO/SP_3543907_USO"</span>, <span class="va">i</span><span class="op">)</span>,
        destfile <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"vetor"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"SP_3543907_USO"</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Caso o download n√£o funcione ou haja problemas com a importa√ß√£o, disponibilizamos os dados tamb√©m no pacote <code>ecodados</code>.</p>
<div class="sourceCode" id="cb562"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Importar os dados pelo pacote ecodados</span>
<span class="fu">ecodados</span><span class="fu">::</span><span class="va">geo_vetor_nascentes</span>
<span class="fu">ecodados</span><span class="fu">::</span><span class="va">geo_vetor_hidrografia</span>
<span class="fu">ecodados</span><span class="fu">::</span><span class="va">geo_vetor_cobertura</span></code></pre></div>
<p>Agora podemos importar esses dados para o R. Primeiro vamos importar as nascentes (Figura <a href="cap15.html#fig:fig-vetor-nascentes">15.8</a>).</p>
<div class="sourceCode" id="cb563"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Importar nascentes</span>
<span class="va">geo_vetor_nascentes</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span>
    <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"vetor"</span>, <span class="st">"SP_3543907_NASCENTES.shp"</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb564"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_nascentes</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, pch <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="st">"blue"</span>, main <span class="op">=</span> <span class="cn">NA</span>, 
     axes <span class="op">=</span> <span class="cn">TRUE</span>, graticule <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-nascentes"></span>
<img src="livro_files/figure-html/fig-vetor-nascentes-1.png" alt="Mapa de nascentes de Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.8: Mapa de nascentes de Rio Claro/SP.
</p>
</div>
<p>Agora vamos importar a hidrografia (Figura <a href="cap15.html#fig:fig-vetor-hidrografia">15.9</a>).</p>
<div class="sourceCode" id="cb565"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Importar hidrografia</span>
<span class="va">geo_vetor_hidrografia</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span>
    <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"vetor"</span>, <span class="st">"SP_3543907_RIOS_SIMPLES.shp"</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb566"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_hidrografia</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"steelblue"</span>, main <span class="op">=</span> <span class="cn">NA</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, graticule <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-hidrografia"></span>
<img src="livro_files/figure-html/fig-vetor-hidrografia-1.png" alt="Mapa da hidrografia de Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.9: Mapa da hidrografia de Rio Claro/SP.
</p>
</div>
<p>E por fim, vamos importar a cobertura da terra (Figura <a href="cap15.html#fig:fig-vetor-cobertura">15.10</a>).</p>
<div class="sourceCode" id="cb567"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Importar cobertura da terra</span>
<span class="va">geo_vetor_cobertura</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span>
    <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"vetor"</span>, <span class="st">"SP_3543907_USO.shp"</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb568"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_cobertura</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>, 
     col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"orange"</span>, <span class="st">"gray30"</span>, <span class="st">"forestgreen"</span>, <span class="st">"green"</span><span class="op">)</span>, 
     main <span class="op">=</span> <span class="cn">NA</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, graticule <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">.1</span>, y <span class="op">=</span> <span class="fl">.3</span>, pch <span class="op">=</span> <span class="fl">15</span>, cex <span class="op">=</span> <span class="fl">.7</span>, pt.cex <span class="op">=</span> <span class="fl">2.5</span>, 
       legend <span class="op">=</span> <span class="op">(</span><span class="va">geo_vetor_cobertura</span><span class="op">$</span><span class="va">CLASSE_USO</span><span class="op">)</span>, 
       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"orange"</span>, <span class="st">"gray30"</span>, <span class="st">"forestgreen"</span>, <span class="st">"green"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-cobertura"></span>
<img src="livro_files/figure-html/fig-vetor-cobertura-1.png" alt="Mapa de cobertura da terra de Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.10: Mapa de cobertura da terra de Rio Claro/SP.
</p>
</div>
<p><strong>Importar utilizando pacotes</strong></p>
<p>Al√©m de dados existentes, podemos importar dados vetoriais de pacotes, como listado anteriormente na Tabela <a href="cap15.html#tab:tab-packages-bases">15.4</a>. Para o Brasil, o pacote mais interessante trata-se do <a href="https://ipeagit.github.io/geobr/"><code>geobr</code></a>, do <a href="https://www.ipea.gov.br/portal/">Instituto de Pesquisa Econ√¥mica Aplicada (IPEA)</a>, que possui dados oficiais do <a href="https://www.ibge.gov.br/">Instituto Brasileiro de Geografia e Estat√≠stica (IBGE)</a>.</p>
<p>√â poss√≠vel listar todos os dados dispon√≠veis no pacote atrav√©s da fun√ß√£o <code><a href="https://rdrr.io/pkg/geobr/man/list_geobr.html">geobr::list_geobr()</a></code>. Na Tabela <a href="cap15.html#tab:tab-vetor-dados-geobr">15.7</a> √© poss√≠vel ver alguns desses dados.</p>
<div class="sourceCode" id="cb569"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Listar todos os dados do geobr</span>
<span class="fu">geobr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/geobr/man/list_geobr.html">list_geobr</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:tab-vetor-dados-geobr">Tabela 15.7: </span>Alguns dados dispon√≠veis no pacote <code>geobr</code>.
</caption>
<thead><tr>
<th style="text-align:left;">
function
</th>
<th style="text-align:left;">
geography
</th>
<th style="text-align:left;">
years
</th>
<th style="text-align:left;">
source
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
<code>read_country</code>
</td>
<td style="text-align:left;">
Country
</td>
<td style="text-align:left;">
1872, 1900, 1911, 1920, 1933, 1940, 1950, 1960, 1970, 1980, 1991, 2000, 2001, 2010, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020
</td>
<td style="text-align:left;">
IBGE
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>read_region</code>
</td>
<td style="text-align:left;">
Region
</td>
<td style="text-align:left;">
2000, 2001, 2010, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020
</td>
<td style="text-align:left;">
IBGE
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>read_state</code>
</td>
<td style="text-align:left;">
States
</td>
<td style="text-align:left;">
1872, 1900, 1911, 1920, 1933, 1940, 1950, 1960, 1970, 1980, 1991, 2000, 2001, 2010, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020
</td>
<td style="text-align:left;">
IBGE
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>read_meso_region</code>
</td>
<td style="text-align:left;">
Meso region
</td>
<td style="text-align:left;">
2000, 2001, 2010, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020
</td>
<td style="text-align:left;">
IBGE
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>read_micro_region</code>
</td>
<td style="text-align:left;">
Micro region
</td>
<td style="text-align:left;">
2000, 2001, 2010, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020
</td>
<td style="text-align:left;">
IBGE
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>read_intermediate_region</code>
</td>
<td style="text-align:left;">
Intermediate region
</td>
<td style="text-align:left;">
2017, 2019, 2020
</td>
<td style="text-align:left;">
IBGE
</td>
</tr>
</tbody>
</table></div>
<p>Como exemplo, vamos fazer o download o limite do munic√≠pio de Rio Claro/SP, utilizando o c√≥digo do munic√≠pio (3543907) (Figura <a href="cap15.html#fig:fig-vetor-rio-claro">15.11</a>).</p>
<div class="alert alert-info">
<p><strong> üìù Importante </strong><br>
Para saber todos os c√≥digos dos munic√≠pios do Brasil, recomendamos a verifica√ß√£o no <a href="https://www.ibge.gov.br/explica/codigos-dos-municipios.php">site do IBGE</a>.</p>
</div>
<div class="sourceCode" id="cb570"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Pol√≠gono do limite do munic√≠pio de Rio Claro</span>
<span class="va">geo_vetor_rio_claro</span> <span class="op">&lt;-</span> <span class="fu">geobr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/geobr/man/read_municipality.html">read_municipality</a></span><span class="op">(</span>code_muni <span class="op">=</span> <span class="fl">3543907</span>, 
                                                year <span class="op">=</span> <span class="fl">2020</span>, showProgress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>Caso o download n√£o funcione ou haja problemas com a importa√ß√£o, disponibilizamos os dados tamb√©m no pacote <code>ecodados</code>.</p>
<div class="sourceCode" id="cb571"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Importar os dados pelo pacote ecodados</span>
<span class="fu">ecodados</span><span class="fu">::</span><span class="va">geo_vetor_rio_claro</span></code></pre></div>
<div class="sourceCode" id="cb572"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"gray"</span>, main <span class="op">=</span> <span class="cn">NA</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, graticule <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-rio-claro"></span>
<img src="livro_files/figure-html/fig-vetor-rio-claro-1.png" alt="Limite do munic√≠pio de Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.11: Limite do munic√≠pio de Rio Claro/SP.
</p>
</div>
<p>J√° para o mundo, o pacote mais interessante trata-se do <a href="https://docs.ropensci.org/rnaturalearth/"><code>rnaturalearth</code></a>, que faz o download de dados do <a href="https://www.naturaleatoriorthdata.com/">Natural Earth</a>. Vamos fazer o download do limite do Brasil (Figura <a href="cap15.html#fig:fig-vetor-brasil">15.12</a>).</p>
<div class="sourceCode" id="cb573"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Pol√≠gono do limite do Brasil</span>
<span class="va">geo_vetor_brasil</span> <span class="op">&lt;-</span> <span class="fu">rnaturalearth</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rnaturalearth/man/ne_countries.html">ne_countries</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="st">"large"</span>, 
                                                country <span class="op">=</span> <span class="st">"Brazil"</span>, returnclass <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span></code></pre></div>
<p>Caso o download n√£o funcione ou haja problemas com a importa√ß√£o, disponibilizamos os dados tamb√©m no pacote <code>ecodados</code>.</p>
<div class="sourceCode" id="cb574"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Importar os dados pelo pacote ecodados</span>
<span class="fu">ecodados</span><span class="fu">::</span><span class="va">geo_vetor_brasil</span></code></pre></div>
<div class="sourceCode" id="cb575"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_brasil</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"gray"</span>, main <span class="op">=</span> <span class="cn">NA</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, graticule <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-brasil"></span>
<img src="livro_files/figure-html/fig-vetor-brasil-1.png" alt="Limite do Brasil." width="100%" height="100%"><p class="caption">
Figura 15.12: Limite do Brasil.
</p>
</div>
<p><strong>Criar um objeto espacial de uma tabela de coordenadas</strong></p>
<p>√â muito comum em coletas de campo ou bases de dados, ter coordenadas de locais de estudo ou de ocorr√™ncias de esp√©cies organizadas em tabelas. Essas tabelas devem possuir duas colunas: longitude e latitude, ou X e Y para dados UTM, por exemplo. Ao import√°-las para o R, o formato que assumem pode ser de uma das classes: <code>matrix</code>, <code>data frame</code> ou <code>tibble</code>, ou seja, ainda n√£o s√£o da classe vetorial <code>sf</code>. Nesta se√ß√£o iremos ver como fazer essa convers√£o.</p>
<p>Para tanto, vamos usar os dados de comunidades de anf√≠bios da Mata Atl√¢ntica (Atlantic Amphibians, Vancine et al. <span class="citation">(<a href="refer%C3%AAncias.html#ref-vancine2018" role="doc-biblioref">2018</a>)</span>). Faremos o download diretamente do site da fonte dos dados. Antes vamos criar um diret√≥rio.</p>
<div class="sourceCode" id="cb576"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Criar diret√≥rio</span>
<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"tabelas"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Em seguida, vamos fazer o download de um arquivo <code>.zip</code> e vamos extrair usando a fun√ß√£o <code><a href="https://rdrr.io/r/utils/unzip.html">unzip()</a></code> nesse mesmo diret√≥rio.</p>
<div class="sourceCode" id="cb577"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Download</span>
<span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span>url <span class="op">=</span> <span class="st">"https://esajournals.onlinelibrary.wiley.com/action/downloadSupplement?doi=10.1002%2Fecy.2392&amp;file=ecy2392-sup-0001-DataS1.zip"</span>,
              destfile <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"tabelas"</span>, <span class="st">"atlantic_amphibians.zip"</span><span class="op">)</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span>

<span class="co">## Unzip</span>
<span class="fu"><a href="https://rdrr.io/r/utils/unzip.html">unzip</a></span><span class="op">(</span>zipfile <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"tabelas"</span>, <span class="st">"atlantic_amphibians.zip"</span><span class="op">)</span>,
      exdir <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"tabelas"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Agora podemos importar a tabela de dados com a fun√ß√£o <code><a href="https://readr.tidyverse.org/reference/read_delim.html">readr::read_csv()</a></code>.</p>
<div class="sourceCode" id="cb578"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Importar tabela de locais</span>
<span class="va">geo_anfibios_locais</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span>
    <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"tabelas"</span>, <span class="st">"ATLANTIC_AMPHIBIANS_sites.csv"</span><span class="op">)</span>,
    locale <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/locale.html">locale</a></span><span class="op">(</span>encoding <span class="op">=</span> <span class="st">"latin1"</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">geo_anfibios_locais</span>
<span class="co">#&gt; # A tibble: 1,163 √ó 25</span>
<span class="co">#&gt;    id      reference_number species_number record sampled_habitat active_methods passive_methods complementary_metho‚Ä¶</span>
<span class="co">#&gt;    &lt;chr&gt;              &lt;dbl&gt;          &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;           &lt;chr&gt;          &lt;chr&gt;           &lt;chr&gt;               </span>
<span class="co">#&gt;  1 amp1001             1001             19 ab     fo,ll           as             pt              &lt;NA&gt;                </span>
<span class="co">#&gt;  2 amp1002             1002             16 co     fo,la,ll        as             pt              &lt;NA&gt;                </span>
<span class="co">#&gt;  3 amp1003             1002             14 co     fo,la,ll        as             pt              &lt;NA&gt;                </span>
<span class="co">#&gt;  4 amp1004             1002             13 co     fo,la,ll        as             pt              &lt;NA&gt;                </span>
<span class="co">#&gt;  5 amp1005             1003             30 co     fo,ll,br        as             &lt;NA&gt;            &lt;NA&gt;                </span>
<span class="co">#&gt;  6 amp1006             1004             42 co     tp,pp,la,ll,is  &lt;NA&gt;           &lt;NA&gt;            &lt;NA&gt;                </span>
<span class="co">#&gt;  7 amp1007             1005             23 co     sp              as             &lt;NA&gt;            &lt;NA&gt;                </span>
<span class="co">#&gt;  8 amp1008             1005             19 co     sp,la,sw        as,sb,tr       &lt;NA&gt;            &lt;NA&gt;                </span>
<span class="co">#&gt;  9 amp1009             1005             13 ab     fo              &lt;NA&gt;           pt              &lt;NA&gt;                </span>
<span class="co">#&gt; 10 amp1010             1006              1 ab     fo              &lt;NA&gt;           pt              &lt;NA&gt;                </span>
<span class="co">#&gt; # ‚Ä¶ with 1,153 more rows, and 17 more variables: period &lt;chr&gt;, month_start &lt;dbl&gt;, year_start &lt;dbl&gt;,</span>
<span class="co">#&gt; #   month_finish &lt;dbl&gt;, year_finish &lt;dbl&gt;, effort_months &lt;dbl&gt;, country &lt;chr&gt;, state &lt;chr&gt;,</span>
<span class="co">#&gt; #   state_abbreviation &lt;chr&gt;, municipality &lt;chr&gt;, site &lt;chr&gt;, latitude &lt;dbl&gt;, longitude &lt;dbl&gt;,</span>
<span class="co">#&gt; #   coordinate_precision &lt;chr&gt;, altitude &lt;dbl&gt;, temperature &lt;dbl&gt;, precipitation &lt;dbl&gt;</span></code></pre></div>
<p>Caso o download n√£o funcione ou haja problemas com a importa√ß√£o, disponibilizamos os dados tamb√©m no pacote <code>ecodados</code>.</p>
<div class="sourceCode" id="cb579"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Importar os dados pelo pacote ecodados</span>
<span class="fu">ecodados</span><span class="fu">::</span><span class="va">geo_anfibios_locais</span></code></pre></div>
<p>Por fim, podemos facilmente criar um objeto espacial do tipo <code>MULTIPOINT</code> utilizando a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">sf::st_as_sf()</a></code>. Podemos ver essas coordenadas plotadas no mapa simples da Figura <a href="cap15.html#fig:fig-vetor-pontos-atlantic-amphibians">15.13</a> <span class="citation">(<a href="refer%C3%AAncias.html#ref-vancine2018" role="doc-biblioref">Vancine et al. 2018</a>)</span>.</p>
<p>√â necess√°rio antes se ater ao argumento <code>coords</code> que deve indicar as colunas de longitude e latitude, nessa ordem; e tamb√©m ao argumento <code>crs</code> para indicar o CRS correspondente dessas coordenadas, que aqui sabemos se tratar de coordenadas geogr√°ficas e datum WGS84. Ent√£o podemos facilmente utilizar o c√≥digo EPSG 4326. Entretanto, se as coordenadas estiverem em metros, por exemplo, teremos de nos ater a qual CRS as mesmas foram coletadas, ou seja, se forem coordenadas de GPS, √© preciso saber como o GPS estava configurado (proje√ß√£o e datum).</p>
<div class="sourceCode" id="cb580"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Converter dados tabulares para sf</span>
<span class="va">geo_anfibios_locais_vetor</span> <span class="op">&lt;-</span> <span class="va">geo_anfibios_locais</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span>
<span class="va">geo_anfibios_locais_vetor</span>
<span class="co">#&gt; Simple feature collection with 1163 features and 23 fields</span>
<span class="co">#&gt; Geometry type: POINT</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: -56.74194 ymin: -33.51083 xmax: -34.79667 ymax: -3.51525</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt; # A tibble: 1,163 √ó 24</span>
<span class="co">#&gt;    id      reference_number species_number record sampled_habitat active_methods passive_methods complementary_metho‚Ä¶</span>
<span class="co">#&gt;  * &lt;chr&gt;              &lt;dbl&gt;          &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;           &lt;chr&gt;          &lt;chr&gt;           &lt;chr&gt;               </span>
<span class="co">#&gt;  1 amp1001             1001             19 ab     fo,ll           as             pt              &lt;NA&gt;                </span>
<span class="co">#&gt;  2 amp1002             1002             16 co     fo,la,ll        as             pt              &lt;NA&gt;                </span>
<span class="co">#&gt;  3 amp1003             1002             14 co     fo,la,ll        as             pt              &lt;NA&gt;                </span>
<span class="co">#&gt;  4 amp1004             1002             13 co     fo,la,ll        as             pt              &lt;NA&gt;                </span>
<span class="co">#&gt;  5 amp1005             1003             30 co     fo,ll,br        as             &lt;NA&gt;            &lt;NA&gt;                </span>
<span class="co">#&gt;  6 amp1006             1004             42 co     tp,pp,la,ll,is  &lt;NA&gt;           &lt;NA&gt;            &lt;NA&gt;                </span>
<span class="co">#&gt;  7 amp1007             1005             23 co     sp              as             &lt;NA&gt;            &lt;NA&gt;                </span>
<span class="co">#&gt;  8 amp1008             1005             19 co     sp,la,sw        as,sb,tr       &lt;NA&gt;            &lt;NA&gt;                </span>
<span class="co">#&gt;  9 amp1009             1005             13 ab     fo              &lt;NA&gt;           pt              &lt;NA&gt;                </span>
<span class="co">#&gt; 10 amp1010             1006              1 ab     fo              &lt;NA&gt;           pt              &lt;NA&gt;                </span>
<span class="co">#&gt; # ‚Ä¶ with 1,153 more rows, and 16 more variables: period &lt;chr&gt;, month_start &lt;dbl&gt;, year_start &lt;dbl&gt;,</span>
<span class="co">#&gt; #   month_finish &lt;dbl&gt;, year_finish &lt;dbl&gt;, effort_months &lt;dbl&gt;, country &lt;chr&gt;, state &lt;chr&gt;,</span>
<span class="co">#&gt; #   state_abbreviation &lt;chr&gt;, municipality &lt;chr&gt;, site &lt;chr&gt;, coordinate_precision &lt;chr&gt;, altitude &lt;dbl&gt;,</span>
<span class="co">#&gt; #   temperature &lt;dbl&gt;, precipitation &lt;dbl&gt;, geometry &lt;POINT [¬∞]&gt;</span></code></pre></div>
<div class="sourceCode" id="cb581"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_anfibios_locais_vetor</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, pch <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="st">"black"</span>, 
     main <span class="op">=</span> <span class="cn">NA</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, graticule <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-pontos-atlantic-amphibians"></span>
<img src="livro_files/figure-html/fig-vetor-pontos-atlantic-amphibians-1.png" alt="Coordenadas das comunidades do Atlantic Amphibians." width="100%" height="100%"><p class="caption">
Figura 15.13: Coordenadas das comunidades do Atlantic Amphibians.
</p>
</div>
<p><strong>Converter dados espaciais sp para sf</strong></p>
<p>O pacote <code>sf</code> √© mais recente e mais f√°cil de manipular objetos vetoriais no R. Seu predecessor, o pacote <code>sp</code> possui uma classe pr√≥pria e hom√¥nima. Entretanto, muitos pacotes de an√°lises espaciais ainda utilizam essa classe em suas fun√ß√µes, apesar dessa migra√ß√£o ter ocorrido rapidamente recentemente. Dessa forma, a convers√£o entre essas classes pode ser necess√°ria em alguns momentos.</p>
<p>Abaixo, veremos como podemos fazer essa convers√£o facilmente. Primeiramente, vamos importar dados <code>sp</code>.</p>
<div class="sourceCode" id="cb582"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Pol√≠gonos pa√≠ses sp</span>
<span class="va">co110_sp</span> <span class="op">&lt;-</span> <span class="fu">rnaturalearth</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/rnaturalearth/man/countries.html">countries110</a></span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">co110_sp</span><span class="op">)</span>
<span class="co">#&gt; [1] "SpatialPolygonsDataFrame"</span>
<span class="co">#&gt; attr(,"package")</span>
<span class="co">#&gt; [1] "sp"</span></code></pre></div>
<p>Agora, podemos converter facilmente com a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">sf::st_as_sf()</a></code>.</p>
<div class="sourceCode" id="cb583"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Pol√≠gonos pa√≠ses sf</span>
<span class="va">co110_sf</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="va">co110_sp</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">co110_sf</span><span class="op">)</span>
<span class="co">#&gt; [1] "sf"         "data.frame"</span></code></pre></div>
<p>Podemos facilmente converter esse objeto novamente para a classe <code>sp</code> com a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/coerce-methods.html">sf::as_Spatial()</a></code>.</p>
<div class="sourceCode" id="cb584"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Pol√≠gonos pa√≠ses sp</span>
<span class="va">co110_sp</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/coerce-methods.html">as_Spatial</a></span><span class="op">(</span><span class="va">co110_sf</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">co110_sp</span><span class="op">)</span>
<span class="co">#&gt; [1] "SpatialPolygonsDataFrame"</span>
<span class="co">#&gt; attr(,"package")</span>
<span class="co">#&gt; [1] "sp"</span></code></pre></div>
<p><strong>Raster</strong></p>
<p>Para importar dados raster no R, utilizaremos a fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/raster.html">raster::raster()</a></code>, <code><a href="https://rdrr.io/pkg/raster/man/brick.html">raster::brick()</a></code> ou <code><a href="https://rdrr.io/pkg/raster/man/stack.html">raster::stack()</a></code>. Para apenas uma camada raster, usaremos a fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/raster.html">raster::raster()</a></code>, com o argumento <code>x</code> sendo o nome do arquivo. J√° para mais camadas, usaremos <code><a href="https://rdrr.io/pkg/raster/man/brick.html">raster::brick()</a></code> para um arquivo que possua m√∫ltiplas camadas, ou ainda a fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/stack.html">raster::stack()</a></code> para v√°rios arquivos em diferentes camadas tamb√©m no argumento <code>x</code>, sendo necess√°rio listar os arquivos no diret√≥rio, geralmente utilizando a fun√ß√£o <code><a href="https://rdrr.io/r/base/list.files.html">dir()</a></code> ou <code><a href="https://rdrr.io/r/base/list.files.html">list.files()</a></code>. Entretanto, para especificar uma camada, podemos utilizar o argumento <code>band</code> ou <code>layer</code> e o nome dessa camada.</p>
<p><strong>Raster Layer</strong></p>
<p>Primeiramente, vamos criar um diret√≥rio para os dados raster que fazeremos o download.</p>
<div class="sourceCode" id="cb585"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Criar diret√≥rio</span>
<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"raster"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Em seguida, vamos fazer o download de dados de eleva√ß√£o, na verdade dados de Modelo Digital de Eleva√ß√£o (<em>Digital Elevation Model</em> - DEM), localizados tamb√©m para o munic√≠pio de Rio Claro. Utilizaremos os dados do <a href="https://srtm.csi.cgiar.org/"><em>Shuttle Radar Topography Mission - SRTM</em></a>. Para saber mais sobre esses dados, recomendamos a leitura do artigo de Farr et al. <span class="citation">(<a href="refer%C3%AAncias.html#ref-farr_shuttle_2007" role="doc-biblioref">2007</a>)</span>.</p>
<div class="sourceCode" id="cb586"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Aumentar o tempo de download</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>timeout <span class="op">=</span> <span class="fl">1e3</span><span class="op">)</span>

<span class="co">## Download</span>
<span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span>url <span class="op">=</span> <span class="st">"https://srtm.csi.cgiar.org/wp-content/uploads/files/srtm_5x5/TIFF/srtm_27_17.zip"</span>,
              destfile <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"raster"</span>, <span class="st">"srtm_27_17.zip"</span><span class="op">)</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span>

<span class="co">## Unzip</span>
<span class="fu"><a href="https://rdrr.io/r/utils/unzip.html">unzip</a></span><span class="op">(</span>zipfile <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"raster"</span>, <span class="st">"srtm_27_17.zip"</span><span class="op">)</span>,
      exdir <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"raster"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Caso o download n√£o funcione ou haja problemas com a importa√ß√£o, disponibilizamos os dados tamb√©m no pacote <code>ecodados</code>.</p>
<div class="sourceCode" id="cb587"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Importar os dados pelo pacote ecodados</span>
<span class="fu">ecodados</span><span class="fu">::</span><span class="va">geo_raster_srtm</span></code></pre></div>
<p>Agora podemos importar essa camada para o R, e visualiz√°-la em rela√ß√£o ao limite do munic√≠pio de Rio Claro/SP (Figura <a href="cap15.html#fig:fig-raster-dem">15.14</a>).</p>
<div class="sourceCode" id="cb588"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Importar raster de altitude</span>
<span class="va">geo_raster_srtm</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html">raster</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"raster"</span>, <span class="st">"srtm_27_17.tif"</span><span class="op">)</span><span class="op">)</span>
<span class="va">geo_raster_srtm</span>
<span class="co">#&gt; class      : RasterLayer </span>
<span class="co">#&gt; dimensions : 6000, 6000, 3.6e+07  (nrow, ncol, ncell)</span>
<span class="co">#&gt; resolution : 0.0008333333, 0.0008333333  (x, y)</span>
<span class="co">#&gt; extent     : -50, -45, -25, -20  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs </span>
<span class="co">#&gt; source     : srtm_27_17.tif </span>
<span class="co">#&gt; names      : srtm_27_17 </span>
<span class="co">#&gt; values     : -32768, 32767  (min, max)</span></code></pre></div>
<div class="sourceCode" id="cb589"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_raster_srtm</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-dem"></span>
<img src="livro_files/figure-html/fig-raster-dem-1.png" alt="Camada raster do DEM em rela√ß√£o ao limite do munic√≠pio de Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.14: Camada raster do DEM em rela√ß√£o ao limite do munic√≠pio de Rio Claro/SP.
</p>
</div>
<p><strong>Raster Stack</strong></p>
<p>Al√©m dos dados de eleva√ß√£o, dados de temperatura e precipita√ß√£o podem ser obtidos do <a href="https://www.worldclim.org/">WorldClim</a>. Para saber mais sobre esses dados, recomendamos a leitura do artigo Fick &amp; Hijmans <span class="citation">(<a href="refer%C3%AAncias.html#ref-fick_worldclim_2017" role="doc-biblioref">2017</a>)</span>.</p>
<div class="sourceCode" id="cb590"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Aumentar o tempo de download</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>timeout <span class="op">=</span> <span class="fl">1e3</span><span class="op">)</span>

<span class="co">## Download</span>
<span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span>url <span class="op">=</span> <span class="st">"https://biogeo.ucdavis.edu/data/worldclim/v2.1/base/wc2.1_10m_bio.zip"</span>,
              destfile <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"raster"</span>, <span class="st">"wc2.0_10m_bio.zip"</span><span class="op">)</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span>

<span class="co">## Unzip</span>
<span class="fu"><a href="https://rdrr.io/r/utils/unzip.html">unzip</a></span><span class="op">(</span>zipfile <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"raster"</span>, <span class="st">"wc2.0_10m_bio.zip"</span><span class="op">)</span>,
      exdir <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"raster"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Caso o download n√£o funcione ou haja problemas com a importa√ß√£o, disponibilizamos os dados tamb√©m no pacote <code>ecodados</code>.</p>
<div class="sourceCode" id="cb591"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Importar os dados pelo pacote ecodados</span>
<span class="fu">ecodados</span><span class="fu">::</span><span class="va">geo_raster_bioclim</span></code></pre></div>
<p>Para importar essa s√©rie de camadas, primeiramente listaremos os arquivos e depois importar no formato <code>RasterStack</code> (Figura <a href="cap15.html#fig:fig-raster-wc">15.15</a>).</p>
<div class="sourceCode" id="cb592"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Listar arquivos</span>
<span class="va">arquivos_raster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">dir</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"raster"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"wc"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">".tif"</span>, <span class="va">.</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">arquivos_raster</span>
<span class="co">#&gt;  [1] "wc2.1_10m_bio_1.tif"  "wc2.1_10m_bio_10.tif" "wc2.1_10m_bio_11.tif" "wc2.1_10m_bio_12.tif"</span>
<span class="co">#&gt;  [5] "wc2.1_10m_bio_13.tif" "wc2.1_10m_bio_14.tif" "wc2.1_10m_bio_15.tif" "wc2.1_10m_bio_16.tif"</span>
<span class="co">#&gt;  [9] "wc2.1_10m_bio_17.tif" "wc2.1_10m_bio_18.tif" "wc2.1_10m_bio_19.tif" "wc2.1_10m_bio_2.tif" </span>
<span class="co">#&gt; [13] "wc2.1_10m_bio_3.tif"  "wc2.1_10m_bio_4.tif"  "wc2.1_10m_bio_5.tif"  "wc2.1_10m_bio_6.tif" </span>
<span class="co">#&gt; [17] "wc2.1_10m_bio_7.tif"  "wc2.1_10m_bio_8.tif"  "wc2.1_10m_bio_9.tif"</span>

<span class="co">## Importar v√°rios rasters como stack</span>
<span class="va">geo_raster_bioclim</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html">stack</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"raster"</span>, <span class="va">arquivos_raster</span><span class="op">)</span><span class="op">)</span>
<span class="va">geo_raster_bioclim</span>
<span class="co">#&gt; class      : RasterStack </span>
<span class="co">#&gt; dimensions : 1080, 2160, 2332800, 19  (nrow, ncol, ncell, nlayers)</span>
<span class="co">#&gt; resolution : 0.1666667, 0.1666667  (x, y)</span>
<span class="co">#&gt; extent     : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs </span>
<span class="co">#&gt; names      : wc2.1_10m_bio_1, wc2.1_10m_bio_10, wc2.1_10m_bio_11, wc2.1_10m_bio_12, wc2.1_10m_bio_13, wc2.1_10m_bio_14, wc2.1_10m_bio_15, wc2.1_10m_bio_16, wc2.1_10m_bio_17, wc2.1_10m_bio_18, wc2.1_10m_bio_19, wc2.1_10m_bio_2, wc2.1_10m_bio_3, wc2.1_10m_bio_4, wc2.1_10m_bio_5, ... </span>
<span class="co">#&gt; min values :      -54.724354,       -37.781418,       -66.311249,         0.000000,         0.000000,         0.000000,         0.000000,         0.000000,         0.000000,         0.000000,         0.000000,        1.000000,        9.131122,        0.000000,      -29.686001, ... </span>
<span class="co">#&gt; max values :        30.98764,         38.21617,         29.15299,      11191.00000,       2381.00000,        484.00000,        229.00169,       5284.00000,       1507.00000,       5282.00000,       4467.00000,        21.14754,       100.00000,      2363.84595,        48.08275, ...</span></code></pre></div>
<div class="sourceCode" id="cb593"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_raster_bioclim</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-wc"></span>
<img src="livro_files/figure-html/fig-raster-wc-1.png" alt="Camadas rasters do WorldClim (BIO01 e BIO12) para o mundo." width="100%" height="100%"><p class="caption">
Figura 15.15: Camadas rasters do WorldClim (BIO01 e BIO12) para o mundo.
</p>
</div>
</div>
<div id="exportar-dados-1" class="section level3" number="15.6.3">
<h3>
<span class="header-section-number">15.6.3</span> Exportar dados<a class="anchor" aria-label="anchor" href="#exportar-dados-1"><i class="fas fa-link"></i></a>
</h3>
<p>Saber a melhor forma de exportar dados geoespaciais de objetos rec√©m-criados no R √© fundamental, principalmente porque essa a√ß√£o depender√° do tipo de dado (vetor ou raster), classe do objeto (por exemplo, <code>MULTIPOINT</code> ou <code>RasterLayer</code>) e tipo e quantidade de informa√ß√µes armazenadas (por exemplo, tamanho do objeto, intervalo de valores, etc.).</p>
<p><strong>Vetor</strong></p>
<p>Para dados vetoriais, a principal fun√ß√£o utilizada √© a <code><a href="https://r-spatial.github.io/sf/reference/st_write.html">sf::st_write()</a></code>. Essa fun√ß√£o permite gravar objetos <code>sf</code> em v√°rios formatos de arquivos vetoriais, como <code>.shp</code>, <code>.gpkg</code> ou <code>.geojson</code>. O formato a ser exportado vai influenciar na velocidade do processo de grava√ß√£o.</p>
<p>Os argumentos dessa fun√ß√£o ser√° o <code>obj</code> que √© o objeto <code>sf</code> criado no ambiente R, e o <code>dsn</code> (<em>data source name</em>), ou seja, o nome que o arquivo ter√° ao ser exportado do R, de modo que o complemento <code>.shp</code> no nome de sa√≠da, por exemplo, definir√° que o arquivo ter√° a extens√£o <code>ESRI Shapefile</code>. Entretanto, essa extens√£o pode ser definida tamb√©m utilizando o argumento <code>driver</code>, com as possibilidades listadas nesse <a href="https://gdal.org/drivers/vector/index.html">site</a>.</p>
<div class="sourceCode" id="cb594"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Exportar o pol√≠gono de Rio Claro na extens√£o ESRI Shapefile</span>
<span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html">st_write</a></span><span class="op">(</span>obj <span class="op">=</span> <span class="va">geo_vetor_rio_claro</span>, 
             dsn <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"vetor"</span>, <span class="st">"geo_vetor_rio_claro.shp"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Ou podemos ainda exportar o objeto vetorial na extens√£o <code>GeoPackage</code>. Entretanto, aqui √© interessante acrescentar um argumento chamado <code>layer</code> para definir o nome das camadas a serem exportadas no mesmo arquivo <code>GeoPackage</code>, por exemplo.</p>
<div class="sourceCode" id="cb595"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Exportar o pol√≠gono de Rio Claro na extens√£o Geopackage</span>
<span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html">st_write</a></span><span class="op">(</span>obj <span class="op">=</span> <span class="va">geo_vetor_rio_claro</span>, 
             dsn <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"vetor"</span>, <span class="st">"vetores.gpkg"</span><span class="op">)</span>, 
             layer <span class="op">=</span> <span class="st">"rio_claro"</span><span class="op">)</span></code></pre></div>
<p>Ainda sobre o formato <code>GeoPackage</code>, h√° algo muito interessante que podemos fazer: podemos acrescentar outros arquivos vetoriais ao mesmo arquivo j√° criado. Como exemplo, exportaremos o limite do Brasil para o mesmo arquivo.</p>
<div class="sourceCode" id="cb596"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Exportar o pol√≠gono do Brasil na extens√£o Geopackage</span>
<span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html">st_write</a></span><span class="op">(</span>obj <span class="op">=</span> <span class="va">geo_vetor_brasil</span>, 
             dsn <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"vetor"</span>, <span class="st">"vetores.gpkg"</span><span class="op">)</span>, 
             layer <span class="op">=</span> <span class="st">"brasil"</span><span class="op">)</span></code></pre></div>
<p><strong>Raster</strong></p>
<p>Para exportar dados raster utilizamos geralmente a fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/writeRaster.html">raster::writeRaster()</a></code>. Exportar dados raster √© um pouco mais complexo que exportar dados vetoriais. Teremos de definir se exportaremos arquivos em uma ou v√°rias camadas, quantidade de informa√ß√µes por pixel, e ainda diferentes extens√µes de sa√≠da.</p>
<div class="alert alert-info">
<p><strong> üìù Importante </strong><br>
Arquivos raster escritos em discos geralmente ocupam bastante espa√ßo, e dessa forma, h√° par√¢metros espec√≠ficos para certos tipos de dados, que detalharemos a seguir para contornar esse problema e comprimir os arquivos.</p>
</div>
<p>Na fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/writeRaster.html">raster::writeRaster()</a></code>, o argumento <code>x</code> diz respeito ao objeto raster no ambiente R. O argumento <code>filename</code> √© nome do arquivo que ser√° exportado do R, podendo ou n√£o possuir a extens√£o que se pretende que o arquivo tenha. O argumento <code>format</code> √© o formato do arquivo, sendo as principais possibilidades resumidas na Tabela <a href="cap15.html#tab:tab-raster-formatos">15.8</a>, e para saber das possibilidades suportadas, use a fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/writeFormats.html">raster::writeFormats()</a></code>. O argumento <code>bylayer</code> diz se m√∫ltiplas camadas ser√£o exportadas em arquivos diferentes ou em apenas um arquivo.</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:tab-raster-formatos">Tabela 15.8: </span>Principais formatos de arquivos raster exportados do R.
</caption>
<thead><tr>
<th style="text-align:left;">
Tipo de arquivo
</th>
<th style="text-align:left;">
Nome longo
</th>
<th style="text-align:left;">
Extens√£o
</th>
<th style="text-align:left;">
Suporte a m√∫ltiplas camadas
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
raster
</td>
<td style="text-align:left;">
Formato pacote raster
</td>
<td style="text-align:left;">
.grd
</td>
<td style="text-align:left;">
Sim
</td>
</tr>
<tr>
<td style="text-align:left;">
ascii
</td>
<td style="text-align:left;">
ESRI Ascii
</td>
<td style="text-align:left;">
.asc
</td>
<td style="text-align:left;">
N√£o
</td>
</tr>
<tr>
<td style="text-align:left;">
SAGA
</td>
<td style="text-align:left;">
SAGA GIS
</td>
<td style="text-align:left;">
.sdat
</td>
<td style="text-align:left;">
N√£o
</td>
</tr>
<tr>
<td style="text-align:left;">
IDRISI
</td>
<td style="text-align:left;">
IDRISI
</td>
<td style="text-align:left;">
.rst
</td>
<td style="text-align:left;">
N√£o
</td>
</tr>
<tr>
<td style="text-align:left;">
CDF
</td>
<td style="text-align:left;">
netCDF (requer ncdf4)
</td>
<td style="text-align:left;">
.nc
</td>
<td style="text-align:left;">
Sim
</td>
</tr>
<tr>
<td style="text-align:left;">
GTiff
</td>
<td style="text-align:left;">
GeoTiff (requer rgdal)
</td>
<td style="text-align:left;">
.tif
</td>
<td style="text-align:left;">
Sim
</td>
</tr>
<tr>
<td style="text-align:left;">
ENVI
</td>
<td style="text-align:left;">
ENVI .hdr
</td>
<td style="text-align:left;">
.envi
</td>
<td style="text-align:left;">
Sim
</td>
</tr>
<tr>
<td style="text-align:left;">
EHdr
</td>
<td style="text-align:left;">
ESRI .hdr
</td>
<td style="text-align:left;">
.bil
</td>
<td style="text-align:left;">
Sim
</td>
</tr>
<tr>
<td style="text-align:left;">
HFA
</td>
<td style="text-align:left;">
Erdas imagem (.img)
</td>
<td style="text-align:left;">
.img
</td>
<td style="text-align:left;">
Sim
</td>
</tr>
</tbody>
</table></div>
<p>Dentre os argumentos adicionais, temos ainda o <code>datatype</code>, que faz refer√™ncia a um dos nove tipos de formato de dados detalhados na Tabela <a href="cap15.html#tab:tab-raster-tipos">15.9</a>, sendo que o tipo de dado determina a representa√ß√£o em bits (quantidade de informa√ß√£o) na c√©lula do objeto raster exportado e depende da faixa de valores do objeto raster em cada pixel. Quanto mais valores um tipo de dado puder representar, maior ser√° o arquivo exportado no disco. Dessa forma, √© interessante utilizar um tipo de dado que diminua o tamanho do arquivo a ser exportado, dependendo do tipo de dado em cada pixel. Para a fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/writeRaster.html">raster::writeRaster()</a></code>, o default √© <code>FLT4S</code>, o que pode ocupar mais espa√ßo em disco do que o necess√°rio.</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:tab-raster-tipos">Tabela 15.9: </span>Tipos de dados suportados pelo pacote <code>raster</code>.
</caption>
<thead><tr>
<th style="text-align:left;">
Tipo de dado
</th>
<th style="text-align:left;">
Valor m√≠nimo
</th>
<th style="text-align:left;">
Valor m√°ximo
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
LOG1S
</td>
<td style="text-align:left;">
FALSE (0)
</td>
<td style="text-align:left;">
TRUE (1)
</td>
</tr>
<tr>
<td style="text-align:left;">
INT1S
</td>
<td style="text-align:left;">
-127
</td>
<td style="text-align:left;">
127
</td>
</tr>
<tr>
<td style="text-align:left;">
INT1U
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
255
</td>
</tr>
<tr>
<td style="text-align:left;">
INT2S
</td>
<td style="text-align:left;">
-32.767
</td>
<td style="text-align:left;">
32.767
</td>
</tr>
<tr>
<td style="text-align:left;">
INT2U
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
65534
</td>
</tr>
<tr>
<td style="text-align:left;">
INT4S
</td>
<td style="text-align:left;">
-2.147.483.647
</td>
<td style="text-align:left;">
2.147.483.647
</td>
</tr>
<tr>
<td style="text-align:left;">
INT4U
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
42.94.967.296
</td>
</tr>
<tr>
<td style="text-align:left;">
FLT4S
</td>
<td style="text-align:left;">
-3,4e+38
</td>
<td style="text-align:left;">
3,4e+38
</td>
</tr>
<tr>
<td style="text-align:left;">
FLT8S
</td>
<td style="text-align:left;">
-1,7e+308
</td>
<td style="text-align:left;">
1,7e+308
</td>
</tr>
</tbody>
</table></div>
<p>Outros argumentos de suporte s√£o: <code>overwrite</code> para sobrescrever um arquivo que j√° exista, <code>progress</code> para mostrar uma barra de progresso da exporta√ß√£o como ‚Äútext‚Äù ou ‚Äúwindow‚Äù, e <code>options</code> que permite op√ß√µes do GDAL. Para esse √∫ltimo, quando exportar especificamente na extens√£o <code>GeoTIFF</code>, podemos utilizar <code>options = c("COMPRESS=DEFLATE", "TFW=YES")</code> para que haja compress√£o do arquivo, diminuindo consideravelmente seu tamanho (cerca de um ter√ßo), aliado √† cria√ß√£o de um arquivo auxiliar <code>.tfw</code>, para ser carregado em softwares espec√≠ficos de SIG, como o ArcGIS.</p>
<p>Para exportar apenas uma camada <code>RasterLayer</code>, podemos utilizar a fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/writeRaster.html">raster::writeRaster()</a></code> em um formato mais simples.</p>
<div class="sourceCode" id="cb597"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Criar diret√≥rio</span>
<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"raster"</span>, <span class="st">"exportados"</span><span class="op">)</span><span class="op">)</span>

<span class="co">## Exportar raster layer</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/writeRaster.html">writeRaster</a></span><span class="op">(</span><span class="va">geo_raster_srtm</span>, 
                    filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"raster"</span>, <span class="st">"exportados"</span>, <span class="st">"elevation"</span><span class="op">)</span>,
                    format <span class="op">=</span> <span class="st">"GTiff"</span>,
                    datatype <span class="op">=</span> <span class="st">"INT2S"</span>,
                    options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"COMPRESS=DEFLATE"</span>, <span class="st">"TFW=YES"</span><span class="op">)</span>,
                    progress <span class="op">=</span> <span class="st">"text"</span>,
                    overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>Para mais de uma camada <code>RasterBrick</code> ou <code>RasterStack</code>, podemos utilizar a fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/writeRaster.html">raster::writeRaster()</a></code> com o <code>bylayer = TRUE</code>.</p>
<div class="sourceCode" id="cb598"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Exportar raster stack</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/writeRaster.html">writeRaster</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">geo_raster_bioclim</span>, 
                    filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"raster"</span>, <span class="st">"exportados"</span>, <span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">geo_raster_bioclim</span><span class="op">)</span><span class="op">)</span>,
                    bylayer <span class="op">=</span> <span class="cn">TRUE</span>, 
                    format <span class="op">=</span> <span class="st">"GTiff"</span>,
                    datatype <span class="op">=</span> <span class="st">"INT2S"</span>,
                    options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"COMPRESS=DEFLATE"</span>, <span class="st">"TFW=YES"</span><span class="op">)</span>,
                    progress <span class="op">=</span> <span class="st">"text"</span>,
                    overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="descri√ß√£o-de-objetos-geoespaciais" class="section level2" number="15.7">
<h2>
<span class="header-section-number">15.7</span> Descri√ß√£o de objetos geoespaciais<a class="anchor" aria-label="anchor" href="#descri%C3%A7%C3%A3o-de-objetos-geoespaciais"><i class="fas fa-link"></i></a>
</h2>
<p>Muitas vezes precisaremos verificar as informa√ß√µes dos objetos geoespaciais importados para o R. Apesar de chamar o objeto trazer grande parte das informa√ß√µes que precisamos consultar, existem fun√ß√µes espec√≠ficas que nos auxiliam nesse processo de descri√ß√£o dos objetos.</p>
<div id="vetor-2" class="section level3" number="15.7.1">
<h3>
<span class="header-section-number">15.7.1</span> Vetor<a class="anchor" aria-label="anchor" href="#vetor-2"><i class="fas fa-link"></i></a>
</h3>
<p>Podemos acessar as informa√ß√µes geoespaciais e a tabela de atributos de um objeto importado como vetor simplesmente chamando o nome do objeto no R.</p>
<div class="sourceCode" id="cb599"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Munic√≠pio de Rio Claro</span>
<span class="va">geo_vetor_rio_claro</span>
<span class="co">#&gt; Simple feature collection with 1 feature and 7 fields</span>
<span class="co">#&gt; Geometry type: MULTIPOLYGON</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: -47.76521 ymin: -22.55203 xmax: -47.46188 ymax: -22.24368</span>
<span class="co">#&gt; Geodetic CRS:  SIRGAS 2000</span>
<span class="co">#&gt;     code_muni name_muni code_state abbrev_state name_state code_region name_region                           geom</span>
<span class="co">#&gt; 493   3543907 Rio Claro         35           SP  S√£o Paulo           3     Sudeste MULTIPOLYGON (((-47.46875 -...</span></code></pre></div>
<p>Mas tamb√©m podemos acessar informa√ß√µes geoespaciais com fun√ß√µes espec√≠ficas, como tipo de geometria, limites geoespaciais do vetor (extens√£o), sistema de refer√™ncia de coordenadas (CRS), e a tabela de atributos.</p>
<div class="sourceCode" id="cb600"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Tipo de geometria</span>
<span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry_type.html">st_geometry_type</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro</span><span class="op">)</span>
<span class="co">#&gt; [1] MULTIPOLYGON</span>
<span class="co">#&gt; 18 Levels: GEOMETRY POINT LINESTRING POLYGON MULTIPOINT MULTILINESTRING MULTIPOLYGON ... TRIANGLE</span>

<span class="co">## Extens√£o</span>
<span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro</span><span class="op">)</span>
<span class="co">#&gt;      xmin      ymin      xmax      ymax </span>
<span class="co">#&gt; -47.76521 -22.55203 -47.46188 -22.24368</span>

<span class="co">## CRS</span>
<span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro</span><span class="op">)</span>
<span class="co">#&gt; Coordinate Reference System:</span>
<span class="co">#&gt;   User input: SIRGAS 2000 </span>
<span class="co">#&gt;   wkt:</span>
<span class="co">#&gt; GEOGCRS["SIRGAS 2000",</span>
<span class="co">#&gt;     DATUM["Sistema de Referencia Geocentrico para las AmericaS 2000",</span>
<span class="co">#&gt;         ELLIPSOID["GRS 1980",6378137,298.257222101,</span>
<span class="co">#&gt;             LENGTHUNIT["metre",1]]],</span>
<span class="co">#&gt;     PRIMEM["Greenwich",0,</span>
<span class="co">#&gt;         ANGLEUNIT["degree",0.0174532925199433]],</span>
<span class="co">#&gt;     CS[ellipsoidal,2],</span>
<span class="co">#&gt;         AXIS["geodetic latitude (Lat)",north,</span>
<span class="co">#&gt;             ORDER[1],</span>
<span class="co">#&gt;             ANGLEUNIT["degree",0.0174532925199433]],</span>
<span class="co">#&gt;         AXIS["geodetic longitude (Lon)",east,</span>
<span class="co">#&gt;             ORDER[2],</span>
<span class="co">#&gt;             ANGLEUNIT["degree",0.0174532925199433]],</span>
<span class="co">#&gt;     USAGE[</span>
<span class="co">#&gt;         SCOPE["Horizontal component of 3D system."],</span>
<span class="co">#&gt;         AREA["Latin America - Central America and South America - onshore and offshore. Brazil - onshore and offshore."],</span>
<span class="co">#&gt;         BBOX[-59.87,-122.19,32.72,-25.28]],</span>
<span class="co">#&gt;     ID["EPSG",4674]]</span>

<span class="co">## Acessar a tabela de atributos</span>
<span class="va">geo_vetor_rio_claro_tab</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro</span><span class="op">)</span>
<span class="va">geo_vetor_rio_claro_tab</span>
<span class="co">#&gt;     code_muni name_muni code_state abbrev_state name_state code_region name_region</span>
<span class="co">#&gt; 493   3543907 Rio Claro         35           SP  S√£o Paulo           3     Sudeste</span></code></pre></div>
</div>
<div id="raster-2" class="section level3" number="15.7.2">
<h3>
<span class="header-section-number">15.7.2</span> Raster<a class="anchor" aria-label="anchor" href="#raster-2"><i class="fas fa-link"></i></a>
</h3>
<p>Da mesma forma, podemos acessar as informa√ß√µes objetos raster chamando o nome do objeto.</p>
<div class="sourceCode" id="cb601"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Raster layer</span>
<span class="va">geo_raster_srtm</span>
<span class="co">#&gt; class      : RasterLayer </span>
<span class="co">#&gt; dimensions : 6000, 6000, 3.6e+07  (nrow, ncol, ncell)</span>
<span class="co">#&gt; resolution : 0.0008333333, 0.0008333333  (x, y)</span>
<span class="co">#&gt; extent     : -50, -45, -25, -20  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs </span>
<span class="co">#&gt; source     : srtm_27_17.tif </span>
<span class="co">#&gt; names      : srtm_27_17 </span>
<span class="co">#&gt; values     : -32768, 32767  (min, max)</span></code></pre></div>
<p>Al√©m disso, podemos selecionar informa√ß√µes desse objeto com fun√ß√µes espec√≠ficas, tanto para <code>RasterLayer</code>, quanto para <code>RasterBrick</code> ou <code>RasterStack</code> como: classe, dimens√µes (n√∫mero de linhas, colunas e camadas), n√∫mero de camadas, n√∫mero de linhas, n√∫mero de colunas, n√∫mero de c√©lulas, resolu√ß√£o (largura e altura do tamanho do pixel), extens√£o (limites geoespaciais), sistema de refer√™ncia de coordenadas (CRS), nome das camadas e extrair os valores de todos os pixels.</p>
<div class="sourceCode" id="cb602"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Classe</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">geo_raster_srtm</span><span class="op">)</span>
<span class="co">#&gt; [1] "RasterLayer"</span>
<span class="co">#&gt; attr(,"package")</span>
<span class="co">#&gt; [1] "raster"</span>

<span class="co">## Dimens√µes</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/dimensions.html">dim</a></span><span class="op">(</span><span class="va">geo_raster_srtm</span><span class="op">)</span>
<span class="co">#&gt; [1] 6000 6000    1</span>

<span class="co">## N√∫mero de camadas</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/nlayers.html">nlayers</a></span><span class="op">(</span><span class="va">geo_raster_srtm</span><span class="op">)</span>
<span class="co">#&gt; [1] 1</span>

<span class="co">## N√∫mero de linhas</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">nrow</a></span><span class="op">(</span><span class="va">geo_raster_srtm</span><span class="op">)</span>
<span class="co">#&gt; [1] 6000</span>

<span class="co">## N√∫mero de colunas</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">ncol</a></span><span class="op">(</span><span class="va">geo_raster_srtm</span><span class="op">)</span>
<span class="co">#&gt; [1] 6000</span>

<span class="co">## N√∫mero de c√©lulas</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">ncell</a></span><span class="op">(</span><span class="va">geo_raster_srtm</span><span class="op">)</span>
<span class="co">#&gt; [1] 3.6e+07</span>

<span class="co">## Resolu√ß√£o</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/resolution.html">res</a></span><span class="op">(</span><span class="va">geo_raster_srtm</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.0008333333 0.0008333333</span>

<span class="co">## Extens√£o</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span><span class="op">(</span><span class="va">geo_raster_srtm</span><span class="op">)</span>
<span class="co">#&gt; class      : Extent </span>
<span class="co">#&gt; xmin       : -50 </span>
<span class="co">#&gt; xmax       : -45 </span>
<span class="co">#&gt; ymin       : -25 </span>
<span class="co">#&gt; ymax       : -20</span>

<span class="co">## Proje√ß√£o ou CRS</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/projection.html">projection</a></span><span class="op">(</span><span class="va">geo_raster_srtm</span><span class="op">)</span>
<span class="co">#&gt; [1] "+proj=longlat +datum=WGS84 +no_defs"</span>

<span class="co">## Nomes</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">geo_raster_srtm</span><span class="op">)</span>
<span class="co">#&gt; [1] "srtm_27_17"</span>

<span class="co">## Valores</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/getValues.html">getValues</a></span><span class="op">(</span><span class="va">geo_raster_srtm</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">head</span>
<span class="co">#&gt; [1] 382 379 379 379 379 383</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/getValues.html">values</a></span><span class="op">(</span><span class="va">geo_raster_srtm</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">head</span>
<span class="co">#&gt; [1] 382 379 379 379 379 383</span>
<span class="va">geo_raster_srtm</span><span class="op">[</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">head</span>
<span class="co">#&gt; [1] 382 379 379 379 379 383</span></code></pre></div>
</div>
</div>
<div id="reproje√ß√£o-de-dados-geoespaciais" class="section level2" number="15.8">
<h2>
<span class="header-section-number">15.8</span> Reproje√ß√£o de dados geoespaciais<a class="anchor" aria-label="anchor" href="#reproje%C3%A7%C3%A3o-de-dados-geoespaciais"><i class="fas fa-link"></i></a>
</h2>
<p>Em algumas situa√ß√µes √© necess√°rio alterar o CRS de um objeto espacial para um novo CRS. A reproje√ß√£o √© justamente a transforma√ß√£o de coordenadas de um CRS para outro: geoespaciais (‚Äòlon/lat‚Äô, com unidades em graus de longitude e latitude) e projetados (normalmente com unidades de metros a partir de um <em>datum</em>).</p>
<p>Geralmente precisaremos fazer essa opera√ß√£o para transformar camadas vetoriais ou rasters para o mesmo CRS, de modo que possam ser exibidas conjuntamente, ou ainda que as camadas possuem CRS projetado para realizar alguma opera√ß√£o espacial entre camadas, ou quando precisamos calcular √°reas, formatos ou dist√¢ncias, como m√©tricas de paisagem, por exemplo. Existe uma infinidade de proje√ß√µes e um excelente material de consulta √© o livro de Lapaine &amp; Usery <span class="citation">(<a href="refer%C3%AAncias.html#ref-lapaine2017" role="doc-biblioref">2017</a>)</span>.</p>
<p>Podemos verificar o CRS de uma camada atrav√©s da fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/st_crs.html">sf::st_crs()</a></code> ou <code><a href="https://rdrr.io/pkg/raster/man/projection.html">raster::projection()</a></code> e <code><a href="https://rdrr.io/pkg/raster/man/projection.html">raster::crs()</a></code>, ou ainda, saber se a mesma possui um CRS geogr√°fico ou n√£o, com a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/st_is_longlat.html">sf::st_is_longlat()</a></code>.</p>
<p>J√° para reprojetar um objeto <code>sf</code> usamos a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/st_transform.html">sf::st_transform()</a></code> e para um objeto <code>raster</code> usamos a fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/projectRaster.html">raster::projectRaster()</a></code>.</p>
<div class="sourceCode" id="cb603"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Proje√ß√£o de vetores</span>
<span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro</span><span class="op">)</span>
<span class="co">#&gt; Coordinate Reference System:</span>
<span class="co">#&gt;   User input: SIRGAS 2000 </span>
<span class="co">#&gt;   wkt:</span>
<span class="co">#&gt; GEOGCRS["SIRGAS 2000",</span>
<span class="co">#&gt;     DATUM["Sistema de Referencia Geocentrico para las AmericaS 2000",</span>
<span class="co">#&gt;         ELLIPSOID["GRS 1980",6378137,298.257222101,</span>
<span class="co">#&gt;             LENGTHUNIT["metre",1]]],</span>
<span class="co">#&gt;     PRIMEM["Greenwich",0,</span>
<span class="co">#&gt;         ANGLEUNIT["degree",0.0174532925199433]],</span>
<span class="co">#&gt;     CS[ellipsoidal,2],</span>
<span class="co">#&gt;         AXIS["geodetic latitude (Lat)",north,</span>
<span class="co">#&gt;             ORDER[1],</span>
<span class="co">#&gt;             ANGLEUNIT["degree",0.0174532925199433]],</span>
<span class="co">#&gt;         AXIS["geodetic longitude (Lon)",east,</span>
<span class="co">#&gt;             ORDER[2],</span>
<span class="co">#&gt;             ANGLEUNIT["degree",0.0174532925199433]],</span>
<span class="co">#&gt;     USAGE[</span>
<span class="co">#&gt;         SCOPE["Horizontal component of 3D system."],</span>
<span class="co">#&gt;         AREA["Latin America - Central America and South America - onshore and offshore. Brazil - onshore and offshore."],</span>
<span class="co">#&gt;         BBOX[-59.87,-122.19,32.72,-25.28]],</span>
<span class="co">#&gt;     ID["EPSG",4674]]</span>

<span class="co">## Proje√ß√£o de raster</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/projection.html">projection</a></span><span class="op">(</span><span class="va">geo_raster_srtm</span><span class="op">)</span>
<span class="co">#&gt; [1] "+proj=longlat +datum=WGS84 +no_defs"</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/projection.html">crs</a></span><span class="op">(</span><span class="va">geo_raster_srtm</span><span class="op">)</span>
<span class="co">#&gt; Coordinate Reference System:</span>
<span class="co">#&gt; Deprecated Proj.4 representation: +proj=longlat +datum=WGS84 +no_defs </span>
<span class="co">#&gt; WKT2 2019 representation:</span>
<span class="co">#&gt; GEOGCRS["WGS 84 (with axis order normalized for visualization)",</span>
<span class="co">#&gt;     DATUM["World Geodetic System 1984",</span>
<span class="co">#&gt;         ELLIPSOID["WGS 84",6378137,298.257223563,</span>
<span class="co">#&gt;             LENGTHUNIT["metre",1]]],</span>
<span class="co">#&gt;     PRIMEM["Greenwich",0,</span>
<span class="co">#&gt;         ANGLEUNIT["degree",0.0174532925199433]],</span>
<span class="co">#&gt;     CS[ellipsoidal,2],</span>
<span class="co">#&gt;         AXIS["geodetic longitude (Lon)",east,</span>
<span class="co">#&gt;             ORDER[1],</span>
<span class="co">#&gt;             ANGLEUNIT["degree",0.0174532925199433,</span>
<span class="co">#&gt;                 ID["EPSG",9122]]],</span>
<span class="co">#&gt;         AXIS["geodetic latitude (Lat)",north,</span>
<span class="co">#&gt;             ORDER[2],</span>
<span class="co">#&gt;             ANGLEUNIT["degree",0.0174532925199433,</span>
<span class="co">#&gt;                 ID["EPSG",9122]]]]</span>

<span class="co">## Verificar se o CRS √© geogr√°fico</span>
<span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_is_longlat.html">st_is_longlat</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>As fun√ß√µes <code><a href="https://r-spatial.github.io/sf/reference/st_transform.html">sf::st_transform()</a></code> e <code><a href="https://rdrr.io/pkg/raster/man/projectRaster.html">raster::projectRaster()</a></code> possuem dois argumentos importantes: <code>x</code> que √© o objeto a ser reprojetado e o <code>crs</code> que √© o CRS alvo. O argumento <code>crs</code> pode ser especificado de quatro maneiras: i) c√≥digo EPSG (por exemplo, 4326), ii) string PROJ4 (por exemplo, <code>+ proj = longlat + datum = WGS84 + no_defs</code>), iii) string WKT, ou iv) objeto <code>crs</code> de outra camada, conforme retornado por <code><a href="https://r-spatial.github.io/sf/reference/st_crs.html">sf::st_crs()</a></code> ou <code><a href="https://rdrr.io/pkg/raster/man/projection.html">raster::crs()</a></code>. Essas informa√ß√µes de EPSG, PROJ4 e WKT podem ser acessadas nas bases: <a href="http://epsg.io/">epsg.io</a> e <a href="https://spatialreference.org/">spatialreference.org</a>.</p>
<p>Dentre os poss√≠veis CRSs a serem utilizados, alguns s√£o mais comuns para CRSs geoespaciais e projetados. Para CRSs geoespaciais, o mais comum para o mundo √© o <em>World Geodetic System 1984</em> (WGS84), ou seja, geogr√°fico com <em>datum</em> WGS84. Para o Brasil, o CRS adotado √© o <a href="http://www.sirgas.org/pt/sirgas-realizations/sirgas2000/">Sistema de Referencia Geoc√©ntrico para las Am√©ricas 2000 (SIRGAS 2000)</a>, ou seja, geogr√°fico com <em>datum</em> SIRGAS2000.</p>
<p>Para CRSs projetados, essa escolha vai depender da extens√£o e localiza√ß√£o da √°rea de interesse no globo terrestre. Aqui destacaremos os principais, para tr√™s escalas: global, regional e local. Para a escala global, geralmente usa-se umas dessas proje√ß√µes, dependendo do objetivo: i) Proje√ß√£o de Mollweide, ii) Proje√ß√£o de Winkel Tripel, iii) Proje√ß√£o de Eckert IV, iv) Proje√ß√£o Azimutal de Lambert. Para a escala regional, como um hemisf√©rio, geralmente usa-se a Proje√ß√£o C√¥nica de Albers. Por fim, para a escala local, usa-se geralmente a Proje√ß√£o Universal Transverse Mercator (UTM), um conjunto de CRSs que divide a Terra em 60 cunhas longitudinais e 20 segmentos latitudinais, como pode ser visto neste <a href="http://www.dmap.co.uk/utmworld.htm">link</a>.</p>
<p>Os principais CRSs s√£o descritos na Tabela <a href="cap15.html#tab:tab-crs">15.10</a>.</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:tab-crs">Tabela 15.10: </span>Principais CRSs utilizados.
</caption>
<thead><tr>
<th style="text-align:left;">
CRS
</th>
<th style="text-align:left;">
Tipo de CRS
</th>
<th style="text-align:left;">
Descri√ß√£o
</th>
<th style="text-align:left;">
epsg.io
</th>
<th style="text-align:left;">
spatialreference.org
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
World Geodetic System 1984 (WGS84)
</td>
<td style="text-align:left;">
Geogr√°fico
</td>
<td style="text-align:left;">
CRS geogr√°fico mais comum para o mundo
</td>
<td style="text-align:left;">
<a href="http://epsg.io/4326">EPSG:4326</a>
</td>
<td style="text-align:left;">
<a href="https://spatialreference.org/ref/epsg/4326/">EPSG:4326</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
Sistema de Referencia Geoc√©ntrico para las Am√©ricas 2000 (SIRGAS 2000)
</td>
<td style="text-align:left;">
Geogr√°fico
</td>
<td style="text-align:left;">
CRS geogr√°fico oficial para o Brasil
</td>
<td style="text-align:left;">
<a href="http://epsg.io/4674">EPSG:4674</a>
</td>
<td style="text-align:left;">
<a href="https://spatialreference.org/ref/epsg/4674/">EPSG:4674</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
Proje√ß√£o de Mollweide
</td>
<td style="text-align:left;">
Projetado
</td>
<td style="text-align:left;">
CRS projetado que preserva as rela√ß√µes de √°rea
</td>
<td style="text-align:left;">
<a href="https://epsg.io/54009">ESRI:54009</a>
</td>
<td style="text-align:left;">
<a href="https://spatialreference.org/ref/sr-org/7099/">SR-ORG:7099</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
Proje√ß√£o de Winkel Tripel
</td>
<td style="text-align:left;">
Projetado
</td>
<td style="text-align:left;">
CRS projetado com m√≠nimo de distor√ß√£o para √°rea, dire√ß√£o e dist√¢ncia
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
<a href="https://spatialreference.org/ref/sr-org/7291/">SR-ORG:7291</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
Proje√ß√£o de Eckert IV
</td>
<td style="text-align:left;">
Projetado
</td>
<td style="text-align:left;">
CRS projetado que preserva a √°rea e com meridianos el√≠pticos
</td>
<td style="text-align:left;">
<a href="https://epsg.io/54012">EPSG:54012</a>
</td>
<td style="text-align:left;">
<a href="https://spatialreference.org/ref/esri/54012/">ESRI:54012</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
Proje√ß√£o Azimutal de Lambert
</td>
<td style="text-align:left;">
Projetado
</td>
<td style="text-align:left;">
CRS projetado que preserva os tamanhos relativos e senso de dire√ß√£o a partir do centro
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Proje√ß√£o C√¥nica de Albers
</td>
<td style="text-align:left;">
Projetado
</td>
<td style="text-align:left;">
CRS projetado para escala regional, mantendo a √°rea constante em toda sua superf√≠cie
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
<a href="https://spatialreference.org/ref/sr-org/7823/">SR-ORG:7823</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
Proje√ß√£o Universal Transverse Mercator (UTM)
</td>
<td style="text-align:left;">
Projetado
</td>
<td style="text-align:left;">
CRS projetado para escala local, distorcendo √°reas e dist√¢ncias com gravidade crescente com a dist√¢ncia do centro da zona UTM
</td>
<td style="text-align:left;">
<a href="https://epsg.io/31983">EPSG:31983</a>
</td>
<td style="text-align:left;">
<a href="https://spatialreference.org/ref/epsg/31983/">EPSG:31983</a>
</td>
</tr>
</tbody>
</table></div>
<div id="vetor-3" class="section level3" number="15.8.1">
<h3>
<span class="header-section-number">15.8.1</span> Vetor<a class="anchor" aria-label="anchor" href="#vetor-3"><i class="fas fa-link"></i></a>
</h3>
<p>Como dissemos, para reprojetar um vetor, utilizamos a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/st_transform.html">sf::st_transform()</a></code>, observando os argumentos <code>x</code> que √© a camada a ser reprojetada, e o <code>crs</code> que √© o CRS alvo.</p>
<p>Vamos reprojetar o limite do munic√≠pio de Rio Claro/SP do CRS SIRGAS2000/geogr√°fico para o CRS projetado SIRGAS2000/UTM23S, com os efeitos da transforma√ß√£o podendo ser notados na Figura <a href="cap15.html#fig:fig-vetor-crs-trans">15.16</a>.</p>
<div class="sourceCode" id="cb604"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Converter CRS</span>
<span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">geo_vetor_rio_claro</span>, 
                                                          crs <span class="op">=</span> <span class="fl">31983</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-crs-trans"></span>
<img src="livro_files/figure-html/fig-vetor-crs-trans-1.png" alt="Limites do munic√≠pio de Rio Claro/SP com CRS SIRGAS2000/geogr√°fico e com CRS SIRGAS2000/UTM23S." width="100%" height="100%"><p class="caption">
Figura 15.16: Limites do munic√≠pio de Rio Claro/SP com CRS SIRGAS2000/geogr√°fico e com CRS SIRGAS2000/UTM23S.
</p>
</div>
<p>Podemos ainda utilizar o formato <code>proj4string</code> no argumento <code>crs</code> para fazer a transforma√ß√£o. Vamos primeiramente plotar o mundo em WGS84/Geogr√°fico (Figura <a href="cap15.html#fig:fig-vetor-mundo-wgs84">15.17</a>).</p>
<div class="sourceCode" id="cb605"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">co110_sf</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"gray"</span>,  main <span class="op">=</span> <span class="st">"WGS84/Geogr√°fio"</span>, graticule <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-mundo-wgs84"></span>
<img src="livro_files/figure-html/fig-vetor-mundo-wgs84-1.png" alt="Camada BIO01 para o mundo com CRS geogr√°fico e datum WGS84." width="100%" height="100%"><p class="caption">
Figura 15.17: Camada BIO01 para o mundo com CRS geogr√°fico e datum WGS84.
</p>
</div>
<p>Agora, reprojetaremos utilizando a Proje√ß√£o de Mollweide (Figura <a href="cap15.html#fig:fig-vetor-mundo-moll">15.18</a>).</p>
<div class="sourceCode" id="cb606"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Proje√ß√£o de Mollweide </span>
<span class="va">co110_sf_moll</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">co110_sf</span>, crs <span class="op">=</span> <span class="st">"+proj=moll"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb607"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">co110_sf_moll</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"gray"</span>, main <span class="op">=</span> <span class="st">"Proje√ß√£o de Mollweide"</span>, graticule <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-mundo-moll"></span>
<img src="livro_files/figure-html/fig-vetor-mundo-moll-1.png" alt="Camada BIO01 para o mundo com CRS Proje√ß√£o de Mollweide." width="100%" height="100%"><p class="caption">
Figura 15.18: Camada BIO01 para o mundo com CRS Proje√ß√£o de Mollweide.
</p>
</div>
<p>Ou ainda podemos utilizar a Proje√ß√£o Azimutal de Lambert com alguns par√¢metros ajustados para centralizar a proje√ß√£o no Brasil (Figura <a href="cap15.html#fig:fig-vetor-mundo-laea">15.19</a>).</p>
<div class="sourceCode" id="cb608"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Proje√ß√£o Azimutal de Lambert</span>
<span class="va">co110_sf_laea</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">co110_sf</span>, 
                                  crs <span class="op">=</span> <span class="st">"+proj=laea +x_0=0 +y_0=0 +lon_0=-50 +lat_0=0"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb609"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">co110_sf_laea</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"gray"</span>, main <span class="op">=</span> <span class="st">"Proje√ß√£o Azimutal de Lambert"</span>, graticule <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-mundo-laea"></span>
<img src="livro_files/figure-html/fig-vetor-mundo-laea-1.png" alt="amada BIO01 para o mundo com CRS Proje√ß√£o Azimutal de Lambert centrado no Brasil." width="100%" height="100%"><p class="caption">
Figura 15.19: amada BIO01 para o mundo com CRS Proje√ß√£o Azimutal de Lambert centrado no Brasil.
</p>
</div>
</div>
<div id="raster-3" class="section level3" number="15.8.2">
<h3>
<span class="header-section-number">15.8.2</span> Raster<a class="anchor" aria-label="anchor" href="#raster-3"><i class="fas fa-link"></i></a>
</h3>
<p>A reproje√ß√£o de objetos raster n√£o √© uma tarefa t√£o simples quanto a reproje√ß√£o de vetores. Em vetores, a reproje√ß√£o altera as coordenadas de cada v√©rtice. Entretanto, como rasters s√£o compostos de c√©lulas retangulares do mesmo tamanho, a reproje√ß√£o do raster envolve a cria√ß√£o de um novo objeto raster, envolvendo duas opera√ß√µes espaciais separadas: i) reproje√ß√£o vetorial dos centroides celulares para outro CRS (i.e., muda a posi√ß√£o e tamanho do pixel) e, ii) c√°lculo de novos valores do pixel por meio de reamostragem (i.e., muda o valor do pixel).</p>
<p>A fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/projectRaster.html">raster::projectRaster()</a></code> possui alguns par√¢metros que necessitam de algumas especifica√ß√µes. O argumento <code>from</code> que √© o objeto raster de entrada que sofre a reproje√ß√£o. O argumento <code>to</code> √© um objeto raster do qual todas as propriedades dos CRSs, como extens√£o e resolu√ß√£o ser√£o associadas ao objeto raster indicado no argumento <code>from</code>. O argumento <code>res</code> permite ajustar a resolu√ß√£o do pixel de sa√≠da do objeto raster reprojetado.</p>
<p>O argumento <code>crs</code> aceita apenas as defini√ß√µes de <code>proj4string</code> extensas de um CRS em vez de c√≥digos EPSG concisos. Contudo, √© poss√≠vel usar um c√≥digo <code>EPSG</code> em uma defini√ß√£o de <code>proj4string</code> com <code>+init=epsg:EPSG</code>. Por exemplo, pode-se usar a defini√ß√£o <code>+init=epsg:4326</code> para definir CRS para WGS84 (c√≥digo EPSG de 4326). A biblioteca <code>PROJ</code> adiciona automaticamente o resto dos par√¢metros e os converte em <code>+init=epsg:4326 +proj=longlat +datum=WGS84 + no_defs + ellps=WGS84 + towgs84=0,0,0</code>.</p>
<p>O argumento <code>method</code> permite escolher entre os m√©todos <code>ngb</code> (vizinho mais pr√≥ximo) ou <code>biliniar</code> (interpola√ß√£o bilinear), sendo o primeiro mais indicado para reproje√ß√£o de rasters categ√≥ricos, pois os valores estimados devem ser iguais aos do raster original. O m√©todo <code>ngb</code> define cada novo valor de c√©lula para o valor da c√©lula mais pr√≥xima (centro) do raster de entrada. J√° o m√©todo <code>biliniar</code> √© indicado para raster cont√≠nuos e calcula o valor da c√©lula de sa√≠da com base nas quatro c√©lulas mais pr√≥ximas no raster original, sendo a m√©dia ponderada da dist√¢ncia dos valores dessas quatro c√©lulas. Existem outras formas de interpola√ß√£o, mas n√£o as abordaremos aqui.</p>
<p>Aqui, vamos reprojetar os dados de eleva√ß√£o para Rio Claro/SP. Para que esse processo seja mais r√°pido, iremos antes ajustar a extens√£o do raster para o limite do munic√≠pio usando a fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/crop.html">raster::crop()</a></code> (Figura <a href="cap15.html#fig:fig-raster-crop">15.20</a>). Essa fun√ß√£o √© melhor explicada na se√ß√£o de cortes e m√°scaras, mais adiante.</p>
<div class="sourceCode" id="cb610"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Ajuste do limite</span>
<span class="va">geo_raster_srtm_rio_claro</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/crop.html">crop</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">geo_raster_srtm</span>, 
                                          y <span class="op">=</span> <span class="va">geo_vetor_rio_claro</span><span class="op">)</span>
<span class="va">geo_raster_srtm_rio_claro</span>
<span class="co">#&gt; class      : RasterLayer </span>
<span class="co">#&gt; dimensions : 370, 364, 134680  (nrow, ncol, ncell)</span>
<span class="co">#&gt; resolution : 0.0008333333, 0.0008333333  (x, y)</span>
<span class="co">#&gt; extent     : -47.765, -47.46167, -22.55167, -22.24333  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs </span>
<span class="co">#&gt; source     : memory</span>
<span class="co">#&gt; names      : srtm_27_17 </span>
<span class="co">#&gt; values     : 491, 985  (min, max)</span></code></pre></div>
<div class="sourceCode" id="cb611"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-crop"></span>
<img src="livro_files/figure-html/fig-raster-crop-1.png" alt="Ajuste da extens√£o do raster de eleva√ß√£o para o munic√≠pio de Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.20: Ajuste da extens√£o do raster de eleva√ß√£o para o munic√≠pio de Rio Claro/SP.
</p>
</div>
<p>Primeiramente, vamos reprojetar indicando uma proje√ß√£o e sem especificar o tamanho da c√©lula. Note que o tamanho da c√©lula vai se ajustar para valores diferentes, sendo portanto, pixels retangulares e n√£o quadrados.</p>
<div class="sourceCode" id="cb612"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Reproje√ß√£o</span>
<span class="va">geo_raster_srtm_rio_claro_sirgas2000_utm23s</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/projectRaster.html">projectRaster</a></span><span class="op">(</span>
    from <span class="op">=</span> <span class="va">geo_raster_srtm_rio_claro</span>, 
    crs <span class="op">=</span> <span class="st">"+init=epsg:31983"</span>, 
    method <span class="op">=</span> <span class="st">"bilinear"</span><span class="op">)</span>
<span class="va">geo_raster_srtm_rio_claro_sirgas2000_utm23s</span>
<span class="co">#&gt; class      : RasterLayer </span>
<span class="co">#&gt; dimensions : 386, 381, 147066  (nrow, ncol, ncell)</span>
<span class="co">#&gt; resolution : 85.8, 92.3  (x, y)</span>
<span class="co">#&gt; extent     : 214575.4, 247265.2, 7503009, 7538637  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs        : +proj=utm +zone=23 +south +ellps=GRS80 +units=m +no_defs </span>
<span class="co">#&gt; source     : memory</span>
<span class="co">#&gt; names      : srtm_27_17 </span>
<span class="co">#&gt; values     : 491.6033, 980.4151  (min, max)</span></code></pre></div>
<p>Agora vamos reprojetar especificando o tamanho da c√©lula (Figura <a href="cap15.html#fig:fig-raster-reproj">15.21</a>). Dessa forma, todas as c√©lulas ter√£o o mesmo, i.e., quadrados de 90 metros.</p>
<div class="sourceCode" id="cb613"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Reproje√ß√£o</span>
<span class="va">geo_raster_srtm_rio_claro_sirgas2000_utm23s</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/projectRaster.html">projectRaster</a></span><span class="op">(</span>
    from <span class="op">=</span> <span class="va">geo_raster_srtm_rio_claro</span>, 
    crs <span class="op">=</span> <span class="st">"+init=epsg:31983"</span>, 
    method <span class="op">=</span> <span class="st">"bilinear"</span>, 
    res <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>
<span class="va">geo_raster_srtm_rio_claro_sirgas2000_utm23s</span>
<span class="co">#&gt; class      : RasterLayer </span>
<span class="co">#&gt; dimensions : 396, 364, 144144  (nrow, ncol, ncell)</span>
<span class="co">#&gt; resolution : 90, 90  (x, y)</span>
<span class="co">#&gt; extent     : 214554.4, 247314.4, 7502985, 7538625  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs        : +proj=utm +zone=23 +south +ellps=GRS80 +units=m +no_defs </span>
<span class="co">#&gt; source     : memory</span>
<span class="co">#&gt; names      : srtm_27_17 </span>
<span class="co">#&gt; values     : 493.2395, 986.686  (min, max)</span></code></pre></div>
<div class="sourceCode" id="cb614"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro_sirgas2000_utm23s</span>, 
     col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span><span class="op">$</span><span class="va">geom</span>,
     col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-reproj"></span>
<img src="livro_files/figure-html/fig-raster-reproj-1.png" alt="Reproje√ß√£o do raster de eleva√ß√£o para SIRGAS2000/UTM23S especificado por um objeto e informando o tamanho da c√©lula." width="100%" height="100%"><p class="caption">
Figura 15.21: Reproje√ß√£o do raster de eleva√ß√£o para SIRGAS2000/UTM23S especificado por um objeto e informando o tamanho da c√©lula.
</p>
</div>
<p>Vamos tamb√©m reprojetar uma camada mundial da m√©dia de temperatura anual (BIO01), indicando o tamanho da c√©lula para 25.000 m (Figura <a href="cap15.html#fig:fig-raster-reproj-celula-mundo">15.22</a>).</p>
<div class="sourceCode" id="cb615"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Reproje√ß√£o</span>
<span class="va">geo_raster_bioclim_moll</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/projectRaster.html">projectRaster</a></span><span class="op">(</span>
    from <span class="op">=</span> <span class="va">geo_raster_bioclim</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, 
    crs <span class="op">=</span> <span class="st">"+proj=moll"</span>,
    res <span class="op">=</span> <span class="fl">25000</span>, 
    method <span class="op">=</span> <span class="st">"bilinear"</span><span class="op">)</span>
<span class="va">geo_raster_bioclim_moll</span>
<span class="co">#&gt; class      : RasterLayer </span>
<span class="co">#&gt; dimensions : 732, 1453, 1063596  (nrow, ncol, ncell)</span>
<span class="co">#&gt; resolution : 25000, 25000  (x, y)</span>
<span class="co">#&gt; extent     : -18159905, 18165095, -9154952, 9145048  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs        : +proj=moll +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs </span>
<span class="co">#&gt; source     : memory</span>
<span class="co">#&gt; names      : wc2.1_10m_bio_1 </span>
<span class="co">#&gt; values     : -54.66752, 30.71805  (min, max)</span></code></pre></div>
<div class="sourceCode" id="cb616"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_raster_bioclim_moll</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">co110_sf_moll</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, col <span class="op">=</span> <span class="cn">NA</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-reproj-celula-mundo"></span>
<img src="livro_files/figure-html/fig-raster-reproj-celula-mundo-1.png" alt="Reproje√ß√£o do raster de m√©dia de temperatura anual (BIO01) para Proje√ß√£o de Mollweide informando o tamanho da c√©lula." width="100%" height="100%"><p class="caption">
Figura 15.22: Reproje√ß√£o do raster de m√©dia de temperatura anual (BIO01) para Proje√ß√£o de Mollweide informando o tamanho da c√©lula.
</p>
</div>
</div>
</div>
<div id="principais-opera√ß√µes-com-dados-geoespaciais" class="section level2" number="15.9">
<h2>
<span class="header-section-number">15.9</span> Principais opera√ß√µes com dados geoespaciais<a class="anchor" aria-label="anchor" href="#principais-opera%C3%A7%C3%B5es-com-dados-geoespaciais"><i class="fas fa-link"></i></a>
</h2>
<p>Nesta se√ß√£o veremos as principais fun√ß√µes para realizar opera√ß√µes com dados geoespaciais. Essas opera√ß√µes s√£o separadas conforme Lovelace et al. <span class="citation">(<a href="refer%C3%AAncias.html#ref-lovelace2019" role="doc-biblioref">2019</a>)</span> em: <strong>Opera√ß√µes de atributos</strong>, <strong>Opera√ß√µes espaciais</strong>, e <strong>Opera√ß√µes geom√©tricas</strong>.</p>
<div id="opera√ß√µes-de-atributos" class="section level3" number="15.9.1">
<h3>
<span class="header-section-number">15.9.1</span> Opera√ß√µes de atributos<a class="anchor" aria-label="anchor" href="#opera%C3%A7%C3%B5es-de-atributos"><i class="fas fa-link"></i></a>
</h3>
<p>S√£o modifica√ß√£o de objetos geoespaciais baseado em informa√ß√µes n√£o espaciais associadas a dados geoespaciais, como a tabela de atributos ou valores das c√©lulas e nome das camadas dos rasters.</p>
<p><strong>Vetor</strong></p>
<p>As principais opera√ß√µes de atributos vetoriais s√£o com respeito √† tabela de atributos, sendo as principais: i) filtro, ii) jun√ß√£o, iii) agrega√ß√£o e iv) manipula√ß√£o da tabela de atributos. A lista de poss√≠veis opera√ß√µes √© longa, dessa forma, apresentaremos algumas opera√ß√µes utilizando as principais fun√ß√µes e listamos as demais fun√ß√µes e suas opera√ß√µes, que depender√£o de objetivos espec√≠ficos.</p>
<p>Quase todas as opera√ß√µes ser√£o as mesmas realizadas pelo pacote <code>dplyr</code> em uma tabela de dados (ver o Cap√≠tulo <a href="cap5.html#cap5">5</a>), sendo algumas opera√ß√µes espec√≠ficas para alterar apenas campos da tabela de atributos e outras que refletem opera√ß√µes nas fei√ß√µes, ou seja, alterar√£o atrav√©s da tabela de atributos as caracter√≠sticas das fei√ß√µes. Essas fun√ß√µes e suas opera√ß√µes s√£o descritas com detalhes na Tabela <a href="cap15.html#tab:tab-vetor-operacoes-atributos">15.11</a>.</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:tab-vetor-operacoes-atributos">Tabela 15.11: </span>Principais fun√ß√µes para realizar opera√ß√µes de atributos e suas descri√ß√µes.
</caption>
<thead><tr>
<th style="text-align:left;">
Fun√ß√µes
</th>
<th style="text-align:left;">
Onde atua
</th>
<th style="text-align:left;">
Descri√ß√£o
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
<code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>
</td>
<td style="text-align:left;">
Fei√ß√µes
</td>
<td style="text-align:left;">
Selecionar fei√ß√µes por valores
</td>
</tr>
<tr>
<td style="text-align:left;">
<code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice()</a></code>
</td>
<td style="text-align:left;">
Fei√ß√µes
</td>
<td style="text-align:left;">
Selecionar fei√ß√µes pela posi√ß√£o na tabela de atributos
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>n_sample()</code>
</td>
<td style="text-align:left;">
Fei√ß√µes
</td>
<td style="text-align:left;">
Amostrar fei√ß√µes na tabela de atributos
</td>
</tr>
<tr>
<td style="text-align:left;">
<code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>
</td>
<td style="text-align:left;">
Fei√ß√µes
</td>
<td style="text-align:left;">
Agrupar fei√ß√µes por valores da tabela de atributos
</td>
</tr>
<tr>
<td style="text-align:left;">
<code><a href="https://r-spatial.github.io/sf/reference/tidyverse.html">summarise()</a></code>
</td>
<td style="text-align:left;">
Fei√ß√µes
</td>
<td style="text-align:left;">
Opera√ß√µes com valores das fei√ß√µes na tabela de atributos, que acabam por dissolver as fei√ß√µes
</td>
</tr>
<tr>
<td style="text-align:left;">
<code><a href="https://rdrr.io/pkg/raster/man/select.html">select()</a></code>
</td>
<td style="text-align:left;">
Atributos
</td>
<td style="text-align:left;">
Selecionar colunas da tabela de atributos
</td>
</tr>
<tr>
<td style="text-align:left;">
<code><a href="https://dplyr.tidyverse.org/reference/pull.html">pull()</a></code>
</td>
<td style="text-align:left;">
Atributos
</td>
<td style="text-align:left;">
Selecionar uma coluna da tabela de atributos como vetor
</td>
</tr>
<tr>
<td style="text-align:left;">
<code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></code>
</td>
<td style="text-align:left;">
Atributos
</td>
<td style="text-align:left;">
Renomear uma coluna da tabela de atributos
</td>
</tr>
<tr>
<td style="text-align:left;">
<code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>
</td>
<td style="text-align:left;">
Atributos
</td>
<td style="text-align:left;">
Criar uma coluna ou alterar os valores da tabela de atributos
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>*_join()</code>
</td>
<td style="text-align:left;">
Atributos
</td>
<td style="text-align:left;">
Diversas fun√ß√µes para juntar dados de outras tabelas de dados √† tabela de atributos
</td>
</tr>
</tbody>
</table></div>
<p>Para exemplificar as opera√ß√µes de atributos, vamos utilizar os dados de nascentes, hidrologia e cobertura da terra para o munic√≠pio de Rio Claro/SP.</p>
<p><strong>Filtro</strong></p>
<p>Vamos iniciar as opera√ß√µes fazendo o filtro de fei√ß√µes pela tabela de atributos, que permite selecionar fei√ß√µes pelos seus valores atribu√≠dos, utilizando a fun√ß√£o <code><a href="https://dplyr.tidyverse.org/reference/filter.html">dplyr::filter()</a></code>. Aqui vamos selecionar as fei√ß√µes de floresta do mapa de cobertura da terra para Rio Claro/SP (Figura <a href="cap15.html#fig:fig-vetor-opat-filtro">15.23</a>).</p>
<div class="sourceCode" id="cb617"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Filtro</span>
<span class="va">geo_vetor_cobertura_floresta</span> <span class="op">&lt;-</span> <span class="va">geo_vetor_cobertura</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">CLASSE_USO</span> <span class="op">==</span> <span class="st">"forma√ß√£o florestal"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb618"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="st">"gray"</span>, main <span class="op">=</span> <span class="cn">NA</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, graticule <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_cobertura_floresta</span><span class="op">$</span><span class="va">geometry</span>, col <span class="op">=</span> <span class="st">"forestgreen"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-opat-filtro"></span>
<img src="livro_files/figure-html/fig-vetor-opat-filtro-1.png" alt="Filtro da classe floresta para o mapeamento de cobertura da terra para o munic√≠pio de Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.23: Filtro da classe floresta para o mapeamento de cobertura da terra para o munic√≠pio de Rio Claro/SP.
</p>
</div>
<p><strong>Jun√ß√£o</strong></p>
<p>Uma das fun√ß√µes mais √∫teis de opera√ß√µes de atributos √© a jun√ß√£o, referida em ingl√™s como <em>join</em>, realizada atrav√©s das fun√ß√µes <code>dplyr::*_join()</code> (ver detalhes do Cap√≠tulo <a href="cap5.html#cap5">5</a>). Nela, usamos uma coluna identificadora para atribuir dados de outra tabela de dados. Como exemplo, vamos criar uma tabela de dados com novos nomes das classes de cobertura da terra e atribuir esses novos nomes √† tabela de atributos do objeto vetorial. √â fundamental destacar que para que essa fun√ß√£o funcione, precisamos de uma coluna identificadora dos valores para que a jun√ß√£o seja poss√≠vel.</p>
<div class="sourceCode" id="cb619"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Dados</span>
<span class="va">dados_classes</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
    CLASSE_USO <span class="op">=</span> <span class="va">geo_vetor_cobertura</span><span class="op">$</span><span class="va">CLASSE_USO</span>, 
    classe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"agua"</span>, <span class="st">"antropico"</span>, <span class="st">"edificado"</span>, <span class="st">"floresta"</span>, <span class="st">"silvicultura"</span><span class="op">)</span><span class="op">)</span>
<span class="va">dados_classes</span>
<span class="co">#&gt; # A tibble: 5 √ó 2</span>
<span class="co">#&gt;   CLASSE_USO         classe      </span>
<span class="co">#&gt;   &lt;chr&gt;              &lt;chr&gt;       </span>
<span class="co">#&gt; 1 √°gua               agua        </span>
<span class="co">#&gt; 2 √°rea antropizada   antropico   </span>
<span class="co">#&gt; 3 √°rea edificada     edificado   </span>
<span class="co">#&gt; 4 forma√ß√£o florestal floresta    </span>
<span class="co">#&gt; 5 silvicultura       silvicultura</span></code></pre></div>
<div class="sourceCode" id="cb620"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Jun√ß√£o</span>
<span class="va">geo_vetor_cobertura_classes</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="va">geo_vetor_cobertura</span>, 
    y <span class="op">=</span> <span class="va">dados_classes</span>, 
    by <span class="op">=</span> <span class="st">"CLASSE_USO"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">geo_vetor_cobertura_classes</span>
<span class="co">#&gt;   GEOCODIGO MUNICIPIO UF CD_UF         CLASSE_USO   AREA_HA       classe</span>
<span class="co">#&gt; 1   3543907 RIO CLARO SP    35               √°gua   357.027         agua</span>
<span class="co">#&gt; 2   3543907 RIO CLARO SP    35   √°rea antropizada 37297.800    antropico</span>
<span class="co">#&gt; 3   3543907 RIO CLARO SP    35     √°rea edificada  5078.330    edificado</span>
<span class="co">#&gt; 4   3543907 RIO CLARO SP    35 forma√ß√£o florestal  7017.990     floresta</span>
<span class="co">#&gt; 5   3543907 RIO CLARO SP    35       silvicultura   138.173 silvicultura</span></code></pre></div>
<p><strong>Agrega√ß√£o</strong></p>
<p>Outra fun√ß√£o bastante √∫til √© a agrega√ß√£o de atributos. Apesar de existir uma fun√ß√£o que realiza a uni√£o de fei√ß√µes que veremos na pr√≥xima se√ß√£o, o uso conjunto das fun√ß√µes <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">dplyr::group_by()</a></code> e <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">dplyr::summarise()</a></code> realizam uma tarefa semelhante. Aqui vamos agregar as nascentes para Rio Claro/SP, i.e., juntar cada ponto que estava numa linha da tabela de atributos de modo que todos fiquem numa mesma linha, com o valor da quantidade de nascentes (Figura <a href="cap15.html#fig:fig-vetor-opat-agregar">15.24</a>).</p>
<div class="sourceCode" id="cb621"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Agregar</span>
<span class="va">geo_vetor_nascentes_n</span> <span class="op">&lt;-</span> <span class="va">geo_vetor_nascentes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">MUNICIPIO</span>, <span class="va">HIDRO</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">geo_vetor_nascentes_n</span>
<span class="co">#&gt; Simple feature collection with 1 feature and 3 fields</span>
<span class="co">#&gt; Geometry type: MULTIPOINT</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: 217622.9 ymin: 7504132 xmax: 246367.4 ymax: 7537855</span>
<span class="co">#&gt; Projected CRS: SIRGAS 2000 / UTM zone 23S</span>
<span class="co">#&gt; # A tibble: 1 √ó 4</span>
<span class="co">#&gt; # Groups:   MUNICIPIO [1]</span>
<span class="co">#&gt;   MUNICIPIO HIDRO        n                                                                                  geometry</span>
<span class="co">#&gt;   &lt;chr&gt;     &lt;chr&gt;    &lt;int&gt;                                                                          &lt;MULTIPOINT [m]&gt;</span>
<span class="co">#&gt; 1 RIO CLARO nascente  1220 ((217622.9 7528315), (217836.5 7528103), (217988.9 7528203), (218288.9 7528237), (2183...</span></code></pre></div>
<div class="sourceCode" id="cb622"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span><span class="op">$</span><span class="va">geom</span>, 
     col <span class="op">=</span> <span class="st">"gray"</span>, main <span class="op">=</span> <span class="cn">NA</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, graticule <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_nascentes_n</span><span class="op">$</span><span class="va">geometry</span>, pch <span class="op">=</span> <span class="fl">20</span>, 
     col <span class="op">=</span> <span class="st">"blue"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-opat-agregar"></span>
<img src="livro_files/figure-html/fig-vetor-opat-agregar-1.png" alt="Agrega√ß√£o e contagem das nascentes para o munic√≠pio de Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.24: Agrega√ß√£o e contagem das nascentes para o munic√≠pio de Rio Claro/SP.
</p>
</div>
<p><strong>Manipula√ß√£o da tabela de atributos</strong></p>
<p>Por fim, √© muito comum em an√°lises de softwares SIG a cria√ß√£o ou atualiza√ß√£o dos valores de colunas na tabela de atributos. Aqui, podemos utilizar a fun√ß√£o <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">dplyr::mutate()</a></code> para criar essas novas colunas, assim como atualizar os valores de colunas existentes. Em nosso exemplo, faremos uma composi√ß√£o das colunas <code>CLASSE_USO</code> e <code>AREA_HA</code> numa nova coluna chamada <code>classe_area</code>.</p>
<div class="sourceCode" id="cb623"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Criar coluna</span>
<span class="va">geo_vetor_cobertura_cob_col_area</span> <span class="op">&lt;-</span> <span class="va">geo_vetor_cobertura</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>classe_area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">CLASSE_USO</span>, <span class="st">" ("</span>, <span class="va">AREA_HA</span>, <span class="st">" ha)"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">geo_vetor_cobertura_cob_col_area</span>
<span class="co">#&gt;   GEOCODIGO MUNICIPIO UF CD_UF         CLASSE_USO   AREA_HA                     classe_area</span>
<span class="co">#&gt; 1   3543907 RIO CLARO SP    35               √°gua   357.027               √°gua (357.027 ha)</span>
<span class="co">#&gt; 2   3543907 RIO CLARO SP    35   √°rea antropizada 37297.800   √°rea antropizada (37297.8 ha)</span>
<span class="co">#&gt; 3   3543907 RIO CLARO SP    35     √°rea edificada  5078.330     √°rea edificada (5078.33 ha)</span>
<span class="co">#&gt; 4   3543907 RIO CLARO SP    35 forma√ß√£o florestal  7017.990 forma√ß√£o florestal (7017.99 ha)</span>
<span class="co">#&gt; 5   3543907 RIO CLARO SP    35       silvicultura   138.173       silvicultura (138.173 ha)</span></code></pre></div>
<p>Duas fun√ß√µes s√£o bastante interessantes de serem integradas junto √† manipula√ß√£o de tabelas de atributos. Elas calculam propriedades geom√©tricas num√©ricas dos vetores de linhas (comprimento) e pol√≠gonos (√°rea): <code><a href="https://r-spatial.github.io/sf/reference/geos_measures.html">sf::st_length()</a></code> e <code><a href="https://r-spatial.github.io/sf/reference/geos_measures.html">sf::st_area()</a></code>. Essas fun√ß√µes calculam essas propriedades em metros para comprimento e em metros quadrados para √°rea, independentemente do CRS. Para tanto, vamos utilizar as linhas de hidrografia e os pol√≠gonos de cobertura da terra para Rio Claro/SP, e atribuir esses valores √† tabela de atributos de ambos os objetos geoespaciais, utilizando em conjunto a fun√ß√£o <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">dplyr::mutate()</a></code>.</p>
<div class="sourceCode" id="cb624"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Comprimento das linhas</span>
<span class="va">geo_vetor_hidrografia_comp</span> <span class="op">&lt;-</span> <span class="va">geo_vetor_hidrografia</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>comprimento <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html">st_length</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span>
<span class="va">geo_vetor_hidrografia_comp</span>
<span class="co">#&gt; Simple feature collection with 1 feature and 7 fields</span>
<span class="co">#&gt; Geometry type: MULTILINESTRING</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: 215155.3 ymin: 7504132 xmax: 246367.4 ymax: 7537978</span>
<span class="co">#&gt; Projected CRS: SIRGAS 2000 / UTM zone 23S</span>
<span class="co">#&gt;   GEOCODIGO MUNICIPIO UF CD_UF                  HIDRO COMP_KM                       geometry comprimento</span>
<span class="co">#&gt; 1   3543907 RIO CLARO SP    35 curso d'√°gua (0 - 10m) 1142.98 MULTILINESTRING ((231815.7 ... 1142981 [m]</span></code></pre></div>
<div class="sourceCode" id="cb625"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## √Årea dos pol√≠gonos</span>
<span class="va">geo_vetor_cobertura_area</span> <span class="op">&lt;-</span> <span class="va">geo_vetor_cobertura</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>area_m2 <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html">st_area</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span>
<span class="va">geo_vetor_cobertura_area</span>
<span class="co">#&gt; Simple feature collection with 5 features and 7 fields</span>
<span class="co">#&gt; Geometry type: MULTIPOLYGON</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: 215151.7 ymin: 7503723 xmax: 246582.4 ymax: 7537978</span>
<span class="co">#&gt; Projected CRS: SIRGAS 2000 / UTM zone 23S</span>
<span class="co">#&gt;   GEOCODIGO MUNICIPIO UF CD_UF         CLASSE_USO   AREA_HA                       geometry         area_m2</span>
<span class="co">#&gt; 1   3543907 RIO CLARO SP    35               √°gua   357.027 MULTIPOLYGON (((235487.6 75...   3570267 [m^2]</span>
<span class="co">#&gt; 2   3543907 RIO CLARO SP    35   √°rea antropizada 37297.800 MULTIPOLYGON (((232275 7504... 372978415 [m^2]</span>
<span class="co">#&gt; 3   3543907 RIO CLARO SP    35     √°rea edificada  5078.330 MULTIPOLYGON (((233123.6 75...  50783283 [m^2]</span>
<span class="co">#&gt; 4   3543907 RIO CLARO SP    35 forma√ß√£o florestal  7017.990 MULTIPOLYGON (((232355 7504...  70179895 [m^2]</span>
<span class="co">#&gt; 5   3543907 RIO CLARO SP    35       silvicultura   138.173 MULTIPOLYGON (((243052.1 75...   1381726 [m^2]</span></code></pre></div>
<p><strong>Raster</strong></p>
<p>Devido √† estrutura espacial do raster ser formada por uma ou mais superf√≠cies cont√≠nuas, as manipula√ß√µes como subconjunto e outras opera√ß√µes em objetos raster funcionam de uma maneira diferente do que em objetos vetoriais. Veremos aqui as tr√™s principais: i) subconjunto de c√©lulas usando o operador <code>[]</code> ou subconjunto de camadas <code>RasterStack</code> ou <code>RasterBrick</code> utilizando os operadores <code>[[]]</code> e <code>$</code>, ii) renomear nomes das camadas, e iii) resumir informa√ß√µes de todos os pixels.</p>
<p><strong>Subconjunto</strong></p>
<p>Podemos fazer um subconjunto de c√©lulas utilizando dentro dos operadores <code>[]</code> valores para indicar a posi√ß√£o da linha e da coluna de um raster, ou ainda a posi√ß√£o de uma c√©lula utilizando apenas um n√∫mero. Essas opera√ß√µes resultar√£o em valores diferentes para <code>RasterLayer</code> e <code>RasterBrick</code> ou <code>RasterStack</code>.</p>
<div class="sourceCode" id="cb626"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Raster - linha 1 e columna 1</span>
<span class="va">geo_raster_srtm</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span>
<span class="co">#&gt;     </span>
<span class="co">#&gt; 382</span>

<span class="co">## Raster - c√©lula 1</span>
<span class="va">geo_raster_srtm</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
<span class="co">#&gt;     </span>
<span class="co">#&gt; 382</span>

<span class="co">## Stack - linha 1 e columna 1</span>
<span class="va">geo_raster_bioclim</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span>
<span class="co">#&gt;      wc2.1_10m_bio_1 wc2.1_10m_bio_10 wc2.1_10m_bio_11 wc2.1_10m_bio_12 wc2.1_10m_bio_13 wc2.1_10m_bio_14</span>
<span class="co">#&gt; [1,]              NA               NA               NA               NA               NA               NA</span>
<span class="co">#&gt;      wc2.1_10m_bio_15 wc2.1_10m_bio_16 wc2.1_10m_bio_17 wc2.1_10m_bio_18 wc2.1_10m_bio_19 wc2.1_10m_bio_2</span>
<span class="co">#&gt; [1,]               NA               NA               NA               NA               NA              NA</span>
<span class="co">#&gt;      wc2.1_10m_bio_3 wc2.1_10m_bio_4 wc2.1_10m_bio_5 wc2.1_10m_bio_6 wc2.1_10m_bio_7 wc2.1_10m_bio_8 wc2.1_10m_bio_9</span>
<span class="co">#&gt; [1,]              NA              NA              NA              NA              NA              NA              NA</span>

<span class="co">## Stack - c√©lula 1</span>
<span class="va">geo_raster_bioclim</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
<span class="co">#&gt;      wc2.1_10m_bio_1 wc2.1_10m_bio_10 wc2.1_10m_bio_11 wc2.1_10m_bio_12 wc2.1_10m_bio_13 wc2.1_10m_bio_14</span>
<span class="co">#&gt; [1,]              NA               NA               NA               NA               NA               NA</span>
<span class="co">#&gt;      wc2.1_10m_bio_15 wc2.1_10m_bio_16 wc2.1_10m_bio_17 wc2.1_10m_bio_18 wc2.1_10m_bio_19 wc2.1_10m_bio_2</span>
<span class="co">#&gt; [1,]               NA               NA               NA               NA               NA              NA</span>
<span class="co">#&gt;      wc2.1_10m_bio_3 wc2.1_10m_bio_4 wc2.1_10m_bio_5 wc2.1_10m_bio_6 wc2.1_10m_bio_7 wc2.1_10m_bio_8 wc2.1_10m_bio_9</span>
<span class="co">#&gt; [1,]              NA              NA              NA              NA              NA              NA              NA</span></code></pre></div>
<p>Para selecionar uma camada de um <code>RasterBrick</code> ou <code>RasterStack</code>, podemos utilizar as fun√ß√µes <code><a href="https://rdrr.io/pkg/raster/man/subset.html">raster::subset()</a></code> ou <code><a href="https://rdrr.io/pkg/raster/man/raster.html">raster::raster()</a></code> com o argumento <code>layer</code> indicando a ordem ou o nome da camada, al√©m dos operadores <code>[[]]</code> e <code>$</code> (Figura <a href="cap15.html#fig:fig-raster-stack-subset">15.25</a>).</p>
<div class="sourceCode" id="cb627"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Sele√ß√£o de camada num objeto stack utilizando a fun√ß√£o subset</span>
<span class="va">geo_raster_bioclim_bio01</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/subset.html">subset</a></span><span class="op">(</span><span class="va">geo_raster_bioclim</span>, <span class="st">"wc2.1_10m_bio_1"</span><span class="op">)</span>
<span class="va">geo_raster_bioclim_bio01</span>
<span class="co">#&gt; class      : RasterLayer </span>
<span class="co">#&gt; dimensions : 1080, 2160, 2332800  (nrow, ncol, ncell)</span>
<span class="co">#&gt; resolution : 0.1666667, 0.1666667  (x, y)</span>
<span class="co">#&gt; extent     : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs </span>
<span class="co">#&gt; source     : wc2.1_10m_bio_1.tif </span>
<span class="co">#&gt; names      : wc2.1_10m_bio_1 </span>
<span class="co">#&gt; values     : -54.72435, 30.98764  (min, max)</span>

<span class="co">## Sele√ß√£o de camada num objeto stack utilizando a fun√ß√£o raster</span>
<span class="va">geo_raster_bioclim_bio01</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html">raster</a></span><span class="op">(</span><span class="va">geo_raster_bioclim</span>, layer <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">geo_raster_bioclim_bio01</span>
<span class="co">#&gt; class      : RasterLayer </span>
<span class="co">#&gt; dimensions : 1080, 2160, 2332800  (nrow, ncol, ncell)</span>
<span class="co">#&gt; resolution : 0.1666667, 0.1666667  (x, y)</span>
<span class="co">#&gt; extent     : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs </span>
<span class="co">#&gt; source     : wc2.1_10m_bio_1.tif </span>
<span class="co">#&gt; names      : wc2.1_10m_bio_1 </span>
<span class="co">#&gt; values     : -54.72435, 30.98764  (min, max)</span>

<span class="co">## Sele√ß√£o de camada num objeto stack utilizando os operadores [[]] e o nome</span>
<span class="va">geo_raster_bioclim_bio01</span> <span class="op">&lt;-</span> <span class="va">geo_raster_bioclim</span><span class="op">[[</span><span class="st">"wc2.1_10m_bio_1"</span><span class="op">]</span><span class="op">]</span>
<span class="va">geo_raster_bioclim_bio01</span>
<span class="co">#&gt; class      : RasterLayer </span>
<span class="co">#&gt; dimensions : 1080, 2160, 2332800  (nrow, ncol, ncell)</span>
<span class="co">#&gt; resolution : 0.1666667, 0.1666667  (x, y)</span>
<span class="co">#&gt; extent     : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs </span>
<span class="co">#&gt; source     : wc2.1_10m_bio_1.tif </span>
<span class="co">#&gt; names      : wc2.1_10m_bio_1 </span>
<span class="co">#&gt; values     : -54.72435, 30.98764  (min, max)</span>

<span class="co">## Sele√ß√£o de camada num objeto stack utilizando os operadores [[]] e a posicao</span>
<span class="va">geo_raster_bioclim_bio01</span> <span class="op">&lt;-</span> <span class="va">geo_raster_bioclim</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="va">geo_raster_bioclim_bio01</span>
<span class="co">#&gt; class      : RasterLayer </span>
<span class="co">#&gt; dimensions : 1080, 2160, 2332800  (nrow, ncol, ncell)</span>
<span class="co">#&gt; resolution : 0.1666667, 0.1666667  (x, y)</span>
<span class="co">#&gt; extent     : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs </span>
<span class="co">#&gt; source     : wc2.1_10m_bio_1.tif </span>
<span class="co">#&gt; names      : wc2.1_10m_bio_1 </span>
<span class="co">#&gt; values     : -54.72435, 30.98764  (min, max)</span>

<span class="co">## Sele√ß√£o de camada num objeto stack utilizando o operador $</span>
<span class="va">geo_raster_bioclim_bio01</span> <span class="op">&lt;-</span> <span class="va">geo_raster_bioclim</span><span class="op">$</span><span class="va">wc2.1_10m_bio_1</span>
<span class="va">geo_raster_bioclim_bio01</span>
<span class="co">#&gt; class      : RasterLayer </span>
<span class="co">#&gt; dimensions : 1080, 2160, 2332800  (nrow, ncol, ncell)</span>
<span class="co">#&gt; resolution : 0.1666667, 0.1666667  (x, y)</span>
<span class="co">#&gt; extent     : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs </span>
<span class="co">#&gt; source     : wc2.1_10m_bio_1.tif </span>
<span class="co">#&gt; names      : wc2.1_10m_bio_1 </span>
<span class="co">#&gt; values     : -54.72435, 30.98764  (min, max)</span></code></pre></div>
<div class="sourceCode" id="cb628"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_raster_bioclim_bio01</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-stack-subset"></span>
<img src="livro_files/figure-html/fig-raster-stack-subset-1.png" alt="Camada BIO01 selecionada pelas opera√ß√µes de subconjunto." width="100%" height="100%"><p class="caption">
Figura 15.25: Camada BIO01 selecionada pelas opera√ß√µes de subconjunto.
</p>
</div>
<p><strong>Renomear</strong></p>
<p>Podemos ainda renomear camadas dos raster <code>RasterLayer</code> utilizando a fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/names.html">names()</a></code>.</p>
<div class="sourceCode" id="cb629"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Raster - nomes</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro</span><span class="op">)</span>
<span class="co">#&gt; [1] "srtm_27_17"</span>

<span class="co">## Raster - renomear</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"elevacao"</span>

<span class="co">## Raster - nomes</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro</span><span class="op">)</span>
<span class="co">#&gt; [1] "elevacao"</span></code></pre></div>
<p>E essa opera√ß√£o tamb√©m funciona para <code>RasterBrick</code> e <code>RasterStack</code>.</p>
<div class="sourceCode" id="cb630"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Stack - nomes</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">geo_raster_bioclim</span><span class="op">)</span>
<span class="co">#&gt;  [1] "wc2.1_10m_bio_1"  "wc2.1_10m_bio_10" "wc2.1_10m_bio_11" "wc2.1_10m_bio_12" "wc2.1_10m_bio_13"</span>
<span class="co">#&gt;  [6] "wc2.1_10m_bio_14" "wc2.1_10m_bio_15" "wc2.1_10m_bio_16" "wc2.1_10m_bio_17" "wc2.1_10m_bio_18"</span>
<span class="co">#&gt; [11] "wc2.1_10m_bio_19" "wc2.1_10m_bio_2"  "wc2.1_10m_bio_3"  "wc2.1_10m_bio_4"  "wc2.1_10m_bio_5" </span>
<span class="co">#&gt; [16] "wc2.1_10m_bio_6"  "wc2.1_10m_bio_7"  "wc2.1_10m_bio_8"  "wc2.1_10m_bio_9"</span>

<span class="co">## Stack - renomear</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">geo_raster_bioclim</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"bio"</span>, <span class="fl">10</span><span class="op">:</span><span class="fl">19</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"bio0"</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span><span class="op">)</span>

<span class="co">## Stack - nomes</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">geo_raster_bioclim</span><span class="op">)</span>
<span class="co">#&gt;  [1] "bio01" "bio10" "bio11" "bio12" "bio13" "bio14" "bio15" "bio16" "bio17" "bio18" "bio19" "bio02" "bio03" "bio04"</span>
<span class="co">#&gt; [15] "bio05" "bio06" "bio07" "bio08" "bio09"</span></code></pre></div>
<p><strong>Resumir</strong></p>
<p>Muitas vezes queremos fazer c√°lculos para todos as c√©lulas de um raster. Podemos resumir informa√ß√µes de todos os pixels fazendo c√°lculos simples com todos os pixels de cada camada com a fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/cellStats.html">raster::cellStats()</a></code>, sendo <code>x</code> o argumento do objeto raster e <code>stat</code> o nome da fun√ß√£o resumo, como ‚Äúmean‚Äù ou ‚Äúsum‚Äù.</p>
<div class="sourceCode" id="cb631"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Raster - m√©dia de todas as c√©lulas de altitude</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/cellStats.html">cellStats</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">geo_raster_srtm_rio_claro</span>, stat <span class="op">=</span> <span class="va">mean</span><span class="op">)</span>
<span class="co">#&gt; [1] 625.8273</span>

<span class="co">## Stack - m√©dia de todas as c√©lulas de cada camada bioclim√°tica</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/cellStats.html">cellStats</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">geo_raster_bioclim</span>, stat <span class="op">=</span> <span class="va">mean</span><span class="op">)</span>
<span class="co">#&gt;       bio01       bio10       bio11       bio12       bio13       bio14       bio15       bio16       bio17 </span>
<span class="co">#&gt;  -4.0378283   7.2035545 -13.8963286 550.0569022  93.4633916  15.3689993  74.7084151 241.6525005  55.4149542 </span>
<span class="co">#&gt;       bio18       bio19       bio02       bio03       bio04       bio05       bio06       bio07       bio08 </span>
<span class="co">#&gt; 156.4237816 108.8950626   9.9432120  34.5221528 880.1215546  13.9386423 -19.7938943  33.7325366  -0.9226276 </span>
<span class="co">#&gt;       bio09 </span>
<span class="co">#&gt;  -5.3774489</span></code></pre></div>
<p>Ou ainda, podemos analisar a frequ√™ncia com que cada valor dos pixels ocorre, utilizando a fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/freq.html">raster::freq()</a></code>.</p>
<div class="sourceCode" id="cb632"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Raster - frequ√™ncia das c√©lulas</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/freq.html">freq</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">geo_raster_srtm_rio_claro</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/headtail.html">head</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt;      value count</span>
<span class="co">#&gt; [1,]   491     1</span>
<span class="co">#&gt; [2,]   492     4</span>
<span class="co">#&gt; [3,]   493     9</span>
<span class="co">#&gt; [4,]   494    19</span>
<span class="co">#&gt; [5,]   495    32</span>
<span class="co">#&gt; [6,]   496    44</span>

<span class="co">## Stack - frequ√™ncia das c√©lulas</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/freq.html">freq</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">geo_raster_bioclim</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/headtail.html">head</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt;      value count</span>
<span class="co">#&gt; [1,]   -55   319</span>
<span class="co">#&gt; [2,]   -54  4529</span>
<span class="co">#&gt; [3,]   -53  5778</span>
<span class="co">#&gt; [4,]   -52  6128</span>
<span class="co">#&gt; [5,]   -51  6090</span>
<span class="co">#&gt; [6,]   -50  7892</span></code></pre></div>
</div>
<div id="opera√ß√µes-espaciais" class="section level3" number="15.9.2">
<h3>
<span class="header-section-number">15.9.2</span> Opera√ß√µes espaciais<a class="anchor" aria-label="anchor" href="#opera%C3%A7%C3%B5es-espaciais"><i class="fas fa-link"></i></a>
</h3>
<p>As opera√ß√µes espaciais s√£o modifica√ß√µes de objetos geoespaciais baseado em informa√ß√µes espaciais, como localiza√ß√£o e formato. Seria quase imposs√≠vel abordar todas as opera√ß√µes realiz√°veis nesse cap√≠tulo, ent√£o demonstraremos as principais para dados vetoriais e raster.</p>
<p><strong>Vetor</strong></p>
<p>As principais opera√ß√µes espaciais para dados vetoriais s√£o: i) filtro espacial, ii) jun√ß√£o espacial, iii) agrega√ß√£o espacial e iv) dist√¢ncia espacial. Apresentaremos essas opera√ß√µes utilizando as principais fun√ß√µes utilizando os dados de nascentes, hidrologia e cobertura da terra para o munic√≠pio de Rio Claro/SP.</p>
<p><strong>Filtro espacial</strong></p>
<p>Filtros espaciais s√£o opera√ß√µes que realizam sele√ß√£o de fei√ß√µes espaciais entre dois objetos geoespaciais (x e y). Existe uma grande quantidade de fun√ß√µes para realizar filtros espaciais no R, como podemos ver na Tabela <a href="cap15.html#tab:tab-filtro-espacial">15.12</a>. Essas fun√ß√µes verificam se cada fei√ß√£o em x mant√©m sua rela√ß√£o em y. Ao especificar o par√¢metro <code>sparse = FALSE</code>, as fun√ß√µes retornam uma matriz l√≥gica (composta por <code>TRUE</code> e <code>FALSE</code>).</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:tab-filtro-espacial">Tabela 15.12: </span>Principais pacotes para composi√ß√£o de mapas no R.
</caption>
<thead><tr>
<th style="text-align:left;">
Fun√ß√£o
</th>
<th style="text-align:left;">
Descri√ß√£o
</th>
<th style="text-align:left;">
Fun√ß√£o inversa
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
<code><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">sf::st_contains()</a></code>
</td>
<td style="text-align:left;">
Nenhum dos pontos de x est√° fora de y
</td>
<td style="text-align:left;">
<code>st_within</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
<code><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">sf::st_contains_properly()</a></code>
</td>
<td style="text-align:left;">
x cont√©m y, e y n√£o tem pontos em comum com a fronteira de x
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
<code><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">sf::st_covers()</a></code>
</td>
<td style="text-align:left;">
Nenhum ponto de y se encontra no exterior de x
</td>
<td style="text-align:left;">
<code>st_covered_by</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
<code><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">sf::st_covered_by()</a></code>
</td>
<td style="text-align:left;">
Inverso de <code><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">sf::st_covers()</a></code>
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
<code><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">sf::st_crosses()</a></code>
</td>
<td style="text-align:left;">
x e y t√™m alguns, mas n√£o todos os pontos internos em comum
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
<code><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">sf::st_disjoint()</a></code>
</td>
<td style="text-align:left;">
x e y n√£o t√™m pontos em comum
</td>
<td style="text-align:left;">
<code>st_intersects</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
<code><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">sf::st_equals()</a></code>
</td>
<td style="text-align:left;">
x e y s√£o geometricamente iguais; o n√∫mero de pedido dos n√≥s pode ser diferente
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
<code><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">sf::st_equals_exact()</a></code>
</td>
<td style="text-align:left;">
x e y s√£o geometricamente iguais e t√™m ordem de n√≥ id√™ntica
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
<code><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">sf::st_intersects()</a></code>
</td>
<td style="text-align:left;">
x e y n√£o s√£o separados
</td>
<td style="text-align:left;">
<code>st_disjoint</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
<code><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">sf::st_is_within_distance()</a></code>
</td>
<td style="text-align:left;">
x est√° mais perto de y do que uma determinada dist√¢ncia
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
<code><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">sf::st_within()</a></code>
</td>
<td style="text-align:left;">
Nenhum dos pontos de y est√° fora de x
</td>
<td style="text-align:left;">
<code>st_contains</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
<code><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">sf::st_touches()</a></code>
</td>
<td style="text-align:left;">
x e y t√™m pelo menos um ponto limite em comum, mas nenhum ponto interno
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
<code><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">sf::st_overlaps()</a></code>
</td>
<td style="text-align:left;">
x e y t√™m alguns pontos em comum; a dimens√£o destes √© id√™ntica √† de x e y
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
<code><a href="https://r-spatial.github.io/sf/reference/st_relate.html">sf::st_relate()</a></code>
</td>
<td style="text-align:left;">
Dado um padr√£o, retorna se x e y aderem a este padr√£o
</td>
<td style="text-align:left;">
NA
</td>
</tr>
</tbody>
</table></div>
<p>Em nosso exemplo, utilizaremos a fun√ß√£o <code>sf::intersects()</code> para filtrar as nascentes dentro de floresta para Rio Claro/SP. Essa fun√ß√£o vai retornar a resposta bin√°ria se as nascentes est√£o (1) ou n√£o (empty) dentro dos pol√≠gonos de floresta.</p>
<div class="sourceCode" id="cb633"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Filtro espacial</span>
<span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">st_intersects</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">geo_vetor_nascentes</span>, y <span class="op">=</span> <span class="va">geo_vetor_cobertura_floresta</span><span class="op">)</span>
<span class="co">#&gt; Sparse geometry binary predicate list of length 1220, where the predicate was `intersects'</span>
<span class="co">#&gt; first 10 elements:</span>
<span class="co">#&gt;  1: 1</span>
<span class="co">#&gt;  2: 1</span>
<span class="co">#&gt;  3: (empty)</span>
<span class="co">#&gt;  4: 1</span>
<span class="co">#&gt;  5: (empty)</span>
<span class="co">#&gt;  6: (empty)</span>
<span class="co">#&gt;  7: (empty)</span>
<span class="co">#&gt;  8: (empty)</span>
<span class="co">#&gt;  9: 1</span>
<span class="co">#&gt;  10: (empty)</span></code></pre></div>
<p>Podemos usar essa mesma fun√ß√£o em conjunto com a fun√ß√£o <code><a href="https://dplyr.tidyverse.org/reference/filter.html">dplyr::filter()</a></code> para filtrar as nascentes dentro de florestas, mas agora com o argumento <code>sparse = FALSE</code> para valores l√≥gicos funcionarem com o filtro.</p>
<div class="sourceCode" id="cb634"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Filtro espacial - interno</span>
<span class="va">geo_vetor_nascentes_floresta_int</span> <span class="op">&lt;-</span> <span class="va">geo_vetor_nascentes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">st_intersects</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.</span>, y <span class="op">=</span> <span class="va">geo_vetor_cobertura_floresta</span>, sparse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Ou ainda podemos utilizar o operador <code>[]</code> para realizar esse filtro, como podemos notar na Figura <a href="cap15.html#fig:fig-vetor-filtro-espacial-interno">15.26</a>.</p>
<div class="sourceCode" id="cb635"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Filtro espacial com [] - interno</span>
<span class="va">geo_vetor_nascentes_floresta_int</span> <span class="op">&lt;-</span> <span class="va">geo_vetor_nascentes</span><span class="op">[</span><span class="va">geo_vetor_cobertura_floresta</span>, <span class="op">]</span></code></pre></div>
<div class="sourceCode" id="cb636"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="st">"gray"</span>, main <span class="op">=</span> <span class="cn">NA</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, graticule <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_cobertura_floresta</span><span class="op">$</span><span class="va">geometry</span>, col <span class="op">=</span> <span class="st">"forestgreen"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_nascentes_floresta_int</span><span class="op">$</span><span class="va">geometry</span>, col <span class="op">=</span> <span class="st">"blue"</span>, pch <span class="op">=</span> <span class="fl">20</span>, cex <span class="op">=</span> <span class="fl">1</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-filtro-espacial-interno"></span>
<img src="livro_files/figure-html/fig-vetor-filtro-espacial-interno-1.png" alt="Nascentes dentro de florestas no munic√≠pio de Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.26: Nascentes dentro de florestas no munic√≠pio de Rio Claro/SP.
</p>
</div>
<p>Entretanto, muitas vezes queremos fazer o filtro de fei√ß√µes que est√£o fora de fei√ß√µes de outro objeto espacial. Para isso, podemos usar a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">sf::st_disjoint()</a></code> ou ainda utilizando o operador <code>[]</code>, mas com o argumento <code>op</code>, nesse caso utilizando a mesma fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">sf::st_disjoint()</a></code> como opera√ß√£o (Figura <a href="cap15.html#fig:fig-vetor-filtro-espacial-externo">15.27</a>). Atentar o segundo vazio nesse filtro.</p>
<div class="sourceCode" id="cb637"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Filtro espacial - externo</span>
<span class="va">geo_vetor_nascentes_floresta_ext</span> <span class="op">&lt;-</span> <span class="va">geo_vetor_nascentes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">st_disjoint</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.</span>, y <span class="op">=</span> <span class="va">geo_vetor_cobertura_floresta</span>, sparse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>

<span class="co">## Filtro espacial com [] - externo</span>
<span class="va">geo_vetor_nascentes_floresta_ext</span> <span class="op">&lt;-</span> <span class="va">geo_vetor_nascentes</span><span class="op">[</span><span class="va">geo_vetor_cobertura_floresta</span>, , op <span class="op">=</span> <span class="va">st_disjoint</span><span class="op">]</span></code></pre></div>
<div class="sourceCode" id="cb638"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="st">"gray"</span>, main <span class="op">=</span> <span class="cn">NA</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, graticule <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_cobertura_floresta</span><span class="op">$</span><span class="va">geometry</span>, col <span class="op">=</span> <span class="st">"forestgreen"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_nascentes_floresta_ext</span><span class="op">$</span><span class="va">geometry</span>, col <span class="op">=</span> <span class="st">"steelblue"</span>, pch <span class="op">=</span> <span class="fl">20</span>, cex <span class="op">=</span> <span class="fl">1</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-filtro-espacial-externo"></span>
<img src="livro_files/figure-html/fig-vetor-filtro-espacial-externo-1.png" alt="Nascentes fora de florestas no munic√≠pio de Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.27: Nascentes fora de florestas no munic√≠pio de Rio Claro/SP.
</p>
</div>
<p><strong>Jun√ß√£o espacial</strong></p>
<p>Outra opera√ß√£o muito usada dentro de an√°lises espaciais √© a jun√ß√£o espacial ou do ingl√™s <em>spatial join</em>. A ideia base √© muito semelhante com a jun√ß√£o baseada em atributos, mas aqui atribuiremos o valor da tabela de atributos das fei√ß√µes de um objeto espacial y √†s fei√ß√µes que fazem intersec√ß√£o com um objeto espacial x, de modo que esses valores sejam armazenados na tabela de atributos do primeiro objeto espacial.</p>
<p>Para exemplificar, vamos atribuir os valores dos pol√≠gonos de cobertura da terra aos pontos de nascentes para Rio Claro/SP, fazendo um agrupamento pela tabela de atributos para permitir criar o mapa da Figura <a href="cap15.html#fig:fig-vetor-juncao-espacial">15.28</a>.</p>
<div class="sourceCode" id="cb639"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Jun√ß√£o espacial</span>
<span class="va">geo_vetor_nascentes_cob_jun</span> <span class="op">&lt;-</span> <span class="va">geo_vetor_nascentes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html">st_join</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.</span>, y <span class="op">=</span> <span class="va">geo_vetor_cobertura</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">CLASSE_USO</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb640"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="st">"gray"</span>, main <span class="op">=</span> <span class="cn">NA</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, graticule <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_nascentes_cob_jun</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"orange"</span>, <span class="st">"gray30"</span>, <span class="st">"forestgreen"</span>, <span class="st">"green"</span><span class="op">)</span>,
     pch <span class="op">=</span> <span class="fl">20</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">209000</span>, y <span class="op">=</span> <span class="fl">7520000</span>, pch <span class="op">=</span> <span class="fl">15</span>, cex <span class="op">=</span> <span class="fl">.7</span>, pt.cex <span class="op">=</span> <span class="fl">2.5</span>, 
       legend <span class="op">=</span> <span class="op">(</span><span class="va">geo_vetor_nascentes_cob_jun</span><span class="op">$</span><span class="va">CLASSE_USO</span><span class="op">)</span>, 
       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"orange"</span>, <span class="st">"gray30"</span>, <span class="st">"forestgreen"</span>, <span class="st">"green"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-juncao-espacial"></span>
<img src="livro_files/figure-html/fig-vetor-juncao-espacial-1.png" alt="Jun√ß√£o espacial da cobertura da terra para as nascentes no munic√≠pio de Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.28: Jun√ß√£o espacial da cobertura da terra para as nascentes no munic√≠pio de Rio Claro/SP.
</p>
</div>
<p><strong>Agrega√ß√£o espacial</strong></p>
<p>Muitas vezes queremos contabilizar quantas fei√ß√µes ou agregar valores de fei√ß√µes para pol√≠gonos. Podemos realizar essa opera√ß√£o usando as fun√ß√µes <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">dplyr::group_by()</a></code> e <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">dplyr::summarise</a></code>, ou utilizar a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/aggregate.sf.html">aggregate()</a></code>. Nesse exemplo, vamos contabilizar quantas nascentes h√° por pol√≠gono de cobertura da terra para o munic√≠pio de Rio Claro/SP (Figura <a href="cap15.html#fig:fig-vetor-agregacao-espacial">15.29</a>).</p>
<div class="sourceCode" id="cb641"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Agrega√ß√£o espacial</span>
<span class="va">geo_vetor_cobertura_nas_agre</span> <span class="op">&lt;-</span> <span class="va">geo_vetor_nascentes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/aggregate.sf.html">aggregate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.</span>, by <span class="op">=</span> <span class="va">geo_vetor_cobertura</span>, FUN <span class="op">=</span> <span class="va">length</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb642"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_cobertura_nas_agre</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, graticule <span class="op">=</span> <span class="cn">TRUE</span>, main <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-agregacao-espacial"></span>
<img src="livro_files/figure-html/fig-vetor-agregacao-espacial-1.png" alt="Agrega√ß√£o espacial contabilizando o n√∫mero de nascentes para cada classe de cobertura da terra no munic√≠pio de Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.29: Agrega√ß√£o espacial contabilizando o n√∫mero de nascentes para cada classe de cobertura da terra no munic√≠pio de Rio Claro/SP.
</p>
</div>
<p><strong>Dist√¢ncia espacial</strong></p>
<p>A dist√¢ncia espacial √© a dist√¢ncia calculada em duas dimens√µes (2D) entre um objeto espacial x e y baseado no CRS e para cada fei√ß√£o dos objetos geoespaciais. Para realizar esse c√°lculo, utilizamos a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/geos_measures.html">sf::st_distance()</a></code>. Em nosso exemplo, vamos calcular a dist√¢ncia das nascentes at√© a floresta mais pr√≥xima, e adicionando essa informa√ß√£o para cada ponto na tabela de atributos com a fun√ß√£o <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">dplyr::mutate()</a></code>, para o munic√≠pio de Rio Claro/SP (Figura <a href="cap15.html#fig:fig-vetor-distancia-espacial">15.30</a>).</p>
<div class="sourceCode" id="cb643"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Dist√¢ncia espacial</span>
<span class="va">geo_vetor_nascentes_dist_flo</span> <span class="op">&lt;-</span> <span class="va">geo_vetor_nascentes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>dist_flo <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html">st_distance</a></span><span class="op">(</span><span class="va">geo_vetor_nascentes</span>, <span class="va">geo_vetor_cobertura_floresta</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb644"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_nascentes_dist_flo</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span>, pch <span class="op">=</span> <span class="fl">20</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, graticule <span class="op">=</span> <span class="cn">TRUE</span>, main <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-distancia-espacial"></span>
<img src="livro_files/figure-html/fig-vetor-distancia-espacial-1.png" alt="Dist√¢ncia espacial das nascentes at√© o fragmento de floresta mais pr√≥xima no munic√≠pio de Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.30: Dist√¢ncia espacial das nascentes at√© o fragmento de floresta mais pr√≥xima no munic√≠pio de Rio Claro/SP.
</p>
</div>
<p><strong>Raster</strong></p>
<p>As principais opera√ß√µes espaciais para dados raster podem ser classificas, segundo Lovelace et al. <span class="citation">(<a href="refer%C3%AAncias.html#ref-lovelace2019" role="doc-biblioref">2019</a>)</span>, em: i) opera√ß√µes locais (por c√©lula), ii) opera√ß√µes focais (por bloco de m√∫ltiplas c√©lulas regulares - e.g.¬†3x3), iii) opera√ß√µes zonais (por bloco de m√∫ltiplas c√©lulas irregulares) e iv) opera√ß√µes globais (por um ou v√°rios rasters inteiros). Cada uma delas √© aplicada para objetivos e escalas espaciais espec√≠ficas. Para os exemplos desta se√ß√£o, utilizaremos o dado raster de eleva√ß√£o para o munic√≠pio de Rio Claro/SP.</p>
<p><strong>Opera√ß√µes locais</strong></p>
<p>As opera√ß√µes locais contemplam todas as opera√ß√µes realizadas c√©lula a c√©lula em uma ou v√°rias camadas de um objeto raster. A √°lgebra de raster √© uma das mais comuns, simples e poderosas opera√ß√µes no R envolvendo rasters. Com ela podemos fazer opera√ß√µes simples atrav√©s de operadores aritm√©ticos (soma, subtra√ß√£o, multiplica√ß√£o, divis√£o ou potencia√ß√£o) entre dois ou mais objetos raster, ou utilizar fun√ß√µes para alterar todos os valores dos pixels como, por exemplo, as fun√ß√µes <code>lo10()</code> ou <code><a href="https://rdrr.io/r/base/MathFun.html">sqrt()</a></code>, ou ainda a fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/scale.html">raster::scale()</a></code> para padronizar ou centralizar os valores dos rasters (Figura <a href="cap15.html#fig:fig-raster-local-aritmetico">15.31</a>).</p>
<div class="sourceCode" id="cb645"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Soma</span>
<span class="va">geo_raster_srtm_rio_claro2</span> <span class="op">&lt;-</span> <span class="va">geo_raster_srtm_rio_claro</span> <span class="op">+</span> <span class="va">geo_raster_srtm_rio_claro</span>

<span class="co">## Log10</span>
<span class="va">geo_raster_srtm_rio_claro_log10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb646"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="va">old_par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro2</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro_log10</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="va">old_par</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-local-aritmetico"></span>
<img src="livro_files/figure-html/fig-raster-local-aritmetico-1.png" alt="Rasters de soma e log10 do mapa de eleva√ß√£o para Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.31: Rasters de soma e log10 do mapa de eleva√ß√£o para Rio Claro/SP.
</p>
</div>
<p>Al√©m das opera√ß√µes aritm√©ticas, a √°lgebra de rasters tamb√©m permite opera√ß√µes l√≥gicas, como criar um raster (bin√°rio - composto por 1 quando a opera√ß√£o l√≥gica √© verdadeira, e 0 quanto √© falsa). Em nosso caso, buscamos todos os pixels acima de 600 metros para o raster de eleva√ß√£o de Rio Claro/SP (Figura <a href="cap15.html#fig:fig-raster-local-logico">15.32</a>).</p>
<div class="sourceCode" id="cb647"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Acima de 600</span>
<span class="va">geo_raster_srtm_rio_claro_acima_600</span> <span class="op">&lt;-</span> <span class="va">geo_raster_srtm_rio_claro</span> <span class="op">&gt;</span> <span class="fl">600</span></code></pre></div>
<div class="sourceCode" id="cb648"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro_acima_600</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-local-logico"></span>
<img src="livro_files/figure-html/fig-raster-local-logico-1.png" alt="Opera√ß√£o local l√≥gica mostrando todos os pixels acima de 600 metros de eleva√ß√£o para Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.32: Opera√ß√£o local l√≥gica mostrando todos os pixels acima de 600 metros de eleva√ß√£o para Rio Claro/SP.
</p>
</div>
<p>Al√©m dos operadores aritm√©ticos, tamb√©m podemos usar as fun√ß√µes <code><a href="https://rdrr.io/pkg/raster/man/calc.html">raster::calc()</a></code> (uma camada) e <code><a href="https://rdrr.io/pkg/raster/man/overlay.html">raster::overlay()</a></code> (duas ou mais camadas) para realizar opera√ß√µes em todas as c√©lulas. Elas funcionam com a cria√ß√£o de uma fun√ß√£o espec√≠fica atrav√©s da fun√ß√£o <code>function()</code> (Cap√≠tulo <a href="cap4.html#cap4">4</a>), para que esta seja aplicada em todas as c√©lulas do raster. Essas fun√ß√µes s√£o muito eficientes, portanto, s√£o prefer√≠veis para grandes conjuntos de dados raster. Exemplificaremos essa opera√ß√£o calculando o produto de todos os pixels por eles mesmos do raster de eleva√ß√£o de Rio Claro/SP (Figura <a href="cap15.html#fig:fig-raster-local-calc">15.33</a>).</p>
<div class="sourceCode" id="cb649"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Produto dos pixel - calc</span>
<span class="va">geo_raster_srtm_rio_claro_prod</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/calc.html">calc</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">geo_raster_srtm_rio_claro</span>, fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">x</span> <span class="op">*</span> <span class="va">x</span><span class="op">}</span><span class="op">)</span>
<span class="va">geo_raster_srtm_rio_claro_prod</span> 
<span class="co">#&gt; class      : RasterLayer </span>
<span class="co">#&gt; dimensions : 370, 364, 134680  (nrow, ncol, ncell)</span>
<span class="co">#&gt; resolution : 0.0008333333, 0.0008333333  (x, y)</span>
<span class="co">#&gt; extent     : -47.765, -47.46167, -22.55167, -22.24333  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs </span>
<span class="co">#&gt; source     : memory</span>
<span class="co">#&gt; names      : layer </span>
<span class="co">#&gt; values     : 241081, 970225  (min, max)</span></code></pre></div>
<div class="sourceCode" id="cb650"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro_prod</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-local-calc"></span>
<img src="livro_files/figure-html/fig-raster-local-calc-1.png" alt="Opera√ß√£o local de multiplica√ß√£o de todos os pixels por eles mesmos do raster de eleva√ß√£o para Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.33: Opera√ß√£o local de multiplica√ß√£o de todos os pixels por eles mesmos do raster de eleva√ß√£o para Rio Claro/SP.
</p>
</div>
<p>A predi√ß√£o de objetos raster (utilizando a fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/predict.html">raster::predict()</a></code>) √© outra aplica√ß√£o extremamente √∫til em opera√ß√µes locais, n√≥s a veremos mais √† frente nesse cap√≠tulo. Essa fun√ß√£o possui basicamente dois argumentos: <code>object</code> que √© os rasters preditores e <code>model</code> com o modelo ajustado para o qual os valores ser√£o preditos com base nos valores dos rasters. A partir da rela√ß√£o entre vari√°veis respostas (e.g, pontos no espa√ßo, como ocorr√™ncia ou riqueza de esp√©cies), e vari√°veis preditoras (rasters cont√≠nuos de eleva√ß√£o, pH, precipita√ß√£o, temperatura, cobertura da terra ou classe de solo), criamos modelos usando fun√ß√µes como <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>, <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code>, <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam()</a></code> ou uma t√©cnica de aprendizado de m√°quina, e fazemos predi√ß√µes espaciais aplicando os coeficientes estimados aos valores dos raster preditores (consulte od Cap√≠tulos <a href="cap7.html#cap7">7</a> e <a href="cap8.html#cap8">8</a>).</p>
<p>Por fim, a reclassifica√ß√£o de rasters √© outra opera√ß√£o muito comum quando trabalhamos com rasters. Nela √© realizada a classifica√ß√£o de intervalos de valores num√©ricos em grupos, e.g.¬†agrupar um modelo digital de eleva√ß√£o em classes de valores. A fun√ß√£o que faz essa opera√ß√£o √© a <code><a href="https://rdrr.io/pkg/raster/man/reclassify.html">raster::reclassify()</a></code>. Ela possui dois argumentos: <code>x</code> que √© o raster a ser reclassificado, e o segundo <code>rcl</code> para o qual devemos construir uma matriz de reclassifica√ß√£o, onde a primeira coluna √© a extremidade inferior, a segunda coluna √© a extremidade superior, e a terceira coluna representa o novo valor para os intervalos das colunas um e dois. Vamos reclassificar o raster de eleva√ß√£o de Rio Claro/SP para os intervalos 400‚Äì600, 600‚Äì800 e 800‚Äì1000 que s√£o reclassificados para os valores 1, 2 e 3, respectivamente (Figura <a href="cap15.html#fig:fig-raster-local-reclassificacao">15.34</a>).</p>
<div class="sourceCode" id="cb651"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Matriz de reclassifica√ß√£o</span>
<span class="va">rcl</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">400</span>,<span class="fl">600</span>,<span class="fl">1</span>, 
                 <span class="fl">600</span>,<span class="fl">800</span>,<span class="fl">2</span>, 
                 <span class="fl">800</span>,<span class="fl">1000</span>,<span class="fl">3</span><span class="op">)</span>, 
               ncol <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co">## Reclassifi√ß√£o</span>
<span class="va">geo_raster_srtm_rio_claro_rcl</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/reclassify.html">reclassify</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">geo_raster_srtm_rio_claro</span>, rcl <span class="op">=</span> <span class="va">rcl</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb652"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro_rcl</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-local-reclassificacao"></span>
<img src="livro_files/figure-html/fig-raster-local-reclassificacao-1.png" alt="Opera√ß√£o local de reclassifica√ß√£o para tr√™s classes de eleva√ß√£o para Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.34: Opera√ß√£o local de reclassifica√ß√£o para tr√™s classes de eleva√ß√£o para Rio Claro/SP.
</p>
</div>
<p><strong>Opera√ß√µes focais</strong></p>
<p>As opera√ß√µes focais levam em considera√ß√£o uma c√©lula central e seus vizinhos. A vizinhan√ßa (tamb√©m chamada de janela m√≥vel - <em>moving window</em>) tipicamente √© composta de c√©lulas de 3 por 3 (c√©lula central e seus oito vizinhos), mas pode assumir outra forma. A opera√ß√£o focal aplica uma fun√ß√£o de agrega√ß√£o a todas as c√©lulas dentro da vizinhan√ßa especificada, e usa a sa√≠da correspondente como o novo valor para a c√©lula central, e segue para a pr√≥xima c√©lula central e seus vizinhos. Essa opera√ß√£o √© realizada atrav√©s da fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/focal.html">raster::focal()</a></code>. O par√¢metro <code>x</code> especifica o raster de entrada, o par√¢metro <code>w</code> define a janela m√≥vel por uma matriz cujos valores correspondem a pesos, e por fim, o par√¢metro <code>fun</code> especifica a fun√ß√£o que desejamos aplicar √†s c√©lulas, como <code><a href="https://rdrr.io/r/base/Extremes.html">min()</a></code>, <code><a href="https://rdrr.io/r/base/Extremes.html">max()</a></code>, <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code>, <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code>, <code><a href="https://rdrr.io/r/stats/sd.html">sd()</a></code> ou <code><a href="https://rdrr.io/r/stats/cor.html">var()</a></code>. Existem diversas aplica√ß√µes dessa opera√ß√£o para dados raster, como no processamento de imagens de sat√©lite (ver mais em Wegmann et al. <span class="citation">(<a href="refer%C3%AAncias.html#ref-wegmann2016" role="doc-biblioref">2016</a>)</span>). Outra utilidade √© para o c√°lculo de caracter√≠sticas topogr√°ficas, como declividade, aspecto e dire√ß√µes de fluxo. Para calcular essas m√©tricas espec√≠ficas, podemos utilizar a fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/terrain.html">raster::terrain()</a></code>.</p>
<p>Para nosso exemplo, vamos realizar o c√°lculo do desvio padr√£o da eleva√ß√£o e a m√©trica de aspecto (orienta√ß√£o da vertente) para o raster de eleva√ß√£o em Rio Claro/SP (Figura <a href="cap15.html#fig:fig-raster-focal">15.35</a>).</p>
<div class="sourceCode" id="cb653"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Janela m√≥vel - moving window</span>
<span class="va">geo_raster_srtm_rio_claro_focal_sd</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/focal.html">focal</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="va">geo_raster_srtm_rio_claro</span>, 
    w <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fl">1</span>, nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, 
    fun <span class="op">=</span> <span class="va">sd</span><span class="op">)</span>

<span class="co">## Declividade</span>
<span class="va">geo_raster_srtm_rio_claro_asp</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/terrain.html">terrain</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">geo_raster_srtm_rio_claro</span>, opt <span class="op">=</span> <span class="st">"aspect"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb654"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="va">old_par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro_focal_sd</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro_asp</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="va">old_par</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-focal"></span>
<img src="livro_files/figure-html/fig-raster-focal-1.png" alt="C√°lculo do desvio padr√£o da eleva√ß√£o para uma janela de 3x3 e do aspecto para Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.35: C√°lculo do desvio padr√£o da eleva√ß√£o para uma janela de 3x3 e do aspecto para Rio Claro/SP.
</p>
</div>
<p><strong>Opera√ß√µes zonais</strong></p>
<p>As opera√ß√µes zonais aplicam uma fun√ß√£o de agrega√ß√£o para v√°rias c√©lulas de um raster. Geralmente usa-se um segundo raster categ√≥rico para definir as zonas, de modo que as c√©lulas raster que definem a zona n√£o precisam ser vizinhas, como na opera√ß√£o focal. O resultado de uma opera√ß√£o zonal √© uma tabela de resumo agrupada por zona, explicando porque essa opera√ß√£o tamb√©m √© conhecida como estat√≠stica zonal. Isso √© um contraste com as opera√ß√µes focais que retornam um objeto raster.</p>
<p>A opera√ß√£o zonal √© realizada atrav√©s da fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/zonal.html">raster::zonal()</a></code>, que recebe de entrada no <code>x</code> o raster cont√≠nuo, em <code>z</code> o raster categ√≥rico, e em <code>fun</code> a fun√ß√£o que resumir√° as c√©lulas. Em nosso exemplo, vamos calcular diversas medidas resumo da eleva√ß√£o com a fun√ß√£o <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> para cada classe de eleva√ß√£o que criamos anteriormente.</p>
<div class="sourceCode" id="cb655"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Estat√≠stica zonal</span>
<span class="va">geo_raster_srtm_rio_claro_zonal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/zonal.html">zonal</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro</span>, <span class="va">geo_raster_srtm_rio_claro_rcl</span>, fun <span class="op">=</span> <span class="st">"summary"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro_zonal</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"zona"</span>, <span class="st">"min"</span>, <span class="st">"1qt"</span>, <span class="st">"mediana"</span>, <span class="st">"media"</span>, <span class="st">"3qt"</span>, <span class="st">"max"</span><span class="op">)</span>
<span class="va">geo_raster_srtm_rio_claro_zonal</span>
<span class="co">#&gt;   zona min 1qt mediana    media 3qt max</span>
<span class="co">#&gt; 1    1 491 552   574.0 567.5995 589 600</span>
<span class="co">#&gt; 2    2 601 620   640.0 650.6829 670 800</span>
<span class="co">#&gt; 3    3 801 817   832.5 834.2732 846 985</span></code></pre></div>
<p><strong>Opera√ß√µes globais</strong></p>
<p>As opera√ß√µes globais usam todo o conjunto de dados raster representando uma √∫nica zona. As opera√ß√µes globais mais comuns s√£o estat√≠sticas descritivas para todos os pixels do raster, utilizando a fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/cellStats.html">raster::cellStats()</a></code> ou <code><a href="https://rdrr.io/pkg/raster/man/freq.html">raster::freq()</a></code>, j√° vistas. Al√©m das estat√≠sticas descritivas, podemos gerar rasters de dist√¢ncia, que calcula a dist√¢ncia de cada c√©lula a uma ou um grupo c√©lulas-alvo espec√≠fica, utilizando a fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/distance.html">raster::distance()</a></code>.</p>
<p>Em nosso exemplo, vamos selecionar os pixels abaixo de 500 m do raster de eleva√ß√£o e calcular a Dist√¢ncia Euclidiana (Figura <a href="cap15.html#fig:fig-raster-global">15.36</a>).</p>
<div class="sourceCode" id="cb656"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Dist√¢ncia euclidiana</span>
<span class="va">geo_raster_srtm_rio_claro_abaixo_500</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/calc.html">calc</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="va">geo_raster_srtm_rio_claro</span>, 
    fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">500</span>, <span class="fl">1</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>
<span class="va">geo_raster_srtm_rio_claro_global_dist</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/distance.html">distance</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro_abaixo_500</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb657"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro_global_dist</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro_abaixo_500</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">"white"</span>, legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-global"></span>
<img src="livro_files/figure-html/fig-raster-global-1.png" alt="Raster de dist√¢ncia Euclidiana dos pixels abaixo de 500 m de eleva√ß√£o para Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.36: Raster de dist√¢ncia Euclidiana dos pixels abaixo de 500 m de eleva√ß√£o para Rio Claro/SP.
</p>
</div>
</div>
<div id="opera√ß√µes-geom√©tricas" class="section level3" number="15.9.3">
<h3>
<span class="header-section-number">15.9.3</span> Opera√ß√µes geom√©tricas<a class="anchor" aria-label="anchor" href="#opera%C3%A7%C3%B5es-geom%C3%A9tricas"><i class="fas fa-link"></i></a>
</h3>
<p>As opera√ß√µes geom√©tricas realizam modifica√ß√µes em objetos geoespaciais baseado na geometria do vetor ou do raster e na intera√ß√£o e convers√£o entre vetor-raster. As opera√ß√µes geom√©tricas vetoriais podem ser un√°rias (funcionam em uma √∫nica geometria) ou bin√°rias (modificam uma geometria com base na forma de outra geometria). Ainda podemos fazer transforma√ß√µes para alterar os tipos vetores, que refletir√° se as fei√ß√µes s√£o √∫nicas ou m√∫ltiplas, inclusive na tabela de atributos. As opera√ß√µes geom√©tricas em rasters envolvem mudar a posi√ß√£o, tamanho e n√∫mero dos pixels subjacentes e atribuir-lhes novos valores. Por fim, podemos ainda fazer opera√ß√µes de intera√ß√µes e convers√µes entre raster-vetor para ajustar rasters a vetores, assim como converter um objeto espacial vetorial para raster e vice-versa.</p>
<p><strong>Vetor</strong></p>
<p>Como dissemos, as opera√ß√µes geom√©tricas em vetores criar√£o ou alterar a geometria de objetos da classe <code>sf</code>, podendo fazer altera√ß√µes em √∫nica geometria (un√°rias): i) simplifica√ß√£o, ii) centroides, iii) pontos aleat√≥rios, iv) buffers, v) pol√≠gono convexo, vi) pol√≠gonos de Voronoi, vii) quadr√≠culas e hex√°gonos; ou modificar uma geometria com base na forma de outra geometria (bin√°rias), viii) uni√£o e ix) recortes; ou ainda fazer transforma√ß√µes de tipo de geometrias.</p>
<p>Para exemplificar as opera√ß√µes geom√©tricas com vetores, vamos utilizar os dados do limite, nascentes, hidrologia e cobertura da terra para o munic√≠pio de Rio Claro/SP.</p>
<p><strong>Simplifica√ß√£o</strong></p>
<p>A simplifica√ß√£o possui o intuito de generalizar linhas ou pol√≠gonos, diminuindo assim suas complexidades em rela√ß√£o ao n√∫mero de v√©rtices. √â utilizada para representa√ß√£o em mapas menores ou mapas interativos ou ainda quando um objeto vetorial √© muito grande. A fun√ß√£o utilizada √© a <code><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">sf::st_simplify()</a></code>, que usa o argumento <code>x</code> para uma geometria de entrada e <code>dTolerance</code> para controlar o n√≠vel de generaliza√ß√£o nas unidades do mapa. Em nosso exemplo, simplificaremos a hidrografia de Rio Claro/SP (Figura <a href="cap15.html#fig:fig-vetor-simplificacao">15.37</a>).</p>
<div class="sourceCode" id="cb658"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Simplifica√ß√£o</span>
<span class="va">geo_vetor_hidrografia_simplificado</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_simplify</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">geo_vetor_hidrografia</span>, dTolerance <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb659"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="st">"gray"</span>, main <span class="op">=</span> <span class="cn">NA</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, graticule <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_hidrografia</span><span class="op">$</span><span class="va">geometry</span>, col <span class="op">=</span> <span class="st">"steelblue"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_hidrografia_simplificado</span><span class="op">$</span><span class="va">geometry</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/adjustcolor.html">adjustcolor</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="fl">.7</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-simplificacao"></span>
<img src="livro_files/figure-html/fig-vetor-simplificacao-1.png" alt="Simplifica√ß√£o da hidrografia para Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.37: Simplifica√ß√£o da hidrografia para Rio Claro/SP.
</p>
</div>
<p><strong>Centroides</strong></p>
<p>A opera√ß√£o de centroides identifica o centro de objetos geoespaciais, geralmente o centro de massa das fei√ß√µes. √â utilizado para gerar um ponto simples para representa√ß√µes complexas ou para estimar a dist√¢ncia entre pol√≠gonos utilizando esse centroide. Podemos calcul√°-los com a fun√ß√£o <code>sf::st_centroids()</code> ou com a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">sf::st_point_on_surface()</a></code> para garantir que esses centroides caiam dentro das geometrias. Aqui calcularemos o centroide do munic√≠pio de Rio Claro/SP (Figura <a href="cap15.html#fig:fig-vetor-centroide">15.38</a>).</p>
<div class="sourceCode" id="cb660"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Centroides</span>
<span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_cent</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_centroid</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb661"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="st">"gray"</span>, main <span class="op">=</span> <span class="cn">NA</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, graticule <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_cent</span><span class="op">$</span><span class="va">geom</span>, cex <span class="op">=</span> <span class="fl">3</span>, pch <span class="op">=</span> <span class="fl">20</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-centroide"></span>
<img src="livro_files/figure-html/fig-vetor-centroide-1.png" alt="Centroide do limite do munic√≠pio de Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.38: Centroide do limite do munic√≠pio de Rio Claro/SP.
</p>
</div>
<p><strong>Pontos aleat√≥rios</strong></p>
<p>Por vezes precisamos criar algum padr√£o aleat√≥rio dentro de um contexto espacial. Isso pode ser realizado de diversas formas. Uma delas √© a cria√ß√£o de pontos aleat√≥rios dentro de um pol√≠gono. Podemos realizar essa opera√ß√£o com a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/st_sample.html">sf::st_sample()</a></code>. Para essa fun√ß√£o, dois argumentos s√£o utilizados: <code>x</code> uma geometria de entrada e o <code>size</code> indicando o n√∫mero de pontos √† seres criados. Outro argumento bastante interessante √© o <code>type</code>, indicando o tipo de amostragem espacial (aleat√≥rio, regular ou triangular). Para nosso exemplo, vamos fixar a amostragem utilizando a fun√ß√£o <code><a href="https://rdrr.io/r/base/Random.html">set.seed()</a></code> e sortear 30 pontos para o limite do munic√≠pio de Rio Claro/SP (Figura <a href="cap15.html#fig:fig-vetor-pontos-aleatorios">15.39</a>). Para mais detalhes da fun√ß√£o <code><a href="https://rdrr.io/r/base/Random.html">set.seed()</a></code>, consultar o Cap√≠tulo <a href="cap4.html#cap4">4</a>.</p>
<div class="sourceCode" id="cb662"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Fixar amostragem</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span>

<span class="co">## Pontos aleat√≥rios</span>
<span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_pontos_aleatorios</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_sample.html">st_sample</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span>, size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb663"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="st">"gray"</span>, main <span class="op">=</span> <span class="cn">NA</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, graticule <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_pontos_aleatorios</span>, pch <span class="op">=</span> <span class="fl">20</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-pontos-aleatorios"></span>
<img src="livro_files/figure-html/fig-vetor-pontos-aleatorios-1.png" alt="Sorteio de 30 pontos aleat√≥rio para Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.39: Sorteio de 30 pontos aleat√≥rio para Rio Claro/SP.
</p>
</div>
<p><strong>Buffer</strong></p>
<p>Buffers s√£o pol√≠gonos que representam a √°rea dentro de uma determinada dist√¢ncia de um elemento geom√©trico, independentemente de ser um ponto, linha ou pol√≠gono. O buffer √© comumente utilizado para an√°lise de dados geoespaciais, geralmente sendo entendio como uma unidade amostral, delimitando uma por√ß√£o no entorno de algum elemento ou evento, como as condi√ß√µes clim√°ticas ou da estrutura da paisagem para uma amostragem, ou as caracter√≠sticas de cobertura da terra ao longo de um corpo d‚Äô√°gua, e.g., √Åreas de Preserva√ß√£o Permanente (APPs).</p>
<p>A fun√ß√£o utilizada para criar buffers √© a <code><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">sf::st_buffer()</a></code>, que requer pelo menos dois argumentos: <code>x</code> uma geometria de entrada e o <code>dist</code> uma dist√¢ncia para o buffer, fornecido nas unidades do CRS da geometria de entrada. Em nosso exemplo, vamos criar buffers circulares de 1000 metros para os 30 pontos aleat√≥rios criados anteriormente para o munic√≠pio de Rio Claro/SP (Figura <a href="cap15.html#fig:fig-vetor-buffer">15.40</a>).</p>
<div class="sourceCode" id="cb664"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Buffer</span>
<span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_pontos_aleatorios_buffer</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_buffer</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_pontos_aleatorios</span>, dist <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb665"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="st">"gray"</span>, main <span class="op">=</span> <span class="cn">NA</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, graticule <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_pontos_aleatorios_buffer</span>, col <span class="op">=</span> <span class="cn">NA</span>, lwd <span class="op">=</span> <span class="fl">2</span>, border <span class="op">=</span> <span class="st">"red"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_pontos_aleatorios</span>, pch <span class="op">=</span> <span class="fl">20</span>, cex <span class="op">=</span> <span class="fl">1</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-buffer"></span>
<img src="livro_files/figure-html/fig-vetor-buffer-1.png" alt="Buffers de 1000 metros para os 30 pontos aleat√≥rios no munic√≠pio de Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.40: Buffers de 1000 metros para os 30 pontos aleat√≥rios no munic√≠pio de Rio Claro/SP.
</p>
</div>
<p>Podemos ainda criar buffers quadrados acrescentando o argumento <code>uendCapStyle = "SQUARE"</code> (Figura <a href="cap15.html#fig:fig-vetor-buffer-quad">15.41</a>).</p>
<div class="sourceCode" id="cb666"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Buffer</span>
<span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_pontos_aleatorios_buffer_quad</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_buffer</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_pontos_aleatorios</span>, dist <span class="op">=</span> <span class="fl">1000</span>, endCapStyle <span class="op">=</span> <span class="st">"SQUARE"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb667"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="st">"gray"</span>, main <span class="op">=</span> <span class="cn">NA</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, graticule <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_pontos_aleatorios_buffer_quad</span>, col <span class="op">=</span> <span class="cn">NA</span>, lwd <span class="op">=</span> <span class="fl">2</span>, border <span class="op">=</span> <span class="st">"red"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_pontos_aleatorios</span>, pch <span class="op">=</span> <span class="fl">20</span>, cex <span class="op">=</span> <span class="fl">1</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-buffer-quad"></span>
<img src="livro_files/figure-html/fig-vetor-buffer-quad-1.png" alt="Buffers quadrados de 1000 metros para os 30 pontos aleat√≥rios no munic√≠pio de Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.41: Buffers quadrados de 1000 metros para os 30 pontos aleat√≥rios no munic√≠pio de Rio Claro/SP.
</p>
</div>
<p><strong>Pol√≠gono convexo</strong></p>
<p>Uma an√°lise bastante comum, principalmente realizada pela IUCN, √© a cria√ß√£o de pol√≠gonos convexos, para definir a extens√£o de ocorr√™ncia de uma esp√©cie (<em>Extent of occurrence</em> - EOO). Nesse sentido, essa opera√ß√£o ligar√° os pontos externos de um conjunto de pontos e cria um pol√≠gono a partir deles. Podemos criar esse pol√≠gono com a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">sf::st_convex_hull()</a></code>. Um √∫nico passo que precisamos adiantar √© utilizar a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/geos_combine.html">sf::st_union()</a></code> para unir todos os pontos e criar um objeto <code>sf</code> <code>MULTIPOINT</code>, j√° iremos explicar com mais detalhes adiante. Vamos utilizar os pontos aleat√≥rios que criamos anteriormente para criar o pol√≠gono convexo (Figura <a href="cap15.html#fig:fig-vetor-convexo">15.42</a>).</p>
<div class="sourceCode" id="cb668"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Pol√≠gono convexo</span>
<span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_convexo</span> <span class="op">&lt;-</span> <span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_pontos_aleatorios</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html">st_union</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_convex_hull</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb669"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="st">"gray"</span>, main <span class="op">=</span> <span class="cn">NA</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, graticule <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_convexo</span>, col <span class="op">=</span> <span class="cn">NA</span>, lwd <span class="op">=</span> <span class="fl">2</span>, border <span class="op">=</span> <span class="st">"red"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_pontos_aleatorios</span>, pch <span class="op">=</span> <span class="fl">20</span>, cex <span class="op">=</span> <span class="fl">1</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-convexo"></span>
<img src="livro_files/figure-html/fig-vetor-convexo-1.png" alt="Pol√≠gono convexo para os 30 pontos criados aleatoriamente para Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.42: Pol√≠gono convexo para os 30 pontos criados aleatoriamente para Rio Claro/SP.
</p>
</div>
<p><strong>Pol√≠gonos de Voronoi</strong></p>
<p>Uma outra forma de criar pol√≠gonos para resumir dados espaciais √© atrav√©s dos Pol√≠gonos de Voronoi ou Diagrama de Voronoi. Nele, pol√≠gonos irregulares s√£o criados a partir da proximidade de pontos, de modo a estimar uma √°rea de abrang√™ncia no entorno dos mesmos <span class="citation">(<a href="refer%C3%AAncias.html#ref-okabe_spatial_2000" role="doc-biblioref">Okabe 2000</a>)</span>. Esses pol√≠gonos podem ser criados com a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">sf::st_voronoi()</a></code>, mas precisamos novamente utilizar a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/geos_combine.html">sf::st_union()</a></code> para unir todos os pontos e criar um objeto <code>sf</code> do tipo <code>MULTIPOINT</code>. Vamos utilizar os pontos aleat√≥rios que criamos anteriormente para criar o pol√≠gono de Voronoi (Figura <a href="cap15.html#fig:fig-vetor-voronoi">15.43</a>).</p>
<div class="sourceCode" id="cb670"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Pol√≠gonos de Voronoi</span>
<span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_voronoi</span> <span class="op">&lt;-</span> <span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_pontos_aleatorios</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html">st_union</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_voronoi</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb671"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="st">"gray"</span>, main <span class="op">=</span> <span class="cn">NA</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, graticule <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_voronoi</span>, col <span class="op">=</span> <span class="cn">NA</span>, lwd <span class="op">=</span> <span class="fl">2</span>, border <span class="op">=</span> <span class="st">"red"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_pontos_aleatorios</span>, pch <span class="op">=</span> <span class="fl">20</span>, cex <span class="op">=</span> <span class="fl">1</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-voronoi"></span>
<img src="livro_files/figure-html/fig-vetor-voronoi-1.png" alt="Pol√≠gonos de Voronoi para os 30 pontos criados aleatoriamente para Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.43: Pol√≠gonos de Voronoi para os 30 pontos criados aleatoriamente para Rio Claro/SP.
</p>
</div>
<p><strong>Quadr√≠culas e hex√°gonos</strong></p>
<p>Muitas vezes precisamos criar unidades espaciais id√™nticas e igualmente espa√ßadas para resumir informa√ß√µes dispersas por toda a nossa √°rea de estudo. Uma pr√°tica muito comum √© a cria√ß√£o de um gride de pontos ou quadr√≠culas em toda a √°rea de estudo, e depois utilizar essas geometrias para associar ou resumir informa√ß√µes espacializadas, como a IUCN utiliza para a an√°lise de √°rea de ocupa√ß√£o (<em>Are of occupancy</em> - AOO). Al√©m das quadr√≠culas, uma outra geometria que se tornou bastante comum para as finalidades descritas, √© a cria√ß√£o de hex√°gonos, que al√©m de serem mais esteticamente atraentes, possuem uma explica√ß√£o matem√°tica de sua melhor funcionalidade para an√°lises espaciais em Ecologia <span class="citation">(<a href="refer%C3%AAncias.html#ref-birch_rectangular_2007" role="doc-biblioref">Birch, Oom, and Beecham 2007</a>)</span>.</p>
<p>A fun√ß√£o utilizada para criar esses grides √© a <code><a href="https://r-spatial.github.io/sf/reference/st_make_grid.html">sf::st_make_grid()</a></code>, que requer pelo menos dois argumentos: <code>x</code> uma geometria de entrada e o <code>cellsize</code> indicando o tamanho do gride a ser criado, fornecido nas unidades do CRS da geometria de entrada. H√° diversos outros argumentos, mas os mais importantes s√£o o <code>square</code> que definir√° se o gride ser√° de quadriculas ou de hex√°gonos, e o <code>what</code> que definir√° se geraremos pol√≠gonos, cantos ou centroides.</p>
<p>Em nosso exemplo, vamos criar quadr√≠culas e hex√°gonos de 2000 metros (i.e.¬†4000000 metros quadrados) para o munic√≠pio de Rio Claro/SP (Figura <a href="cap15.html#fig:fig-vetor-quad">15.44</a> e Figura <a href="cap15.html#fig:fig-vetor-hex">15.45</a>). Podemos ainda utilizar as fun√ß√µes de filtros espaciais (Tabela <a href="cap15.html#tab:tab-filtro-espacial">15.12</a>) para definir como selecionaremos esses elementos para a √°rea de estudo. Aqui utilizamos a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">sf::st_intersects()</a></code>.</p>
<div class="sourceCode" id="cb672"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Quadr√≠culas</span>
<span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_grid</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_make_grid.html">st_make_grid</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span>, cellsize <span class="op">=</span> <span class="fl">2000</span>, what <span class="op">=</span> <span class="st">"polygons"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">st_intersects</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.</span>, y <span class="op">=</span> <span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span>, sparse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>

<span class="co">## Centroides das quadr√≠culas</span>
<span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_grid_cent</span> <span class="op">&lt;-</span> <span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_make_grid.html">st_make_grid</a></span><span class="op">(</span>cellsize <span class="op">=</span> <span class="fl">2000</span>, what <span class="op">=</span> <span class="st">"centers"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">st_intersects</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.</span>, y <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html">st_union</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_grid</span><span class="op">)</span>, sparse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb673"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="st">"gray"</span>, main <span class="op">=</span> <span class="cn">NA</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, graticule <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_grid</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_grid_cent</span>, pch <span class="op">=</span> <span class="fl">20</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-quad"></span>
<img src="livro_files/figure-html/fig-vetor-quad-1.png" alt="Quadr√≠culas de 2000 metros de arestas e centroides para Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.44: Quadr√≠culas de 2000 metros de arestas e centroides para Rio Claro/SP.
</p>
</div>
<div class="sourceCode" id="cb674"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Hex√°gonos</span>
<span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_hex</span> <span class="op">&lt;-</span> <span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_make_grid.html">st_make_grid</a></span><span class="op">(</span>cellsize <span class="op">=</span> <span class="fl">2000</span>, square <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">st_intersects</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.</span>, 
                                    y <span class="op">=</span> <span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span>, 
                                    sparse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>

<span class="co">## Centroides de hex√°gonos</span>
<span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_hex_cent</span> <span class="op">&lt;-</span> <span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_make_grid.html">st_make_grid</a></span><span class="op">(</span>cellsize <span class="op">=</span> <span class="fl">2000</span>, square <span class="op">=</span> <span class="cn">FALSE</span>, what <span class="op">=</span> <span class="st">"centers"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">st_intersects</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.</span>, 
                                    y <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html">st_union</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_hex</span><span class="op">)</span>,
                                    sparse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb675"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="st">"gray"</span>, main <span class="op">=</span> <span class="cn">NA</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, graticule <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_hex</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_hex_cent</span>, pch <span class="op">=</span> <span class="fl">20</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-hex"></span>
<img src="livro_files/figure-html/fig-vetor-hex-1.png" alt="Hex√°gonos equivalentes a quadr√≠culas de 2000 metros de arestas e centroides para Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.45: Hex√°gonos equivalentes a quadr√≠culas de 2000 metros de arestas e centroides para Rio Claro/SP.
</p>
</div>
<p><strong>Uni√£o (‚Äúdissolver‚Äù)</strong></p>
<p>Como vimos, na agrega√ß√£o por atributos podemos dissolver as geometrias de pol√≠gonos do mesmo grupo pelos valores da tabela de atributos, onde, naquele exemplo, contabilizamos quantas nascentes haviam por pol√≠gono de cobertura da terra para o munic√≠pio de Rio Claro/SP (Figura <a href="cap15.html#fig:fig-vetor-agregacao-espacial">15.29</a>).</p>
<p>Nesta se√ß√£o, vamos utilizar a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/geos_combine.html">sf::st_union()</a></code> para unir diversas fei√ß√µes em uma s√≥, dissolvendo os limites entre elas. Vamos utilizar de exemplo os buffers que criamos a partir dos 30 pontos aleat√≥rios (Figura <a href="cap15.html#fig:fig-vetor-uniao">15.46</a>).</p>
<div class="sourceCode" id="cb676"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Uni√£o</span>
<span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_pontos_aleatorios_buffer_uniao</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html">st_union</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_pontos_aleatorios_buffer</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb677"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="st">"gray"</span>, main <span class="op">=</span> <span class="cn">NA</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, graticule <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_pontos_aleatorios_buffer_uniao</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/adjustcolor.html">adjustcolor</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="fl">.1</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-uniao"></span>
<img src="livro_files/figure-html/fig-vetor-uniao-1.png" alt="Uni√£o - dissolu√ß√£o - dos buffers criados a partir de pontos aleat√≥rios para Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.46: Uni√£o - dissolu√ß√£o - dos buffers criados a partir de pontos aleat√≥rios para Rio Claro/SP.
</p>
</div>
<p><strong>Recorte e apagar (‚Äúclipar‚Äù e ‚Äúerase‚Äù)</strong></p>
<p>O recorte realiza um subconjunto espacial envolvendo dois objetos geoespaciais. O recorte √© aplicado somente a linhas e pol√≠gonos, ou seja, usaremos linhas e pol√≠gonos para recortar linhas ou pol√≠gonos. Esse recorte pode ser realizado de tr√™s formas: i) intersec√ß√£o (subconjunto das geometrias sobrepostas entre os dois objetos), ii) diferen√ßa (subconjunto das geometrias do primeiro objeto sem sobreposi√ß√£o com o segundo objeto), e iii) diferen√ßa sim√©trica (apenas as geometrias n√£o sobrepostas entre os dois objetos). Respectivamente para cada uma dessas opera√ß√µes temos fun√ß√µes espec√≠ficas: <code><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html">sf::st_intersection()</a></code>, <code><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html">sf::st_difference()</a></code> e <code><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html">sf::st_sym_difference()</a></code>.</p>
<p>Para nosso exemplo, faremos o recorte da hidrografia em rela√ß√£o aos buffers criados e unidos para os 30 pontos aleat√≥rios em Rio Claro/SP. Primeiramente, faremos o recorte para dentro dos buffers com a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html">sf::st_intersection()</a></code> (Figura <a href="cap15.html#fig:fig-vetor-interseccao">15.47</a>).</p>
<div class="sourceCode" id="cb678"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Recorte - intersec√ß√£o</span>
<span class="va">geo_vetor_hidrografia_interseccao</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html">st_intersection</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">geo_vetor_hidrografia</span>, y <span class="op">=</span> <span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_pontos_aleatorios_buffer_uniao</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb679"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="st">"gray"</span>, main <span class="op">=</span> <span class="cn">NA</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, graticule <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_pontos_aleatorios_buffer_uniao</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/adjustcolor.html">adjustcolor</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="fl">.1</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_hidrografia_interseccao</span><span class="op">$</span><span class="va">geometry</span>, col <span class="op">=</span> <span class="st">"blue"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-interseccao"></span>
<img src="livro_files/figure-html/fig-vetor-interseccao-1.png" alt="Recorte da hidrografia para dentro dos buffers dos 30 aleat√≥rios para Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.47: Recorte da hidrografia para dentro dos buffers dos 30 aleat√≥rios para Rio Claro/SP.
</p>
</div>
<p>Para nosso segundo exemplo, realizamos o recorte da hidrografia em rela√ß√£o aos buffers, mas agora para fora dos buffers utilizando a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html">sf::st_difference()</a></code> (Figura <a href="cap15.html#fig:fig-vetor-difereca">15.48</a>), que seria semelhando a opera√ß√£o de apagar (‚Äúerase‚Äù).</p>
<div class="sourceCode" id="cb680"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Recorte - diferen√ßa</span>
<span class="va">geo_vetor_hidrografia_diferenca</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html">st_difference</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">geo_vetor_hidrografia</span>, y <span class="op">=</span> <span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_pontos_aleatorios_buffer_uniao</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb681"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="st">"gray"</span>, main <span class="op">=</span> <span class="cn">NA</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, graticule <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_pontos_aleatorios_buffer_uniao</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/adjustcolor.html">adjustcolor</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="fl">.1</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_hidrografia_diferenca</span><span class="op">$</span><span class="va">geometry</span>, col <span class="op">=</span> <span class="st">"blue"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-difereca"></span>
<img src="livro_files/figure-html/fig-vetor-difereca-1.png" alt="Recorte da hidrografia para fora dos buffers dos 30 aleat√≥rios para Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.48: Recorte da hidrografia para fora dos buffers dos 30 aleat√≥rios para Rio Claro/SP.
</p>
</div>
<p><strong>Transforma√ß√µes de tipo</strong></p>
<p>Esse t√≥pico possui muitas funcionalidades, que s√£o exploradas no t√≥pico ‚Äú5.2.7 <em>Type transformations</em>‚Äù de Lovelace et al. <span class="citation">(<a href="refer%C3%AAncias.html#ref-lovelace2019" role="doc-biblioref">2019</a>)</span>. Aqui, nosso interesse principal √© em rela√ß√£o √† transforma√ß√£o dos tipos de objetos geoespaciais da classe <code>sf</code>: <code>MULTIPOINT</code>, <code>MULTILINESTRING</code> e <code>MULTIPOLYGON</code>, para <code>POINT</code>, <code>LINESTRING</code> e <code>POLYGON</code>. Muitas vezes as fei√ß√µes de nossos objetos, i.e., as linhas da tabela de atributos est√£o agrupadas em apenas uma linha da tabela. Quando o objeto espacial est√° nesse formato, geralmente em alguma classe dessas (<code>MULTIPOINT</code>, <code>MULTILINESTRING</code> e <code>MULTIPOLYGON</code>), n√£o temos como realizar opera√ß√µes espaciais ou geom√©tricas para cada fei√ß√£o, e precisamos separ√°-las em linhas diferentes para que opera√ß√µes como o c√°lculo de comprimento ou √°rea seja poss√≠vel para cada fei√ß√£o.</p>
<p>Dessa forma, podemos utilizar a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/st_cast.html">sf::st_cast()</a></code> para fazer essas transforma√ß√µes e atribuir cada fei√ß√£o a uma linha da tabela de atributos. Como exemplo, vamos separar os fragmentos de floresta e calcular a √°rea para cada fei√ß√£o em hectares (Figura <a href="cap15.html#fig:fig-vetor-tipo">15.49</a>).</p>
<div class="sourceCode" id="cb682"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Transforma√ß√£o de tipo</span>
<span class="va">geo_vetor_cobertura_floresta_polygon</span> <span class="op">&lt;-</span> <span class="va">geo_vetor_cobertura_floresta</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html">st_cast</a></span><span class="op">(</span><span class="st">"POLYGON"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>area_ha <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html">st_area</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">/</span><span class="fl">1e4</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb683"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="st">"gray"</span>, main <span class="op">=</span> <span class="cn">NA</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, graticule <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_cobertura_floresta_polygon</span><span class="op">[</span><span class="st">"area_ha"</span><span class="op">]</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>,  add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-tipo"></span>
<img src="livro_files/figure-html/fig-vetor-tipo-1.png" alt="Transforma√ß√£o do vetor de florestas em `POLYGON` e c√°lculo da √°rea para cada fei√ß√£o para Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.49: Transforma√ß√£o do vetor de florestas em <code>POLYGON</code> e c√°lculo da √°rea para cada fei√ß√£o para Rio Claro/SP.
</p>
</div>
<p><strong>Raster</strong></p>
<p>As opera√ß√µes geom√©tricas em rasters envolvem mudar a posi√ß√£o, tamanho e n√∫mero dos pixels e atribuir novos valores, geralmente aumentando ou diminuindo o tamanho desses pixels. Essas opera√ß√µes permitem alinhar rasters de diversas fontes, fazendo com que compartilhem uma correspond√™ncia entre seus pixels, permitindo que eles sejam processados todos juntos, ou simplesmente permite a realiza√ß√£o de an√°lises que demorariam muito, caso os rasters possuam um tamanho de pixel muito pequeno.</p>
<div class="alert alert-info">
<p><strong> üìù Importante </strong><br>
Essas opera√ß√µes funcionam para as tr√™s classes dos objetos raster: <code>RasterLayer</code>, <code>RasterBrick</code> e <code>RasterStack</code>.</p>
</div>
<p>Para exemplificar as opera√ß√µes geom√©tricas com rasters, vamos utilizar os dados de eleva√ß√£o para o munic√≠pio de Rio Claro/SP e bioclim√°ticos para o mundo.</p>
<p><strong>Agrega√ß√£o</strong></p>
<p>Na agrega√ß√£o de rasters, aumentaremos o tamanho dos pixels (diminuindo a resolu√ß√£o), agregando os valores dos pixels em um pixel maior. Podemos realizar essa opera√ß√£o com a fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/aggregate.html">raster::aggregate()</a></code>, que possui tr√™s argumentos: <code>x</code> corresponde ao objeto raster de entrada, <code>fact</code> √© o fator de agrega√ß√£o e corresponde ao n√∫mero que definir√° o novo tamanho do pixel (e.g., se um raster tem resolu√ß√£o de 90 m, um fator de agrega√ß√£o de 10 far√° com o novo raster tenha a resolu√ß√£o de 900 m), e <code>fun</code> √© a fun√ß√£o utilizada para realizar a agrega√ß√£o dos pixels (Figura <a href="cap15.html#fig:fig-raster-agregacao">15.50</a>).</p>
<p>Em nosso exemplo, vamos aumentar o tamanho dos pixels para 900 metros do raster de eleva√ß√£o para Rio Claro/SP.</p>
<div class="sourceCode" id="cb684"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Agrega√ß√£o - aumentar o tamanho do pixel</span>
<span class="va">geo_raster_srtm_rio_claro_sirgas2000_utm23s_agre_media</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/aggregate.html">aggregate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">geo_raster_srtm_rio_claro_sirgas2000_utm23s</span>, fact <span class="op">=</span> <span class="fl">10</span>, fun <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span>
<span class="va">geo_raster_srtm_rio_claro_sirgas2000_utm23s_agre_media</span>
<span class="co">#&gt; class      : RasterLayer </span>
<span class="co">#&gt; dimensions : 40, 37, 1480  (nrow, ncol, ncell)</span>
<span class="co">#&gt; resolution : 900, 900  (x, y)</span>
<span class="co">#&gt; extent     : 214554.4, 247854.4, 7502625, 7538625  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs        : +proj=utm +zone=23 +south +ellps=GRS80 +units=m +no_defs </span>
<span class="co">#&gt; source     : memory</span>
<span class="co">#&gt; names      : srtm_27_17 </span>
<span class="co">#&gt; values     : 506.0024, 922.8709  (min, max)</span></code></pre></div>
<div class="sourceCode" id="cb685"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro_sirgas2000_utm23s_agre_media</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-agregacao"></span>
<img src="livro_files/figure-html/fig-raster-agregacao-1.png" alt="Agrega√ß√£o (aumento do pixel para 900 metros) utilizando a m√©dia para o raster de eleva√ß√£o para Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.50: Agrega√ß√£o (aumento do pixel para 900 metros) utilizando a m√©dia para o raster de eleva√ß√£o para Rio Claro/SP.
</p>
</div>
<p><strong>Desagrega√ß√£o</strong></p>
<p>De modo contr√°rio, na desagrega√ß√£o de rasters, diminuiremos o tamanho dos pixels (aumentando a resolu√ß√£o), preenchendo com novos valores. Podemos realizar essa opera√ß√£o com a fun√ß√£o <code>raster::desaggregate()</code>, que assim como a fun√ß√£o anterior, possui tr√™s argumentos: <code>x</code> corresponde ao objeto raster de entrada, <code>fact</code> √© o fator de desagrega√ß√£o e corresponde ao n√∫mero que definir√° o novo tamanho do pixel (e.g., se um raster tem resolu√ß√£o de 90 m, um fator de desagrega√ß√£o de 2 far√° com que o novo raster tenha a resolu√ß√£o de 45 m), e <code>method</code> √© a fun√ß√£o utilizada para realizar a desagrega√ß√£o dos pixels (Figura <a href="cap15.html#fig:fig-raster-desagregacao">15.51</a>).</p>
<p>Nesse exemplo, vamos diminuir o tamanho dos pixels para 45 metros do raster de eleva√ß√£o para Rio Claro/SP.</p>
<div class="sourceCode" id="cb686"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Desagrega√ß√£o - diminuir o tamanho do pixel</span>
<span class="va">geo_raster_srtm_rio_claro_desg_bil</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/disaggregate.html">disaggregate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">geo_raster_srtm_rio_claro_sirgas2000_utm23s</span>, fact <span class="op">=</span> <span class="fl">2</span>, method <span class="op">=</span> <span class="st">"bilinear"</span><span class="op">)</span>
<span class="va">geo_raster_srtm_rio_claro_desg_bil</span>
<span class="co">#&gt; class      : RasterLayer </span>
<span class="co">#&gt; dimensions : 792, 728, 576576  (nrow, ncol, ncell)</span>
<span class="co">#&gt; resolution : 45, 45  (x, y)</span>
<span class="co">#&gt; extent     : 214554.4, 247314.4, 7502985, 7538625  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs        : +proj=utm +zone=23 +south +ellps=GRS80 +units=m +no_defs </span>
<span class="co">#&gt; source     : memory</span>
<span class="co">#&gt; names      : srtm_27_17 </span>
<span class="co">#&gt; values     : 493.7046, 986.5187  (min, max)</span></code></pre></div>
<div class="sourceCode" id="cb687"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro_desg_bil</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-desagregacao"></span>
<img src="livro_files/figure-html/fig-raster-desagregacao-1.png" alt="Desagrega√ß√£o (diminui√ß√£o do pixel para 45 metros) utilizando o m√©todo bilinear para o raster de eleva√ß√£o para Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.51: Desagrega√ß√£o (diminui√ß√£o do pixel para 45 metros) utilizando o m√©todo bilinear para o raster de eleva√ß√£o para Rio Claro/SP.
</p>
</div>
<p><strong>Alinhamento de rasters</strong></p>
<p>Muitas vezes queremos ir al√©m de ajustar o tamanho do pixel, ajustando tamb√©m a extens√£o, n√∫mero e origem dos pixels para v√°rias camadas rasters, principalmente se precisamos criar objetos das classes <code>RasterBrick</code> ou <code>RasterStack</code>. Dessa forma, podemos utilizar a fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/compare.html">raster::compareRaster()</a></code> para comparar os rasters em rela√ß√£o a extens√£o, n√∫mero de linhas e colunas, proje√ß√£o, resolu√ß√£o e origem (ou um subconjunto dessas compara√ß√µes).</p>
<p>Podemos utilizar a fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/resample.html">raster::resample()</a></code> para fazer esse alinhamento, ou ainda a fun√ß√£o <code><a href="https://rdrr.io/pkg/gdalUtils/man/align_rasters.html">gdalUtils::align_rasters()</a></code>. Para a primeira fun√ß√£o, os argumentos s√£o <code>x</code> para o raster de entrada, <code>y</code> para o raster de alinhamento e <code>method</code> para o m√©todo utilizado no alinhamento. Para nosso exemplo, vamos ajustar uma camada bioclim√°tica (BIO01) √† camada de eleva√ß√£o para Rio Claro/SP (Figura <a href="cap15.html#fig:fig-raster-reamostragem">15.52</a>).</p>
<div class="sourceCode" id="cb688"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Reamostragem</span>
<span class="va">geo_raster_bioclim_rc</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/resample.html">resample</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">geo_raster_bioclim</span><span class="op">$</span><span class="va">bio01</span>, 
                                          y <span class="op">=</span> <span class="va">geo_raster_srtm_rio_claro</span>, 
                                          method <span class="op">=</span> <span class="st">"bilinear"</span><span class="op">)</span>
<span class="va">geo_raster_bioclim_rc</span>
<span class="co">#&gt; class      : RasterLayer </span>
<span class="co">#&gt; dimensions : 370, 364, 134680  (nrow, ncol, ncell)</span>
<span class="co">#&gt; resolution : 0.0008333333, 0.0008333333  (x, y)</span>
<span class="co">#&gt; extent     : -47.765, -47.46167, -22.55167, -22.24333  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs </span>
<span class="co">#&gt; source     : memory</span>
<span class="co">#&gt; names      : bio01 </span>
<span class="co">#&gt; values     : 19.8383, 20.60492  (min, max)</span></code></pre></div>
<div class="sourceCode" id="cb689"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_raster_bioclim</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-reamostragem"></span>
<img src="livro_files/figure-html/fig-raster-reamostragem-1.png" alt="Reamostragem (alinhamento dos rasters) utilizando o m√©todo bilinear para alinhar o raster bioclim√°tico (BIO01) ao de eleva√ß√£o para Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.52: Reamostragem (alinhamento dos rasters) utilizando o m√©todo bilinear para alinhar o raster bioclim√°tico (BIO01) ao de eleva√ß√£o para Rio Claro/SP.
</p>
</div>
<p><strong>Intera√ß√µes raster-vetor</strong></p>
<p>Podemos fazer opera√ß√µes da intera√ß√£o entre objetos vetoriais e raster, como ajustes da extens√£o e limite do raster para vetores (corte e m√°scara), extra√ß√£o dos valores dos pixels para vetores (pontos, linhas e pol√≠gonos), e estat√≠sticas zonais dos valores dos pixels dos raster para um vetor (pol√≠gonos).</p>
<p><strong>Cortes e m√°scaras</strong></p>
<p>Muitas vezes precisamos ajustar o tamanho de um objeto raster a uma √°rea menor de interesse, geralmente definido por um objeto vetorial. Para realizar essa opera√ß√£o, dispomos de duas fun√ß√µes: <code><a href="https://rdrr.io/pkg/raster/man/crop.html">raster::crop()</a></code> e <code><a href="https://rdrr.io/pkg/raster/man/mask.html">raster::mask()</a></code>.</p>
<div class="alert alert-info">
<p><strong> üìù Importante </strong><br>
√â fundamental que ambos os objetos raster a ser reduzido e o vetor como molde precisam estar no mesmo CRS.</p>
</div>
<p>A fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/crop.html">raster::crop()</a></code> ajusta o raster √† extens√£o do vetor. Como exemplo, vamos retomar o raster de eleva√ß√£o original baixado e importado anteriormente (Figura <a href="cap15.html#fig:fig-raster-dem">15.14</a>). Primeiramente, vamos usar a fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/crop.html">raster::crop()</a></code> para ajustar esse raster √† extens√£o do limite do munic√≠pio de Rio Claro/SP (Figura <a href="cap15.html#fig:fig-raster-corte">15.53</a>).</p>
<div class="sourceCode" id="cb690"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Crop - adjuste da extens√£o</span>
<span class="va">geo_raster_srtm_rio_claro_crop</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/crop.html">crop</a></span><span class="op">(</span><span class="va">geo_raster_srtm</span>, <span class="va">geo_vetor_rio_claro</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb691"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro_crop</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-corte"></span>
<img src="livro_files/figure-html/fig-raster-corte-1.png" alt="Ajuste da extens√£o do raster de eleva√ß√£o para a extens√£o de Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.53: Ajuste da extens√£o do raster de eleva√ß√£o para a extens√£o de Rio Claro/SP.
</p>
</div>
<p>Para ajustar o raster ao limite do munic√≠pio de Rio Claro/SP, vamos usar a fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/mask.html">raster::mask()</a></code>. √â importante notar que essa fun√ß√£o preenche com <code>NAs</code> os pixels que est√£o fora do limite do pol√≠gono e n√£o ajusta a extens√£o (Figura <a href="cap15.html#fig:fig-raster-corte">15.53</a>).</p>
<div class="sourceCode" id="cb692"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Mask - adjuste ao limite</span>
<span class="va">geo_raster_srtm_rio_claro_mask</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/mask.html">mask</a></span><span class="op">(</span><span class="va">geo_raster_srtm</span>, <span class="va">geo_vetor_rio_claro</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb693"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro_mask</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-mascara"></span>
<img src="livro_files/figure-html/fig-raster-mascara-1.png" alt="Ajuste do raster de eleva√ß√£o para o limite de Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.54: Ajuste do raster de eleva√ß√£o para o limite de Rio Claro/SP.
</p>
</div>
<p>Para ajustar o raster √† extens√£o e ao limite do munic√≠pio de Rio Claro/SP, precisamos utilizar conjuntamente as fun√ß√µes <code><a href="https://rdrr.io/pkg/raster/man/crop.html">raster::crop()</a></code> e <code><a href="https://rdrr.io/pkg/raster/man/mask.html">raster::mask()</a></code> (Figura <a href="cap15.html#fig:fig-raster-corte-mascara">15.55</a>).</p>
<div class="sourceCode" id="cb694"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Crop e mask - ajuste da extens√£o e do limite</span>
<span class="va">geo_raster_srtm_rio_claro_crop_mask</span> <span class="op">&lt;-</span> <span class="va">geo_raster_srtm</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/crop.html">crop</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/mask.html">mask</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb695"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro_crop_mask</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-corte-mascara"></span>
<img src="livro_files/figure-html/fig-raster-corte-mascara-1.png" alt="Ajuste da extens√£o e do limite do raster de eleva√ß√£o para Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.55: Ajuste da extens√£o e do limite do raster de eleva√ß√£o para Rio Claro/SP.
</p>
</div>
<p>A fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/mask.html">raster::mask()</a></code> possui ainda um argumento chamado <code>inverse</code>, que cria uma m√°scara inversa ao limite, preenchendo com <code>NA</code> o pixels internos ao limite do pol√≠gono, como podemos ver para o raster de eleva√ß√£o e o limite de Rio Claro/SP (Figura <a href="cap15.html#fig:fig-raster-corte-mascara-inverso">15.56</a>).</p>
<div class="sourceCode" id="cb696"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Crop e mask inversa - ajuste da extens√£o e do limite inverso</span>
<span class="va">geo_raster_srtm_rio_claro_crop_mask_inv</span> <span class="op">&lt;-</span> <span class="va">geo_raster_srtm</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/crop.html">crop</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/mask.html">mask</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb697"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro_crop_mask_inv</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-corte-mascara-inverso"></span>
<img src="livro_files/figure-html/fig-raster-corte-mascara-inverso-1.png" alt="Ajuste da extens√£o e do limite externo do raster de eleva√ß√£o para Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.56: Ajuste da extens√£o e do limite externo do raster de eleva√ß√£o para Rio Claro/SP.
</p>
</div>
<p><strong>Extra√ß√£o</strong></p>
<p>A intera√ß√£o entre raster-vetor de extra√ß√£o √© o processo que identifica e retorna valores associados de pixels de um raster com base em um objeto vetorial. √â uma opera√ß√£o extremamente comum em an√°lises espaciais, principalmente para associar valores de raster ambientais (cont√≠nuos ou categ√≥ricos) a pontos de ocorr√™ncia ou amostragem. Os valores retornados depender√£o do tipo vetor (pontos, linhas ou pol√≠gonos) e de argumentos da fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/extract.html">raster::extract()</a></code> que alteram o funcionamento da extra√ß√£o.</p>
<p>Em nosso exemplo, vamos extrair os valores do raster de eleva√ß√£o para as nascentes do munic√≠pio de Rio Claro/SP (Figura <a href="cap15.html#fig:fig-raster-extracao">15.57</a>).</p>
<div class="sourceCode" id="cb698"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Extra√ß√£o</span>
<span class="va">geo_vetor_nascentes_ele</span> <span class="op">&lt;-</span> <span class="va">geo_vetor_nascentes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>elev <span class="op">=</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extract.html">extract</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">geo_raster_srtm_rio_claro_sirgas2000_utm23s</span>, y <span class="op">=</span> <span class="va">.</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb699"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_nascentes_ele</span><span class="op">[</span><span class="st">"elev"</span><span class="op">]</span>, 
     pch <span class="op">=</span> <span class="fl">20</span>, main <span class="op">=</span> <span class="cn">NA</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, graticule <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-extracao"></span>
<img src="livro_files/figure-html/fig-raster-extracao-1.png" alt="Extra√ß√£o dos valores de eleva√ß√£o para as nascentes de Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.57: Extra√ß√£o dos valores de eleva√ß√£o para as nascentes de Rio Claro/SP.
</p>
</div>
<p>Al√©m da extra√ß√£o dos valores totais, podemos resumir os valores dos pixels com a mesma opera√ß√£o de extra√ß√£o, utilizando ainda a fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/extract.html">raster::extract()</a></code>, mas utilizando uma outra fun√ß√£o para resumir os valores dos pixels para um pol√≠gono, opera√ß√£o tamb√©m denominada de estat√≠stica zonal (agora para vetores). J√° vimos que ela pode ser realizada entre rasters na se√ß√£o de opera√ß√µes zonais, mas aqui a realizaremos para rasters e vetores.</p>
<p>Para o exemplo, vamos calcular a eleva√ß√£o m√©dia dos valores para os hex√°gonos que criamos para o limite de Rio Claro/SP( Figura <a href="cap15.html#fig:fig-raster-zonas">15.58</a>).</p>
<div class="sourceCode" id="cb700"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Extra√ß√£o - estat√≠stica por zonas</span>
<span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_hex_alt</span> <span class="op">&lt;-</span> <span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_hex</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>elev_mean <span class="op">=</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extract.html">extract</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">geo_raster_srtm_rio_claro_sirgas2000_utm23s</span>, 
                                              y <span class="op">=</span> <span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_hex</span>, 
                                              fun <span class="op">=</span> <span class="va">mean</span>, 
                                              na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb701"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s_hex_alt</span><span class="op">[</span><span class="st">"elev_mean"</span><span class="op">]</span>, 
     pch <span class="op">=</span> <span class="fl">20</span>, main <span class="op">=</span> <span class="cn">NA</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, graticule <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-zonas"></span>
<img src="livro_files/figure-html/fig-raster-zonas-1.png" alt="Extra√ß√£o dos valores de eleva√ß√£o e resumo pela m√©dia para os hex√°gonos de Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.58: Extra√ß√£o dos valores de eleva√ß√£o e resumo pela m√©dia para os hex√°gonos de Rio Claro/SP.
</p>
</div>
<p><strong>Convers√µes raster-vetor</strong></p>
<p>Por fim, podemos ainda fazer opera√ß√µes de convers√£o entre objetos vetoriais para raster e vice-versa. Nessas opera√ß√µes, podemos resumir ou transformar objetos vetoriais (pontos, linhas ou pol√≠gonos) para rasters, escolhendo um raster previamente existente, processo denominado rasteriza√ß√£o. Tamb√©m podemos realizar o processo inverso, i.e., transformar o raster em um vetor, podendo esse vetor ser um gride pontos, linhas ou pol√≠gonos, opera√ß√£o chamada de vetoriza√ß√£o.</p>
<p><strong>Rasteriza√ß√£o</strong></p>
<p>A convers√£o de vetor para raster pode ser realizada de pontos, linhas ou pol√≠gonos para rasters. Nesse processo, podemos utilizar uma fun√ß√£o para resumir os dados pontuais para os pixels do raster que criaremos. Para essa opera√ß√£o, podemos utilizar a fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/rasterize.html">raster::rasterize()</a></code>, com o argumento <code>x</code> sendo o vetor de pontos de entrada, <code>y</code> o raster base, <code>field</code> a coluna ou campo da tabela de atributos do objeto vetorial para os quais os valores ser√£o utilizados e <code>fun</code> a fun√ß√£o utilizada para agrega√ß√£o dos dados.</p>
<p>Aqui, vamos contabilizar a quantidade de nascentes por pixel, utilizando como base o raster para o qual mudamos a resolu√ß√£o para 900 metros (Figura <a href="cap15.html#fig:fig-raster-rasterizacao-pontos">15.59</a>).</p>
<div class="sourceCode" id="cb702"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Rasterizar pontos</span>
<span class="va">geo_vetor_nascentes_rasterizacao</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterize.html">rasterize</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">geo_vetor_nascentes</span>, y <span class="op">=</span> <span class="va">geo_raster_srtm_rio_claro_sirgas2000_utm23s_agre_media</span>, field <span class="op">=</span> <span class="fl">1</span>, fun <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb703"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_nascentes_rasterizacao</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_nascentes</span><span class="op">$</span><span class="va">geometry</span>, pch <span class="op">=</span> <span class="fl">20</span>, cex <span class="op">=</span> <span class="fl">.5</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/adjustcolor.html">adjustcolor</a></span><span class="op">(</span><span class="st">"gray"</span>, <span class="fl">.5</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-rasterizacao-pontos"></span>
<img src="livro_files/figure-html/fig-raster-rasterizacao-pontos-1.png" alt="Rasteriza√ß√£o das nascentes, com a opera√ß√£o de contabiliza√ß√£o de pontos para Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.59: Rasteriza√ß√£o das nascentes, com a opera√ß√£o de contabiliza√ß√£o de pontos para Rio Claro/SP.
</p>
</div>
<p>Al√©m de pontos, podemos tamb√©m rasterizar linhas. Aqui vamos contabilizar as linhas da hidrografia simplificada para Rio Claro/SP (Figura <a href="cap15.html#fig:fig-raster-rasterizacao-linhas">15.60</a>).</p>
<div class="sourceCode" id="cb704"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Rasterizar linhas</span>
<span class="va">geo_vetor_hidrografia_rasterizacao</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterize.html">rasterize</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="va">geo_vetor_hidrografia_simplificado</span>,
    y <span class="op">=</span> <span class="va">geo_raster_srtm_rio_claro_sirgas2000_utm23s_agre_media</span>,
    field <span class="op">=</span> <span class="fl">1</span>, fun <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb705"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_hidrografia_rasterizacao</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_hidrografia_simplificado</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="st">"gray"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-rasterizacao-linhas"></span>
<img src="livro_files/figure-html/fig-raster-rasterizacao-linhas-1.png" alt="Rasteriza√ß√£o da hidrografia, com a opera√ß√£o de contabiliza√ß√£o de linhas para Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.60: Rasteriza√ß√£o da hidrografia, com a opera√ß√£o de contabiliza√ß√£o de linhas para Rio Claro/SP.
</p>
</div>
<p>Podemos ainda rasterizar pol√≠gonos, de modo que cada pixel do raster a ser criado receber√°o valor da tabela de atributos, ou uma an√°lise pelo vizinho mais pr√≥ximo no caso de um campo categ√≥rico, como a cobertura da terra, que tamb√©m vai depender da resolu√ß√£o do raster base e do tamanho da fei√ß√£o do pol√≠gono. Para nosso exemplo, antes de criar o raster vamos transforma a coluna de classe de cobertura da terra em <code>factor</code> (Figura <a href="cap15.html#fig:fig-raster-rasterizacao-poligonos">15.61</a>). Entretanto, essa opera√ß√£o de rasteriza√ß√£o tende a demorar muito no caso de pol√≠gonos muito detalhados ou um raster com pixels muito pequenos, sendo que dois pacotes aceleram esse processamento (<code>fasterize</code> e <code>gdalUtils</code>), com suas respectivas fun√ß√µes: <code><a href="https://rdrr.io/pkg/fasterize/man/fasterize.html">fasterize::fasterize()</a></code> e <code><a href="https://rdrr.io/pkg/gdalUtils/man/gdal_rasterize.html">gdalUtils::gdal_rasterize()</a></code>.</p>
<div class="sourceCode" id="cb706"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Rasterizar pol√≠gonos</span>
<span class="va">geo_vetor_cobertura_rasterizacao</span> <span class="op">&lt;-</span> <span class="va">geo_vetor_cobertura</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>classe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">as.factor</a></span><span class="op">(</span><span class="va">CLASSE_USO</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterize.html">rasterize</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.</span>, y <span class="op">=</span> <span class="va">geo_raster_srtm_rio_claro_sirgas2000_utm23s_agre_media</span>, field <span class="op">=</span> <span class="st">"classe"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb707"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_cobertura_rasterizacao</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_cobertura</span><span class="op">$</span><span class="va">geom</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-rasterizacao-poligonos"></span>
<img src="livro_files/figure-html/fig-raster-rasterizacao-poligonos-1.png" alt="Rasteriza√ß√£o da cobertura da terra para Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.61: Rasteriza√ß√£o da cobertura da terra para Rio Claro/SP.
</p>
</div>
<p><strong>Vetoriza√ß√£o</strong></p>
<p>A opera√ß√£o inversa √† rasteriza√ß√£o √© a vetoriza√ß√£o, na qual convertemos um raster em um vetor, sendo que esse vetor receber√° os valores dos pixels. O vetor em quest√£o pode ser pontos (geralmente um gride de pontos), linhas (geralmente isolinhas ou linhas de contorno), ou pol√≠gonos (podendo esses pol√≠gonos ser ou n√£o dissolvidos pelos valores dos pixels). Existem fun√ß√µes espec√≠ficas para cada uma dessas convers√µes, sendo elas: <code><a href="https://rdrr.io/pkg/raster/man/rasterToPoints.html">raster::rasterToPoints()</a></code>, <code><a href="https://rdrr.io/pkg/raster/man/rasterToContour.html">raster::rasterToContour()</a></code> e <code><a href="https://rdrr.io/pkg/raster/man/rasterToPolygons.html">raster::rasterToPolygons()</a></code>, respectivamente. Para a √∫ltima fun√ß√£o, ainda dispomos de uma alternativa mais veloz <code><a href="https://mdsumner.github.io/spex/reference/polygonize.html">spex::polygonize()</a></code>.</p>
<p>Em nosso exemplo, vamos vetorizar o raster de eleva√ß√£o para Rio Claro/SP, criando um gride de pontos, sendo os pontos os centroides de cada pixels (Figura <a href="cap15.html#fig:fig-raster-vetorizacao-pontos">15.62</a>).</p>
<div class="sourceCode" id="cb708"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Vetoriza√ß√£o de pontos</span>
<span class="va">geo_raster_srtm_rio_claro_sirgas2000_utm23s_agre_media_pontos</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterToPoints.html">rasterToPoints</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro_sirgas2000_utm23s_agre_media</span>, spatial <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb709"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro_sirgas2000_utm23s_agre_media</span>, 
     col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">10</span>, alpha <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro_sirgas2000_utm23s_agre_media_pontos</span>, 
     pch <span class="op">=</span> <span class="fl">20</span>, cex <span class="op">=</span> <span class="fl">.7</span>, main <span class="op">=</span> <span class="cn">FALSE</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="cn">NA</span>, 
     border <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-vetorizacao-pontos"></span>
<img src="livro_files/figure-html/fig-raster-vetorizacao-pontos-1.png" alt="Vetoriza√ß√£o do raster de eleva√ß√£o criando um gride de pontos para Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.62: Vetoriza√ß√£o do raster de eleva√ß√£o criando um gride de pontos para Rio Claro/SP.
</p>
</div>
<p>Nesse outro exemplo, vamos vetorizar o raster de eleva√ß√£o para Rio Claro/SP novamente, mas agora criando isolinhas (Figura <a href="cap15.html#fig:fig-raster-vetorizacao-linhas">15.63</a>).</p>
<div class="sourceCode" id="cb710"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Vetoriza√ß√£o de linhas</span>
<span class="va">geo_raster_srtm_rio_claro_sirgas2000_utm23s_agre_media_linhas</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterToContour.html">rasterToContour</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="va">geo_raster_srtm_rio_claro_sirgas2000_utm23s_agre_media</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb711"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro_sirgas2000_utm23s_agre_media</span>,
     col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">10</span>, alpha <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/contour.html">contour</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro_sirgas2000_utm23s_agre_media</span>, 
        labcex <span class="op">=</span> <span class="fl">1</span>, main <span class="op">=</span> <span class="cn">FALSE</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span><span class="op">$</span><span class="va">geom</span>, 
     col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-vetorizacao-linhas"></span>
<img src="livro_files/figure-html/fig-raster-vetorizacao-linhas-1.png" alt="Vetoriza√ß√£o do raster de eleva√ß√£o criando isolinhas para Rio Claro/SP." width="100%" height="100%"><p class="caption">
Figura 15.63: Vetoriza√ß√£o do raster de eleva√ß√£o criando isolinhas para Rio Claro/SP.
</p>
</div>
<p>Por fim, vamos vetorizar o raster de cobertura da terra criado anteriormente para Rio Claro/SP, criando pol√≠gonos n√£o dissolvendo e dissolvidos (Figura <a href="cap15.html#fig:fig-raster-vetorizacao-poligonos">15.64</a>).</p>
<div class="sourceCode" id="cb712"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Vetoriza√ß√£o de pol√≠gonos</span>
<span class="va">geo_vetor_cobertura_rasterizacao_poligonos</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterToPolygons.html">rasterToPolygons</a></span><span class="op">(</span><span class="va">geo_vetor_cobertura_rasterizacao</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="op">)</span>

<span class="co">## Vetoriza√ß√£o de pol√≠gonos dissolvendo</span>
<span class="va">geo_vetor_cobertura_rasterizacao_poligonos_dissolvidos</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterToPolygons.html">rasterToPolygons</a></span><span class="op">(</span><span class="va">geo_vetor_cobertura_rasterizacao</span>, dissolve <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb713"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="va">old_par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_cobertura_rasterizacao</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_cobertura_rasterizacao_poligonos</span><span class="op">$</span><span class="va">geometry</span>, 
     col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"gray"</span>, lwd <span class="op">=</span> <span class="fl">1</span>, main <span class="op">=</span> <span class="cn">FALSE</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span><span class="op">$</span><span class="va">geom</span>, 
     col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_cobertura_rasterizacao</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_cobertura_rasterizacao_poligonos_dissolvidos</span><span class="op">$</span><span class="va">geometry</span>, 
     col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"gray"</span>, lwd <span class="op">=</span> <span class="fl">1</span>, main <span class="op">=</span> <span class="cn">FALSE</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro_sirgas2000_utm23s</span><span class="op">$</span><span class="va">geom</span>, 
     col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="va">old_par</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-vetorizacao-poligonos"></span>
<img src="livro_files/figure-html/fig-raster-vetorizacao-poligonos-1.png" alt="Vetoriza√ß√£o do raster de cobertura da terra para Rio Claro/SP, n√£o dissolvendo e dissolvendos os pol√≠gonos gerados." width="100%" height="100%"><p class="caption">
Figura 15.64: Vetoriza√ß√£o do raster de cobertura da terra para Rio Claro/SP, n√£o dissolvendo e dissolvendos os pol√≠gonos gerados.
</p>
</div>
</div>
</div>
<div id="visualiza√ß√£o-de-dados-geoespaciais" class="section level2" number="15.10">
<h2>
<span class="header-section-number">15.10</span> Visualiza√ß√£o de dados geoespaciais<a class="anchor" aria-label="anchor" href="#visualiza%C3%A7%C3%A3o-de-dados-geoespaciais"><i class="fas fa-link"></i></a>
</h2>
<p>Um dos pontos finais de toda a an√°lise envolvendo a manipula√ß√£o de dados geoespaciais ser√° a apresenta√ß√£o de um mapa com as informa√ß√µes de interesse geoespacializadas. Mas antes, √© necess√°rio ter conhecimento de alguns dos elementos principais para a composi√ß√£o de um mapa relativamente bem informativo. Al√©m disso, o R nos permite criar tipos diferentes de mapas: est√°ticos, animados e interativos. Os mais comuns s√£o os est√°ticos, mas podemos por vezes melhorar a apresenta√ß√£o dos dados geoespaciais criando mapas animados e/ou interativos, com o aux√≠lio de p√°ginas web. Por fim, veremos as melhores formas de exportar mapas para diferentes formatos.</p>
<div id="principais-elementos-de-um-mapa" class="section level3" number="15.10.1">
<h3>
<span class="header-section-number">15.10.1</span> Principais elementos de um mapa<a class="anchor" aria-label="anchor" href="#principais-elementos-de-um-mapa"><i class="fas fa-link"></i></a>
</h3>
<p>Um mapa pode ser composto de v√°rios elementos, tendo estes o intuito de auxiliar a visualiza√ß√£o e entendimento de seu conte√∫do. Apesar disso, nem todos os elementos necessitam estar presentes em todos os <em>layouts</em> de mapas, sendo que os mesmos devem atendem √† necessidade das representa√ß√µes, podendo ser muitas vezes omitidos ou outros podem ser acrescentados.</p>
<p>Os principais elementos de um mapa geralmente s√£o compostos por:</p>
<ol style="list-style-type: decimal">
<li>Mapa principal (ocupando quase toda a √°rea da figura)</li>
<li>Mapa secund√°rio (geralmente muito menor que o mapa principal e com o intuito de mostrar a localiza√ß√£o do mapa principal num contexto mais amplo, como pa√≠s ou continente)</li>
<li>T√≠tulo (para resumir o intuito do mapa)</li>
<li>Legenda (apresentando as informa√ß√µes detalhadas das classes ou escala de valores, geralmente identificando as cores e/ou texturas),</li>
<li>Barra de escala (representando quantas unidades do mapa representam do mundo real)</li>
<li>Indicador de orienta√ß√£o (Norte) (indicando o norte geogr√°fico, podendo ser representado por uma flecha, b√∫ssola ou compasso)</li>
<li>Gride de coordenadas (coordenadas presentes nas laterais)</li>
<li>Descri√ß√£o do CRS (indicando qual o CRS)</li>
<li>Informa√ß√µes de origem (informa√ß√µes sobre a fonte dos dados representados no mapa)</li>
<li>Al√©m de outros elementos auxiliares (como elementos textuais e figuras extras)</li>
</ol>
<p>Podemos visualizar todos esses elementos resumidos na Figura <a href="cap15.html#fig:fig-mapa-elementos">15.65</a>.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-mapa-elementos"></span>
<img src="livro_files/figure-html/fig-mapa-elementos-1.png" alt="Principais elementos de um mapa." width="100%" height="100%"><p class="caption">
Figura 15.65: Principais elementos de um mapa.
</p>
</div>
</div>
<div id="principais-pacotes-para-a-composi√ß√£o-de-mapas" class="section level3" number="15.10.2">
<h3>
<span class="header-section-number">15.10.2</span> Principais pacotes para a composi√ß√£o de mapas<a class="anchor" aria-label="anchor" href="#principais-pacotes-para-a-composi%C3%A7%C3%A3o-de-mapas"><i class="fas fa-link"></i></a>
</h3>
<p>H√° uma grande quantidade de pacotes para a composi√ß√£o de mapas no R. Aqui listamos os principais (Tabela <a href="cap15.html#tab:tab-mapa-pacotes">15.13</a>).</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:tab-mapa-pacotes">Tabela 15.13: </span>Principais pacotes para composi√ß√£o de mapas no R.
</caption>
<thead><tr>
<th style="text-align:left;">
Pacote
</th>
<th style="text-align:left;">
Descri√ß√£o
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/ggplot2/index.html"><code>ggplot2</code></a>
</td>
<td style="text-align:left;">
Cria visualiza√ß√µes de dados elegantes usando a gram√°tica de gr√°ficos
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/ggspatial/index.html"><code>ggspatial</code></a>
</td>
<td style="text-align:left;">
Estrutura de dados espaciais para ggplot2
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/ggmap/index.html"><code>ggmap</code></a>
</td>
<td style="text-align:left;">
Visualiza√ß√£o espacial com ggplot2
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/tmap/index.html"><code>tmap</code></a>
</td>
<td style="text-align:left;">
Mapas tem√°ticos
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/leaflet/index.html"><code>leaflet</code></a>
</td>
<td style="text-align:left;">
Cria mapas da web interativos com a biblioteca JavaScript ‚ÄòLeaflet‚Äô
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/plotly/index.html"><code>plotly</code></a>
</td>
<td style="text-align:left;">
Cria gr√°ficos interativos da Web por meio de ‚Äòplotly.js‚Äô
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/cartography/index.html"><code>cartography</code></a>
</td>
<td style="text-align:left;">
Cartografia tem√°tica
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/googleway/index.html"><code>googleway</code></a>
</td>
<td style="text-align:left;">
Cartografia tem√°tica
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/mapview/index.html"><code>mapview</code></a>
</td>
<td style="text-align:left;">
Acessa APIs do Google Maps para recuperar dados e mapas de plotagem
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/rasterVis/index.html"><code>rasterVis</code></a>
</td>
<td style="text-align:left;">
Visualiza√ß√£o interativa de dados espaciais em R
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/cartogram/index.html"><code>cartogram</code></a>
</td>
<td style="text-align:left;">
M√©todos de visualiza√ß√£o para dados raster
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/mapsf/index.html"><code>mapsf</code></a>
</td>
<td style="text-align:left;">
Crie cartogramas com R
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/geogrid/index.html"><code>geogrid</code></a>
</td>
<td style="text-align:left;">
Transforme pol√≠gonos geoespaciais em grades regulares ou hexagonais
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/geofacet/index.html"><code>geofacet</code></a>
</td>
<td style="text-align:left;">
‚Äòggplot2‚Äô Utilit√°rios de faceta√ß√£o para dados geoespaciais
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/globe/index.html"><code>globe</code></a>
</td>
<td style="text-align:left;">
Plot 2D and 3D Views of the Earth, Including Major Coastline
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://cran.r-project.org/web/packages/linemap/index.html"><code>linemap</code></a>
</td>
<td style="text-align:left;">
Line Maps
</td>
</tr>
</tbody>
</table></div>
</div>
<div id="mapas-est√°ticos" class="section level3" number="15.10.3">
<h3>
<span class="header-section-number">15.10.3</span> Mapas est√°ticos<a class="anchor" aria-label="anchor" href="#mapas-est%C3%A1ticos"><i class="fas fa-link"></i></a>
</h3>
<p>Mapas est√°ticos s√£o mapas simples e fixos para visualiza√ß√£o de dados, sendo o tipo mais comum de sa√≠da visual. No in√≠cio da composi√ß√£o de mapas no R, esse era o √∫nico tipo de mapa que a linguagem permitia produzir, principalmente utilizando o pacote <code>sp</code> <span class="citation">(<a href="refer%C3%AAncias.html#ref-pebesma_roger_2005" role="doc-biblioref">E. J. Pebesma and Bivand 2005</a>)</span>. No entanto, com o advento de ferramentas de visualiza√ß√£o din√¢micas no R, como componentes HTML, os mapas puderam ser compostos de forma din√¢mica (animados e interativos).</p>
<p>Neste t√≥pico abordaremos fun√ß√µes simples para composi√ß√£o de mapas est√°ticos, como o <code><a href="https://r-spatial.github.io/sf/reference/plot.html">plot()</a></code>, al√©m de pacotes para composi√ß√£o de mapas mais elaborados, como os pacotes <code>ggplot2</code> <span class="citation">(<a href="refer%C3%AAncias.html#ref-R-ggplot2" role="doc-biblioref">Wickham et al. 2020</a>)</span> e <code>tmap</code> <span class="citation">(<a href="refer%C3%AAncias.html#ref-R-tmap" role="doc-biblioref">Tennekes 2021</a>)</span>.</p>
<p><strong>Fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/plot.html">plot()</a></code></strong></p>
<p>A fun√ß√£o gen√©rica <code><a href="https://r-spatial.github.io/sf/reference/plot.html">plot()</a></code> √© a maneira mais r√°pida de compor mapas est√°ticos utilizando objetos geoespaciais vetoriais e raster, funcionando para ambos os pacotes que apresentamos anteriormente (<code>sf</code> e <code>raster</code>). Apesar da simplicidade, essa fun√ß√£o geralmente tende a criar mapas com relativa velocidade, nos auxiliando principalmente em fases iniciais de desenvolvimento de um projeto. Essa fun√ß√£o oferece dezenas de argumentos em Base R, permitindo alguns ajustes limitados, com resultados bastante interessantes.</p>
<p>Como dito anteriormente, a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/plot.html">plot()</a></code> vai funcionar diferentemente dependendo da classe do objeto geoespacial. Para objetos geoespaciais <code>sf</code>, a fun√ß√£o vai plotar um mapa para cada coluna da tabela de atributos. Vamos usar de exemplo nosso mapa de biomas mostrado com os principais elementos de um mapa, podendo inclusive selecionar apenas a coluna de caracter√≠sticas geoespaciais (<code>geom</code>).</p>
<p>Primeiramente, vamos fazer o download dos dados de limites de biomas, retirando os sistemas costeiros, usando o pacote <code>geobr</code> <span class="citation">(<a href="refer%C3%AAncias.html#ref-R-geobr" role="doc-biblioref">Pereira and Goncalves 2021</a>)</span>.</p>
<div class="sourceCode" id="cb714"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Download de pol√≠gonos dos geo_vetor_biomas Brasileiros</span>
<span class="va">geo_vetor_biomas</span> <span class="op">&lt;-</span> <span class="fu">geobr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/geobr/man/read_biomes.html">read_biomes</a></span><span class="op">(</span>showProgress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">name_biome</span> <span class="op">!=</span> <span class="st">"Sistema Costeiro"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>nome_bioma <span class="op">=</span> <span class="va">name_biome</span>,
                  codigo_bioma <span class="op">=</span> <span class="va">code_biome</span>,
                  ano <span class="op">=</span> <span class="va">year</span><span class="op">)</span></code></pre></div>
<p>Caso o download n√£o funcione ou haja problemas com a importa√ß√£o, disponibilizamos os dados tamb√©m no pacote <code>ecodados</code>.</p>
<div class="sourceCode" id="cb715"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Importar os dados pelo pacote ecodados</span>
<span class="fu">ecodados</span><span class="fu">::</span><span class="va">geo_vetor_biomas</span></code></pre></div>
<p>Agora, quando utilizamos a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/plot.html">plot()</a></code> para um objeto da classe <code>sf</code>, temos os tr√™s mapas, cada um indicando uma coluna da tabela de atritos (Figura <a href="cap15.html#fig:fig-vetor-map-plot">15.66</a>).</p>
<div class="sourceCode" id="cb716"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_biomas</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-map-plot"></span>
<img src="livro_files/figure-html/fig-vetor-map-plot-1.png" alt="Mapa feito com a fun√ß√£o `plot()` de um objeto `sf` para os Biomas do Brasil." width="100%" height="100%"><p class="caption">
Figura 15.66: Mapa feito com a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/plot.html">plot()</a></code> de um objeto <code>sf</code> para os Biomas do Brasil.
</p>
</div>
<p>Selecionando as colunas desse objeto, podemos escolher a informa√ß√£o que queremos plotar, por exemplo, apenas a geometria <code>geom</code>. Al√©m disso, podemos acrescentar os argumentos <code>col</code> para colorir e <code>main</code> para o t√≠tulo, al√©m dos argumentos <code>axes</code> e <code>graticule</code> para adicionar as coordenadas e quadr√≠culas, respectivamente. A legenda pode ser adicionada com a fun√ß√£o <code><a href="https://rdrr.io/r/graphics/legend.html">legend()</a></code> (Figura <a href="cap15.html#fig:fig-vetor-map-plot-selecao">15.67</a>).</p>
<div class="sourceCode" id="cb717"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_biomas</span><span class="op">$</span><span class="va">geom</span>, 
     col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkgreen"</span>, <span class="st">"orange"</span>, <span class="st">"orange4"</span>, <span class="st">"forestgreen"</span>,
             <span class="st">"yellow"</span>, <span class="st">"yellow3"</span><span class="op">)</span>,
     main <span class="op">=</span> <span class="st">"Biomas do Brasil"</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, graticule <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">-</span><span class="fl">75</span>, y <span class="op">=</span> <span class="op">-</span><span class="fl">20</span>, pch <span class="op">=</span> <span class="fl">15</span>, cex <span class="op">=</span> <span class="fl">.7</span>, pt.cex <span class="op">=</span> <span class="fl">2.5</span>,
       legend <span class="op">=</span> <span class="va">geo_vetor_biomas</span><span class="op">$</span><span class="va">nome_bioma</span>, 
       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkgreen"</span>, <span class="st">"orange"</span>, <span class="st">"orange4"</span>, <span class="st">"forestgreen"</span>, 
               <span class="st">"yellow"</span>, <span class="st">"yellow3"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-map-plot-selecao"></span>
<img src="livro_files/figure-html/fig-vetor-map-plot-selecao-1.png" alt="Mapa feito com a fun√ß√£o `plot()` de um objeto vetor." width="100%" height="100%"><p class="caption">
Figura 15.67: Mapa feito com a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/plot.html">plot()</a></code> de um objeto vetor.
</p>
</div>
<p>Para a classe dos objetos geoespaciais raster, a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/plot.html">plot()</a></code> vai plotar um mapa para o tipo <code>RasterLayer</code> e quantos mapas houverem no objeto e couberem no espa√ßo de plot para <code>RasterBrick</code> e <code>RasterStack</code>. Al√©m disso, para essas classes do objeto raster, essa fun√ß√£o prov√™ tamb√©m uma legenda e uma escala de cores autom√°tica (<code>terrain</code>). Vamos fazer o mapa da camada raster de eleva√ß√£o para o limite do munic√≠pio de Rio Claro/SP (Figura <a href="cap15.html#fig:fig-raster-layer-mapa">15.68</a>).</p>
<div class="sourceCode" id="cb718"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-layer-mapa"></span>
<img src="livro_files/figure-html/fig-raster-layer-mapa-1.png" alt="Mapa feito com a fun√ß√£o `plot()` de um objeto raster com uma camada." width="100%" height="100%"><p class="caption">
Figura 15.68: Mapa feito com a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/plot.html">plot()</a></code> de um objeto raster com uma camada.
</p>
</div>
<p>Agora vamos plotar objetos da classe <code>RasterStack</code>, alterando a cor para <code>viridis</code>, usando a fun√ß√£o <code><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis::viridis()</a></code> do pacote hom√¥nimo. Vamos fazer o mapa de duas camadas raster bioclim√°ticas para o mundo (Figura <a href="cap15.html#fig:fig-raster-stack-mapa">15.69</a>).</p>
<div class="sourceCode" id="cb719"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_raster_bioclim</span><span class="op">[[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-stack-mapa"></span>
<img src="livro_files/figure-html/fig-raster-stack-mapa-1.png" alt="Mapa feito com a fun√ß√£o `plot()` de um objeto raster com v√°rias camadas." width="100%" height="100%"><p class="caption">
Figura 15.69: Mapa feito com a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/plot.html">plot()</a></code> de um objeto raster com v√°rias camadas.
</p>
</div>
<p>Para exportar esses mapas podemos utilizar as fun√ß√µes <code><a href="https://rdrr.io/r/grDevices/png.html">png()</a></code> ou <code><a href="https://rdrr.io/r/grDevices/pdf.html">pdf()</a></code>, indicando os argumentos para ter as configura√ß√µes que desejamos, e finalizando com a fun√ß√£o <code><a href="https://rdrr.io/r/grDevices/dev.html">dev.off()</a></code>. Vamos exportar, a t√≠tulo de exemplo, a √∫ltima figura (mais detalhes no Cap√≠tulo <a href="cap6.html#cap6">6</a>).</p>
<div class="sourceCode" id="cb720"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Criar diret√≥rio</span>
<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"mapas"</span><span class="op">)</span><span class="op">)</span>

<span class="co">## Exportar mapa</span>
<span class="fu"><a href="https://rdrr.io/r/grDevices/png.html">png</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"mapas"</span>, <span class="st">"elev_rc.png"</span><span class="op">)</span>, 
    width <span class="op">=</span> <span class="fl">20</span>, height <span class="op">=</span> <span class="fl">20</span>, units <span class="op">=</span> <span class="st">"cm"</span>, res <span class="op">=</span> <span class="fl">300</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro</span><span class="op">$</span><span class="va">geom</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><strong>Pacotes ggplot2 e ggspatial</strong></p>
<p>Como discutimos no Cap√≠tulo <a href="cap6.html#cap6">6</a> sobre gr√°ficos, o pacote <code>ggplot2</code> utiliza a gram√°tica de gr√°ficos para composi√ß√£o de figuras no R <span class="citation">(<a href="refer%C3%AAncias.html#ref-wilkinson2005" role="doc-biblioref">Wilkinson and Wills 2005</a>; <a href="refer%C3%AAncias.html#ref-wickham2016" role="doc-biblioref">Wickham 2016</a>)</span>. Para cada classe de objeto geogr√°fico h√° fun√ß√µes espec√≠ficas para os dados: para objetos sf <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code> e para objetos raster <code><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_raster()</a></code> e <code><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile()</a></code>.</p>
<p>Al√©m do pacote <code>ggplot2</code>, podemos utilizar o pacote <code>ggspatial</code> para acrescentar elementos geoespaciais como a barra de escala e o indicador de orienta√ß√£o (Norte), atrav√©s das fun√ß√µes <code><a href="https://paleolimbot.github.io/ggspatial/reference/annotation_scale.html">annotation_scale()</a></code> e <code><a href="https://paleolimbot.github.io/ggspatial/reference/annotation_north_arrow.html">annotation_north_arrow()</a></code>, respectivamente, al√©m de outras fun√ß√µes espec√≠ficas que n√£o abordaremos nesta se√ß√£o.</p>
<p>A estrutura de composi√ß√£o das fun√ß√µes do pacote <code>ggplot2</code> vai funcionar parecido com a estrutura√ß√£o de gr√°ficos j√° vista no Cap√≠tulo <a href="cap6.html#cap6">6</a>, de modo que a cada fun√ß√£o iremos utilizando o sinal de <code>+</code> para acrescentar outra camada. Indicaremos os dados com a fun√ß√£o <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> e a coluna da tabela de atributos que queremos representar com a fun√ß√£o <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code>. Em seguida, utilizamos a fun√ß√£o <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code> para indicar que trata-se de um objeto <code>sf</code>.</p>
<p>Al√©m dessas fun√ß√µes, podemos ainda fazer altera√ß√µes nos mapas atrav√©s das fun√ß√µes: <code>scale_*()</code> que vai alterar as caracter√≠sticas indicadas em <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code>, <code>coord_*()</code> que vai alterar constru√ß√£o do mapa em rela√ß√£o √†s coordenadas, <code>facet_*()</code> que altera a disposi√ß√£o de v√°rios mapas, e <code>theme_*()</code> e <code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code> que alterar√£o caracter√≠sticas relacionadas ao tema, como cores de fundo, fontes e legenda. Podemos ainda utilizar as fun√ß√µes <code><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate()</a></code> para adicionar textos e <code><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs()</a></code> para alterar o texto do t√≠tulo, legenda e eixos.</p>
<p>Vamos demonstrar esse funcionamento para compor o mapa de geo_vetor_biomas, apresentado no in√≠cio desta se√ß√£o (Figura <a href="cap15.html#fig:fig-vetor-mapa-ggplot2">15.70</a>).</p>
<div class="sourceCode" id="cb721"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot</span>
<span class="va">mapa_vetor_biomas_ggplot2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">geo_vetor_biomas</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">nome_bioma</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkgreen"</span>, <span class="st">"orange"</span>, <span class="st">"orange4"</span>, 
                                 <span class="st">"forestgreen"</span>, <span class="st">"yellow"</span>, <span class="st">"yellow3"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/annotation_scale.html">annotation_scale</a></span><span class="op">(</span>location <span class="op">=</span> <span class="st">"br"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/annotation_north_arrow.html">annotation_north_arrow</a></span><span class="op">(</span>location <span class="op">=</span> <span class="st">"br"</span>, which_north <span class="op">=</span> <span class="st">"true"</span>,
                           pad_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0</span>, <span class="st">"cm"</span><span class="op">)</span>, pad_y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="st">"cm"</span><span class="op">)</span>,
                           style <span class="op">=</span> <span class="va">north_arrow_fancy_orienteering</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, label <span class="op">=</span> <span class="st">"CRS: SIRGAS2000/Geo"</span>, x <span class="op">=</span> <span class="op">-</span><span class="fl">38</span>, y <span class="op">=</span> <span class="op">-</span><span class="fl">31</span>, size <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, label <span class="op">=</span> <span class="st">"Fonte: IBGE (2019)"</span>, x <span class="op">=</span> <span class="op">-</span><span class="fl">39</span>, y <span class="op">=</span> <span class="op">-</span><span class="fl">32.5</span>, size <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Biomas do Brasil"</span>, fill <span class="op">=</span> <span class="st">"Legenda"</span>, x <span class="op">=</span> <span class="st">"Longitude"</span>, y <span class="op">=</span> <span class="st">"Latitude"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,
          legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,
          legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.15</span>, <span class="fl">.25</span><span class="op">)</span>,
          legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,
          axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span>, face <span class="op">=</span> <span class="st">"plain"</span><span class="op">)</span><span class="op">)</span>
<span class="va">mapa_vetor_biomas_ggplot2</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-mapa-ggplot2"></span>
<img src="livro_files/figure-html/fig-vetor-mapa-ggplot2-1.png" alt="Mapa de Biomas do Brasil com o pacote `ggplot2`." width="100%" height="100%"><p class="caption">
Figura 15.70: Mapa de Biomas do Brasil com o pacote <code>ggplot2</code>.
</p>
</div>
<p>Para objetos raster, o uso do pacote <code>ggplot2</code> para compor mapas requer um passo preliminar. Primeiramente, vamos criar um <code>data frame</code> com os dados do raster, com as linhas sendo os pixels e as colunas sendo as coordenadas centrais da longitude e latitude, al√©m dos valores de cada camada em cada coluna. Esse passo pode ser realizado com a fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/rasterToPoints.html">raster::rasterToPoints()</a></code>.</p>
<p>Uma vez que temos esses dados organizados, podemos utilizar as fun√ß√µes <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> para indicar o <code>data frame</code>, e as colunas com a fun√ß√£o <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code>. Em seguida, utilizamos a fun√ß√£o <code><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_raster()</a></code> para indicar que trata-se de um objeto raster. Al√©m dessas fun√ß√µes, podemos ainda utilizar as demais fun√ß√µes para alterar as caracter√≠sticas do mapa, como comentamos acima. Entretanto, devemos nos atentar para a fun√ß√£o <code>coord_*()</code> e escolher aquela que vai fazer a constru√ß√£o do mapa em rela√ß√£o √† coordenadas e resolu√ß√£o das c√©lulas.</p>
<p>Como exemplo, vamos compor o mapa de eleva√ß√£o para Rio Claro/SP, adicionando tamb√©m o limite do munic√≠pio (Figura <a href="cap15.html#fig:fig-raster-mapa-ggplot2">15.71</a>).</p>
<div class="sourceCode" id="cb722"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Dados</span>
<span class="va">geo_raster_srtm_rio_claro_dados</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterToPoints.html">rasterToPoints</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/headtail.html">head</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro_dados</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 √ó 3</span>
<span class="co">#&gt;       x     y elevacao</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1 -47.8 -22.2      859</span>
<span class="co">#&gt; 2 -47.8 -22.2      856</span>
<span class="co">#&gt; 3 -47.8 -22.2      856</span>
<span class="co">#&gt; 4 -47.8 -22.2      856</span>
<span class="co">#&gt; 5 -47.8 -22.2      853</span>
<span class="co">#&gt; 6 -47.8 -22.2      852</span>

<span class="co">## Mapa</span>
<span class="va">mapa_srtm_rio_claro_ggplot2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_raster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">geo_raster_srtm_rio_claro_dados</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">elevacao</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">geo_vetor_rio_claro</span>, color <span class="op">=</span> <span class="st">"red"</span>, fill <span class="op">=</span> <span class="cn">NA</span>, size <span class="op">=</span> <span class="fl">1.3</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/annotation_scale.html">annotation_scale</a></span><span class="op">(</span>location <span class="op">=</span> <span class="st">"br"</span>,
                     pad_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="st">"cm"</span><span class="op">)</span>, pad_y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">.7</span>, <span class="st">"cm"</span><span class="op">)</span>,<span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/annotation_north_arrow.html">annotation_north_arrow</a></span><span class="op">(</span>location <span class="op">=</span> <span class="st">"br"</span>, which_north <span class="op">=</span> <span class="st">"true"</span>,
                           pad_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">.4</span>, <span class="st">"cm"</span><span class="op">)</span>, pad_y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">1.3</span>, <span class="st">"cm"</span><span class="op">)</span>,
                           style <span class="op">=</span> <span class="va">north_arrow_fancy_orienteering</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, label <span class="op">=</span> <span class="st">"CRS: WGS84/Geo"</span>, 
             x <span class="op">=</span> <span class="op">-</span><span class="fl">47.51</span>, y <span class="op">=</span> <span class="op">-</span><span class="fl">22.53</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Eleva√ß√£o de Rio Claro/SP"</span>, fill <span class="op">=</span> <span class="st">"Eleva√ß√£o (m)"</span>, 
         x <span class="op">=</span> <span class="st">"Longitude"</span>, y <span class="op">=</span> <span class="st">"Latitude"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,
          legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,
          legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.2</span>, <span class="fl">.25</span><span class="op">)</span>,
          legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,
          axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span>, face <span class="op">=</span> <span class="st">"plain"</span><span class="op">)</span>,
          axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">.4</span><span class="op">)</span><span class="op">)</span>
<span class="va">mapa_srtm_rio_claro_ggplot2</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-mapa-ggplot2"></span>
<img src="livro_files/figure-html/fig-raster-mapa-ggplot2-1.png" alt="Mapa raster com o pacote `ggplot2`." width="100%" height="100%"><p class="caption">
Figura 15.71: Mapa raster com o pacote <code>ggplot2</code>.
</p>
</div>
<p>Para exportar mapas criados com o pacote <code>ggplot2</code>, podemos utilizar a fun√ß√£o <code><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggplot2::ggsave()</a></code>, indicando os argumentos para ter as configura√ß√µes que desejamos. Vamos exportar, a t√≠tulo de exemplo, a √∫ltima figura.</p>
<div class="sourceCode" id="cb723"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Exportar mapa ggplot2</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"mapas"</span>, <span class="st">"srtm_rio_claro_ggplot2.png"</span><span class="op">)</span>,
       plot <span class="op">=</span> <span class="va">mapa_srtm_rio_claro_ggplot2</span>, width <span class="op">=</span> <span class="fl">20</span>, height <span class="op">=</span> <span class="fl">20</span>, units <span class="op">=</span> <span class="st">"cm"</span>, dpi <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></code></pre></div>
<p><strong>Pacote tmap</strong></p>
<p>O pacote <code>tmap</code> √© um pacote direcionado √† cria√ß√£o de mapas tem√°ticos, com uma sintaxe concisa que permite a cria√ß√£o de mapas com o m√≠nimo de c√≥digos, mas muito similar √† sintaxe do pacote <code>ggplot2</code> <span class="citation">(<a href="refer%C3%AAncias.html#ref-tmap2018" role="doc-biblioref">Martijn 2018</a>)</span>. Ele tamb√©m pode gerar mapas est√°ticos ou interativos usando o mesmo c√≥digo, apenas mudando a forma de visualiza√ß√£o com a fun√ß√£o <code><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode()</a></code>, com o argumento <code>mode</code> igual a ‚Äúplot‚Äù para est√°tico e ‚Äúview‚Äù para interativo. Por fim, o pacote <code>tmap</code> aceita diversas classes espaciais, incluindo objetos raster, de forma bastante simples. Mais sobre o pacote pode ser lido <a href="https://mtennekes.github.io/tmap/">aqui</a>.</p>
<div class="alert alert-info">
<p><strong> üìù Importante </strong><br>
Atentar para a instala√ß√£o extra em Sistemas Operacionais <a href="https://geocompr.github.io/post/2020/installing-r-spatial-ubuntu/">GNU/Linux</a> e <a href="http://www.kyngchaos.com">MacOS</a>.</p>
</div>
<p>Todas as fun√ß√µes do pacote <code>tmap</code> iniciam-se com <code>tm_*</code>, facilitando seu uso. A cada fun√ß√£o iremos utilizar o sinal de <code>+</code> para acrescentar outra camada, da mesma forma que o pacote <code>ggplot2</code>. A principal fun√ß√£o, em que todos os objetos geoespaciais s√£o dados de entrada, √© <code><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape()</a></code>. A partir dela, podemos seguir com fun√ß√µes espec√≠ficas para visualiza√ß√£o de objetos <code>sf</code>, como <code><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_polygons()</a></code>, <code><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders()</a></code>, <code><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill()</a></code>, <code><a href="https://rdrr.io/pkg/tmap/man/tm_lines.html">tm_lines()</a></code>, <code><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots()</a></code> ou <code><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_bubbles()</a></code>, ou com fun√ß√µes para objetos raster como <code><a href="https://rdrr.io/pkg/tmap/man/tm_raster.html">tm_raster()</a></code>. Ainda h√° fun√ß√µes como <code><a href="https://rdrr.io/pkg/tmap/man/tm_text.html">tm_text()</a></code> para representa√ß√£o de textos das colunas da tabela de atributos, e <code><a href="https://rdrr.io/pkg/tmap/man/tm_scale_bar.html">tm_scale_bar()</a></code>, <code><a href="https://rdrr.io/pkg/tmap/man/tm_compass.html">tm_compass()</a></code> e <code><a href="https://rdrr.io/pkg/tmap/man/tm_grid.html">tm_graticules()</a></code>, para adicionar barra de escala, indicador de orienta√ß√£o (Norte) e gride de coordenadas, respectivamente. Por fim, a fun√ß√£o <code><a href="https://rdrr.io/pkg/tmap/man/tm_credits.html">tm_credits()</a></code> adiciona um texto descritivo e a fun√ß√£o <code><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout()</a></code> faz diversas mudan√ßas nos detalhes e apresenta√ß√£o do mapa.</p>
<p>Uma funcionalidade muito interessante do pacote <code>tmap</code> √© o uso da fun√ß√£o <code><a href="https://rdrr.io/pkg/tmaptools/man/palette_explorer.html">tmaptools::palette_explorer()</a></code> para escolher as paletas de cores dispon√≠veis. Essa fun√ß√£o requer que os pacotes <code>shiny</code> e <code>shinyjs</code> estejam instalados, e quando executada, retorna uma aba onde √© poss√≠vel editar e escolher algumas paletas de cores nativas do <code>tmap</code>.</p>
<p>Diversos par√¢metros podem ser acrescentados √†s fun√ß√µes de composi√ß√£o do tmap, mas n√£o as detalharemos aqui, pois todas s√£o descritas nos vignettes do pacote: <a href="https://cran.r-project.org/web/packages/tmap/vignettes/tmap-getstarted.html">tmap: get started!</a> e <a href="https://cran.r-project.org/web/packages/tmap/vignettes/tmap-changes.html">tmap: version changes</a>.</p>
<p>Vamos seguir com a composi√ß√£o do mapa de biomas para o Brasil apresentado no in√≠cio dessa se√ß√£o (Figura <a href="cap15.html#fig:fig-vetor-mapa-tmap">15.72</a>).</p>
<div class="sourceCode" id="cb724"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Mudar o modo de exibi√ß√£o do tmap</span>
<span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"plot"</span><span class="op">)</span>

<span class="co">## Mapa</span>
<span class="va">mapa_vetor_biomas_tmap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">geo_vetor_biomas</span>, bbox <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">74</span>, <span class="op">-</span><span class="fl">35</span>, <span class="op">-</span><span class="fl">27</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_polygons</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"nome_bioma"</span>,
                pal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkgreen"</span>, <span class="st">"orange"</span>, <span class="st">"orange4"</span>, <span class="st">"forestgreen"</span>, <span class="st">"yellow"</span>, <span class="st">"yellow3"</span><span class="op">)</span>,
                border.col <span class="op">=</span> <span class="st">"black"</span>,
                title <span class="op">=</span> <span class="st">"Legenda"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_compass.html">tm_compass</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span>text.size <span class="op">=</span> <span class="fl">.6</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_grid.html">tm_graticules</a></span><span class="op">(</span>lines <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_credits.html">tm_credits</a></span><span class="op">(</span><span class="st">"CRS: SIRGAS2000/Geo"</span>, position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.63</span>, <span class="fl">.13</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_credits.html">tm_credits</a></span><span class="op">(</span><span class="st">"Fonte: IBGE (2019)"</span>, position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.63</span>, <span class="fl">.09</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Biomas do Brasil"</span>,
              title.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.25</span>, <span class="fl">.95</span><span class="op">)</span>,
              title.size <span class="op">=</span> <span class="fl">1.8</span>,
              title.fontface <span class="op">=</span> <span class="st">"bold"</span>,
              legend.frame <span class="op">=</span> <span class="cn">TRUE</span>,
              legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"bottom"</span><span class="op">)</span>,
              legend.title.fontface <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>
<span class="va">mapa_vetor_biomas_tmap</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-mapa-tmap"></span>
<img src="livro_files/figure-html/fig-vetor-mapa-tmap-1.png" alt="Mapa de Biomas do Brasil com o pacote `tmap`." width="100%" height="100%"><p class="caption">
Figura 15.72: Mapa de Biomas do Brasil com o pacote <code>tmap</code>.
</p>
</div>
<p>Al√©m disso, o pacote <code>tmap</code> nos permite adicionar de forma simples um mapa secund√°rio, provendo uma localiza√ß√£o regional de interesse (Figura <a href="cap15.html#fig:fig-vetor-mapa-sec-tmap">15.73</a>).</p>
<div class="sourceCode" id="cb725"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Dados</span>
<span class="va">geo_vetor_am_sul</span> <span class="op">&lt;-</span> <span class="fu">rnaturalearth</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rnaturalearth/man/ne_countries.html">ne_countries</a></span><span class="op">(</span>continent <span class="op">=</span> <span class="st">"South America"</span><span class="op">)</span>
<span class="va">geo_vetor_brasil</span> <span class="op">&lt;-</span> <span class="fu">rnaturalearth</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rnaturalearth/man/ne_countries.html">ne_countries</a></span><span class="op">(</span>country <span class="op">=</span> <span class="st">"Brazil"</span><span class="op">)</span>
<span class="va">geo_vetor_biomas</span> <span class="op">&lt;-</span> <span class="fu">geobr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/geobr/man/read_biomes.html">read_biomes</a></span><span class="op">(</span>showProgress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">name_biome</span> <span class="op">!=</span> <span class="st">"Sistema Costeiro"</span><span class="op">)</span></code></pre></div>
<p>Caso o download n√£o funcione ou haja problemas com a importa√ß√£o, disponibilizamos os dados tamb√©m no pacote <code>ecodados</code>.</p>
<div class="sourceCode" id="cb726"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Importar os dados pelo pacote ecodados</span>
<span class="fu">ecodados</span><span class="fu">::</span><span class="va">geo_vetor_am_sul</span>
<span class="fu">ecodados</span><span class="fu">::</span><span class="va">geo_vetor_brasil</span>
<span class="fu">ecodados</span><span class="fu">::</span><span class="va">geo_vetor_biomas</span></code></pre></div>
<div class="sourceCode" id="cb727"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Mudar o modo de exibi√ß√£o do tmap</span>
<span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"plot"</span><span class="op">)</span>

<span class="co">## Mapa secund√°rio</span>
<span class="va">mapa_am_sul</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">geo_vetor_am_sul</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_polygons</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">geo_vetor_brasil</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_polygons</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"gray50"</span><span class="op">)</span>

<span class="co">## Juntando os mapas</span>
<span class="va">mapa_vetor_biomas_tmap</span>
<span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/print.html">print</a></span><span class="op">(</span><span class="va">mapa_am_sul</span>, vp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/viewport.html">viewport</a></span><span class="op">(</span><span class="fl">.815</span>, <span class="fl">.875</span>, wi <span class="op">=</span> <span class="fl">.2</span>, he <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-mapa-sec-tmap"></span>
<img src="livro_files/figure-html/fig-vetor-mapa-sec-tmap-1.png" alt="Mapa vetorial prim√°rio e secund√°rio com o pacote `tmap`." width="100%" height="100%"><p class="caption">
Figura 15.73: Mapa vetorial prim√°rio e secund√°rio com o pacote <code>tmap</code>.
</p>
</div>
<p>Como exemplo de mapa raster, vamos compor novamente o mapa de eleva√ß√£o para Rio Claro/SP, adicionando tamb√©m o limite do munic√≠pio (Figura <a href="cap15.html#fig:fig-raster-mapa-tmap">15.74</a>).</p>
<div class="sourceCode" id="cb728"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Mudar o modo de exibi√ß√£o do tmap</span>
<span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"plot"</span><span class="op">)</span>

<span class="co">## Mapa</span>
<span class="va">mapa_srtm_rio_claro_tmap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_raster.html">tm_raster</a></span><span class="op">(</span>pal <span class="op">=</span> <span class="st">"viridis"</span>, title <span class="op">=</span> <span class="st">"Eleva√ß√£o (m)"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">geo_vetor_rio_claro</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_compass.html">tm_compass</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.9</span>, <span class="fl">.08</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span>text.size <span class="op">=</span> <span class="fl">.6</span>, position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.67</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_grid.html">tm_graticules</a></span><span class="op">(</span>lines <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_credits.html">tm_credits</a></span><span class="op">(</span><span class="st">"CRS: WGS84/Geo"</span>, position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.67</span>, <span class="fl">.06</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Eleva√ß√£o Rio Claro/SP"</span>,
              title.size <span class="op">=</span> <span class="fl">1</span>,
              title.fontface <span class="op">=</span> <span class="st">"bold"</span>,
              legend.title.size <span class="op">=</span> <span class="fl">.7</span>,
              legend.text.size <span class="op">=</span> <span class="fl">.6</span>,
              legend.frame <span class="op">=</span> <span class="cn">TRUE</span>,
              legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.01</span>, <span class="fl">.01</span><span class="op">)</span>,
              legend.title.fontface <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>
<span class="va">mapa_srtm_rio_claro_tmap</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-mapa-tmap"></span>
<img src="livro_files/figure-html/fig-raster-mapa-tmap-1.png" alt="Mapa raster de eleva√ß√£o com o pacote `tmap`." width="100%" height="100%"><p class="caption">
Figura 15.74: Mapa raster de eleva√ß√£o com o pacote <code>tmap</code>.
</p>
</div>
<p>Para exportar mapas criados com o pacote <code>tmap</code> podemos utilizar a fun√ß√£o <code><a href="https://rdrr.io/pkg/tmap/man/tmap_save.html">tmap::tmap_save()</a></code>, indicando os argumentos para ter as configura√ß√µes que desejamos. Vamos exportar, a t√≠tulo de exemplo, a √∫ltima figura.</p>
<div class="sourceCode" id="cb729"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Exportar mapa tmap</span>
<span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_save.html">tmap_save</a></span><span class="op">(</span>tm <span class="op">=</span> <span class="va">mapa_srtm_rio_claro_tmap</span>, 
                filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"mapas"</span>, <span class="st">"srtm_rio_claro_tmap.png"</span><span class="op">)</span>,
                width <span class="op">=</span> <span class="fl">20</span>, height <span class="op">=</span> <span class="fl">20</span>, units <span class="op">=</span> <span class="st">"cm"</span>, dpi <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></code></pre></div>
</div>
<div id="mapas-animados" class="section level3" number="15.10.4">
<h3>
<span class="header-section-number">15.10.4</span> Mapas animados<a class="anchor" aria-label="anchor" href="#mapas-animados"><i class="fas fa-link"></i></a>
</h3>
<p>Podemos montar mapas facetados para mostrar como padr√µes espaciais variam ao longo do tempo, como por exemplo, os limites do Brasil ao longo dos anos (Figura <a href="cap15.html#fig:fig-vetor-brasil-tmap-facted">15.75</a>). Entretanto, essa abordagem possui algumas desvantagens, de modo que as facetas podem ficar muito pequenas quando h√° muitas delas.</p>
<div class="sourceCode" id="cb730"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Dados</span>
<span class="va">geo_vetor_brasil_anos</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1872</span>, <span class="fl">1900</span>, <span class="fl">1911</span>, <span class="fl">1920</span>, <span class="fl">1933</span>, <span class="fl">1940</span>, <span class="fl">1950</span>, <span class="fl">1960</span>, <span class="fl">1970</span>,
           <span class="fl">1980</span>, <span class="fl">1991</span>, <span class="fl">2001</span>, <span class="fl">2010</span>, <span class="fl">2019</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">geo_vetor_brasil_anos</span> <span class="op">&lt;-</span> <span class="fu">geobr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/geobr/man/read_state.html">read_state</a></span><span class="op">(</span>code_state <span class="op">=</span> <span class="st">"all"</span>,
                                               year <span class="op">=</span> <span class="va">i</span>, showProgress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
        <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
        <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="va">i</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">geo_vetor_brasil_anos</span>, <span class="va">.</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Caso o download n√£o funcione ou haja problemas com a importa√ß√£o, disponibilizamos os dados tamb√©m no pacote <code>ecodados</code>.</p>
<div class="sourceCode" id="cb731"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Importar os dados pelo pacote ecodados</span>
<span class="fu">ecodados</span><span class="fu">::</span><span class="va">geo_vetor_brasil_anos</span></code></pre></div>
<div class="sourceCode" id="cb732"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Mudar o modo de exibi√ß√£o do tmap</span>
<span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"plot"</span><span class="op">)</span>

<span class="co">## Mapa facetado</span>
<span class="va">mapa_brasil_tmap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">geo_vetor_brasil_anos</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_polygons</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_facets.html">tm_facets</a></span><span class="op">(</span>by <span class="op">=</span> <span class="st">"year"</span>, nrow <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
<span class="va">mapa_brasil_tmap</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-brasil-tmap-facted"></span>
<img src="livro_files/figure-html/fig-vetor-brasil-tmap-facted-1.png" alt="Mapa vetor facetado dos estados brasileiros ao longo do tempo com o pacote `tmap`." width="100%" height="100%"><p class="caption">
Figura 15.75: Mapa vetor facetado dos estados brasileiros ao longo do tempo com o pacote <code>tmap</code>.
</p>
</div>
<p>Uma solu√ß√£o √© a composi√ß√£o de mapas animados. Apesar de dependerem da publica√ß√£o digital, os mapas animados podem aprimorar relat√≥rios f√≠sicos √† medida que o v√≠nculo a uma p√°gina da web contendo a vers√£o animada torna-se simples. Existem v√°rias maneiras de gerar anima√ß√µes em R, e uma forma √© com o pacote <code>gganimate</code> e <code>ggplot2</code>. Entretanto, aqui veremos a cria√ß√£o de mapas animados com <code>tmap</code>.</p>
<p>Podemos criar mapas animados alterando dois argumentos da fun√ß√£o <code><a href="https://rdrr.io/pkg/tmap/man/tm_facets.html">tm_facets()</a></code>:</p>
<ul>
<li>trocando o <code>by = year</code> por <code>along = year</code>
</li>
<li>indicando o <code>free.coords = FALSE</code>
</li>
</ul>
<p>Por fim, podemos exportar o mapa animado no formato de <code>.gif</code> utilizando a fun√ß√£o <code><a href="https://rdrr.io/pkg/tmap/man/tmap_animation.html">tmap::tmap_animation()</a></code>, indicando a taxa de atualiza√ß√£o com o argumento <code>delay</code> (Figura <a href="cap15.html#fig:fig-vetor-brasil-tmap-animated">15.76</a>). Alguns pacotes extras s√£o requeridos dependendo do sistema operacional utilizado.</p>
<div class="sourceCode" id="cb733"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Mudar o modo de exibi√ß√£o do tmap</span>
<span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"plot"</span><span class="op">)</span>

<span class="co">## Mapa animado</span>
<span class="va">mapa_brasil_tmap_ani</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">geo_vetor_brasil_anos</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_polygons</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_facets.html">tm_facets</a></span><span class="op">(</span>along <span class="op">=</span> <span class="st">"year"</span>, free.coords <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co">## Exportar mapa tmap animado</span>
<span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_animation.html">tmap_animation</a></span><span class="op">(</span>tm <span class="op">=</span> <span class="va">mapa_brasil_tmap_ani</span>, 
                     filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"mapas"</span>,
                                           <span class="st">"srtm_rio_claro_tmap_ani.gif"</span><span class="op">)</span>, 
                     delay <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-brasil-tmap-animated"></span>
<img src="img/cap15_fig75.gif" alt="Mapa vetorial animado mostrando os estados brasileiros ao longo do tempo com o pacote `tmap`." width="100%" height="100%"><p class="caption">
Figura 15.76: Mapa vetorial animado mostrando os estados brasileiros ao longo do tempo com o pacote <code>tmap</code>.
</p>
</div>
</div>
<div id="mapas-interativos" class="section level3" number="15.10.5">
<h3>
<span class="header-section-number">15.10.5</span> Mapas interativos<a class="anchor" aria-label="anchor" href="#mapas-interativos"><i class="fas fa-link"></i></a>
</h3>
<p>Mapas interativos podem assumir muitas formas, sendo que a mais comum e √∫til √© a capacidade de deslocar e ampliar qualquer parte de um conjunto de dados geoespaciais sobreposto em um ‚Äúmapa da web‚Äù. Diversos pacotes nos permitem criar esse tipo de mapa, sendo os mais comuns o <code>tmap</code>, <code>mapview</code> e <code>leaflet</code>.</p>
<div class="alert alert-info">
<p><strong> üìù Importante </strong><br>
Destacamos que esses mapas ir√£o ser compostos numa janela especial de ‚ÄúViewer‚Äù.</p>
</div>
<p><strong>pacote tmap</strong></p>
<p>Um recurso exclusivo do <code>tmap</code> √© sua capacidade de criar mapas est√°ticos e interativos usando o mesmo c√≥digo. Os mapas podem ser visualizados interativamente em qualquer ponto mudando para o modo de visualiza√ß√£o, usando a fun√ß√£o <code>tmap::tmap_mode(mode = "view")</code> (Figura <a href="cap15.html#fig:fig-raster-mapa-tmap-int">15.77</a>).</p>
<div class="sourceCode" id="cb734"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Mudar o modo de exibi√ß√£o do tmap</span>
<span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"view"</span><span class="op">)</span>

<span class="co">## Atribuir novo mapa interativo</span>
<span class="va">mapa_srtm_rio_claro_tmap_int</span> <span class="op">&lt;-</span> <span class="va">mapa_srtm_rio_claro_tmap</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-mapa-tmap-int"></span>
<iframe src="img/cap15_fig76.png" width="100%" height="400px" data-external="1">
</iframe>
<p class="caption">
Figura 15.77: Mapa vetorial interativo com o pacote <code>tmap</code>.
</p>
</div>
<p>Para exportar mapas interativos criados com o pacote <code>tmap</code>, podemos utilizar novamente a fun√ß√£o <code><a href="https://rdrr.io/pkg/tmap/man/tmap_save.html">tmap::tmap_save()</a></code>, indicando a extens√£o como <code>.html</code>.</p>
<div class="sourceCode" id="cb735"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Exportar mapa tmap interativo</span>
<span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_save.html">tmap_save</a></span><span class="op">(</span>tm <span class="op">=</span> <span class="va">mapa_srtm_rio_claro_tmap_int</span>, 
                filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"mapas"</span>, <span class="st">"srtm_rio_claro_tmap_int.html"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><strong>Pacote mapview</strong></p>
<p>O pacote <code>mapview</code> cria rapidamente mapas interativos simples com a fun√ß√£o <code>mapvew::mapview()</code> (Figura <a href="cap15.html#fig:fig-raster-mapa-mapview-int">15.78</a>). Entretanto, outras caracter√≠sticas podem ser mudadas para criar mapas mais elaborados, como pode ser visto atrav√©s do <a href="https://r-spatial.github.io/mapview">site do pacote</a>.</p>
<div class="sourceCode" id="cb736"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Mapa</span>
<span class="va">mapa_srtm_rio_claro_mapview_int</span> <span class="op">&lt;-</span> <span class="fu">mapview</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapView.html">mapview</a></span><span class="op">(</span>
    <span class="va">geo_raster_srtm_rio_claro</span>, col.regions <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-mapa-mapview-int"></span>
<iframe src="img/cap15_fig77.png" width="100%" height="400px" data-external="1">
</iframe>
<p class="caption">
Figura 15.78: Mapa vetorial interativo com o pacote <code>mapview</code>.
</p>
</div>
<p>Para exportar mapas interativos criados com o pacote <code>mapview</code>, podemos utilizar a fun√ß√£o <code>mapivew::mapshot()</code>, indicando a extens√£o como <code>.html</code>.</p>
<div class="sourceCode" id="cb737"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Exportar mapa mapview interativo</span>
<span class="fu">mapview</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapshot.html">mapshot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mapa_srtm_rio_claro_mapview_int</span>, 
                 url <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"mapas"</span>, <span class="st">"srtm_rio_claro_mapview_int.html"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><strong>Pacote leaflet</strong></p>
<p>O <code>leaflet</code> √© um dos pacotes de mapeamento interativo mais utilizados e completos em R. Esse pacote fornece uma interface utilizando a biblioteca JavaScript e muitos argumentos podem ser compreendidos lendo a documenta√ß√£o da <a href="leafletjs.com">biblioteca original</a>.</p>
<p>Mapas interativos usando esse pacote s√£o criados utilizando a fun√ß√£o <code><a href="https://rdrr.io/pkg/leaflet/man/leaflet.html">leaflet::leaflet()</a></code>. O resultado dessa fun√ß√£o √© um objeto da classe leaflet, que pode ser alterado por outras fun√ß√µes deste mesmo pacote, permitindo que v√°rias camadas e configura√ß√µes de controle sejam adicionadas interativamente (Figura <a href="cap15.html#fig:fig-raster-mapa-leaflet-int">15.79</a>).</p>
<p>Mais sobre o pacote <code>leaflet</code> pode ser consultado em seu <a href="https://rstudio.github.io/leaflet/">site</a> e <a href="https://raw.githubusercontent.com/rstudio/cheatsheets/master/leaflet.pdf">CheatSheet</a>.</p>
<div class="sourceCode" id="cb738"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Paleta de cores</span>
<span class="va">pal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/colorNumeric.html">colorNumeric</a></span><span class="op">(</span><span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/getValues.html">values</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro</span><span class="op">)</span><span class="op">)</span>

<span class="co">## Mapa</span>
<span class="va">mapa_srtm_rio_claro_leaflet_int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/leaflet.html">leaflet</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addProviderTiles.html">addProviderTiles</a></span><span class="op">(</span><span class="st">"CartoDB.Positron"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addRasterImage.html">addRasterImage</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro</span>, colors <span class="op">=</span> <span class="va">pal</span>, opacity <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addLegend.html">addLegend</a></span><span class="op">(</span>pal <span class="op">=</span> <span class="va">pal</span>, values <span class="op">=</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/getValues.html">values</a></span><span class="op">(</span><span class="va">geo_raster_srtm_rio_claro</span><span class="op">)</span>, 
              title <span class="op">=</span> <span class="st">"Eleva√ß√£o (m)"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-layers.html">addPolygons</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">geo_vetor_rio_claro</span>, col <span class="op">=</span> <span class="st">"red"</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb739"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_url.html">include_url</a></span><span class="op">(</span><span class="st">"img/cap15_fig78.png"</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-mapa-leaflet-int"></span>
<iframe src="img/cap15_fig78.png" width="100%" height="400px" data-external="1">
</iframe>
<p class="caption">
Figura 15.79: Mapa vetorial interativo com o pacote <code>leaflet</code>.
</p>
</div>
<p>Para exportar mapas interativos criados com o pacote <code>leaflet</code>, podemos utilizar novamente a fun√ß√£o <code>mapivew::mapshot()</code>, indicando a extens√£o como <code>.html</code>.</p>
<div class="sourceCode" id="cb740"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Exportar mapa leaflet interativo</span>
<span class="fu">mapview</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapshot.html">mapshot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mapa_srtm_rio_claro_leaflet_int</span>, 
                 url <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"mapas"</span>, <span class="st">"srtm_rio_claro_leaflet_int.html"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="exemplos-de-aplica√ß√µes-de-an√°lises-geoespaciais-para-dados-ecol√≥gicos" class="section level2" number="15.11">
<h2>
<span class="header-section-number">15.11</span> Exemplos de aplica√ß√µes de an√°lises geoespaciais para dados ecol√≥gicos<a class="anchor" aria-label="anchor" href="#exemplos-de-aplica%C3%A7%C3%B5es-de-an%C3%A1lises-geoespaciais-para-dados-ecol%C3%B3gicos"><i class="fas fa-link"></i></a>
</h2>
<p>Agora que vimos os principais conceitos e aplica√ß√µes do manejo e visualiza√ß√£o de dados geoespaciais, podemos avan√ßar para realizar quatro exemplos de aplica√ß√µes para dados ecol√≥gicos. Para isso, usaremos novamente os dados de comunidades de anf√≠bios da Mata Atl√¢ntica <span class="citation">(<a href="refer%C3%AAncias.html#ref-vancine2018" role="doc-biblioref">Vancine et al. 2018</a>)</span>. Primeiramente, veremos como resumir informa√ß√µes de biodiversidade (n√∫mero de ocorr√™ncias e riqueza) para hex√°gonos. Num segundo momento, veremos como associar dados ambientais a coordenadas de esp√©cies ou comunidades. Depois, como resumir dados de rasters para buffers. Por fim, realizaremos predi√ß√µes espaciais cont√≠nuas de adequabilidade de habitat para uma esp√©cie e do n√∫mero de esp√©cies.</p>
<div id="resumir-informa√ß√µes-de-biodiversidade-para-unidades-espaciais" class="section level3" number="15.11.1">
<h3>
<span class="header-section-number">15.11.1</span> Resumir informa√ß√µes de biodiversidade para unidades espaciais<a class="anchor" aria-label="anchor" href="#resumir-informa%C3%A7%C3%B5es-de-biodiversidade-para-unidades-espaciais"><i class="fas fa-link"></i></a>
</h3>
<p>Resumir informa√ß√µes para unidades espaciais √© um passo muito frequente em an√°lises de Macroecologia, Biogeografia ou Ecologia da Paisagem. Nesta se√ß√£o, contabilizaremos o n√∫mero de ocorr√™ncias e riqueza de anf√≠bios para hex√°gonos na Mata Atl√¢ntica.</p>
<p>Primeiramente, vamos importar e preparar os dados de biodiversidade que usaremos nesses exemplos. Vamos come√ßar importando os locais de amostragens de anf√≠bios na Mata Atl√¢ntica e selecionando apenas as colunas de interesse.</p>
<div class="sourceCode" id="cb741"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Importar locais</span>
<span class="va">geo_anfibios_locais</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span>
    <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"tabelas"</span>, <span class="st">"ATLANTIC_AMPHIBIANS_sites.csv"</span><span class="op">)</span>,
    col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">longitude</span>, <span class="va">latitude</span>, <span class="va">species_number</span><span class="op">)</span></code></pre></div>
<p>Agora vamos importar as esp√©cies das comunidades, selecionando apenas as esp√©cies com nomes v√°lidos e transformando a coluna de indiv√≠duos para 1, para compor posteriormente uma matriz de comunidade de esp√©cies.</p>
<div class="sourceCode" id="cb742"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Importar esp√©cies</span>
<span class="va">geo_anfibios_especies</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span>
    <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"tabelas"</span>, <span class="st">"ATLANTIC_AMPHIBIANS_species.csv"</span><span class="op">)</span>, 
    col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">valid_name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">valid_name</span>, <span class="va">individuals</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">valid_name</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>individuals <span class="op">=</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na</a></span><span class="op">(</span><span class="va">individuals</span>, <span class="fl">1</span><span class="op">)</span>,
                  individuals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">individuals</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Caso o download n√£o funcione ou haja problemas com a importa√ß√£o, disponibilizamos os dados tamb√©m no pacote <code>ecodados</code>.</p>
<div class="sourceCode" id="cb743"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Importar os dados pelo pacote ecodados</span>
<span class="fu">ecodados</span><span class="fu">::</span><span class="va">geo_anfibios_locais</span>
<span class="fu">ecodados</span><span class="fu">::</span><span class="va">geo_anfibios_especies</span></code></pre></div>
<p>Podemos agora juntar a tabela de locais, que possui as coordenadas √† tabela de esp√©cies. Em seguida convertemos essa √∫nica tabela na classe vetor <code>sf</code>.</p>
<div class="sourceCode" id="cb744"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Jun√ß√£o das coordenadas e convers√£o para classe sf</span>
<span class="va">geo_anfibios_especies_locais_vetor</span> <span class="op">&lt;-</span> <span class="va">geo_anfibios_especies</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">geo_anfibios_locais</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">longitude</span>, <span class="va">latitude</span>, .after <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>lon <span class="op">=</span> <span class="va">longitude</span>, lat <span class="op">=</span> <span class="va">latitude</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></code></pre></div>
<p>Agora vamos baixar o limite do Bioma da Mata Atl√¢ntica para o Brasil, converter o GCS para WGS84/Geo e ajustar sua extens√£o para remover as ilhas no Oceano Atl√¢ntico.</p>
<div class="sourceCode" id="cb745"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Download do Bioma da Mata Atl√¢ntica</span>
<span class="va">geo_vetor_mata_atlantica</span> <span class="op">&lt;-</span> <span class="fu">geobr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/geobr/man/read_biomes.html">read_biomes</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">2019</span>, showProgress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">name_biome</span> <span class="op">==</span> <span class="st">"Mata Atl√¢ntica"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html">st_crop</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="op">-</span><span class="fl">55</span>, ymin <span class="op">=</span> <span class="op">-</span><span class="fl">30</span>, xmax <span class="op">=</span> <span class="op">-</span><span class="fl">34</span>, ymax <span class="op">=</span> <span class="op">-</span><span class="fl">5</span><span class="op">)</span></code></pre></div>
<p>Caso o download n√£o funcione ou haja problemas com a importa√ß√£o, disponibilizamos os dados tamb√©m no pacote <code>ecodados</code>.</p>
<div class="sourceCode" id="cb746"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Importar os dados pelo pacote ecodados</span>
<span class="fu">ecodados</span><span class="fu">::</span><span class="va">geo_vetor_mata_atlantica</span></code></pre></div>
<p>Podemos verificar se as coordenadas e o limite do bioma est√£o todos corretos compondo um mapa preliminar, usando o pacote <code>tmap</code> (Figura <a href="cap15.html#fig:fig-vetor-aa-ma">15.80</a>).</p>
<div class="sourceCode" id="cb747"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Mudar o modo de exibi√ß√£o do tmap</span>
<span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"plot"</span><span class="op">)</span>

<span class="co">## Mapa</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">geo_vetor_mata_atlantica</span>, 
         bbox <span class="op">=</span> <span class="va">geo_anfibios_especies_locais_vetor</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_polygons</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">geo_anfibios_especies_locais_vetor</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">.1</span>, col <span class="op">=</span> <span class="st">"forestgreen"</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-aa-ma"></span>
<img src="livro_files/figure-html/fig-vetor-aa-ma-1.png" alt="Mapa dos locais do Atlantic Amphibians e do limite da Mata Atl√¢ntica." width="100%" height="100%"><p class="caption">
Figura 15.80: Mapa dos locais do Atlantic Amphibians e do limite da Mata Atl√¢ntica.
</p>
</div>
<p>Como o limite utilizado para reunir informa√ß√µes das comunidades de anf√≠bios foi o mais abrangente poss√≠vel <span class="citation">(<a href="refer%C3%AAncias.html#ref-muylaert2018" role="doc-biblioref">Muylaert et al. 2018</a>; <a href="refer%C3%AAncias.html#ref-vancine2018" role="doc-biblioref">Vancine et al. 2018</a>)</span>, selecionaremos apenas os locais que caem dentro do limite da Mata Atl√¢ntica que estamos utilizando aqui.</p>
<div class="sourceCode" id="cb748"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Selecionar os locais dentro do limite</span>
<span class="va">geo_anfibios_especies_locais_vetor_mata_atlantica</span> <span class="op">&lt;-</span> <span class="va">geo_anfibios_especies_locais_vetor</span><span class="op">[</span><span class="va">geo_vetor_mata_atlantica</span>, <span class="op">]</span></code></pre></div>
<p>Podemos refazer o mapa mostrando as coordenadas retiradas em vermelho e as que ficaram em verde (Figura <a href="cap15.html#fig:fig-vetor-aa-ma-sel">15.81</a>).</p>
<div class="sourceCode" id="cb749"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Mudar o modo de exibi√ß√£o do tmap</span>
<span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"plot"</span><span class="op">)</span>

<span class="co">## Mapa</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">geo_vetor_mata_atlantica</span>,
         bbox <span class="op">=</span> <span class="va">geo_anfibios_especies_locais_vetor</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_polygons</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">geo_anfibios_especies_locais_vetor</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_bubbles</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">.1</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">geo_anfibios_especies_locais_vetor_mata_atlantica</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_bubbles</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">.1</span>, col <span class="op">=</span> <span class="st">"forestgreen"</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-aa-ma-sel"></span>
<img src="livro_files/figure-html/fig-vetor-aa-ma-sel-1.png" alt="Mapa dos locais do Atlantic Amphibians que caem dentro do limite da Mata Atl√¢ntica." width="100%" height="100%"><p class="caption">
Figura 15.81: Mapa dos locais do Atlantic Amphibians que caem dentro do limite da Mata Atl√¢ntica.
</p>
</div>
<p>O pr√≥ximo passo √© criar um gride de hex√°gonos para o Bioma da Mata Atl√¢ntica. Usaremos a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/st_make_grid.html">sf::st_make_grid()</a></code> que pode criar quadr√≠culas ou hex√°gonos. Esses hex√°gonos ter√£o a √°rea equivalente √† quadr√≠culas de 1¬∫ de tamanho (aproximadamente 10000 km¬≤). Usaremos a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/geos_measures.html">sf::st_area()</a></code> para calcular as √°reas dos hex√°gonos e a fun√ß√£o <code><a href="https://tibble.tidyverse.org/reference/rownames.html">tibble::rowid_to_column()</a></code> para criar uma identifica√ß√£o para cada fei√ß√£o.</p>
<div class="sourceCode" id="cb750"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Mudar o modo de exibi√ß√£o do tmap</span>
<span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"plot"</span><span class="op">)</span>

<span class="co">## Criar hex√°gonos de ~110 km</span>
<span class="va">geo_vetor_mata_atlantica_hex</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_make_grid.html">st_make_grid</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="va">geo_vetor_mata_atlantica</span>, cellsize <span class="op">=</span> <span class="fl">1</span>, square <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>areakm2 <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html">st_area</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">/</span><span class="fl">1e6</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rowid_to_column</a></span><span class="op">(</span><span class="st">"id_hex"</span><span class="op">)</span>

<span class="co">## Selecionar os hex√°gonos dentro do limite da Mata Atl√¢ntica</span>
<span class="va">geo_vetor_mata_atlantica_hex</span> <span class="op">&lt;-</span> <span class="va">geo_vetor_mata_atlantica_hex</span><span class="op">[</span><span class="va">geo_vetor_mata_atlantica</span>, <span class="op">]</span></code></pre></div>
<p>Podemos conferir os hex√°gonos criados fazendo um mapa preliminar (Figura <a href="cap15.html#fig:fig-vetor-aa-ma-sel-hex">15.82</a>).</p>
<div class="sourceCode" id="cb751"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Mudar o modo de exibi√ß√£o do tmap</span>
<span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"plot"</span><span class="op">)</span>

<span class="co">## Mapa</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">geo_vetor_mata_atlantica</span>, 
         bbox <span class="op">=</span> <span class="va">geo_vetor_mata_atlantica_hex</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_polygons</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">geo_vetor_mata_atlantica_hex</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-aa-ma-sel-hex"></span>
<img src="livro_files/figure-html/fig-vetor-aa-ma-sel-hex-1.png" alt="Mapa dos hex√°gonos para o limite da Mata Atl√¢ntica." width="100%" height="100%"><p class="caption">
Figura 15.82: Mapa dos hex√°gonos para o limite da Mata Atl√¢ntica.
</p>
</div>
<p>Podemos ser mais restritos e selecionar apenas os hex√°gonos dentro do limite do Bioma da Mata Atl√¢ntica utilizando o operador <code><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">st_within()</a></code> (Figura <a href="cap15.html#fig:fig-vetor-aa-ma-sel-hex-total">15.83</a>).</p>
<div class="sourceCode" id="cb752"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Selecionar os hex√°gonos totalmente dentro do limite da Mata Atl√¢ntica</span>
<span class="va">geo_vetor_mata_atlantica_hex_total</span> <span class="op">&lt;-</span> <span class="va">geo_vetor_mata_atlantica_hex</span><span class="op">[</span><span class="va">geo_vetor_mata_atlantica</span>, , op <span class="op">=</span> <span class="va">st_within</span><span class="op">]</span></code></pre></div>
<div class="sourceCode" id="cb753"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Mudar o modo de exibi√ß√£o do tmap</span>
<span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"plot"</span><span class="op">)</span>

<span class="co">## Mapa</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">geo_vetor_mata_atlantica</span>, 
         bbox <span class="op">=</span> <span class="va">geo_vetor_mata_atlantica_hex</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_polygons</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">geo_vetor_mata_atlantica_hex_total</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-aa-ma-sel-hex-total"></span>
<img src="livro_files/figure-html/fig-vetor-aa-ma-sel-hex-total-1.png" alt="Mapa dos hex√°gonos totalmente dentro do limite da Mata Atl√¢ntica." width="100%" height="100%"><p class="caption">
Figura 15.83: Mapa dos hex√°gonos totalmente dentro do limite da Mata Atl√¢ntica.
</p>
</div>
<p>Podemos agora associar as esp√©cies aos hex√°gonos fazendo um ‚Äújoin‚Äù espacial, utilizando a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/st_join.html">sf::st_join()</a></code>.</p>
<div class="sourceCode" id="cb754"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Jun√ß√£o espacial dos locais com os hex√°gonos</span>
<span class="va">geo_vetor_mata_atlantica_hex_especies</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html">st_join</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="va">geo_vetor_mata_atlantica_hex</span>, 
    y <span class="op">=</span> <span class="va">geo_anfibios_especies_locais_vetor_mata_atlantica</span>,
    left <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>Por fim, podemos agregar os dados para ter o n√∫mero de ocorr√™ncias e de esp√©cies por hex√°gono.</p>
<div class="sourceCode" id="cb755"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Agregar dados de ocorr√™ncias e n√∫mero de esp√©cies por hex√°gono</span>
<span class="va">geo_vetor_mata_atlantica_hex_especies_oco_riq</span> <span class="op">&lt;-</span> <span class="va">geo_vetor_mata_atlantica_hex_especies</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">id_hex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>ocorrencias <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">valid_name</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">valid_name</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,
                     riqueza <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">valid_name</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Finalmente podemos compor os mapas finais, mostrando os hex√°gonos com cores e valores do n√∫mero de ocorr√™ncias e de esp√©cies (Figura <a href="cap15.html#fig:fig-vetor-aa-ma-sel-hex-oco-riq">15.84</a>).</p>
<div class="sourceCode" id="cb756"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Mudar o modo de exibi√ß√£o do tmap</span>
<span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"plot"</span><span class="op">)</span>

<span class="co">## Mapa de ocorr√™ncias</span>
<span class="va">mapa_oco</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">geo_vetor_mata_atlantica_hex_especies_oco_riq</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_polygons</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Ocorr√™ncia de anf√≠bios"</span>, col <span class="op">=</span> <span class="st">"ocorrencias"</span>, 
                pal <span class="op">=</span> <span class="st">"viridis"</span>, style <span class="op">=</span> <span class="st">"pretty"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_text.html">tm_text</a></span><span class="op">(</span><span class="st">"ocorrencias"</span>, size <span class="op">=</span> <span class="fl">.4</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_grid.html">tm_graticules</a></span><span class="op">(</span>lines <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_compass.html">tm_compass</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>legend.title.size <span class="op">=</span> <span class="fl">2</span>,
              legend.title.fontface <span class="op">=</span> <span class="st">"bold"</span>,
              legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"top"</span><span class="op">)</span><span class="op">)</span>

<span class="co">## Mapa de riqueza</span>
<span class="va">mapa_riq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">geo_vetor_mata_atlantica_hex_especies_oco_riq</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_polygons</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Riqueza de anf√≠bios"</span>, col <span class="op">=</span> <span class="st">"riqueza"</span>, 
                pal <span class="op">=</span> <span class="st">"viridis"</span>, style <span class="op">=</span> <span class="st">"pretty"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_text.html">tm_text</a></span><span class="op">(</span><span class="st">"riqueza"</span>, size <span class="op">=</span> <span class="fl">.4</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_grid.html">tm_graticules</a></span><span class="op">(</span>lines <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_compass.html">tm_compass</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>legend.title.size <span class="op">=</span> <span class="fl">2</span>,
              legend.title.fontface <span class="op">=</span> <span class="st">"bold"</span>,
              legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"top"</span><span class="op">)</span><span class="op">)</span>

<span class="co">## Uni√£o dos mapas</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_arrange.html">tmap_arrange</a></span><span class="op">(</span><span class="va">mapa_oco</span>, <span class="va">mapa_riq</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-aa-ma-sel-hex-oco-riq"></span>
<img src="img/cap15_fig81.png" alt="Mapa com o n√∫mero de ocorr√™ncias e riqueza de anf√≠bios para hex√°gonos no limite da Mata Atl√¢ntica." width="100%" height="100%"><p class="caption">
Figura 15.84: Mapa com o n√∫mero de ocorr√™ncias e riqueza de anf√≠bios para hex√°gonos no limite da Mata Atl√¢ntica.
</p>
</div>
</div>
<div id="extrair-dados-raster-para-pontos" class="section level3" number="15.11.2">
<h3>
<span class="header-section-number">15.11.2</span> Extrair dados raster para pontos<a class="anchor" aria-label="anchor" href="#extrair-dados-raster-para-pontos"><i class="fas fa-link"></i></a>
</h3>
<p>Atribuir informa√ß√µes ambientais a ocorr√™ncias √© um passo fundamental para diversas an√°lises. Nesta se√ß√£o, atribuiremos os valores das vari√°veis bioclim√°ticas aos locais de amostragem de anf√≠bios na Mata Atl√¢ntica.</p>
<p>J√° realizamos o download das vari√°veis bioclim√°ticas na se√ß√£o de raster. Vamos importar novamente esses dados, primeiramente listando as camadas e depois importando com a fun√ß√£o <code>raster:stack()</code>.</p>
<div class="sourceCode" id="cb757"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Listar arquivos</span>
<span class="va">arquivos_raster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">dir</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"raster"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"wc"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">".tif"</span>, <span class="va">.</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co">## Importar rasters</span>
<span class="va">geo_raster_bioclim</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html">stack</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"raster"</span>, <span class="va">arquivos_raster</span><span class="op">)</span><span class="op">)</span>

<span class="co">## Renomear rasters</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">geo_raster_bioclim</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"bio"</span>, <span class="fl">10</span><span class="op">:</span><span class="fl">19</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"bio0"</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Caso o download n√£o funcione ou haja problemas com a importa√ß√£o, disponibilizamos os dados tamb√©m no pacote <code>ecodados</code>.</p>
<div class="sourceCode" id="cb758"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Importar os dados pelo pacote ecodados</span>
<span class="fu">ecodados</span><span class="fu">::</span><span class="va">geo_raster_bioclim</span></code></pre></div>
<p>Da se√ß√£o anterior, j√° temos o objeto com a tabela de coordenadas dos locais de amostragem das comunidades de anf√≠bios. Vamos agora criar um objeto vetorial das coordenadas e em seguida selecionar os locais dentro do limite do bioma da Mata Atl√¢ntica.</p>
<div class="sourceCode" id="cb759"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Importar locais e converter em sf</span>
<span class="va">geo_anfibios_locais_vetor</span> <span class="op">&lt;-</span> <span class="va">geo_anfibios_locais</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>lon <span class="op">=</span> <span class="va">longitude</span>, lat <span class="op">=</span> <span class="va">latitude</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span>
<span class="va">geo_anfibios_locais_vetor</span>
<span class="co">#&gt; Simple feature collection with 1163 features and 4 fields</span>
<span class="co">#&gt; Geometry type: POINT</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: -56.74194 ymin: -33.51083 xmax: -34.79667 ymax: -3.51525</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt; # A tibble: 1,163 √ó 5</span>
<span class="co">#&gt;    id      longitude latitude species_number              geometry</span>
<span class="co">#&gt;  * &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;          &lt;dbl&gt;           &lt;POINT [¬∞]&gt;</span>
<span class="co">#&gt;  1 amp1001     -43.4    -8.68             19     (-43.42194 -8.68)</span>
<span class="co">#&gt;  2 amp1002     -38.9    -3.55             16 (-38.85783 -3.545527)</span>
<span class="co">#&gt;  3 amp1003     -38.9    -3.57             14 (-38.88869 -3.574194)</span>
<span class="co">#&gt;  4 amp1004     -38.9    -3.52             13   (-38.9188 -3.51525)</span>
<span class="co">#&gt;  5 amp1005     -38.9    -4.28             30 (-38.91083 -4.280556)</span>
<span class="co">#&gt;  6 amp1006     -36.4    -9.23             42 (-36.42806 -9.229167)</span>
<span class="co">#&gt;  7 amp1007     -40.9    -3.85             23 (-40.89444 -3.846111)</span>
<span class="co">#&gt;  8 amp1008     -40.9    -3.83             19 (-40.91944 -3.825833)</span>
<span class="co">#&gt;  9 amp1009     -40.9    -3.84             13   (-40.91028 -3.8375)</span>
<span class="co">#&gt; 10 amp1010     -35.2    -6.14              1 (-35.22944 -6.136944)</span>
<span class="co">#&gt; # ‚Ä¶ with 1,153 more rows</span></code></pre></div>
<p>Usaremos agora a fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/extract.html">raster::extract()</a></code> para extrair e associar os valores das vari√°veis bioclim√°ticas para os locais de amostragem.</p>
<div class="sourceCode" id="cb760"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Extrair valores das vari√°veis para os locais</span>
<span class="va">geo_anfibios_locais_vetor_bioclim</span> <span class="op">&lt;-</span> <span class="va">geo_anfibios_locais_vetor</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extract.html">extract</a></span><span class="op">(</span><span class="va">geo_raster_bioclim</span>, <span class="va">.</span>, df <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">ID</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">bio02</span><span class="op">:</span><span class="va">bio09</span>, .after <span class="op">=</span> <span class="va">bio01</span><span class="op">)</span></code></pre></div>
<p>Podemos ver esses dados na Tabela <a href="cap15.html#tab:tab-aa-var">15.14</a>.</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:tab-aa-var">Tabela 15.14: </span>Dados extra√≠dos e atribu√≠dos aos locais
de amostragens de comunidades de anf√≠bios na Mata Atl√¢ntica
</caption>
<thead><tr>
<th style="text-align:left;">
id
</th>
<th style="text-align:right;">
longitude
</th>
<th style="text-align:right;">
latitude
</th>
<th style="text-align:right;">
species_number
</th>
<th style="text-align:right;">
bio01
</th>
<th style="text-align:right;">
bio02
</th>
<th style="text-align:right;">
bio03
</th>
<th style="text-align:right;">
bio04
</th>
<th style="text-align:right;">
bio05
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
amp1001
</td>
<td style="text-align:right;">
-43.42194
</td>
<td style="text-align:right;">
-8.680000
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
24.88622
</td>
<td style="text-align:right;">
12.842188
</td>
<td style="text-align:right;">
76.28720
</td>
<td style="text-align:right;">
84.54608
</td>
<td style="text-align:right;">
33.17875
</td>
</tr>
<tr>
<td style="text-align:left;">
amp1002
</td>
<td style="text-align:right;">
-38.85783
</td>
<td style="text-align:right;">
-3.545527
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
26.43918
</td>
<td style="text-align:right;">
7.802419
</td>
<td style="text-align:right;">
78.70332
</td>
<td style="text-align:right;">
59.72862
</td>
<td style="text-align:right;">
31.37876
</td>
</tr>
<tr>
<td style="text-align:left;">
amp1003
</td>
<td style="text-align:right;">
-38.88869
</td>
<td style="text-align:right;">
-3.574194
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
26.43918
</td>
<td style="text-align:right;">
7.802419
</td>
<td style="text-align:right;">
78.70332
</td>
<td style="text-align:right;">
59.72862
</td>
<td style="text-align:right;">
31.37876
</td>
</tr>
<tr>
<td style="text-align:left;">
amp1004
</td>
<td style="text-align:right;">
-38.91880
</td>
<td style="text-align:right;">
-3.515250
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
26.43918
</td>
<td style="text-align:right;">
7.802419
</td>
<td style="text-align:right;">
78.70332
</td>
<td style="text-align:right;">
59.72862
</td>
<td style="text-align:right;">
31.37876
</td>
</tr>
<tr>
<td style="text-align:left;">
amp1005
</td>
<td style="text-align:right;">
-38.91083
</td>
<td style="text-align:right;">
-4.280556
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
22.52411
</td>
<td style="text-align:right;">
8.434667
</td>
<td style="text-align:right;">
73.76507
</td>
<td style="text-align:right;">
64.62517
</td>
<td style="text-align:right;">
28.08925
</td>
</tr>
<tr>
<td style="text-align:left;">
amp1006
</td>
<td style="text-align:right;">
-36.42806
</td>
<td style="text-align:right;">
-9.229167
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
21.61951
</td>
<td style="text-align:right;">
8.110271
</td>
<td style="text-align:right;">
67.74083
</td>
<td style="text-align:right;">
147.67953
</td>
<td style="text-align:right;">
27.98150
</td>
</tr>
</tbody>
</table></div>
<p>Podemos ainda fazer alguns mapas para espacializar essas vari√°veis (Figura <a href="cap15.html#fig:fig-vetor-aa-var">15.85</a>).</p>
<div class="sourceCode" id="cb761"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Mudar o modo de exibi√ß√£o do tmap</span>
<span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"plot"</span><span class="op">)</span>

<span class="co">## Mapa</span>
<span class="va">geo_anfibios_locais_vetor_bioclim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">bio01</span><span class="op">:</span><span class="va">bio06</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">var</span>, <span class="va">val</span>, <span class="op">-</span><span class="va">geometry</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_bubbles</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">.1</span>, col <span class="op">=</span> <span class="st">"val"</span>, pal <span class="op">=</span> <span class="st">"viridis"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_facets.html">tm_facets</a></span><span class="op">(</span><span class="st">"var"</span>, free.scales <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-aa-var"></span>
<img src="livro_files/figure-html/fig-vetor-aa-var-1.png" alt="Mapa mostrando os valores das vari√°veis bioclim√°ticas (BIO01:BIO06) para os locais amostrados de comunidades de anf√≠bios para hex√°gonos no limite da Mata Atl√¢ntica." width="100%" height="100%"><p class="caption">
Figura 15.85: Mapa mostrando os valores das vari√°veis bioclim√°ticas (BIO01:BIO06) para os locais amostrados de comunidades de anf√≠bios para hex√°gonos no limite da Mata Atl√¢ntica.
</p>
</div>
</div>
<div id="resumir-dados-de-rasters-para-buffers" class="section level3" number="15.11.3">
<h3>
<span class="header-section-number">15.11.3</span> Resumir dados de rasters para buffers<a class="anchor" aria-label="anchor" href="#resumir-dados-de-rasters-para-buffers"><i class="fas fa-link"></i></a>
</h3>
<p>Muitas an√°lises requerem que fa√ßamos um resumo da composi√ß√£o da paisagem para buffers, sendo o buffer uma unidade de an√°lise espacial no entorno de um ponto de amostragem.</p>
<p>Aqui, usaremos os dados do <a href="http://due.esrin.esa.int/page_globcover.php">GlobCover v.2.3</a> de 2009 <span class="citation">(<a href="refer%C3%AAncias.html#ref-arino2012" role="doc-biblioref">Arino et al. 2012</a>)</span> como raster de cobertura da terra. O arquivo √© grande (~400 Mb) e pode demorar muito, dependendo da velocidade da sua internet.</p>
<div class="sourceCode" id="cb762"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Aumentar o tempo de download</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>timeout <span class="op">=</span> <span class="fl">1e5</span><span class="op">)</span>

<span class="co">## Download dos dados do GlobCover</span>
<span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span>url <span class="op">=</span> <span class="st">"http://due.esrin.esa.int/files/Globcover2009_V2.3_Global_.zip"</span>,
              destfile <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"raster"</span>, <span class="st">"Globcover2009_V2.3_Global.zip"</span><span class="op">)</span>, 
              mode <span class="op">=</span> <span class="st">"wb"</span>, extra <span class="op">=</span> <span class="st">"c"</span><span class="op">)</span>

<span class="co">## Unzip</span>
<span class="fu"><a href="https://rdrr.io/r/utils/unzip.html">unzip</a></span><span class="op">(</span>zipfile <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"raster"</span>, <span class="st">"Globcover2009_V2.3_Global.zip"</span><span class="op">)</span>,
      exdir <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"raster"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Depois de fazer o download, vamos importar e ajustar esse raster para o limite da Mata Atl√¢ntica (Figura <a href="cap15.html#fig:fig-raster-globcover">15.86</a>).</p>
<div class="sourceCode" id="cb763"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Importar raster do GlobCover</span>
<span class="va">geo_raster_globcover</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html">raster</a></span><span class="op">(</span>
    <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"dados"</span>, <span class="st">"raster"</span>, <span class="st">"GLOBCOVER_L4_200901_200912_V2.3.tif"</span><span class="op">)</span><span class="op">)</span>

<span class="co">## Ajustar para o limite do bioma da Mata Atl√¢ntica</span>
<span class="va">geo_raster_globcover_mata_atlantica</span> <span class="op">&lt;-</span> <span class="va">geo_raster_globcover</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/crop.html">crop</a></span><span class="op">(</span><span class="va">geo_vetor_mata_atlantica</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/mask.html">mask</a></span><span class="op">(</span><span class="va">geo_vetor_mata_atlantica</span><span class="op">)</span>
<span class="va">geo_raster_globcover_mata_atlantica</span>
<span class="co">#&gt; class      : RasterLayer </span>
<span class="co">#&gt; dimensions : 8940, 7274, 65029560  (nrow, ncol, ncell)</span>
<span class="co">#&gt; resolution : 0.002777778, 0.002777778  (x, y)</span>
<span class="co">#&gt; extent     : -54.99861, -34.79306, -29.98194, -5.148611  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs </span>
<span class="co">#&gt; source     : memory</span>
<span class="co">#&gt; names      : GLOBCOVER_L4_200901_200912_V2.3 </span>
<span class="co">#&gt; values     : 14, 220  (min, max)</span></code></pre></div>
<p>Caso o download n√£o funcione ou haja problemas com a importa√ß√£o, disponibilizamos os dados tamb√©m no pacote <code>ecodados</code>.</p>
<div class="sourceCode" id="cb764"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Importar os dados pelo pacote ecodados</span>
<span class="fu">ecodados</span><span class="fu">::</span><span class="va">geo_raster_globcover_mata_atlantica</span></code></pre></div>
<div class="sourceCode" id="cb765"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">geo_raster_globcover_mata_atlantica</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">200</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-globcover"></span>
<img src="livro_files/figure-html/fig-raster-globcover-1.png" alt="Camada raster do GlobCover 2.3 para o Bioma da Mata Atl√¢ntica." width="100%" height="100%"><p class="caption">
Figura 15.86: Camada raster do GlobCover 2.3 para o Bioma da Mata Atl√¢ntica.
</p>
</div>
<p>Vamos agora transformar a tabela de locais em vetor, selecionar aleatoriamente 50 amostragens das comunidades de anf√≠bios e criar buffers de ~10 km.</p>
<div class="sourceCode" id="cb766"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Fixar a amostragem</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span>

<span class="co">## Pontos</span>
<span class="va">geo_anfibios_especies_locais_vetor_mata_atlantica</span> <span class="op">&lt;-</span> <span class="va">geo_anfibios_locais</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">st_intersects</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.</span>, y <span class="op">=</span> <span class="va">geo_vetor_mata_atlantica</span>, sparse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>

<span class="co">## Buffers de ~1 km</span>
<span class="va">geo_anfibios_especies_locais_vetor_mata_atlantica_buffer10km</span> <span class="op">&lt;-</span>
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_buffer</a></span><span class="op">(</span><span class="va">geo_anfibios_especies_locais_vetor_mata_atlantica</span>,
                  dist <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></code></pre></div>
<p>Podemos conferir no mapa da Figura <a href="cap15.html#fig:fig-vetor-aa-ma-buffer">15.87</a>.</p>
<div class="sourceCode" id="cb767"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Mudar o modo de exibi√ß√£o do tmap</span>
<span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"plot"</span><span class="op">)</span>

<span class="co">## Mapa</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">geo_vetor_mata_atlantica</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_polygons</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">geo_anfibios_especies_locais_vetor_mata_atlantica_buffer10km</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_bubbles</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">.3</span>, border.col <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">geo_anfibios_especies_locais_vetor_mata_atlantica</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">.01</span>, col <span class="op">=</span> <span class="st">"forestgreen"</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-vetor-aa-ma-buffer"></span>
<img src="livro_files/figure-html/fig-vetor-aa-ma-buffer-1.png" alt="Distribui√ß√£o de 50 localidades aleat√≥rios e buffers de ~1 km (fora de escala)." width="100%" height="100%"><p class="caption">
Figura 15.87: Distribui√ß√£o de 50 localidades aleat√≥rios e buffers de ~1 km (fora de escala).
</p>
</div>
<p>Agora podemos utilizar a fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/extract.html">raster::extract()</a></code> para fazer a contabiliza√ß√£o, j√° em porcentagem, de pixels de cada classe para cada buffer.</p>
<div class="sourceCode" id="cb768"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Estat√≠stica zonal </span>
<span class="va">geo_anfibios_locais_vetor_ma_buffer10km_ext</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extract.html">extract</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="va">geo_raster_globcover_mata_atlantica</span>,
    y <span class="op">=</span> <span class="va">geo_anfibios_especies_locais_vetor_mata_atlantica_buffer10km</span>,
    df <span class="op">=</span> <span class="cn">TRUE</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">ID</span>, classe <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">classe</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>classe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"classe_"</span>, <span class="va">classe</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">classe</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="va">id</span>, names_from <span class="op">=</span> <span class="va">classe</span>, values_from <span class="op">=</span> <span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na</a></span><span class="op">(</span><span class="va">.x</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/adorn_totals.html">adorn_totals</a></span><span class="op">(</span><span class="st">"col"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/adorn_percentages.html">adorn_percentages</a></span><span class="op">(</span><span class="st">"row"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/adorn_pct_formatting.html">adorn_pct_formatting</a></span><span class="op">(</span>rounding <span class="op">=</span> <span class="st">"half up"</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/headtail.html">head</a></span><span class="op">(</span><span class="va">geo_anfibios_locais_vetor_ma_buffer10km_ext</span><span class="op">)</span>
<span class="co">#&gt;  id classe_30 classe_40 classe_14 classe_20 classe_130 classe_50 classe_60 classe_190 classe_210 classe_110</span>
<span class="co">#&gt;   1      7.7%     92.3%      0.0%      0.0%       0.0%      0.0%      0.0%       0.0%       0.0%       0.0%</span>
<span class="co">#&gt;   2     21.6%     45.9%     24.3%      8.1%       0.0%      0.0%      0.0%       0.0%       0.0%       0.0%</span>
<span class="co">#&gt;   3     56.3%     12.5%      9.4%     21.9%       0.0%      0.0%      0.0%       0.0%       0.0%       0.0%</span>
<span class="co">#&gt;   4     38.9%     25.0%     27.8%      0.0%       8.3%      0.0%      0.0%       0.0%       0.0%       0.0%</span>
<span class="co">#&gt;   5      0.0%     66.7%      0.0%      8.3%      16.7%      5.6%      2.8%       0.0%       0.0%       0.0%</span>
<span class="co">#&gt;   6     31.4%      2.9%      0.0%     11.4%      37.1%      5.7%      0.0%      11.4%       0.0%       0.0%</span>
<span class="co">#&gt;  classe_200 classe_120  Total</span>
<span class="co">#&gt;        0.0%       0.0% 100.0%</span>
<span class="co">#&gt;        0.0%       0.0% 100.0%</span>
<span class="co">#&gt;        0.0%       0.0% 100.0%</span>
<span class="co">#&gt;        0.0%       0.0% 100.0%</span>
<span class="co">#&gt;        0.0%       0.0% 100.0%</span>
<span class="co">#&gt;        0.0%       0.0% 100.0%</span></code></pre></div>
<p>Agora podemos combinar esses dados aos dados dos buffers.</p>
<div class="sourceCode" id="cb769"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Combina√ß√£o</span>
<span class="va">geo_anfibios_locais_vetor_ma_buffer10km_ext_bind</span>  <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="va">geo_anfibios_especies_locais_vetor_mata_atlantica_buffer10km</span>,
    y <span class="op">=</span> <span class="va">geo_anfibios_locais_vetor_ma_buffer10km_ext</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">geo_anfibios_locais_vetor_ma_buffer10km_ext_bind</span>
<span class="co">#&gt; # A tibble: 50 √ó 15</span>
<span class="co">#&gt;    id     species_number classe_30 classe_40 classe_14 classe_20 classe_130 classe_50 classe_60 classe_190 classe_210</span>
<span class="co">#&gt;  * &lt;chr&gt;           &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;     </span>
<span class="co">#&gt;  1 amp17‚Ä¶             10 7.7%      92.3%     0.0%      0.0%      0.0%       0.0%      0.0%      0.0%       0.0%      </span>
<span class="co">#&gt;  2 amp13‚Ä¶             16 21.6%     45.9%     24.3%     8.1%      0.0%       0.0%      0.0%      0.0%       0.0%      </span>
<span class="co">#&gt;  3 amp11‚Ä¶             19 56.3%     12.5%     9.4%      21.9%     0.0%       0.0%      0.0%      0.0%       0.0%      </span>
<span class="co">#&gt;  4 amp10‚Ä¶             20 38.9%     25.0%     27.8%     0.0%      8.3%       0.0%      0.0%      0.0%       0.0%      </span>
<span class="co">#&gt;  5 amp12‚Ä¶              3 0.0%      66.7%     0.0%      8.3%      16.7%      5.6%      2.8%      0.0%       0.0%      </span>
<span class="co">#&gt;  6 amp11‚Ä¶              9 31.4%     2.9%      0.0%      11.4%     37.1%      5.7%      0.0%      11.4%      0.0%      </span>
<span class="co">#&gt;  7 amp18‚Ä¶             14 0.0%      100.0%    0.0%      0.0%      0.0%       0.0%      0.0%      0.0%       0.0%      </span>
<span class="co">#&gt;  8 amp10‚Ä¶              8 0.0%      23.5%     0.0%      76.5%     0.0%       0.0%      0.0%      0.0%       0.0%      </span>
<span class="co">#&gt;  9 amp11‚Ä¶              5 18.8%     0.0%      62.5%     18.8%     0.0%       0.0%      0.0%      0.0%       0.0%      </span>
<span class="co">#&gt; 10 amp13‚Ä¶              7 37.8%     2.7%      0.0%      24.3%     21.6%      13.5%     0.0%      0.0%       0.0%      </span>
<span class="co">#&gt; # ‚Ä¶ with 40 more rows, and 4 more variables: classe_110 &lt;chr&gt;, classe_200 &lt;chr&gt;, classe_120 &lt;chr&gt;, Total &lt;chr&gt;</span></code></pre></div>
</div>
<div id="predi√ß√µes-espaciais-de-objetos-raster" class="section level3" number="15.11.4">
<h3>
<span class="header-section-number">15.11.4</span> Predi√ß√µes espaciais de objetos raster<a class="anchor" aria-label="anchor" href="#predi%C3%A7%C3%B5es-espaciais-de-objetos-raster"><i class="fas fa-link"></i></a>
</h3>
<p>O pacote <code>raster</code> al√©m de permitir realizar a manipula√ß√£o e visualiza√ß√£o de dados raster no R, tamb√©m permite a extrapola√ß√£o do ajuste de an√°lises, como <code>LMs</code>, <code>GLMs</code>, <code>GAMs</code> dentre outras (Cap√≠tulos <a href="cap7.html#cap7">7</a> e <a href="cap8.html#cap8">8</a>). Aqui, faremos uma pequena demonstra√ß√£o utilizando a fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/predict.html">raster::predict()</a></code>, predizendo o resultado de dois ajustes de GLMs para a presen√ßa/aus√™ncia de uma esp√©cie de anuro e a extrapola√ß√£o do n√∫mero de esp√©cies de anf√≠bios para o Bioma da Mata Atl√¢ntica.</p>
<p>Para ajustar um GLM para dados de presen√ßa/aus√™ncia, podemos usar a tabela j√° criada anteriormente, com as esp√©cies e as coordenadas, e fazer uma jun√ß√£o com a √∫ltima tabela que criamos com os dados bioclim√°ticos.</p>
<div class="sourceCode" id="cb770"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Jun√ß√£o dos dados ambientais aos dados de esp√©cies</span>
<span class="va">geo_anfibios_locais_especies_vetor_bioclim</span> <span class="op">&lt;-</span> <span class="va">geo_anfibios_especies</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="va">geo_anfibios_locais_vetor_bioclim</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></code></pre></div>
<p>Agora, vamos selecionar ocorr√™ncias da esp√©cie <em>Haddadus binotatus</em>, atribuindo <strong>1</strong> quando ela ocorre e <strong>0</strong> quando ela n√£o ocorre. Essa esp√©cie √© relativamente comum na serrapilheira de fragmentos florestais da Mata Atl√¢ntica, e recebe esse nome em homenagem a um grande pesquisador de anf√≠bios da Mata Atl√¢ntica, o <strong>Prof.¬†C√©lio Fernando Baptista Haddad</strong>.</p>
<div class="sourceCode" id="cb771"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Sele√ß√£o da esp√©cie Haddadus binotatus</span>
<span class="va">geo_anfibios_locais_especies_vetor_bioclim_hb</span> <span class="op">&lt;-</span> <span class="va">geo_anfibios_locais_especies_vetor_bioclim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>pa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">valid_name</span> <span class="op">==</span> <span class="st">"Haddadus binotatus"</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>, .after <span class="op">=</span> <span class="va">individuals</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">id</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>Vamos utilizar apenas as vari√°veis n√£o correlacionadas para o √≠ndice de correla√ß√£o de Pearson para r &lt; 0,7 (Cap√≠tulo <a href="cap7.html#cap7">7</a>).</p>
<div class="sourceCode" id="cb772"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Correla√ß√£o entre as vari√°veis</span>
<span class="va">corr</span> <span class="op">&lt;-</span> <span class="va">geo_anfibios_locais_especies_vetor_bioclim_hb</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">bio01</span><span class="op">:</span><span class="va">bio19</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/findCorrelation.html">findCorrelation</a></span><span class="op">(</span><span class="fl">.7</span>, names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co">## Sele√ß√£o das vari√°veis n√£o correlacionadas</span>
<span class="va">geo_anfibios_locais_especies_vetor_bioclim_hb_cor</span> <span class="op">&lt;-</span> <span class="va">geo_anfibios_locais_especies_vetor_bioclim_hb</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">pa</span>, <span class="va">bio01</span><span class="op">:</span><span class="va">bio19</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">corr</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Agora sim, podemos ajustar um modelo simples da presen√ßa e aus√™ncia dessa esp√©cie, utilizando as vari√°veis n√£o correlacionadas, atrav√©s de um GLM para a fam√≠lia binomial. Nosso intuito n√£o analisar se o modelo atende √† todos os pressupostos, e sim exemplificar a predi√ß√£o espacial, para esses detalhes, consulte o Cap√≠tulo <a href="cap8.html#cap8">8</a>.</p>
<div class="sourceCode" id="cb773"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Ajustar um modelo GLM binomial</span>
<span class="va">modelo_pa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">pa</span> <span class="op">~</span> <span class="va">.</span>, 
                 data <span class="op">=</span> <span class="va">geo_anfibios_locais_especies_vetor_bioclim_hb_cor</span>, 
                 family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span><span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Antes de fazermos a predi√ß√£o da distribui√ß√£o potencial da esp√©cie √© fundamental que o objeto raster esteja ajustado para o limite da Mata Atl√¢ntica. Para isso vamos utilizar as fun√ß√µes <code><a href="https://rdrr.io/pkg/raster/man/crop.html">raster::crop()</a></code> e <code><a href="https://rdrr.io/pkg/raster/man/mask.html">raster::mask()</a></code> para fazer esse ajuste (Figura <a href="cap15.html#fig:fig-raster-bio-ajuste">15.88</a>).</p>
<div class="sourceCode" id="cb774"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Ajuste da extens√£o e limite</span>
<span class="va">geo_raster_bioclim_mata_atlantica</span> <span class="op">&lt;-</span> <span class="va">geo_raster_bioclim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/crop.html">crop</a></span><span class="op">(</span><span class="va">geo_vetor_mata_atlantica</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/mask.html">mask</a></span><span class="op">(</span><span class="va">geo_vetor_mata_atlantica</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb775"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Mudar o modo de exibi√ß√£o do tmap</span>
<span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"plot"</span><span class="op">)</span>

<span class="co">## Mapa</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">geo_raster_bioclim_mata_atlantica</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_raster.html">tm_raster</a></span><span class="op">(</span>pal <span class="op">=</span> <span class="st">"viridis"</span>, title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio12"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_facets.html">tm_facets</a></span><span class="op">(</span>free.scales.raster <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-bio-ajuste"></span>
<img src="livro_files/figure-html/fig-raster-bio-ajuste-1.png" alt="Mapa de dois rasters (BIO01 e BIO12) ajustados ao limite da Mata Atl√¢ntica." width="100%" height="100%"><p class="caption">
Figura 15.88: Mapa de dois rasters (BIO01 e BIO12) ajustados ao limite da Mata Atl√¢ntica.
</p>
</div>
<p>Agora podemos fazer a predi√ß√£o desse modelo para todo o Bioma da Mata Atl√¢ntica. Essa fun√ß√£o vai utilizar os coeficientes do modelo ajustado para gerar um raster de predi√ß√£o para todos os pixels da Mata Atl√¢ntica. Vamos usar o argumento <code>type = "response"</code> para que os valores da predi√ß√£o sejam ajustados a 0 a 1.</p>
<div class="alert alert-info">
<p><strong> üìù Importante </strong><br>
Para que a predi√ß√£o funcione, os nomes das camadas raster <code>geo_raster_bioclim_mata_atlantica</code> devem possuir o mesmo nome das colunas das vari√°veis preditoras ajustadas no modelo <code>modelo_pa</code>.</p>
</div>
<div class="sourceCode" id="cb776"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Predi√ß√µes</span>
<span class="va">modelo_pa_pred</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/predict.html">predict</a></span><span class="op">(</span>
    object <span class="op">=</span> <span class="va">geo_raster_bioclim_mata_atlantica</span>, 
    model <span class="op">=</span> <span class="va">modelo_pa</span>,
    type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>
<span class="va">modelo_pa_pred</span>
<span class="co">#&gt; class      : RasterLayer </span>
<span class="co">#&gt; dimensions : 149, 121, 18029  (nrow, ncol, ncell)</span>
<span class="co">#&gt; resolution : 0.1666667, 0.1666667  (x, y)</span>
<span class="co">#&gt; extent     : -55, -34.83333, -30, -5.166667  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs </span>
<span class="co">#&gt; source     : memory</span>
<span class="co">#&gt; names      : layer </span>
<span class="co">#&gt; values     : 1.255833e-12, 0.1983049  (min, max)</span></code></pre></div>
<p>Por fim, no √∫ltimo passo podemos tornar esse modelo bin√°rio, ou seja, apenas com valores 0 ou 1. Para isso vamos adotar arbitrariamente o valor de 0,01 como ponto de corte. A partir desse valor consideraremos os pixels acima como 1 e abaixo como 0.</p>
<div class="sourceCode" id="cb777"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Sele√ß√£o dos pixels de presen√ßa/aus√™ncia potencial</span>
<span class="va">modelo_pa_pred_corte</span> <span class="op">&lt;-</span> <span class="va">modelo_pa_pred</span> <span class="op">&gt;=</span> <span class="fl">.01</span></code></pre></div>
<p>Por fim, vamos produzir dois mapas mostrando os valores das predi√ß√µes, o mapa bin√°rio e as ocorr√™ncias da esp√©cie (Figura <a href="cap15.html#fig:fig-raster-pred-modelo-bin">15.89</a>).</p>
<div class="sourceCode" id="cb778"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Mudar o modo de exibi√ß√£o do tmap</span>
<span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"plot"</span><span class="op">)</span>

<span class="co">## Combinar os dois raster</span>
<span class="va">modelo_pa_pred</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html">stack</a></span><span class="op">(</span><span class="va">modelo_pa_pred</span>, <span class="va">modelo_pa_pred_corte</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">modelo_pa_pred</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Cont√≠nuo"</span>, <span class="st">"Bin√°rio"</span><span class="op">)</span>

<span class="co">## Mapas de predi√ß√£o cont√≠nua e bin√°ria</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">modelo_pa_pred</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_raster.html">tm_raster</a></span><span class="op">(</span>pal <span class="op">=</span> <span class="st">"viridis"</span>, title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Predi√ß√£o"</span>, <span class="st">"Predi√ß√£o"</span><span class="op">)</span>,
              style <span class="op">=</span> <span class="st">"fisher"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_facets.html">tm_facets</a></span><span class="op">(</span>free.scales.raster <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-pred-modelo-bin"></span>
<img src="livro_files/figure-html/fig-raster-pred-modelo-bin-1.png" alt="Mapa da predi√ß√£o cont√≠nua e bin√°ria do modelo ajustado para a presen√ßa/aus√™ncia da esp√©cie *Haddadus binotatus* na Mata Atl√¢ntica e suas ocorr√™ncias." width="100%" height="100%"><p class="caption">
Figura 15.89: Mapa da predi√ß√£o cont√≠nua e bin√°ria do modelo ajustado para a presen√ßa/aus√™ncia da esp√©cie <em>Haddadus binotatus</em> na Mata Atl√¢ntica e suas ocorr√™ncias.
</p>
</div>
<div class="alert alert-info">
<p><strong> üìù Importante </strong><br>
Essa an√°lise foi realizada com o intuito de exemplificar o funcionamento da fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/predict.html">raster::predict()</a></code>, para mais detalhes, consultar livros espec√≠ficos da √°rea de Modelagem de Distribui√ß√£o de Esp√©cies ou Modelagem de Nicho Ecol√≥gico <span class="citation">Fletcher and Fortin (<a href="refer%C3%AAncias.html#ref-fletcher2018" role="doc-biblioref">2018</a>)</span>.</p>
</div>
<p>Em nossa segunda an√°lise, vamos predizer os dados de riqueza para todo o bioma da Mata Atl√¢ntica. Para isso, temos de retirar novamente as vari√°veis correlacionadas.</p>
<div class="sourceCode" id="cb779"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Correla√ß√£o</span>
<span class="va">corr</span> <span class="op">&lt;-</span> <span class="va">geo_anfibios_locais_vetor_bioclim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">bio01</span><span class="op">:</span><span class="va">bio19</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/findCorrelation.html">findCorrelation</a></span><span class="op">(</span><span class="fl">.7</span>, names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co">## Sele√ß√£o das vari√°veis n√£o correlacionadas</span>
<span class="va">geo_anfibios_locais_bioclim_cor</span> <span class="op">&lt;-</span> <span class="va">geo_anfibios_locais_vetor_bioclim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">species_number</span>, <span class="va">bio01</span><span class="op">:</span><span class="va">bio19</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">corr</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Agora sim, podemos criar os GLMs com fam√≠lias de distribui√ß√£o apropriadas para dados de contagem como Poisson e Binomial Negativa. Nosso intuito n√£o analisar se o modelo atende √† todos os pressupostos, e sim exemplificar a predi√ß√£o espacial, para esses detalhes, consulte o Cap√≠tulo <a href="cap8.html#cap8">8</a>.</p>
<div class="sourceCode" id="cb780"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Modelo Poisson</span>
<span class="va">modelo_riq_pois</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span>
    formula <span class="op">=</span> <span class="va">species_number</span> <span class="op">~</span> <span class="va">.</span>, 
    data <span class="op">=</span> <span class="va">geo_anfibios_locais_bioclim_cor</span>, 
    family <span class="op">=</span> <span class="va">poisson</span><span class="op">)</span>

<span class="co">## Modelo Binomial Negativo</span>
<span class="va">modelo_riq_nb</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/glm.nb.html">glm.nb</a></span><span class="op">(</span>
    formula <span class="op">=</span> <span class="va">species_number</span> <span class="op">~</span> <span class="va">.</span>,
    data <span class="op">=</span> <span class="va">geo_anfibios_locais_bioclim_cor</span><span class="op">)</span></code></pre></div>
<p>Com os modelos ajustados, podemos fazer as predi√ß√µes utilizando os objetos raster com as vari√°veis ambientais.</p>
<div class="sourceCode" id="cb781"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Predi√ß√£o do modelo Poisson</span>
<span class="va">modelo_riq_pois_pred</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/predict.html">predict</a></span><span class="op">(</span>
    object <span class="op">=</span> <span class="va">geo_raster_bioclim_mata_atlantica</span>,
    model <span class="op">=</span> <span class="va">modelo_riq_pois</span>,
    type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>
<span class="va">modelo_riq_pois_pred</span>
<span class="co">#&gt; class      : RasterLayer </span>
<span class="co">#&gt; dimensions : 149, 121, 18029  (nrow, ncol, ncell)</span>
<span class="co">#&gt; resolution : 0.1666667, 0.1666667  (x, y)</span>
<span class="co">#&gt; extent     : -55, -34.83333, -30, -5.166667  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs </span>
<span class="co">#&gt; source     : memory</span>
<span class="co">#&gt; names      : layer </span>
<span class="co">#&gt; values     : 8.249131, 24.76082  (min, max)</span>

<span class="co">## Predi√ß√£o do modelo Binomial Negativo</span>
<span class="va">modelo_riq_nb_pred</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/predict.html">predict</a></span><span class="op">(</span>
    object <span class="op">=</span> <span class="va">geo_raster_bioclim_mata_atlantica</span>,
    model <span class="op">=</span> <span class="va">modelo_riq_nb</span>,
    type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>
<span class="va">modelo_riq_nb_pred</span>
<span class="co">#&gt; class      : RasterLayer </span>
<span class="co">#&gt; dimensions : 149, 121, 18029  (nrow, ncol, ncell)</span>
<span class="co">#&gt; resolution : 0.1666667, 0.1666667  (x, y)</span>
<span class="co">#&gt; extent     : -55, -34.83333, -30, -5.166667  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs </span>
<span class="co">#&gt; source     : memory</span>
<span class="co">#&gt; names      : layer </span>
<span class="co">#&gt; values     : 9.262095, 24.45297  (min, max)</span></code></pre></div>
<p>Por fim, podemos compor os dois mapas de predi√ß√µes (Figura <a href="cap15.html#fig:fig-raster-pred-modelo-riq">15.90</a>).</p>
<div class="sourceCode" id="cb782"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Mudar o modo de exibi√ß√£o do tmap</span>
<span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"plot"</span><span class="op">)</span>

<span class="co">## Combinar os dois raster</span>
<span class="va">modelo_riq_pred</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html">stack</a></span><span class="op">(</span><span class="va">modelo_riq_pois_pred</span>, <span class="va">modelo_riq_nb_pred</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">modelo_riq_pred</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Poisson"</span>, <span class="st">"Binomial Negativa"</span><span class="op">)</span>

<span class="co">## Mapas da predi√ß√£o Poisson e Binomial Negativa</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">modelo_riq_pred</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_raster.html">tm_raster</a></span><span class="op">(</span>pal <span class="op">=</span> <span class="st">"viridis"</span>, title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"N√∫mero de esp√©cies"</span>, <span class="st">"N√∫mero de esp√©cies"</span><span class="op">)</span>,
              style <span class="op">=</span> <span class="st">"fisher"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_facets.html">tm_facets</a></span><span class="op">(</span>free.scales.raster <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-raster-pred-modelo-riq"></span>
<img src="livro_files/figure-html/fig-raster-pred-modelo-riq-1.png" alt="Mapa da predi√ß√£o de riqueza utilizando o modelo Poisson e Binomial Negativa para a Mata Atl√¢ntica." width="100%" height="100%"><p class="caption">
Figura 15.90: Mapa da predi√ß√£o de riqueza utilizando o modelo Poisson e Binomial Negativa para a Mata Atl√¢ntica.
</p>
</div>
<div class="alert alert-info">
<p><strong> üìù Importante </strong><br>
Essa an√°lise foi realizada com o intuito de exemplificar o funcionamento da fun√ß√£o <code><a href="https://rdrr.io/pkg/raster/man/predict.html">raster::predict()</a></code>, para mais detalhes, consultar livros espec√≠ficos da √°rea de Ecologia Espacial <span class="citation">(<a href="refer%C3%AAncias.html#ref-fletcher2018" role="doc-biblioref">Fletcher and Fortin 2018</a>)</span>.</p>
</div>
</div>
</div>
<div id="para-se-aprofundar-11" class="section level2" number="15.12">
<h2>
<span class="header-section-number">15.12</span> Para se aprofundar<a class="anchor" aria-label="anchor" href="#para-se-aprofundar-11"><i class="fas fa-link"></i></a>
</h2>
<div id="livros-10" class="section level3" number="15.12.1">
<h3>
<span class="header-section-number">15.12.1</span> Livros<a class="anchor" aria-label="anchor" href="#livros-10"><i class="fas fa-link"></i></a>
</h3>
<p>Listamos aqui as principais refer√™ncias sobre manipula√ß√£o, visualiza√ß√£o de dados geoespaciais e an√°lises geoespaciais no R. Recomendamos aos interessados os livros: i) Lovelace, Nowosad &amp; Muenchow <span class="citation">(<a href="refer%C3%AAncias.html#ref-lovelace2019" role="doc-biblioref">2019</a>)</span> <a href="https://geocompr.robinlovelace.net/">Geocomputation with R</a>, ii) Mas et al. <span class="citation">(<a href="refer%C3%AAncias.html#ref-mas2019" role="doc-biblioref">2019</a>)</span> <a href="https://bit.ly/2KpSI7C">An√°lise espacial com R</a>, iii) Olaya <span class="citation">(<a href="refer%C3%AAncias.html#ref-olaya2020" role="doc-biblioref">2020</a>)</span> <a href="http://volaya.github.io/libro-sig/">Sistemas de Informaci√≥n Geogr√°fica</a>, iv) Moraga <span class="citation">(<a href="refer%C3%AAncias.html#ref-moraga_geospatial_2019" role="doc-biblioref">2019</a>)</span> <a href="https://www.paulamoraga.com/book-geospatial/">Geospatial Health Data: Modeling and Visualization with R-INLA and Shiny</a>, v) Brunsdon &amp; Comber <span class="citation">(<a href="refer%C3%AAncias.html#ref-brunsdon_introduction_2015" role="doc-biblioref">2015</a>)</span> <a href="https://bookdown.org/lexcomber/brunsdoncomber2e/">An Introduction to Spatial Analysis and Mapping in R</a>, vi) Wegmann, Leutner &amp; Dech <span class="citation">(<a href="refer%C3%AAncias.html#ref-wegmann2016" role="doc-biblioref">2016</a>)</span> Remote Sensing and GIS for Ecologists: Using Open Source Software, vii) Wegmann, Schwalb-Willmann &amp; Dech <span class="citation">(<a href="refer%C3%AAncias.html#ref-wegmann2020" role="doc-biblioref">2020</a>)</span> An Introduction to Spatial Data Analysis Remote Sensing and GIS with Open Source Software, viii) Fletcher &amp; Fortin <span class="citation">(<a href="refer%C3%AAncias.html#ref-fletcher2018" role="doc-biblioref">2018</a>)</span> Spatial ecology and conservation modeling: Applications with R, ix) Lapaine, Miljenko, Usery, E. Lynn <span class="citation">(<a href="refer%C3%AAncias.html#ref-lapaine2017" role="doc-biblioref">2017</a>)</span> Choosing a Map Projection.</p>
</div>
<div id="links-10" class="section level3" number="15.12.2">
<h3>
<span class="header-section-number">15.12.2</span> Links<a class="anchor" aria-label="anchor" href="#links-10"><i class="fas fa-link"></i></a>
</h3>
<p><a href="https://github.com/sacridini/Awesome-Geospatial#r">Awesome Geospatial</a></p>
<p><a href="https://keen-swartz-3146c4.netlify.app/">Spatial Data Science</a></p>
<p><a href="https://mgimond.github.io/Spatial/index.html">Intro to GIS and Spatial Analysis</a></p>
<p><a href="https://geobgu.xyz/r/">Introduction to Spatial Data Programming with R</a></p>
<p><a href="https://sdesabbata.github.io/r-for-geographic-data-science">R for Geographic Data Science</a></p>
<p><a href="https://rspatial.org/#">Spatial Data Science with R</a></p>
<p><a href="https://gdsl-ul.github.io/san/">Spatial Modelling for Data Scientists</a></p>
<p><a href="https://soilmapper.org/">Predictive Soil Mapping with R</a></p>
</div>
</div>
<div id="exerc√≠cios-11" class="section level2" number="15.13">
<h2>
<span class="header-section-number">15.13</span> Exerc√≠cios<a class="anchor" aria-label="anchor" href="#exerc%C3%ADcios-11"><i class="fas fa-link"></i></a>
</h2>
<p><strong>15.1</strong>
Importe o limite dos estados brasileiros no formato <code>sf</code> com o nome <code>br</code>. Para isso, use a fun√ß√£o <code>ne_states</code> do pacote <code>rnaturalearth</code>. Crie um mapa simples cinza utilizando a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/plot.html">plot()</a></code>, selecionando a coluna <code>geometry</code> com o operador <code>$</code> e com os argumentos <code>axes</code> e <code>graticule</code> verdadeiros.</p>
<p><strong>15.2</strong>
Dados vetoriais podem ser criados com diversos erros de topologia, e.g., sobreposi√ß√£o de linhas ou pol√≠gonos ou buracos. Algumas fun√ß√µes exigem que os objetos vetoriais aos quais s√£o atribu√≠dos esses dados n√£o possuam esses erros para que o algoritmo funcione. Para verificar se h√° erros, podemos usar a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/valid.html">st_is_valid()</a></code> do pacote <code>sf</code>. H√° diversas forma de corre√ß√µes desses erros, mas vamos usar uma corre√ß√£o simples do R, com a fun√ß√£o <code><a href="https://r-spatial.github.io/sf/reference/valid.html">st_make_valid()</a></code>. Vamos fazer essa corre√ß√£o para o <code>br</code> importado anteriormente e atribuindo ao objeto <code>br_valid</code>. Podemos conferir para saber se h√° erros e fazer um plot.</p>
<p><strong>15.3</strong>
Crie um objeto RasterLayer vazio chamado <code>ra</code> com resolu√ß√£o de 5¬∫ (~600 km). Atribua um sistema de refer√™ncia de coordenadas com o c√≥digo <code>4326</code>. Atribua valores aleat√≥rios de uma distribui√ß√£o normal e plote o mesmo.</p>
<p><strong>15.4</strong>
Reprojete o limite dos estados brasileiros do exerc√≠cio anterior para o CRS SIRGAS 2000/Brazil Polyconic, utilizando o c√≥digo EPSG:5880 e chamando de <code>br_poly</code>. Fa√ßa um mapa simples como no exerc√≠cio 1. Atente para as curvaturas das linhas.</p>
<p><strong>15.5</strong>
Utilizando a fun√ß√£o <code>st_centroid</code> do pacote <code>sf</code>, crie um vetor chamado <code>br_valid_cen</code> que armazenar√° o centroide de cada estado brasileiro do objeto <code>br_valid</code> do exerc√≠cio 2 e plot o resultado.</p>
<p><strong>15.6</strong>
Ajuste o limite e m√°scara do objeto raster criado no exerc√≠cio 3 para o limite do Brasil, atribuindo ao objeto <code>ra_br</code>. Depois reprojete esse raster para a mesma proje√ß√£o utilizada no exerc√≠cio 4 com o nome <code>ra_br_poly</code> e plote o mapa resultante.</p>
<p><strong>15.7</strong>
Extraia os valores de cada pixel do raster criado no exerc√≠cio 6 para os centroides dos estados do Brasil criado no exerc√≠cio 5, atribuindo √† coluna <code>val</code> do objeto espacial chamado <code>br_valid_poly_cent_ra</code>.</p>
<p><strong>15.8</strong>
Crie um mapa final usando os resultados dos exerc√≠cios 4, 5 e 6. Utilize o pacote <code>tmap</code> e inclua todos os principais elementos de um mapa.</p>
<p><a href="https://exercicios-livro-aer.netlify.app/cap.-15---dados-geoespaciais.html">Solu√ß√µes dos exerc√≠cios</a>.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="cap14.html"><span class="header-section-number">14</span> Diversidade Funcional</a></div>
<div class="next"><a href="gloss%C3%A1rio.html">Gloss√°rio</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="Neste cap√≠tulo"><h2>Nesta p√°gina</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#cap15"><span class="header-section-number">15</span> Dados geoespaciais</a></li>
<li><a class="nav-link" href="#pr%C3%A9-requisitos-do-cap%C3%ADtulo-11">Pr√©-requisitos do cap√≠tulo</a></li>
<li><a class="nav-link" href="#contextualiza%C3%A7%C3%A3o-3"><span class="header-section-number">15.1</span> Contextualiza√ß√£o</a></li>
<li>
<a class="nav-link" href="#vetor"><span class="header-section-number">15.2</span> Vetor</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#sf-principal-pacote-no-r-para-dados-vetoriais"><span class="header-section-number">15.2.1</span> sf: principal pacote no R para dados vetoriais</a></li></ul>
</li>
<li>
<a class="nav-link" href="#raster"><span class="header-section-number">15.3</span> Raster</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#raster-principal-pacote-no-r-para-dados-raster"><span class="header-section-number">15.3.1</span> raster: principal pacote no R para dados raster</a></li></ul>
</li>
<li>
<a class="nav-link" href="#sistema-de-refer%C3%AAncia-de-coordenadas-e-unidades"><span class="header-section-number">15.4</span> Sistema de Refer√™ncia de Coordenadas e Unidades</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#sistema-de-coordenadas-geogr%C3%A1ficas"><span class="header-section-number">15.4.1</span> Sistema de Coordenadas Geogr√°ficas</a></li>
<li><a class="nav-link" href="#sistema-de-coordenadas-projetadas"><span class="header-section-number">15.4.2</span> Sistema de Coordenadas Projetadas</a></li>
<li><a class="nav-link" href="#datum"><span class="header-section-number">15.4.3</span> Datum</a></li>
<li><a class="nav-link" href="#sistema-de-refer%C3%AAncia-de-coordenadas-crs-no-r"><span class="header-section-number">15.4.4</span> Sistema de Refer√™ncia de Coordenadas (CRS) no R</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#principais-fontes-de-dados-geoespaciais"><span class="header-section-number">15.5</span> Principais fontes de dados geoespaciais</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#vetor-1"><span class="header-section-number">15.5.1</span> Vetor</a></li>
<li><a class="nav-link" href="#raster-1"><span class="header-section-number">15.5.2</span> Raster</a></li>
<li><a class="nav-link" href="#pacotes-do-r"><span class="header-section-number">15.5.3</span> Pacotes do R</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#importar-e-exportar-dados-geoespaciais"><span class="header-section-number">15.6</span> Importar e exportar dados geoespaciais</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#principais-formatos-de-arquivos-geoespaciais"><span class="header-section-number">15.6.1</span> Principais formatos de arquivos geoespaciais</a></li>
<li><a class="nav-link" href="#importar-dados-1"><span class="header-section-number">15.6.2</span> Importar dados</a></li>
<li><a class="nav-link" href="#exportar-dados-1"><span class="header-section-number">15.6.3</span> Exportar dados</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#descri%C3%A7%C3%A3o-de-objetos-geoespaciais"><span class="header-section-number">15.7</span> Descri√ß√£o de objetos geoespaciais</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#vetor-2"><span class="header-section-number">15.7.1</span> Vetor</a></li>
<li><a class="nav-link" href="#raster-2"><span class="header-section-number">15.7.2</span> Raster</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#reproje%C3%A7%C3%A3o-de-dados-geoespaciais"><span class="header-section-number">15.8</span> Reproje√ß√£o de dados geoespaciais</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#vetor-3"><span class="header-section-number">15.8.1</span> Vetor</a></li>
<li><a class="nav-link" href="#raster-3"><span class="header-section-number">15.8.2</span> Raster</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#principais-opera%C3%A7%C3%B5es-com-dados-geoespaciais"><span class="header-section-number">15.9</span> Principais opera√ß√µes com dados geoespaciais</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#opera%C3%A7%C3%B5es-de-atributos"><span class="header-section-number">15.9.1</span> Opera√ß√µes de atributos</a></li>
<li><a class="nav-link" href="#opera%C3%A7%C3%B5es-espaciais"><span class="header-section-number">15.9.2</span> Opera√ß√µes espaciais</a></li>
<li><a class="nav-link" href="#opera%C3%A7%C3%B5es-geom%C3%A9tricas"><span class="header-section-number">15.9.3</span> Opera√ß√µes geom√©tricas</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#visualiza%C3%A7%C3%A3o-de-dados-geoespaciais"><span class="header-section-number">15.10</span> Visualiza√ß√£o de dados geoespaciais</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#principais-elementos-de-um-mapa"><span class="header-section-number">15.10.1</span> Principais elementos de um mapa</a></li>
<li><a class="nav-link" href="#principais-pacotes-para-a-composi%C3%A7%C3%A3o-de-mapas"><span class="header-section-number">15.10.2</span> Principais pacotes para a composi√ß√£o de mapas</a></li>
<li><a class="nav-link" href="#mapas-est%C3%A1ticos"><span class="header-section-number">15.10.3</span> Mapas est√°ticos</a></li>
<li><a class="nav-link" href="#mapas-animados"><span class="header-section-number">15.10.4</span> Mapas animados</a></li>
<li><a class="nav-link" href="#mapas-interativos"><span class="header-section-number">15.10.5</span> Mapas interativos</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#exemplos-de-aplica%C3%A7%C3%B5es-de-an%C3%A1lises-geoespaciais-para-dados-ecol%C3%B3gicos"><span class="header-section-number">15.11</span> Exemplos de aplica√ß√µes de an√°lises geoespaciais para dados ecol√≥gicos</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#resumir-informa%C3%A7%C3%B5es-de-biodiversidade-para-unidades-espaciais"><span class="header-section-number">15.11.1</span> Resumir informa√ß√µes de biodiversidade para unidades espaciais</a></li>
<li><a class="nav-link" href="#extrair-dados-raster-para-pontos"><span class="header-section-number">15.11.2</span> Extrair dados raster para pontos</a></li>
<li><a class="nav-link" href="#resumir-dados-de-rasters-para-buffers"><span class="header-section-number">15.11.3</span> Resumir dados de rasters para buffers</a></li>
<li><a class="nav-link" href="#predi%C3%A7%C3%B5es-espaciais-de-objetos-raster"><span class="header-section-number">15.11.4</span> Predi√ß√µes espaciais de objetos raster</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#para-se-aprofundar-11"><span class="header-section-number">15.12</span> Para se aprofundar</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#livros-10"><span class="header-section-number">15.12.1</span> Livros</a></li>
<li><a class="nav-link" href="#links-10"><span class="header-section-number">15.12.2</span> Links</a></li>
</ul>
</li>
<li><a class="nav-link" href="#exerc%C3%ADcios-11"><span class="header-section-number">15.13</span> Exerc√≠cios</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/paternogbc/livro_aer/blob/master/15_geoespacial.Rmd">Ver fonte <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/paternogbc/livro_aer/edit/master/15_geoespacial.Rmd">Edite esta p√°gina <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>An√°lises Ecol√≥gicas no R</strong>" foi escrito por Fernando Rodrigues da Silva, Thiago Gon√ßalves-Souza, Gustavo Brant Paterno, <br> Diogo Borges Provete, Maur√≠cio Humberto Vancine. √öltima atualiza√ß√£o: 2022-02-27.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
        <p>Este livro foi compilado com o pacote <a class="text-light" href="https://bookdown.org">bookdown</a>.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
