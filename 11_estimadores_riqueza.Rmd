# Estimadores de riqueza {#cap11}

## Pr√©-requisitos do cap√≠tulo {-}

Pacotes e dados que ser√£o utilizados nesse cap√≠tulo.

```{r}
## Pacotes
library(iNEXT)
library(devtools)
library(ecodados)
library(ggplot2)
library(vegan)
library(nlme)
library(dplyr)
library(piecewiseSEM)

## Dados
dados_coleta <- poca_anuros
data(mite)
data(mite.xy)
coord <- mite.xy
colnames(coord) <- c("long", "lat") # altera o nome das colunas
data(mite.env)
agua <- mite.env[, 2] # seleciona a vari√°vel de interesse
```

## Aspectos te√≥ricos

Uma vez que determinar o n√∫mero total de esp√©cies numa √°rea √© praticamente imposs√≠vel, principalmente em regi√µes com alta riqueza de esp√©cies, os estimadores s√£o √∫teis para extrapolar a riqueza observada e tentar estimar a riqueza total atrav√©s de uma amostra incompleta de uma comunidade biol√≥gica [@walther2005]. Neste cap√≠tulo, ser√£o considerados os estimadores n√£o param√©tricos que usam informa√ß√µes da frequ√™ncia de esp√©cies raras na comunidade [@gotelli2013]. Isto porque tanto os testes param√©tricos que tentam determinar os par√¢metros de uma curva usando o formato da curva de acumula√ß√£o de esp√©cies (e.g. equa√ß√£o log√≠stica, Michaelis-Menten), quanto os testes que usam a frequ√™ncia do n√∫mero de indiv√≠duos para enquadr√°-las em uma das distribui√ß√µes de abund√¢ncia das esp√©cies (e.g. distribui√ß√µes log-s√©ries, log-normal) n√£o funcionam muito bem com dados emp√≠ricos [@gotelli2013]. Para mais detalhes sobre os testes param√©tricos veja Magurran & McGill [-@magurran_biological_2011] e  Colwell & Coddington [-@colwell1994].

Para que estimador de riqueza seja considera bom, ele precisa atender a quatro caracter√≠sticas  [@chazdon1998; @hortal2006].

1. Independ√™ncia do tamanho da amostra (quantidade de esfor√ßo amostral realizado)
1. Insensibilidade a diferentes padr√µes de distribui√ß√µes (e.g. agrupado, disperso ou aleat√≥rio)
1. Insensibilidade em rela√ß√£o √† ordem das amostragens
1. Insensibilidade √† heterogeneidade entre as amostras usadas entre os estudos

## Estimadores baseados na abund√¢ncia das esp√©cies

### CHAO 1

Estimador simples do n√∫mero absoluto de esp√©cies em uma comunidade. √â baseado no n√∫mero de esp√©cies raras dentro de uma amostra [@chao1984; @chao1987].

$$Chao_{1} = S_{obs} + \left(\frac{n-1}{n}\right)\frac{F_1(F_1-1)}{2(F_2+1)}$$

onde:

- S~obs~ = n√∫mero de esp√©cies observadas na comunidade
- *n* = n√∫mero de amostras
- F~1~ = n√∫mero de esp√©cies observadas com abund√¢ncia de um indiv√≠duo (esp√©cies *singleton*)
- F~2~ = n√∫mero de esp√©cies observadas com abund√¢ncia de dois indiv√≠duos (esp√©cies *doubletons*)

O valor de Chao 1 √© m√°ximo quando todas as esp√©cies menos uma s√£o √∫nicas (*singleton*). Neste caso, a riqueza estimada √© aproximadamente o dobro da riqueza observada.

**Exemplo pr√°tico**

**Explica√ß√£o dos dados**

Usaremos os dados hipot√©ticos de 17 esp√©cies de anuros amostradas em 14 dias de coletas de campo em um habitat reprodutivo localizado na regi√£o noroeste do estado de S√£o Paulo, Brasil.

**Pergunta**

- Quantas esp√©cies a mais poderiam ser amostradas caso aument√°ssemos o esfor√ßo amostral at√© o infinito?

**Predi√ß√µes**

- O n√∫mero de esp√©cies estimadas √© similar ao n√∫mero de esp√©cies observadas
- O n√∫mero de esp√©cies estimadas √© maior do que o n√∫mero de esp√©cies observadas

**Vari√°veis**

-   Vari√°veis resposta e preditora

-   data frame com as abund√¢ncias das esp√©cies de anuros (vari√°vel resposta) registradas em 14 dias de amostragens (vari√°vel preditora) em um habitat reprodutivo

**Checklist**

-   Verificar se a sua matriz est√° com as esp√©cies nas colunas e as amostragens nas linhas 
-   Verificar se os dados s√£o de abund√¢ncia e n√£o de incid√™ncia (presen√ßa e aus√™ncia)

**An√°lise**

Vamos olhar os dados.

```{r}
## Cabe√ßalho
head(poca_anuros)
```

C√°lculo do estimador de riqueza - Chao 1.

```{r}
## An√°lise
est_chao1 <- estaccumR(dados_coleta, permutations = 100)
summary(est_chao1, display = "chao")
```

Percebam que a fun√ß√£o retorna: N = n√∫mero de amostragens, Chao = valor m√©dio da estimativa do √≠ndice de Chao, 2.5% e 97.5% = intervalo de confian√ßa de 95%, e Std.Dev = desvio padr√£o. Essas dados s√£o obtidos usando permuta√ß√µes, sem reposi√ß√£o, que alteram a ordem das amostragens. Neste exemplo, usamos 100 permuta√ß√µes.

Vamos visualizar os resultados com intervalo de confian√ßa de 95% (Figura \@ref(fig:fig-chao1)).

```{r fig-chao1, fig.cap="Resultados com intervalo de confian√ßa de 95% para o estimador Chao 1."}
## Preparando os dados para fazer o gr√°fico
resultados <- summary(est_chao1, display = c("S", "chao"))
res_chao <- cbind(resultados$chao[, 1:4], resultados$S[, 2:4])
res_chao <- as.data.frame(res_chao)
colnames(res_chao) <- c("Amostras", "Chao", "C_inferior", "C_superior", 
                        "Riqueza", "R_inferior", "R_superior")

## Gr√°fico
ggplot(res_chao, aes(y = Riqueza, x = Amostras)) +
    geom_point(aes(y = Chao, x = Amostras + 0.1), size = 4, 
               color = "darkorange", alpha = 0.7) +
    geom_point(aes(y = Riqueza, x = Amostras), size = 4, 
               color = "cyan4", alpha = 0.7) +
    geom_point(y = 7.5, x = 9, size = 4, color = "darkorange", alpha = 0.7) + 
    geom_point(y = 5.9, x = 9, size = 4, color = "cyan4", alpha = 0.7) + 
    geom_label(y = 7.5, x = 12, label = "Riqueza estimada - Chao 1") +
    geom_label(y = 5.9, x = 11.3, label = "Riqueza observada") + 
    geom_line(aes(y = Chao, x = Amostras), color = "darkorange") +
    geom_line(aes(y = Riqueza, x = Amostras), color = "cyan4") +
    geom_linerange(aes(ymin = C_inferior, ymax = C_superior,
                       x = Amostras + 0.1), color = "darkorange") +
    geom_linerange(aes(ymin = R_inferior, ymax = R_superior,
                       x = Amostras), color = "cyan4") +
    scale_x_continuous(limits = c(1, 15), breaks = seq(1, 15, 1)) +
    labs (x = "N√∫mero de amostras", y = "Riqueza estimada - Chao 1") +
    tema_livro()
```

**Interpreta√ß√£o dos resultados**

Com base no n√∫mero de esp√©cies raras (*singletons* e *doubletons*), o estimador Chao 1 indicou a possibilidade de encontrarmos mais tr√™s esp√©cies, caso o esfor√ßo amostral fosse maior e n√£o estima tend√™ncia de estabiliza√ß√£o da curva em uma ass√≠ntota.

### ACE - *Abundance-based Coverage Estimator*

Este m√©todo trabalha com a abund√¢ncia das esp√©cies raras (i.e. abund√¢ncia baixa) [@chao1992; @chao2000]. Entretanto, diferente do estimador anterior, esse m√©todo permite ao pesquisador determinar os limites para os quais uma esp√©cie seja considerada rara. Em geral, s√£o consideradas raras esp√©cies com abund√¢ncia entre 1 e 10 indiv√≠duos. A riqueza estimada pode variar conforme se aumente ou diminua o limiar de abund√¢ncia, e infelizmente n√£o existem crit√©rios biol√≥gicos definidos para a escolha do melhor intervalo.

$$ACE = S_{abund} + \frac{S_{rare}}{C_{ace}} + \frac{F_1}{C_{ace}}Y_{ace}^2$$

onde:

- $$Y_{ace}^2 = max \left[\frac{S_{rare}}{C_{ace}}\frac{\sum_{i=i}^{10}i(i-1)F1}{(N_{rare})({N_{rare} - 1)}}-1,0\right]$$

- $$C_{ace} = 1 - \frac{F1}{N_{rare}}$$

- $$N_{rare} = \sum_{i=1}^{10}iF_i$$

**Exemplo pr√°tico**

**Explica√ß√£o dos dados**

Usaremos os mesmos dados hipot√©ticos de 17 esp√©cies de anuros amostradas em 14 dias de coletas de campo em um habitat reprodutivo localizado na regi√£o Noroeste do Estado de S√£o Paulo, Brasil.

**An√°lise**

C√°lculo do estimador de riqueza - ACE.

```{r}
## An√°lise
est_ace <- estaccumR(dados_coleta, permutations = 100)
summary(est_ace, display = "ace")
```

Visualizar os resultados com intervalo de confian√ßa de 95% (Figura \@ref(fig:fig-ace)).

```{r fig-ace, fig.cap="Resultados com intervalo de confian√ßa de 95% para o estimador ACE."}
## Preparando os dados para fazer o gr√°fico
resultados_ace <- summary(est_ace, display = c("S", "ace"))
res_ace <- cbind(resultados_ace$ace[, 1:4], resultados_ace$S[, 2:4])
res_ace <- as.data.frame(res_ace)
colnames(res_ace) <- c("Amostras", "ACE", "ACE_inferior", "ACE_superior", 
                       "Riqueza", "R_inferior", "R_superior")

## Gr√°fico
ggplot(res_ace, aes(y = Riqueza, x = Amostras)) +
    geom_point(aes(y = ACE, x = Amostras + 0.1), size = 4, 
               color = "darkorange", alpha = 0.7) +
    geom_point(aes(y = Riqueza, x = Amostras), size = 4, 
               color = "cyan4", alpha = 0.7) +
    geom_point(y = 7.5, x = 9, size = 4, color = "darkorange", alpha = 0.7) + 
    geom_point(y = 5.9, x = 9, size = 4, color = "cyan4", alpha = 0.7) + 
    geom_label(y = 7.5, x = 11.7, label = "Riqueza estimada - ACE") +
    geom_label(y = 5.9, x = 11.3, label = "Riqueza observada") +
    geom_line(aes(y = ACE, x = Amostras), color = "darkorange") +
    geom_line(aes(y = Riqueza, x = Amostras), color = "cyan4") +
    geom_linerange(aes(ymin = ACE_inferior, ymax = ACE_superior, 
                       x = Amostras + 0.1), color = "darkorange") +
    geom_linerange(aes(ymin = R_inferior, ymax = R_superior,
                       x = Amostras), color = "cyan4") +
    scale_x_continuous(limits = c(1, 15), breaks = seq(1, 15, 1)) +
    labs(x = "N√∫mero de amostras", y = "Riqueza estimada - ACE") +
    tema_livro()
```

**Interpreta√ß√£o dos resultados**

Com base no n√∫mero de esp√©cies raras (abund√¢ncia menor que 10 indiv√≠duos - *default*), o estimador ACE indica a possibilidade de encontrarmos mais sete esp√©cies, caso o esfor√ßo amostral fosse maior e n√£o estimou tend√™ncia de estabiliza√ß√£o da curva em uma ass√≠ntota.

## Estimadores baseados na incid√™ncia das esp√©cies

### CHAO 2

De acordo com [Anne Chao](http://chao.stat.nthu.edu.tw/wordpress/), o estimador Chao 1 pode ser modificado para uso com dados de presen√ßa/aus√™ncia levando em conta a distribui√ß√£o das esp√©cies entre amostras [@chao1987]. Neste caso √© necess√°rio somente conhecer o n√∫mero de esp√©cies encontradas em somente uma amostra e o n√∫mero de esp√©cies encontradas exatamente em duas amostras. Essa varia√ß√£o ficou denominada como Chao 2.

$$Chao_{2} = S_{obs} + \left(\frac{m-1}{m}\right)\left(\frac{Q_1(Q_1-1)}{2(Q_2 + 1}\right)$$

onde:

-   S~obs~ = o n√∫mero de esp√©cies observada na comunidade
-   *m* = n√∫mero de amostras
-   Q~1~ = n√∫mero de esp√©cies observadas em uma amostra (esp√©cies *uniques*)
-   Q~2~ = n√∫mero de esp√©cies observadas em duas amostras (esp√©cies *duplicates*)

O valor de Chao2 √© m√°ximo quando as esp√©cies menos uma s√£o √∫nicas (*uniques*). Neste caso, a riqueza estimada √© aproximadamente o dobro da riqueza observada.

Colwell & Coddington [-@colwell1994] encontraram que o valor de Chao 2 mostrou ser o estimador menos enviesado para amostras com tamanho pequeno.

::: {.alert .alert-info}
<strong> üìù Importante </strong>\
Voc√™ perceber√° que ao longo do cap√≠tulo as recomenda√ß√µes sobre qual √© o melhor √≠ndice varia entre estudos [e.g. @palmer1990; @walther2005].
:::

**Exemplo pr√°tico**

**Explica√ß√£o dos dados**

Usaremos novamente os mesmos dados hipot√©ticos de 17 esp√©cies de anuros amostradas em 14 dias de coletas de campo em um habitat reprodutivo localizado na regi√£o Noroeste do Estado de S√£o Paulo, Brasil.

**An√°lise**

C√°lculo do estimador de riqueza - Chao 2.

```{r}
## An√°lise
est_chao2 <- poolaccum(dados_coleta, permutations = 100)
summary(est_chao2, display = "chao")
```

Visualizar os resultados com intervalo de confian√ßa de 95% (Figura \@ref(fig:fig-chao2)).

```{r fig-chao2, fig.cap="Resultados com intervalo de confian√ßa de 95% para o estimador Chao 2."}
## Preparando os dados para fazer o gr√°fico
resultados_chao2 <- summary(est_chao2, display = c("S", "chao"))
res_chao2 <- cbind(resultados_chao2$chao[, 1:4], resultados_chao2$S[, 2:4])
res_chao2 <- as.data.frame(res_chao2)
colnames(res_chao2) <- c("Amostras", "Chao2", "C_inferior", "C_superior",
                         "Riqueza", "R_inferior", "R_superior")

## Gr√°fico
ggplot(res_chao2, aes(y = Riqueza, x = Amostras)) +
    geom_point(aes(y = Chao2, x = Amostras + 0.1), size = 4, 
               color = "darkorange", alpha = 0.7) +
    geom_point(aes(y = Riqueza, x = Amostras), size = 4, 
               color = "cyan4", alpha = 0.7) +
    geom_point(y = 9.8, x = 10, size = 4, color = "darkorange", alpha = 0.7) + 
    geom_point(y = 7.7, x = 10, size = 4, color = "cyan4", alpha = 0.7) + 
    geom_label(y = 9.8, x = 12.95, label = "Riqueza estimada - Chao 2") +
    geom_label(y = 7.7, x = 12.3, label = "Riqueza observada") +
    geom_line(aes(y = Chao2, x = Amostras), color = "darkorange") +
    geom_line(aes(y = Riqueza, x = Amostras), color = "cyan4") +
    geom_linerange(aes(ymin = C_inferior, ymax = C_superior, 
                       x = Amostras + 0.1), color = "darkorange") +
    geom_linerange(aes(ymin = R_inferior, ymax = R_superior,
                       x = Amostras), color = "cyan4") +
    scale_x_continuous(limits = c(1, 15), breaks = seq(1, 15, 1)) +
    labs(x = "N√∫mero de amostras", y = "Riqueza estimada - Chao 2") +
    tema_livro()
```

**Interpreta√ß√£o dos resultados**

Com base no n√∫mero de esp√©cies raras (*uniques* e *duplicates*), o estimador Chao 2 encontrou a possibilidade de acharmos mais dezesseis esp√©cies, caso o esfor√ßo amostral fosse maior e n√£o estimou tend√™ncia de estabiliza√ß√£o da curva em uma ass√≠ntota.

### JACKKNIFE 1

Este estimador baseia-se no n√∫mero de esp√©cies que ocorrem em somente uma amostra (Q~1~) [@burnham1978; @burnham1979].

$$S_{jack1} = S_{obs} + Q_1\left(\frac{m - 1}{m}\right)$$

onde:

-   S~obs~ = o n√∫mero de esp√©cies observadas na comunidade
-   Q~1~ = n√∫mero de esp√©cies observadas em uma amostra (esp√©cies *uniques*)
-   *m* = n√∫mero de amostras

Jackknife √© um m√©todo de reamostragem (sem repeti√ß√£o) n√£o param√©trico usado para estimar a riqueza de esp√©cies e a vari√¢ncia associada com a estimativa. Para isso, o m√©todo: i) exclui uma amostra e contabiliza o valor da riqueza estimada usando a f√≥rmula acima, ii) repete este processo *n* vezes at√© que todas as amostras tenham sido exclu√≠das, e iii) estima a m√©dia e a vari√¢ncia da riqueza de esp√©cie [@smith1984].

Palmer [-@palmer1990] verificou que Jackknife 1 foi o estimador mais preciso e menos enviesado comparado a outros m√©todos de extrapola√ß√£o.

**Exemplo pr√°tico**

**Explica√ß√£o dos dados**

Usaremos os mesmos dados hipot√©ticos de 17 esp√©cies de anuros amostradas em 14 dias de coletas de campo em um habitat reprodutivo localizado na regi√£o Noroeste do Estado de S√£o Paulo, Brasil.

**An√°lise**

C√°lculo do estimador de riqueza - Jackknife 1.

```{r}
## An√°lise
est_jack1 <- poolaccum(dados_coleta, permutations = 100)
summary(est_jack1, display = "jack1")
```

Visualizar os resultados com 95% intervalo de confian√ßa (Figura \@ref(fig:fig-jack1)).

```{r fig-jack1, fig.cap="Resultados com intervalo de confian√ßa de 95% para o estimador Jackknife 1."}
## Preparando os dados para fazer o gr√°fico
resultados_jack1 <- summary(est_jack1, display = c("S", "jack1"))
res_jack1 <- cbind(resultados_jack1$jack1[, 1:4], resultados_jack1$S[, 2:4])
res_jack1 <- as.data.frame(res_jack1)
colnames(res_jack1) <- c("Amostras", "JACK1", "JACK1_inferior", "JACK1_superior", 
                         "Riqueza", "R_inferior", "R_superior")

## Gr√°fico
ggplot(res_jack1, aes(y = Riqueza, x = Amostras)) +
    geom_point(aes(y = JACK1, x = Amostras + 0.1), size = 4, 
               color = "darkorange", alpha = 0.7) +
    geom_point(aes(y = Riqueza, x = Amostras), size = 4, 
               color = "cyan4", alpha = 0.7) +
    geom_point(y = 9.9, x = 9, size = 4, color = "darkorange", alpha = 0.7) + 
    geom_point(y = 8.6, x = 9, size = 4, color = "cyan4", alpha = 0.7) + 
    geom_label(y = 9.9, x = 12.5, label = "Riqueza estimada - Jackknife 1") +
    geom_label(y = 8.6, x = 11.5, label = "Riqueza observada") +
    geom_line(aes(y = JACK1, x = Amostras), color = "darkorange") +
    geom_line(aes(y = Riqueza, x = Amostras), color = "cyan4") +
    geom_linerange(aes(ymin = JACK1_inferior, ymax = JACK1_superior, 
                       x = Amostras + 0.1), color = "darkorange") +
    geom_linerange(aes(ymin = R_inferior, ymax = R_superior, 
                       x = Amostras), color = "cyan4") +
    scale_x_continuous(limits = c(1, 15), breaks = seq(1, 15, 1)) +
    labs(x = "N√∫mero de amostras", y = "Riqueza estimada - Jackknife 1") +
    tema_livro()
```

**Interpreta√ß√£o dos resultados**

Com base no n√∫mero de esp√©cies raras, o estimador Jackknife 1 estimou possibilidade de encontrarmos mais seis esp√©cies, caso o esfor√ßo amostral fosse maior e n√£o estimou tend√™ncia de estabiliza√ß√£o da curva em uma ass√≠ntota.

### JACKKNIFE 2

Este m√©todo baseia-se no n√∫mero de esp√©cies que ocorrem em apenas uma amostra e no n√∫mero de esp√©cies que ocorrem em exatamente duas amostras  [@burnham1978; @burnham1979; @palmer1991].

$$S_{jack2} = S_{obs} + \left[\frac{Q_1(2m - 3)}{m}-\frac{Q_2(m - 2)^2}{m(m-1)}\right]$$

onde:

-   S~obs~ = o n√∫mero de esp√©cies observadas na comunidade
-   *m* = n√∫mero de amostras
-   Q~1~ = n√∫mero de esp√©cies observadas em uma amostra (esp√©cies *uniques*)
-   Q~2~ = n√∫mero de esp√©cies observadas em duas amostras (esp√©cies *duplicates*)

**Exemplo pr√°tico**

**Explica√ß√£o dos dados**

Usaremos os mesmos dados hipot√©ricos de 17 esp√©cies de anuros amostradas em 14 dias de coletas de campo em um habitat reprodutivo localizado na regi√£o Noroeste do Estado de S√£o Paulo, Brasil.

**An√°lise**

C√°lculo do estimador de riqueza - Jackknife 2.

```{r}
## An√°lise
est_jack2 <- poolaccum(dados_coleta, permutations = 100)
summary(est_jack2, display = "jack2")
```

Visualizar os resultados com intervalo de confian√ßa de 95% (Figura \@ref(fig:fig-jack2)).

```{r fig-jack2, fig.cap="Resultados com intervalo de confian√ßa de 95% para o estimador Jackknife 2."}
## Preparando os dados para fazer o gr√°fico
resultados_jack2 <- summary(est_jack2, display = c("S", "jack2"))
res_jack2 <- cbind(resultados_jack2$jack2[, 1:4], resultados_jack2$S[, 2:4])
res_jack2 <- as.data.frame(res_jack2)
colnames(res_jack2) <- c("Amostras", "JACK2", "JACK2_inferior", "JACK2_superior", 
                         "Riqueza", "R_inferior", "R_superior")

## Gr√°fico
ggplot(res_jack2, aes(y = Riqueza, x = Amostras)) +
    geom_point(aes(y = JACK2, x = Amostras + 0.1), size = 4, 
               color = "darkorange", alpha = 0.7) +
    geom_point(aes(y = Riqueza, x = Amostras), size = 4, 
               color = "cyan4", alpha = 0.7) +
    geom_point(y = 9.9, x = 9, size = 4, color = "darkorange", alpha = 0.7) + 
    geom_point(y = 8.2, x = 9, size = 4, color = "cyan4", alpha = 0.7) + 
    geom_label(y = 9.9, x = 12.5, label = "Riqueza estimada - Jackknife 2") +
    geom_label(y = 8.2, x = 11.5, label = "Riqueza observada") +
    geom_line(aes(y = JACK2, x = Amostras), color = "darkorange") +
    geom_line(aes(y = Riqueza, x = Amostras), color = "cyan4") +
    geom_linerange(aes(ymin = JACK2_inferior, ymax = JACK2_superior, 
                       x = Amostras + 0.1), color = "darkorange") +
    geom_linerange(aes(ymin = R_inferior, ymax = R_superior, 
                       x = Amostras), color = "cyan4") +
    scale_x_continuous(limits = c(1, 15), breaks = seq(1, 15, 1)) +
    labs(x = "N√∫mero de amostras", y = "Riqueza estimada - Jackknife 2") +
    tema_livro()
```

**Interpreta√ß√£o dos resultados**

Com base no n√∫mero de esp√©cies raras, o estimador Jackknife 2 estimou a possibilidade de encontrarmos mais dez esp√©cies, caso o esfor√ßo amostral fosse maior e n√£o estimou tend√™ncia estabiliza√ß√£o da curva em uma ass√≠ntota.

### BOOTSTRAP

Este m√©todo difere dos demais por utilizar dados de todas as esp√©cies coletadas para estimar a riqueza total, n√£o se restringindo √†s esp√©cies raras [@smith1984]. Ele requer somente dados de incid√™ncia. A estimativa pelo bootstrap √© calculada somando-se a riqueza observada √† soma do inverso da propor√ß√£o de amostras em que cada esp√©cie ocorre.

$$S_{boot} = S_{obs} + \sum_{k=1}^{S_{obs}}(1-P_k)^m$$

onde:

-   S~obs~ = o n√∫mero de esp√©cies observadas na comunidade
-   *m* = n√∫mero de amostragens
-   P~k~ = propor√ß√£o do n√∫mero de amostras em que cada esp√©cie foi registrada

Bootstrap √© um m√©todo n√£o param√©trico usado para estimar os par√¢metros de uma popula√ß√£o por reamostragem. A premissa √© que as reamostragens podem ser entendidas como pseudo-popula√ß√µes, com caracter√≠sticas similares as da popula√ß√£o original. Para isso, o m√©todo: i) seleciona ao acaso um conjunto de amostras (no nosso exemplo 14 amostras) **com reposi√ß√£o**, ii) repete este processo *n* vezes, e iii) estima a m√©dia e a vari√¢ncia da riqueza de esp√©cie [@smith1984].

**Exemplo pr√°tico**

**Explica√ß√£o dos dados**

Usaremos os mesmos dados hipot√©ricos de 17 esp√©cies de anuros amostradas em 14 dias de coletas de campo em um habitat reprodutivo localizado na regi√£o Noroeste do Estado de S√£o Paulo, Brasil.

**An√°lise**

C√°lculo do estimador de riqueza - Bootstrap.

```{r}
## An√°lise
est_boot <- poolaccum(dados_coleta, permutations = 100)
summary(est_boot, display = "boot")
```

Visualizar os resultados com intervalo de confian√ßa de 95% (Figura \@ref(fig:fig-boot)).

```{r fig-boot, fig.cap="Resultados com intervalo de confian√ßa de 95% para o estimador Bootstrap."}
## Preparando os dados para fazer o gr√°fico
resultados_boot <- summary(est_boot, display = c("S", "boot"))
res_boot <- cbind(resultados_boot$boot[,1:4], resultados_boot$S[,2:4])
res_boot <- as.data.frame(res_boot)
colnames(res_boot) <- c("Amostras", "BOOT", "BOOT_inferior", "BOOT_superior", 
                        "Riqueza", "R_inferior", "R_superior")

## Gr√°fico
ggplot(res_boot, aes(y = Riqueza, x = Amostras)) +
    geom_point(aes(y = BOOT, x = Amostras + 0.1), size = 4, 
               color = "darkorange", alpha = 0.7) +
    geom_point(aes(y = Riqueza, x = Amostras), size = 4, 
               color = "cyan4", alpha = 0.7) +
    geom_point(y = 10.4, x = 9, size = 4, color = "darkorange", alpha = 0.7) + 
    geom_point(y = 9.3, x = 9, size = 4, color = "cyan4", alpha = 0.7) + 
    geom_label(y = 10.4, x = 12.3, label = "Riqueza estimada - Bootstrap") +
    geom_label(y = 9.3, x = 11.5, label = "Riqueza observada") +
    geom_line(aes(y = BOOT, x = Amostras), color = "darkorange") +
    geom_line(aes(y = Riqueza, x = Amostras), color = "cyan4") +
    geom_linerange(aes(ymin = BOOT_inferior, ymax = BOOT_superior, 
                       x = Amostras + 0.1), color = "darkorange") +
    geom_linerange(aes(ymin = R_inferior, ymax = R_superior, 
                       x = Amostras), color = "cyan4") +
    scale_x_continuous(limits = c(1, 15), breaks = seq(1, 15, 1)) +
    labs(x = "N√∫mero de amostras", y = "Riqueza estimada - Bootstrap") +
    tema_livro()
```

**Interpreta√ß√£o dos resultados**

Com base na frequ√™ncia de ocorr√™ncia das esp√©cies, o estimador bootstrap estimou a possibilidade de encontrarmos mais duas esp√©cies, caso o esfor√ßo amostral fosse maior e n√£o estimou tend√™ncia de estabiliza√ß√£o da curva em uma ass√≠ntota.

## Interpola√ß√£o e extrapola√ß√£o baseadas em rarefa√ß√£o usando amostragens de incid√™ncia ou abund√¢ncia

Este m√©todo utiliza teoria de amostragem (e.g. modelos multinomial, Poisson e Bernoulli) para conectar rarefa√ß√£o (interpola√ß√£o) e predi√ß√£o (extrapola√ß√£o) com base no tamanho da amostra [@chao2012; @colwell2012]. Ele utiliza uma abordagem com bootstrap para calcular o intervalo de confian√ßa de 95%.

::: {.alert .alert-info}
<strong> üìù Importante </strong>\
A extrapola√ß√£o torna-se altamente incerta quando estendida para o dobro ou mais do tamanho da amostragem.
:::

**Exemplo pr√°tico 1**

**Explica√ß√£o dos dados**

Usaremos os mesmos dados hipot√©ticos de 17 esp√©cies de anuros amostradas em 14 dias de coletas de campo em um habitat reprodutivo localizado na regi√£o Noroeste do Estado de S√£o Paulo, Brasil.

**An√°lise**

C√°lculo da extrapola√ß√£o da riqueza com base no n√∫mero de indiv√≠duos (Figura \@ref(fig:fig-extra)).

```{r fig-extra, fig.cap="Resultados com intervalo de confian√ßa de 95% para a extrapola√ß√£o."}
## Preparando os dados para an√°lises considerando a abund√¢ncia
dados_inext_abu <- colSums(dados_coleta) 
resultados_abundancia <- iNEXT(dados_inext_abu, q = 0, datatype = "abundance", 
                               endpoint = 600)

## Gr√°fico
ggiNEXT(resultados_abundancia, type = 1) + 
    scale_linetype_discrete(labels = c("Interpolado", "Extrapolado")) +
    scale_colour_manual(values = "darkorange") +
    scale_fill_manual(values = "darkorange") +
    labs(x = "N√∫mero de indiv√≠duos", y = " Riqueza de esp√©cies") +
    tema_livro()
```

**Interpreta√ß√£o dos resultados**

Veja que o ponto no final da linha cont√≠nua representa as 17 esp√©cies de anuros (eixo Y) observadas entre os 304 individuos (eixo X). A extrapola√ß√£o m√°xima (600 indiv√≠duos no nosso exemplo) estima um aumento de at√© oito esp√©cies (intervalo de confian√ßa) caso amostr√°ssemos mais 296 indiv√≠duos.

C√°lculo da extrapola√ß√£o da riqueza com base no n√∫mero de amostras (Figura \@ref(fig:fig-boot-riq)).

```{r fig-boot-riq, fig.cap="Resultados com intervalo de confian√ßa de 95% para extrapola√ß√£o da riqueza."}
## Preparando os dados para an√°lises considerando a incid√™ncia
# Precisa transpor o data frame.
dados_inext <- as.incfreq(t(dados_coleta)) 
resultados_incidencia <- iNEXT(dados_inext, q = 0, datatype = "incidence_freq", 
                               endpoint = 28)

## Gr√°fico
ggiNEXT(resultados_incidencia, type = 1) +
    scale_linetype_discrete(labels = c("Interpolado", "Extrapolado")) +
    scale_colour_manual(values = "darkorange") +
    scale_fill_manual(values = "darkorange") +
    labs(x = "N√∫mero de amostras", y = " Riqueza de esp√©cies") +
    tema_livro()
```

**Interpreta√ß√£o dos resultados**

Veja que o ponto no final da linha cont√≠nua representa as 17 esp√©cies de anuros (eixo Y) observadas nos 14 dias de coleta (eixo X - amostras). A extrapola√ß√£o m√°xima (28 dias de coleta no nosso exemplo) estima um aumento de at√© 12 esp√©cies (intervalo de confian√ßa) caso amostr√°ssemos mais 14 dias.

**Exemplo pr√°tico 2**

**Explica√ß√£o dos dados**

Neste exemplo, iremos refazer o exemplo do Cap√≠tulo \@ref(cap7) que usa Generalized Least Squares (GLS) para testar a rela√ß√£o da riqueza de √°caros com a quantidade de √°gua no substrato. Contudo, ao inv√©s de considerar a riqueza de esp√©cies de √°caros observada como vari√°vel resposta, iremos utilizar a riqueza extrapolada. Os dados que usaremos est√£o dispon√≠veis no pacote `vegan` e representam a composi√ß√£o de esp√©cies de √°caros amostradas em 70 comunidades/amostras.

**Pergunta**

- A riqueza extrapolada de esp√©cies de √°caros √© maior em comunidades localizadas em √°reas com substratos secos?

**Predi√ß√µes**

- O n√∫mero de esp√©cies extrapolada ser√° maior em substratos secos uma vez que as limita√ß√µes fisiol√≥gicas impostas pela umidade limitam a ocorr√™ncia de v√°rias esp√©cies de √°caros

**Vari√°veis**

-   Vari√°veis resposta e preditoras

-   matriz ou data frame com as abund√¢ncias das esp√©cies de √°caros (vari√°vel resposta) registradas em 70 comunidades/amostras (vari√°vel preditora)

**Checklist**

-   Verificar se a sua matriz ou data frame est√£o com as esp√©cies nas linhas e as comunidades nas colunas

**An√°lise**

Vamos iniciar calculando a riqueza extrapolada com base na comunidade com maior abund√¢ncia.

```{r warning=FALSE, message=FALSE}
## Transposi√ß√£o
# Os dados est√£o com as comunidades nas colunas e as esp√©cies nas linhas. 
# Para as an√°lises teremos que transpor a planilha.
composicao_acaros <- t(mite)

## Dados
# A comunidade com maior abund√¢ncia tem 781 indiv√≠duos. 
max(colSums(composicao_acaros))

# Calcular a riqueza extrapolada de esp√©cies para todas as comunidades 
# considerando a maior abund√¢ncia. 
resultados_extrapolacao <- iNEXT(composicao_acaros, q = 0, 
                                 datatype = "abundance", 
                                 endpoint = 781)
```

Lembrando, estamos interessados no valor rarefeito considerando a abund√¢ncia total de 781 indiv√≠duos. Esta informa√ß√£o est√° armazenada na linha 40 e na coluna 4 dos data frames salvos no objeto `resultados_extrapolacao$iNextEst`. Assim, para obtermos o valor rarefeito de interesse, vamos criar um `loop for` para facilitar a extra√ß√£o da riqueza rarefeita para as 70 comunidades. 

```{r}
## Dados
# Criando um data.frame vazio para salvar os dados
resultados_comunidades_ext <- data.frame()

# Criando um vetor vazio para salvar os resultados
riqueza_extrapolada <- c()

## Lopp
# Loop repetindo as an√°lises para as 70 comunidades
# O objetivo √© extrair a riqueza estimada extrapolada para 781 individuos
for (i in 1:70){
    resultados_comunidades_ext <- data.frame(resultados_extrapolacao$iNextEst[i])
    riqueza_extrapolada[i] <- resultados_comunidades_ext[40, 4] # 8 abund√¢ncia e 4 riqueza rarefeita
}
```

Agora, seguindo os passos descritos no Cap√≠tulo \@ref(cap7), vamos identificar o melhor modelo que representa a estrutura espacial dos dados extrapolados.

```{r}
## Dados
# Criando data frame com todas as vari√°veis
dados_combinado_ext <- data.frame(riqueza_extrapolada, agua, coord)

## Modelo gls sem estrutura espacial
no_spat_gls <- gls(riqueza_extrapolada ~ agua, 
                   data = dados_combinado_ext, 
                   method = "REML")

## Covari√¢ncia esf√©rica
espher_model <- gls(riqueza_extrapolada ~ agua, 
                    data = dados_combinado_ext, 
                    corSpher(form = ~lat + long, nugget = TRUE))

## Covari√¢ncia exponencial
expon_model <- gls(riqueza_extrapolada ~ agua, 
                   data = dados_combinado_ext, 
                   corExp(form = ~lat + long, nugget = TRUE))

## Covari√¢ncia Gaussiana
gauss_model <- gls(riqueza_extrapolada ~ agua,
                   data = dados_combinado_ext, 
                   corGaus(form = ~lat + long, nugget = TRUE))

## Covari√¢ncia linear
cor_linear_model <- gls(riqueza_extrapolada ~ agua,
                        data = dados_combinado_ext,
                        corLin(form = ~lat + long, nugget = TRUE))

## Covari√¢ncia raz√£o quadr√°tica
ratio_model <- gls(riqueza_extrapolada ~ agua, 
                   data = dados_combinado_ext, 
                   corRatio(form = ~lat + long, nugget = TRUE))
```

Vamos usar a sele√ß√£o de modelos por o AIC para selecionar o modelo mais "prov√°vel" explicando a distribui√ß√£o da riqueza extrapolada das esp√©cies de √°caros (Figura \@ref(fig:fig-ext-resi-acaros)).

```{r fig-ext-resi-acaros, fig.cap="Visualiza√ß√£o dos res√≠duos do modelo selecionado."}
## Sele√ß√£o dos modelos
aic_fit_ext <- AIC(no_spat_gls, espher_model, 
                   cor_linear_model, expon_model, 
                   gauss_model, ratio_model)
aic_fit_ext %>% arrange(AIC)

## Visualizando os res√≠duos do modelo com menor valor de AIC (veja Cap√≠tulo 7)
plot(ratio_model)
```

De forma geral, a distribui√ß√£o dos res√≠duos est√° adequada com apenas dois pontos fugindo da nuvem. Contudo, eles podem influenciar os resultados (Figura \@ref(fig:fig-ext-model-acaros)).

```{r fig-ext-model-acaros, fig.cap="Gr√°fico do modelo GLS selecionado."}
## Visualizando os resultados e calculando pseudo-R-squared.
summary(ratio_model)$tTable 
rsquared(ratio_model)

## Gr√°fico
predito_ext <- predict(ratio_model) 

ggplot(data = dados_combinado_ext, aes(x= agua, y= riqueza_extrapolada)) + 
    geom_point(size = 4, shape = 21, fill = "darkorange", alpha = 0.7) +
    geom_line(aes(y = predito_ext), size = 1) +
    labs(x = "Concentra√ß√£o de √°gua no substrato", 
         y = "Riqueza extrapolada \ndas esp√©cies de √°caros") +
    tema_livro()
```

**Interpreta√ß√£o dos resultados**

A riqueza extrapolada das esp√©cies de √°caros foi maior em comunidades localizadas em √°reas com substratos secos do que em √°reas com substratos √∫midos. Contudo, apesar do modelo apresentar um rela√ß√£o significativa entre as vari√°veis, a concentra√ß√£o de √°gua explica apenas 5,9% da varia√ß√£o da riqueza extrapolada das esp√©cies de √°caros. O padr√£o observado, valor de P \< 0.05 e o baixo valor de R^2^, provavelmente est√° relacionado com as duas comunidades com altos valores de riqueza extapolada (e.g. *outilers*). Refa√ßa as an√°lises sem os dois pontos e vejam o padr√£o dos novos resultados.

## Para se aprofundar

### Livros

-   Recomendamos o livro *Biological Diversity Frontiers in Measurement and Assessment* [@magurran_biological_2011]

### Links

-   Recomendamos tamb√©m que acessem a p√°gina do [EstimateS software](http://viceroy.eeb.uconn.edu/estimates) e baixem o manual do usu√°rio que cont√©m informa√ß√µes detalhadas sobre os √≠ndices de rarefa√ß√£o e estimadores de riqueza. Este site foi criado e √© mantido pelo Dr. Robert K. Colwell, um dos maiores especialistas do mundo em estimativas da biodiversidade


## Exerc√≠cios

11.1 Carregue os dados - Cap11_exercicio1 - que est√° no pacote `ecodados`. Este conjunto de dados representa a abund√¢ncia de 50 esp√©cies de besouros coletados em 30 amostras. Calcule os estimadores de riqueza - Chao1 e ACE - e fa√ßa um gr√°fico contendo a riqueza observada e os dois estimadores de riqueza. Qual a sua interpreta√ß√£o sobre o esfor√ßo amostral?

11.2 Utilize o mesmo conjunto de dados do exerc√≠cio anterior. Calcule os estimadores de riqueza - Jackknife 1 e bootstrap. Fa√ßa um gr√°fico contendo a riqueza observada e os dois estimadores de riqueza. Qual a sua interpreta√ß√£o sobre o esfor√ßo amostral? Compare com os resultados do exerc√≠cio anterior que utilizam estimadores baseados na abund√¢ncia das esp√©cies. 

11.3 Vamos refazer o exerc√≠cio 10 do Cap√≠tulo 7 que usa Generalized Least Squares (GLS) para testar a rela√ß√£o da riqueza de anuros em 44 localidades na Mata Atl√¢ntica com a precipita√ß√£o anual. Contudo, ao inv√©s de considerar a riqueza de esp√©cies de anuros observada como vari√°vel resposta, iremos utilizar a riqueza extrapolada. Utilize os dados "anuros_composicao" para estimar a riqueza extrapolada e o dados "anuros_ambientais" para acessar os dados de precipita√ß√£o anual e coordenadas geogr√°ficas. Qual a sua interpreta√ß√£o dos resultados utilizando a riqueza observada e extrapolada? 

Voc√™ pode conferir as solu√ß√µes dos exerc√≠cios [aqui](https://exercicios-livro-aer.netlify.app/cap.-11---estimadores-de-riqueza.html).